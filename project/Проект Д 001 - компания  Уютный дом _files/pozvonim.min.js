// Build at Tue Nov 29 2016 14:27:50 GMT+0300 (MSK) 
(function (window, document) {
    var define = undefined;
    var module = undefined;
    var $j = wjq = (function (a, b) {
    var c = [], d = c.slice, e = c.concat, f = c.push, g = c.indexOf, h = {}, i = h.toString, j = h.hasOwnProperty, k = {}, l = "1.11.3", m = function (a, b) {
        return new m.fn.init(a, b)
    }, n = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, o = /^-ms-/, p = /-([\da-z])/gi, q = function (a, b) {
        return b.toUpperCase()
    };
    m.fn = m.prototype = {
        wjq: l, constructor: m, selector: "", length: 0, toArray: function () {
            return d.call(this)
        }, get: function (a) {
            return null != a ? 0 > a ? this[a + this.length] : this[a] : d.call(this)
        }, pushStack: function (a) {
            var b = m.merge(this.constructor(), a);
            return b.prevObject = this, b.context = this.context, b
        }, each: function (a, b) {
            return m.each(this, a, b)
        }, map: function (a) {
            return this.pushStack(m.map(this, function (b, c) {
                return a.call(b, c, b)
            }))
        }, slice: function () {
            return this.pushStack(d.apply(this, arguments))
        }, first: function () {
            return this.eq(0)
        }, last: function () {
            return this.eq(-1)
        }, eq: function (a) {
            var b = this.length, c = +a + (0 > a ? b : 0);
            return this.pushStack(c >= 0 && b > c ? [this[c]] : [])
        }, end: function () {
            return this.prevObject || this.constructor(null)
        }, push: f, sort: c.sort, splice: c.splice
    }, m.extend = m.fn.extend = function () {
        var a, b, c, d, e, f, g = arguments[0] || {}, h = 1, i = arguments.length, j = !1;
        for ("boolean" == typeof g && (j = g, g = arguments[h] || {}, h++), "object" == typeof g || m.isFunction(g) || (g = {}), h === i && (g = this, h--); i > h; h++)if (null != (e = arguments[h]))for (d in e)a = g[d], c = e[d], g !== c && (j && c && (m.isPlainObject(c) || (b = m.isArray(c))) ? (b ? (b = !1, f = a && m.isArray(a) ? a : []) : f = a && m.isPlainObject(a) ? a : {}, g[d] = m.extend(j, f, c)) : void 0 !== c && (g[d] = c));
        return g
    }, m.extend({
        expando: "wjq" + (l + Math.random()).replace(/\D/g, ""), isReady: !0, error: function (a) {
            throw new Error(a)
        }, noop: function () {
        }, isFunction: function (a) {
            return "function" === m.type(a)
        }, isArray: Array.isArray || function (a) {
            return "array" === m.type(a)
        }, isWindow: function (a) {
            return null != a && a == a.window
        }, isNumeric: function (a) {
            return !m.isArray(a) && a - parseFloat(a) + 1 >= 0
        }, isEmptyObject: function (a) {
            var b;
            for (b in a)return !1;
            return !0
        }, isPlainObject: function (a) {
            var b;
            if (!a || "object" !== m.type(a) || a.nodeType || m.isWindow(a))return !1;
            try {
                if (a.constructor && !j.call(a, "constructor") && !j.call(a.constructor.prototype, "isPrototypeOf"))return !1
            } catch (c) {
                return !1
            }
            if (k.ownLast)for (b in a)return j.call(a, b);
            for (b in a);
            return void 0 === b || j.call(a, b)
        }, type: function (a) {
            return null == a ? a + "" : "object" == typeof a || "function" == typeof a ? h[i.call(a)] || "object" : typeof a
        }, globalEval: function (b) {
            b && m.trim(b) && (a.execScript || function (b) {
                a.eval.call(a, b)
            })(b)
        }, camelCase: function (a) {
            return a.replace(o, "ms-").replace(p, q)
        }, nodeName: function (a, b) {
            return a.nodeName && a.nodeName.toLowerCase() === b.toLowerCase()
        }, each: function (a, b, c) {
            var d, e = 0, f = a.length, g = r(a);
            if (c) {
                if (g) {
                    for (; f > e; e++)if (d = b.apply(a[e], c), d === !1)break
                } else for (e in a)if (d = b.apply(a[e], c), d === !1)break
            } else if (g) {
                for (; f > e; e++)if (d = b.call(a[e], e, a[e]), d === !1)break
            } else for (e in a)if (d = b.call(a[e], e, a[e]), d === !1)break;
            return a
        }, trim: function (a) {
            return null == a ? "" : (a + "").replace(n, "")
        }, makeArray: function (a, b) {
            var c = b || [];
            return null != a && (r(Object(a)) ? m.merge(c, "string" == typeof a ? [a] : a) : f.call(c, a)), c
        }, inArray: function (a, b, c) {
            var d;
            if (b) {
                if (g)return g.call(b, a, c);
                for (d = b.length, c = c ? 0 > c ? Math.max(0, d + c) : c : 0; d > c; c++)if (c in b && b[c] === a)return c
            }
            return -1
        }, merge: function (a, b) {
            var c = +b.length, d = 0, e = a.length;
            while (c > d)a[e++] = b[d++];
            if (c !== c)while (void 0 !== b[d])a[e++] = b[d++];
            return a.length = e, a
        }, grep: function (a, b, c) {
            for (var d, e = [], f = 0, g = a.length, h = !c; g > f; f++)d = !b(a[f], f), d !== h && e.push(a[f]);
            return e
        }, map: function (a, b, c) {
            var d, f = 0, g = a.length, h = r(a), i = [];
            if (h)for (; g > f; f++)d = b(a[f], f, c), null != d && i.push(d); else for (f in a)d = b(a[f], f, c), null != d && i.push(d);
            return e.apply([], i)
        }, guid: 1, proxy: function (a, b) {
            var c, e, f;
            return "string" == typeof b && (f = a[b], b = a, a = f), m.isFunction(a) ? (c = d.call(arguments, 2), e = function () {
                return a.apply(b || this, c.concat(d.call(arguments)))
            }, e.guid = a.guid = a.guid || m.guid++, e) : void 0
        }, now: function () {
            return +new Date
        }, support: k
    }), m.each("Boolean Number String Function Array Date RegExp Object Error".split(" "), function (a, b) {
        h["[object " + b + "]"] = b.toLowerCase()
    });
    function r(a) {
        var b = "length" in a && a.length, c = m.type(a);
        return "function" === c || m.isWindow(a) ? !1 : 1 === a.nodeType && b ? !0 : "array" === c || 0 === b || "number" == typeof b && b > 0 && b - 1 in a
    }

    var s = function (a) {
        var b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u = "sizzle" + 1 * new Date, v = a.document, w = 0, x = 0, y = ha(), z = ha(), A = ha(), B = function (a, b) {
            return a === b && (l = !0), 0
        }, C = 1 << 31, D = {}.hasOwnProperty, E = [], F = E.pop, G = E.push, H = E.push, I = E.slice, J = function (a, b) {
            for (var c = 0, d = a.length; d > c; c++)if (a[c] === b)return c;
            return -1
        }, K = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped", L = "[\\x20\\t\\r\\n\\f]", M = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+", N = M.replace("w", "w#"), O = "\\[" + L + "*(" + M + ")(?:" + L + "*([*^$|!~]?=)" + L + "*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|(" + N + "))|)" + L + "*\\]", P = ":(" + M + ")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|" + O + ")*)|.*)\\)|)", Q = new RegExp(L + "+", "g"), R = new RegExp("^" + L + "+|((?:^|[^\\\\])(?:\\\\.)*)" + L + "+$", "g"), S = new RegExp("^" + L + "*," + L + "*"), T = new RegExp("^" + L + "*([>+~]|" + L + ")" + L + "*"), U = new RegExp("=" + L + "*([^\\]'\"]*?)" + L + "*\\]", "g"), V = new RegExp(P), W = new RegExp("^" + N + "$"), X = {
            ID: new RegExp("^#(" + M + ")"),
            CLASS: new RegExp("^\\.(" + M + ")"),
            TAG: new RegExp("^(" + M.replace("w", "w*") + ")"),
            ATTR: new RegExp("^" + O),
            PSEUDO: new RegExp("^" + P),
            CHILD: new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + L + "*(even|odd|(([+-]|)(\\d*)n|)" + L + "*(?:([+-]|)" + L + "*(\\d+)|))" + L + "*\\)|)", "i"),
            bool: new RegExp("^(?:" + K + ")$", "i"),
            needsContext: new RegExp("^" + L + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + L + "*((?:-\\d)?\\d*)" + L + "*\\)|)(?=[^-]|$)", "i")
        }, Y = /^(?:input|select|textarea|button)$/i, Z = /^h\d$/i, $ = /^[^{]+\{\s*\[native \w/, _ = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/, aa = /[+~]/, ba = /'|\\/g, ca = new RegExp("\\\\([\\da-f]{1,6}" + L + "?|(" + L + ")|.)", "ig"), da = function (a, b, c) {
            var d = "0x" + b - 65536;
            return d !== d || c ? b : 0 > d ? String.fromCharCode(d + 65536) : String.fromCharCode(d >> 10 | 55296, 1023 & d | 56320)
        }, ea = function () {
            m()
        };
        try {
            H.apply(E = I.call(v.childNodes), v.childNodes), E[v.childNodes.length].nodeType
        } catch (fa) {
            H = {
                apply: E.length ? function (a, b) {
                    G.apply(a, I.call(b))
                } : function (a, b) {
                    var c = a.length, d = 0;
                    while (a[c++] = b[d++]);
                    a.length = c - 1
                }
            }
        }
        function ga(a, b, d, e) {
            var f, h, j, k, l, o, r, s, w, x;
            if ((b ? b.ownerDocument || b : v) !== n && m(b), b = b || n, d = d || [], k = b.nodeType, "string" != typeof a || !a || 1 !== k && 9 !== k && 11 !== k)return d;
            if (!e && p) {
                if (11 !== k && (f = _.exec(a)))if (j = f[1]) {
                    if (9 === k) {
                        if (h = b.getElementById(j), !h || !h.parentNode)return d;
                        if (h.id === j)return d.push(h), d
                    } else if (b.ownerDocument && (h = b.ownerDocument.getElementById(j)) && t(b, h) && h.id === j)return d.push(h), d
                } else {
                    if (f[2])return H.apply(d, b.getElementsByTagName(a)), d;
                    if ((j = f[3]) && c.getElementsByClassName)return H.apply(d, b.getElementsByClassName(j)), d
                }
                if (c.qsa && (!q || !q.test(a))) {
                    if (s = r = u, w = b, x = 1 !== k && a, 1 === k && "object" !== b.nodeName.toLowerCase()) {
                        o = g(a), (r = b.getAttribute("id")) ? s = r.replace(ba, "\\$&") : b.setAttribute("id", s), s = "[id='" + s + "'] ", l = o.length;
                        while (l--)o[l] = s + ra(o[l]);
                        w = aa.test(a) && pa(b.parentNode) || b, x = o.join(",")
                    }
                    if (x)try {
                        return H.apply(d, w.querySelectorAll(x)), d
                    } catch (y) {
                    } finally {
                        r || b.removeAttribute("id")
                    }
                }
            }
            return i(a.replace(R, "$1"), b, d, e)
        }

        function ha() {
            var a = [];

            function b(c, e) {
                return a.push(c + " ") > d.cacheLength && delete b[a.shift()], b[c + " "] = e
            }

            return b
        }

        function ia(a) {
            return a[u] = !0, a
        }

        function ja(a) {
            var b = n.createElement("div");
            try {
                return !!a(b)
            } catch (c) {
                return !1
            } finally {
                b.parentNode && b.parentNode.removeChild(b), b = null
            }
        }

        function ka(a, b) {
            var c = a.split("|"), e = a.length;
            while (e--)d.attrHandle[c[e]] = b
        }

        function la(a, b) {
            var c = b && a, d = c && 1 === a.nodeType && 1 === b.nodeType && (~b.sourceIndex || C) - (~a.sourceIndex || C);
            if (d)return d;
            if (c)while (c = c.nextSibling)if (c === b)return -1;
            return a ? 1 : -1
        }

        function ma(a) {
            return function (b) {
                var c = b.nodeName.toLowerCase();
                return "input" === c && b.type === a
            }
        }

        function na(a) {
            return function (b) {
                var c = b.nodeName.toLowerCase();
                return ("input" === c || "button" === c) && b.type === a
            }
        }

        function oa(a) {
            return ia(function (b) {
                return b = +b, ia(function (c, d) {
                    var e, f = a([], c.length, b), g = f.length;
                    while (g--)c[e = f[g]] && (c[e] = !(d[e] = c[e]))
                })
            })
        }

        function pa(a) {
            return a && "undefined" != typeof a.getElementsByTagName && a
        }

        c = ga.support = {}, f = ga.isXML = function (a) {
            var b = a && (a.ownerDocument || a).documentElement;
            return b ? "HTML" !== b.nodeName : !1
        }, m = ga.setDocument = function (a) {
            var b, e, g = a ? a.ownerDocument || a : v;
            return g !== n && 9 === g.nodeType && g.documentElement ? (n = g, o = g.documentElement, e = g.defaultView, e && e !== e.top && (e.addEventListener ? e.addEventListener("unload", ea, !1) : e.attachEvent && e.attachEvent("onunload", ea)), p = !f(g), c.attributes = ja(function (a) {
                return a.className = "i", !a.getAttribute("className")
            }), c.getElementsByTagName = ja(function (a) {
                return a.appendChild(g.createComment("")), !a.getElementsByTagName("*").length
            }), c.getElementsByClassName = $.test(g.getElementsByClassName), c.getById = ja(function (a) {
                return o.appendChild(a).id = u, !g.getElementsByName || !g.getElementsByName(u).length
            }), c.getById ? (d.find.ID = function (a, b) {
                if ("undefined" != typeof b.getElementById && p) {
                    var c = b.getElementById(a);
                    return c && c.parentNode ? [c] : []
                }
            }, d.filter.ID = function (a) {
                var b = a.replace(ca, da);
                return function (a) {
                    return a.getAttribute("id") === b
                }
            }) : (delete d.find.ID, d.filter.ID = function (a) {
                var b = a.replace(ca, da);
                return function (a) {
                    var c = "undefined" != typeof a.getAttributeNode && a.getAttributeNode("id");
                    return c && c.value === b
                }
            }), d.find.TAG = c.getElementsByTagName ? function (a, b) {
                return "undefined" != typeof b.getElementsByTagName ? b.getElementsByTagName(a) : c.qsa ? b.querySelectorAll(a) : void 0
            } : function (a, b) {
                var c, d = [], e = 0, f = b.getElementsByTagName(a);
                if ("*" === a) {
                    while (c = f[e++])1 === c.nodeType && d.push(c);
                    return d
                }
                return f
            }, d.find.CLASS = c.getElementsByClassName && function (a, b) {
                    return p ? b.getElementsByClassName(a) : void 0
                }, r = [], q = [], (c.qsa = $.test(g.querySelectorAll)) && (ja(function (a) {
                o.appendChild(a).innerHTML = "<a id='" + u + "'></a><select id='" + u + "-\f]' msallowcapture=''><option selected=''></option></select>", a.querySelectorAll("[msallowcapture^='']").length && q.push("[*^$]=" + L + "*(?:''|\"\")"), a.querySelectorAll("[selected]").length || q.push("\\[" + L + "*(?:value|" + K + ")"), a.querySelectorAll("[id~=" + u + "-]").length || q.push("~="), a.querySelectorAll(":checked").length || q.push(":checked"), a.querySelectorAll("a#" + u + "+*").length || q.push(".#.+[+~]")
            }), ja(function (a) {
                var b = g.createElement("input");
                b.setAttribute("type", "hidden"), a.appendChild(b).setAttribute("name", "D"), a.querySelectorAll("[name=d]").length && q.push("name" + L + "*[*^$|!~]?="), a.querySelectorAll(":enabled").length || q.push(":enabled", ":disabled"), a.querySelectorAll("*,:x"), q.push(",.*:")
            })), (c.matchesSelector = $.test(s = o.matches || o.webkitMatchesSelector || o.mozMatchesSelector || o.oMatchesSelector || o.msMatchesSelector)) && ja(function (a) {
                c.disconnectedMatch = s.call(a, "div"), s.call(a, "[s!='']:x"), r.push("!=", P)
            }), q = q.length && new RegExp(q.join("|")), r = r.length && new RegExp(r.join("|")), b = $.test(o.compareDocumentPosition), t = b || $.test(o.contains) ? function (a, b) {
                var c = 9 === a.nodeType ? a.documentElement : a, d = b && b.parentNode;
                return a === d || !(!d || 1 !== d.nodeType || !(c.contains ? c.contains(d) : a.compareDocumentPosition && 16 & a.compareDocumentPosition(d)))
            } : function (a, b) {
                if (b)while (b = b.parentNode)if (b === a)return !0;
                return !1
            }, B = b ? function (a, b) {
                if (a === b)return l = !0, 0;
                var d = !a.compareDocumentPosition - !b.compareDocumentPosition;
                return d ? d : (d = (a.ownerDocument || a) === (b.ownerDocument || b) ? a.compareDocumentPosition(b) : 1, 1 & d || !c.sortDetached && b.compareDocumentPosition(a) === d ? a === g || a.ownerDocument === v && t(v, a) ? -1 : b === g || b.ownerDocument === v && t(v, b) ? 1 : k ? J(k, a) - J(k, b) : 0 : 4 & d ? -1 : 1)
            } : function (a, b) {
                if (a === b)return l = !0, 0;
                var c, d = 0, e = a.parentNode, f = b.parentNode, h = [a], i = [b];
                if (!e || !f)return a === g ? -1 : b === g ? 1 : e ? -1 : f ? 1 : k ? J(k, a) - J(k, b) : 0;
                if (e === f)return la(a, b);
                c = a;
                while (c = c.parentNode)h.unshift(c);
                c = b;
                while (c = c.parentNode)i.unshift(c);
                while (h[d] === i[d])d++;
                return d ? la(h[d], i[d]) : h[d] === v ? -1 : i[d] === v ? 1 : 0
            }, g) : n
        }, ga.matches = function (a, b) {
            return ga(a, null, null, b)
        }, ga.matchesSelector = function (a, b) {
            if ((a.ownerDocument || a) !== n && m(a), b = b.replace(U, "='$1']"), !(!c.matchesSelector || !p || r && r.test(b) || q && q.test(b)))try {
                var d = s.call(a, b);
                if (d || c.disconnectedMatch || a.document && 11 !== a.document.nodeType)return d
            } catch (e) {
            }
            return ga(b, n, null, [a]).length > 0
        }, ga.contains = function (a, b) {
            return (a.ownerDocument || a) !== n && m(a), t(a, b)
        }, ga.attr = function (a, b) {
            (a.ownerDocument || a) !== n && m(a);
            var e = d.attrHandle[b.toLowerCase()], f = e && D.call(d.attrHandle, b.toLowerCase()) ? e(a, b, !p) : void 0;
            return void 0 !== f ? f : c.attributes || !p ? a.getAttribute(b) : (f = a.getAttributeNode(b)) && f.specified ? f.value : null
        }, ga.error = function (a) {
            throw new Error("Syntax error, unrecognized expression: " + a)
        }, ga.uniqueSort = function (a) {
            var b, d = [], e = 0, f = 0;
            if (l = !c.detectDuplicates, k = !c.sortStable && a.slice(0), a.sort(B), l) {
                while (b = a[f++])b === a[f] && (e = d.push(f));
                while (e--)a.splice(d[e], 1)
            }
            return k = null, a
        }, e = ga.getText = function (a) {
            var b, c = "", d = 0, f = a.nodeType;
            if (f) {
                if (1 === f || 9 === f || 11 === f) {
                    if ("string" == typeof a.textContent)return a.textContent;
                    for (a = a.firstChild; a; a = a.nextSibling)c += e(a)
                } else if (3 === f || 4 === f)return a.nodeValue
            } else while (b = a[d++])c += e(b);
            return c
        }, d = ga.selectors = {
            cacheLength: 50,
            createPseudo: ia,
            match: X,
            attrHandle: {},
            find: {},
            relative: {
                ">": {dir: "parentNode", first: !0},
                " ": {dir: "parentNode"},
                "+": {dir: "previousSibling", first: !0},
                "~": {dir: "previousSibling"}
            },
            preFilter: {
                ATTR: function (a) {
                    return a[1] = a[1].replace(ca, da), a[3] = (a[3] || a[4] || a[5] || "").replace(ca, da), "~=" === a[2] && (a[3] = " " + a[3] + " "), a.slice(0, 4)
                }, CHILD: function (a) {
                    return a[1] = a[1].toLowerCase(), "nth" === a[1].slice(0, 3) ? (a[3] || ga.error(a[0]), a[4] = +(a[4] ? a[5] + (a[6] || 1) : 2 * ("even" === a[3] || "odd" === a[3])), a[5] = +(a[7] + a[8] || "odd" === a[3])) : a[3] && ga.error(a[0]), a
                }, PSEUDO: function (a) {
                    var b, c = !a[6] && a[2];
                    return X.CHILD.test(a[0]) ? null : (a[3] ? a[2] = a[4] || a[5] || "" : c && V.test(c) && (b = g(c, !0)) && (b = c.indexOf(")", c.length - b) - c.length) && (a[0] = a[0].slice(0, b), a[2] = c.slice(0, b)), a.slice(0, 3))
                }
            },
            filter: {
                TAG: function (a) {
                    var b = a.replace(ca, da).toLowerCase();
                    return "*" === a ? function () {
                        return !0
                    } : function (a) {
                        return a.nodeName && a.nodeName.toLowerCase() === b
                    }
                }, CLASS: function (a) {
                    var b = y[a + " "];
                    return b || (b = new RegExp("(^|" + L + ")" + a + "(" + L + "|$)")) && y(a, function (a) {
                            return b.test("string" == typeof a.className && a.className || "undefined" != typeof a.getAttribute && a.getAttribute("class") || "")
                        })
                }, ATTR: function (a, b, c) {
                    return function (d) {
                        var e = ga.attr(d, a);
                        return null == e ? "!=" === b : b ? (e += "", "=" === b ? e === c : "!=" === b ? e !== c : "^=" === b ? c && 0 === e.indexOf(c) : "*=" === b ? c && e.indexOf(c) > -1 : "$=" === b ? c && e.slice(-c.length) === c : "~=" === b ? (" " + e.replace(Q, " ") + " ").indexOf(c) > -1 : "|=" === b ? e === c || e.slice(0, c.length + 1) === c + "-" : !1) : !0
                    }
                }, CHILD: function (a, b, c, d, e) {
                    var f = "nth" !== a.slice(0, 3), g = "last" !== a.slice(-4), h = "of-type" === b;
                    return 1 === d && 0 === e ? function (a) {
                        return !!a.parentNode
                    } : function (b, c, i) {
                        var j, k, l, m, n, o, p = f !== g ? "nextSibling" : "previousSibling", q = b.parentNode, r = h && b.nodeName.toLowerCase(), s = !i && !h;
                        if (q) {
                            if (f) {
                                while (p) {
                                    l = b;
                                    while (l = l[p])if (h ? l.nodeName.toLowerCase() === r : 1 === l.nodeType)return !1;
                                    o = p = "only" === a && !o && "nextSibling"
                                }
                                return !0
                            }
                            if (o = [g ? q.firstChild : q.lastChild], g && s) {
                                k = q[u] || (q[u] = {}), j = k[a] || [], n = j[0] === w && j[1], m = j[0] === w && j[2], l = n && q.childNodes[n];
                                while (l = ++n && l && l[p] || (m = n = 0) || o.pop())if (1 === l.nodeType && ++m && l === b) {
                                    k[a] = [w, n, m];
                                    break
                                }
                            } else if (s && (j = (b[u] || (b[u] = {}))[a]) && j[0] === w)m = j[1]; else while (l = ++n && l && l[p] || (m = n = 0) || o.pop())if ((h ? l.nodeName.toLowerCase() === r : 1 === l.nodeType) && ++m && (s && ((l[u] || (l[u] = {}))[a] = [w, m]), l === b))break;
                            return m -= e, m === d || m % d === 0 && m / d >= 0
                        }
                    }
                }, PSEUDO: function (a, b) {
                    var c, e = d.pseudos[a] || d.setFilters[a.toLowerCase()] || ga.error("unsupported pseudo: " + a);
                    return e[u] ? e(b) : e.length > 1 ? (c = [a, a, "", b], d.setFilters.hasOwnProperty(a.toLowerCase()) ? ia(function (a, c) {
                        var d, f = e(a, b), g = f.length;
                        while (g--)d = J(a, f[g]), a[d] = !(c[d] = f[g])
                    }) : function (a) {
                        return e(a, 0, c)
                    }) : e
                }
            },
            pseudos: {
                not: ia(function (a) {
                    var b = [], c = [], d = h(a.replace(R, "$1"));
                    return d[u] ? ia(function (a, b, c, e) {
                        var f, g = d(a, null, e, []), h = a.length;
                        while (h--)(f = g[h]) && (a[h] = !(b[h] = f))
                    }) : function (a, e, f) {
                        return b[0] = a, d(b, null, f, c), b[0] = null, !c.pop()
                    }
                }), has: ia(function (a) {
                    return function (b) {
                        return ga(a, b).length > 0
                    }
                }), contains: ia(function (a) {
                    return a = a.replace(ca, da), function (b) {
                        return (b.textContent || b.innerText || e(b)).indexOf(a) > -1
                    }
                }), lang: ia(function (a) {
                    return W.test(a || "") || ga.error("unsupported lang: " + a), a = a.replace(ca, da).toLowerCase(), function (b) {
                        var c;
                        do if (c = p ? b.lang : b.getAttribute("xml:lang") || b.getAttribute("lang"))return c = c.toLowerCase(), c === a || 0 === c.indexOf(a + "-"); while ((b = b.parentNode) && 1 === b.nodeType);
                        return !1
                    }
                }), target: function (b) {
                    var c = a.location && a.location.hash;
                    return c && c.slice(1) === b.id
                }, root: function (a) {
                    return a === o
                }, focus: function (a) {
                    return a === n.activeElement && (!n.hasFocus || n.hasFocus()) && !!(a.type || a.href || ~a.tabIndex)
                }, enabled: function (a) {
                    return a.disabled === !1
                }, disabled: function (a) {
                    return a.disabled === !0
                }, checked: function (a) {
                    var b = a.nodeName.toLowerCase();
                    return "input" === b && !!a.checked || "option" === b && !!a.selected
                }, selected: function (a) {
                    return a.parentNode && a.parentNode.selectedIndex, a.selected === !0
                }, empty: function (a) {
                    for (a = a.firstChild; a; a = a.nextSibling)if (a.nodeType < 6)return !1;
                    return !0
                }, parent: function (a) {
                    return !d.pseudos.empty(a)
                }, header: function (a) {
                    return Z.test(a.nodeName)
                }, input: function (a) {
                    return Y.test(a.nodeName)
                }, button: function (a) {
                    var b = a.nodeName.toLowerCase();
                    return "input" === b && "button" === a.type || "button" === b
                }, text: function (a) {
                    var b;
                    return "input" === a.nodeName.toLowerCase() && "text" === a.type && (null == (b = a.getAttribute("type")) || "text" === b.toLowerCase())
                }, first: oa(function () {
                    return [0]
                }), last: oa(function (a, b) {
                    return [b - 1]
                }), eq: oa(function (a, b, c) {
                    return [0 > c ? c + b : c]
                }), even: oa(function (a, b) {
                    for (var c = 0; b > c; c += 2)a.push(c);
                    return a
                }), odd: oa(function (a, b) {
                    for (var c = 1; b > c; c += 2)a.push(c);
                    return a
                }), lt: oa(function (a, b, c) {
                    for (var d = 0 > c ? c + b : c; --d >= 0;)a.push(d);
                    return a
                }), gt: oa(function (a, b, c) {
                    for (var d = 0 > c ? c + b : c; ++d < b;)a.push(d);
                    return a
                })
            }
        }, d.pseudos.nth = d.pseudos.eq;
        for (b in{radio: !0, checkbox: !0, file: !0, password: !0, image: !0})d.pseudos[b] = ma(b);
        for (b in{submit: !0, reset: !0})d.pseudos[b] = na(b);
        function qa() {
        }

        qa.prototype = d.filters = d.pseudos, d.setFilters = new qa, g = ga.tokenize = function (a, b) {
            var c, e, f, g, h, i, j, k = z[a + " "];
            if (k)return b ? 0 : k.slice(0);
            h = a, i = [], j = d.preFilter;
            while (h) {
                (!c || (e = S.exec(h))) && (e && (h = h.slice(e[0].length) || h), i.push(f = [])), c = !1, (e = T.exec(h)) && (c = e.shift(), f.push({
                    value: c,
                    type: e[0].replace(R, " ")
                }), h = h.slice(c.length));
                for (g in d.filter)!(e = X[g].exec(h)) || j[g] && !(e = j[g](e)) || (c = e.shift(), f.push({
                    value: c,
                    type: g,
                    matches: e
                }), h = h.slice(c.length));
                if (!c)break
            }
            return b ? h.length : h ? ga.error(a) : z(a, i).slice(0)
        };
        function ra(a) {
            for (var b = 0, c = a.length, d = ""; c > b; b++)d += a[b].value;
            return d
        }

        function sa(a, b, c) {
            var d = b.dir, e = c && "parentNode" === d, f = x++;
            return b.first ? function (b, c, f) {
                while (b = b[d])if (1 === b.nodeType || e)return a(b, c, f)
            } : function (b, c, g) {
                var h, i, j = [w, f];
                if (g) {
                    while (b = b[d])if ((1 === b.nodeType || e) && a(b, c, g))return !0
                } else while (b = b[d])if (1 === b.nodeType || e) {
                    if (i = b[u] || (b[u] = {}), (h = i[d]) && h[0] === w && h[1] === f)return j[2] = h[2];
                    if (i[d] = j, j[2] = a(b, c, g))return !0
                }
            }
        }

        function ta(a) {
            return a.length > 1 ? function (b, c, d) {
                var e = a.length;
                while (e--)if (!a[e](b, c, d))return !1;
                return !0
            } : a[0]
        }

        function ua(a, b, c) {
            for (var d = 0, e = b.length; e > d; d++)ga(a, b[d], c);
            return c
        }

        function va(a, b, c, d, e) {
            for (var f, g = [], h = 0, i = a.length, j = null != b; i > h; h++)(f = a[h]) && (!c || c(f, d, e)) && (g.push(f), j && b.push(h));
            return g
        }

        function wa(a, b, c, d, e, f) {
            return d && !d[u] && (d = wa(d)), e && !e[u] && (e = wa(e, f)), ia(function (f, g, h, i) {
                var j, k, l, m = [], n = [], o = g.length, p = f || ua(b || "*", h.nodeType ? [h] : h, []), q = !a || !f && b ? p : va(p, m, a, h, i), r = c ? e || (f ? a : o || d) ? [] : g : q;
                if (c && c(q, r, h, i), d) {
                    j = va(r, n), d(j, [], h, i), k = j.length;
                    while (k--)(l = j[k]) && (r[n[k]] = !(q[n[k]] = l))
                }
                if (f) {
                    if (e || a) {
                        if (e) {
                            j = [], k = r.length;
                            while (k--)(l = r[k]) && j.push(q[k] = l);
                            e(null, r = [], j, i)
                        }
                        k = r.length;
                        while (k--)(l = r[k]) && (j = e ? J(f, l) : m[k]) > -1 && (f[j] = !(g[j] = l))
                    }
                } else r = va(r === g ? r.splice(o, r.length) : r), e ? e(null, g, r, i) : H.apply(g, r)
            })
        }

        function xa(a) {
            for (var b, c, e, f = a.length, g = d.relative[a[0].type], h = g || d.relative[" "], i = g ? 1 : 0, k = sa(function (a) {
                return a === b
            }, h, !0), l = sa(function (a) {
                return J(b, a) > -1
            }, h, !0), m = [function (a, c, d) {
                var e = !g && (d || c !== j) || ((b = c).nodeType ? k(a, c, d) : l(a, c, d));
                return b = null, e
            }]; f > i; i++)if (c = d.relative[a[i].type])m = [sa(ta(m), c)]; else {
                if (c = d.filter[a[i].type].apply(null, a[i].matches), c[u]) {
                    for (e = ++i; f > e; e++)if (d.relative[a[e].type])break;
                    return wa(i > 1 && ta(m), i > 1 && ra(a.slice(0, i - 1).concat({value: " " === a[i - 2].type ? "*" : ""})).replace(R, "$1"), c, e > i && xa(a.slice(i, e)), f > e && xa(a = a.slice(e)), f > e && ra(a))
                }
                m.push(c)
            }
            return ta(m)
        }

        function ya(a, b) {
            var c = b.length > 0, e = a.length > 0, f = function (f, g, h, i, k) {
                var l, m, o, p = 0, q = "0", r = f && [], s = [], t = j, u = f || e && d.find.TAG("*", k), v = w += null == t ? 1 : Math.random() || .1, x = u.length;
                for (k && (j = g !== n && g); q !== x && null != (l = u[q]); q++) {
                    if (e && l) {
                        m = 0;
                        while (o = a[m++])if (o(l, g, h)) {
                            i.push(l);
                            break
                        }
                        k && (w = v)
                    }
                    c && ((l = !o && l) && p--, f && r.push(l))
                }
                if (p += q, c && q !== p) {
                    m = 0;
                    while (o = b[m++])o(r, s, g, h);
                    if (f) {
                        if (p > 0)while (q--)r[q] || s[q] || (s[q] = F.call(i));
                        s = va(s)
                    }
                    H.apply(i, s), k && !f && s.length > 0 && p + b.length > 1 && ga.uniqueSort(i)
                }
                return k && (w = v, j = t), r
            };
            return c ? ia(f) : f
        }

        return h = ga.compile = function (a, b) {
            var c, d = [], e = [], f = A[a + " "];
            if (!f) {
                b || (b = g(a)), c = b.length;
                while (c--)f = xa(b[c]), f[u] ? d.push(f) : e.push(f);
                f = A(a, ya(e, d)), f.selector = a
            }
            return f
        }, i = ga.select = function (a, b, e, f) {
            var i, j, k, l, m, n = "function" == typeof a && a, o = !f && g(a = n.selector || a);
            if (e = e || [], 1 === o.length) {
                if (j = o[0] = o[0].slice(0), j.length > 2 && "ID" === (k = j[0]).type && c.getById && 9 === b.nodeType && p && d.relative[j[1].type]) {
                    if (b = (d.find.ID(k.matches[0].replace(ca, da), b) || [])[0], !b)return e;
                    n && (b = b.parentNode), a = a.slice(j.shift().value.length)
                }
                i = X.needsContext.test(a) ? 0 : j.length;
                while (i--) {
                    if (k = j[i], d.relative[l = k.type])break;
                    if ((m = d.find[l]) && (f = m(k.matches[0].replace(ca, da), aa.test(j[0].type) && pa(b.parentNode) || b))) {
                        if (j.splice(i, 1), a = f.length && ra(j), !a)return H.apply(e, f), e;
                        break
                    }
                }
            }
            return (n || h(a, o))(f, b, !p, e, aa.test(a) && pa(b.parentNode) || b), e
        }, c.sortStable = u.split("").sort(B).join("") === u, c.detectDuplicates = !!l, m(), c.sortDetached = ja(function (a) {
            return 1 & a.compareDocumentPosition(n.createElement("div"))
        }), ja(function (a) {
            return a.innerHTML = "<a href='#'></a>", "#" === a.firstChild.getAttribute("href")
        }) || ka("type|href|height|width", function (a, b, c) {
            return c ? void 0 : a.getAttribute(b, "type" === b.toLowerCase() ? 1 : 2)
        }), c.attributes && ja(function (a) {
            return a.innerHTML = "<input/>", a.firstChild.setAttribute("value", ""), "" === a.firstChild.getAttribute("value")
        }) || ka("value", function (a, b, c) {
            return c || "input" !== a.nodeName.toLowerCase() ? void 0 : a.defaultValue
        }), ja(function (a) {
            return null == a.getAttribute("disabled")
        }) || ka(K, function (a, b, c) {
            var d;
            return c ? void 0 : a[b] === !0 ? b.toLowerCase() : (d = a.getAttributeNode(b)) && d.specified ? d.value : null
        }), ga
    }(a);
    m.find = s, m.expr = s.selectors, m.expr[":"] = m.expr.pseudos, m.unique = s.uniqueSort, m.text = s.getText, m.isXMLDoc = s.isXML, m.contains = s.contains;
    var t = m.expr.match.needsContext, u = /^<(\w+)\s*\/?>(?:<\/\1>|)$/, v = /^.[^:#\[\.,]*$/;

    function w(a, b, c) {
        if (m.isFunction(b))return m.grep(a, function (a, d) {
            return !!b.call(a, d, a) !== c
        });
        if (b.nodeType)return m.grep(a, function (a) {
            return a === b !== c
        });
        if ("string" == typeof b) {
            if (v.test(b))return m.filter(b, a, c);
            b = m.filter(b, a)
        }
        return m.grep(a, function (a) {
            return m.inArray(a, b) >= 0 !== c
        })
    }

    m.filter = function (a, b, c) {
        var d = b[0];
        return c && (a = ":not(" + a + ")"), 1 === b.length && 1 === d.nodeType ? m.find.matchesSelector(d, a) ? [d] : [] : m.find.matches(a, m.grep(b, function (a) {
            return 1 === a.nodeType
        }))
    }, m.fn.extend({
        find: function (a) {
            var b, c = [], d = this, e = d.length;
            if ("string" != typeof a)return this.pushStack(m(a).filter(function () {
                for (b = 0; e > b; b++)if (m.contains(d[b], this))return !0
            }));
            for (b = 0; e > b; b++)m.find(a, d[b], c);
            return c = this.pushStack(e > 1 ? m.unique(c) : c), c.selector = this.selector ? this.selector + " " + a : a, c
        }, filter: function (a) {
            return this.pushStack(w(this, a || [], !1))
        }, not: function (a) {
            return this.pushStack(w(this, a || [], !0))
        }, is: function (a) {
            return !!w(this, "string" == typeof a && t.test(a) ? m(a) : a || [], !1).length
        }
    });
    var x, y = a.document, z = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/, A = m.fn.init = function (a, b) {
        var c, d;
        if (!a)return this;
        if ("string" == typeof a) {
            if (c = "<" === a.charAt(0) && ">" === a.charAt(a.length - 1) && a.length >= 3 ? [null, a, null] : z.exec(a), !c || !c[1] && b)return !b || b.wjq ? (b || x).find(a) : this.constructor(b).find(a);
            if (c[1]) {
                if (b = b instanceof m ? b[0] : b, m.merge(this, m.parseHTML(c[1], b && b.nodeType ? b.ownerDocument || b : y, !0)), u.test(c[1]) && m.isPlainObject(b))for (c in b)m.isFunction(this[c]) ? this[c](b[c]) : this.attr(c, b[c]);
                return this
            }
            if (d = y.getElementById(c[2]), d && d.parentNode) {
                if (d.id !== c[2])return x.find(a);
                this.length = 1, this[0] = d
            }
            return this.context = y, this.selector = a, this
        }
        return a.nodeType ? (this.context = this[0] = a, this.length = 1, this) : m.isFunction(a) ? "undefined" != typeof x.ready ? x.ready(a) : a(m) : (void 0 !== a.selector && (this.selector = a.selector, this.context = a.context), m.makeArray(a, this))
    };
    A.prototype = m.fn, x = m(y);
    var B = /^(?:parents|prev(?:Until|All))/, C = {children: !0, contents: !0, next: !0, prev: !0};
    m.extend({
        dir: function (a, b, c) {
            var d = [], e = a[b];
            while (e && 9 !== e.nodeType && (void 0 === c || 1 !== e.nodeType || !m(e).is(c)))1 === e.nodeType && d.push(e), e = e[b];
            return d
        }, sibling: function (a, b) {
            for (var c = []; a; a = a.nextSibling)1 === a.nodeType && a !== b && c.push(a);
            return c
        }
    }), m.fn.extend({
        has: function (a) {
            var b, c = m(a, this), d = c.length;
            return this.filter(function () {
                for (b = 0; d > b; b++)if (m.contains(this, c[b]))return !0
            })
        }, closest: function (a, b) {
            for (var c, d = 0, e = this.length, f = [], g = t.test(a) || "string" != typeof a ? m(a, b || this.context) : 0; e > d; d++)for (c = this[d]; c && c !== b; c = c.parentNode)if (c.nodeType < 11 && (g ? g.index(c) > -1 : 1 === c.nodeType && m.find.matchesSelector(c, a))) {
                f.push(c);
                break
            }
            return this.pushStack(f.length > 1 ? m.unique(f) : f)
        }, index: function (a) {
            return a ? "string" == typeof a ? m.inArray(this[0], m(a)) : m.inArray(a.wjq ? a[0] : a, this) : this[0] && this[0].parentNode ? this.first().prevAll().length : -1
        }, add: function (a, b) {
            return this.pushStack(m.unique(m.merge(this.get(), m(a, b))))
        }, addBack: function (a) {
            return this.add(null == a ? this.prevObject : this.prevObject.filter(a))
        }
    });
    function D(a, b) {
        do a = a[b]; while (a && 1 !== a.nodeType);
        return a
    }

    m.each({
        parent: function (a) {
            var b = a.parentNode;
            return b && 11 !== b.nodeType ? b : null
        }, parents: function (a) {
            return m.dir(a, "parentNode")
        }, parentsUntil: function (a, b, c) {
            return m.dir(a, "parentNode", c)
        }, next: function (a) {
            return D(a, "nextSibling")
        }, prev: function (a) {
            return D(a, "previousSibling")
        }, nextAll: function (a) {
            return m.dir(a, "nextSibling")
        }, prevAll: function (a) {
            return m.dir(a, "previousSibling")
        }, nextUntil: function (a, b, c) {
            return m.dir(a, "nextSibling", c)
        }, prevUntil: function (a, b, c) {
            return m.dir(a, "previousSibling", c)
        }, siblings: function (a) {
            return m.sibling((a.parentNode || {}).firstChild, a)
        }, children: function (a) {
            return m.sibling(a.firstChild)
        }, contents: function (a) {
            return m.nodeName(a, "iframe") ? a.contentDocument || a.contentWindow.document : m.merge([], a.childNodes)
        }
    }, function (a, b) {
        m.fn[a] = function (c, d) {
            var e = m.map(this, b, c);
            return "Until" !== a.slice(-5) && (d = c), d && "string" == typeof d && (e = m.filter(d, e)), this.length > 1 && (C[a] || (e = m.unique(e)), B.test(a) && (e = e.reverse())), this.pushStack(e)
        }
    });
    var E = /\S+/g, F = {};

    function G(a) {
        var b = F[a] = {};
        return m.each(a.match(E) || [], function (a, c) {
            b[c] = !0
        }), b
    }

    m.Callbacks = function (a) {
        a = "string" == typeof a ? F[a] || G(a) : m.extend({}, a);
        var b, c, d, e, f, g, h = [], i = !a.once && [], j = function (l) {
            for (c = a.memory && l, d = !0, f = g || 0, g = 0, e = h.length, b = !0; h && e > f; f++)if (h[f].apply(l[0], l[1]) === !1 && a.stopOnFalse) {
                c = !1;
                break
            }
            b = !1, h && (i ? i.length && j(i.shift()) : c ? h = [] : k.disable())
        }, k = {
            add: function () {
                if (h) {
                    var d = h.length;
                    !function f(b) {
                        m.each(b, function (b, c) {
                            var d = m.type(c);
                            "function" === d ? a.unique && k.has(c) || h.push(c) : c && c.length && "string" !== d && f(c)
                        })
                    }(arguments), b ? e = h.length : c && (g = d, j(c))
                }
                return this
            }, remove: function () {
                return h && m.each(arguments, function (a, c) {
                    var d;
                    while ((d = m.inArray(c, h, d)) > -1)h.splice(d, 1), b && (e >= d && e--, f >= d && f--)
                }), this
            }, has: function (a) {
                return a ? m.inArray(a, h) > -1 : !(!h || !h.length)
            }, empty: function () {
                return h = [], e = 0, this
            }, disable: function () {
                return h = i = c = void 0, this
            }, disabled: function () {
                return !h
            }, lock: function () {
                return i = void 0, c || k.disable(), this
            }, locked: function () {
                return !i
            }, fireWith: function (a, c) {
                return !h || d && !i || (c = c || [], c = [a, c.slice ? c.slice() : c], b ? i.push(c) : j(c)), this
            }, fire: function () {
                return k.fireWith(this, arguments), this
            }, fired: function () {
                return !!d
            }
        };
        return k
    }, m.extend({
        Deferred: function (a) {
            var b = [["resolve", "done", m.Callbacks("once memory"), "resolved"], ["reject", "fail", m.Callbacks("once memory"), "rejected"], ["notify", "progress", m.Callbacks("memory")]], c = "pending", d = {
                state: function () {
                    return c
                }, always: function () {
                    return e.done(arguments).fail(arguments), this
                }, then: function () {
                    var a = arguments;
                    return m.Deferred(function (c) {
                        m.each(b, function (b, f) {
                            var g = m.isFunction(a[b]) && a[b];
                            e[f[1]](function () {
                                var a = g && g.apply(this, arguments);
                                a && m.isFunction(a.promise) ? a.promise().done(c.resolve).fail(c.reject).progress(c.notify) : c[f[0] + "With"](this === d ? c.promise() : this, g ? [a] : arguments)
                            })
                        }), a = null
                    }).promise()
                }, promise: function (a) {
                    return null != a ? m.extend(a, d) : d
                }
            }, e = {};
            return d.pipe = d.then, m.each(b, function (a, f) {
                var g = f[2], h = f[3];
                d[f[1]] = g.add, h && g.add(function () {
                    c = h
                }, b[1 ^ a][2].disable, b[2][2].lock), e[f[0]] = function () {
                    return e[f[0] + "With"](this === e ? d : this, arguments), this
                }, e[f[0] + "With"] = g.fireWith
            }), d.promise(e), a && a.call(e, e), e
        }, when: function (a) {
            var b = 0, c = d.call(arguments), e = c.length, f = 1 !== e || a && m.isFunction(a.promise) ? e : 0, g = 1 === f ? a : m.Deferred(), h = function (a, b, c) {
                return function (e) {
                    b[a] = this, c[a] = arguments.length > 1 ? d.call(arguments) : e, c === i ? g.notifyWith(b, c) : --f || g.resolveWith(b, c)
                }
            }, i, j, k;
            if (e > 1)for (i = new Array(e), j = new Array(e), k = new Array(e); e > b; b++)c[b] && m.isFunction(c[b].promise) ? c[b].promise().done(h(b, k, c)).fail(g.reject).progress(h(b, j, i)) : --f;
            return f || g.resolveWith(k, c), g.promise()
        }
    });
    var H;
    m.fn.ready = function (a) {
        return m.ready.promise().done(a), this
    }, m.extend({
        isReady: !1, readyWait: 1, holdReady: function (a) {
            a ? m.readyWait++ : m.ready(!0)
        }, ready: function (a) {
            if (a === !0 ? !--m.readyWait : !m.isReady) {
                if (!y.body)return setTimeout(m.ready);
                m.isReady = !0, a !== !0 && --m.readyWait > 0 || (H.resolveWith(y, [m]), m.fn.triggerHandler && (m(y).triggerHandler("ready"), m(y).off("ready")))
            }
        }
    });
    function I() {
        y.addEventListener ? (y.removeEventListener("DOMContentLoaded", J, !1), a.removeEventListener("load", J, !1)) : (y.detachEvent("onreadystatechange", J), a.detachEvent("onload", J))
    }

    function J() {
        (y.addEventListener || "load" === event.type || "complete" === y.readyState) && (I(), m.ready())
    }

    m.ready.promise = function (b) {
        if (!H)if (H = m.Deferred(), "complete" === y.readyState)setTimeout(m.ready); else if (y.addEventListener)y.addEventListener("DOMContentLoaded", J, !1), a.addEventListener("load", J, !1); else {
            y.attachEvent("onreadystatechange", J), a.attachEvent("onload", J);
            var c = !1;
            try {
                c = null == a.frameElement && y.documentElement
            } catch (d) {
            }
            c && c.doScroll && !function e() {
                if (!m.isReady) {
                    try {
                        c.doScroll("left")
                    } catch (a) {
                        return setTimeout(e, 50)
                    }
                    I(), m.ready()
                }
            }()
        }
        return H.promise(b)
    };
    var K = "undefined", L;
    for (L in m(k))break;
    k.ownLast = "0" !== L, k.inlineBlockNeedsLayout = !1, m(function () {
        var a, b, c, d;
        c = y.getElementsByTagName("body")[0], c && c.style && (b = y.createElement("div"), d = y.createElement("div"), d.style.cssText = "position:absolute;border:0;width:0;height:0;top:0;left:-9999px", c.appendChild(d).appendChild(b), typeof b.style.zoom !== K && (b.style.cssText = "display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1", k.inlineBlockNeedsLayout = a = 3 === b.offsetWidth, a && (c.style.zoom = 1)), c.removeChild(d))
    }), function () {
        var a = y.createElement("div");
        if (null == k.deleteExpando) {
            k.deleteExpando = !0;
            try {
                delete a.test
            } catch (b) {
                k.deleteExpando = !1
            }
        }
        a = null
    }(), m.acceptData = function (a) {
        var b = m.noData[(a.nodeName + " ").toLowerCase()], c = +a.nodeType || 1;
        return 1 !== c && 9 !== c ? !1 : !b || b !== !0 && a.getAttribute("classid") === b
    };
    var M = /^(?:\{[\w\W]*\}|\[[\w\W]*\])$/, N = /([A-Z])/g;

    function O(a, b, c) {
        if (void 0 === c && 1 === a.nodeType) {
            var d = "data-" + b.replace(N, "-$1").toLowerCase();
            if (c = a.getAttribute(d), "string" == typeof c) {
                try {
                    c = "true" === c ? !0 : "false" === c ? !1 : "null" === c ? null : +c + "" === c ? +c : M.test(c) ? m.parseJSON(c) : c
                } catch (e) {
                }
                m.data(a, b, c)
            } else c = void 0
        }
        return c
    }

    function P(a) {
        var b;
        for (b in a)if (("data" !== b || !m.isEmptyObject(a[b])) && "toJSON" !== b)return !1;

        return !0
    }

    function Q(a, b, d, e) {
        if (m.acceptData(a)) {
            var f, g, h = m.expando, i = a.nodeType, j = i ? m.cache : a, k = i ? a[h] : a[h] && h;
            if (k && j[k] && (e || j[k].data) || void 0 !== d || "string" != typeof b)return k || (k = i ? a[h] = c.pop() || m.guid++ : h), j[k] || (j[k] = i ? {} : {toJSON: m.noop}), ("object" == typeof b || "function" == typeof b) && (e ? j[k] = m.extend(j[k], b) : j[k].data = m.extend(j[k].data, b)), g = j[k], e || (g.data || (g.data = {}), g = g.data), void 0 !== d && (g[m.camelCase(b)] = d), "string" == typeof b ? (f = g[b], null == f && (f = g[m.camelCase(b)])) : f = g, f
        }
    }

    function R(a, b, c) {
        if (m.acceptData(a)) {
            var d, e, f = a.nodeType, g = f ? m.cache : a, h = f ? a[m.expando] : m.expando;
            if (g[h]) {
                if (b && (d = c ? g[h] : g[h].data)) {
                    m.isArray(b) ? b = b.concat(m.map(b, m.camelCase)) : b in d ? b = [b] : (b = m.camelCase(b), b = b in d ? [b] : b.split(" ")), e = b.length;
                    while (e--)delete d[b[e]];
                    if (c ? !P(d) : !m.isEmptyObject(d))return
                }
                (c || (delete g[h].data, P(g[h]))) && (f ? m.cleanData([a], !0) : k.deleteExpando || g != g.window ? delete g[h] : g[h] = null)
            }
        }
    }

    m.extend({
        cache: {},
        noData: {"applet ": !0, "embed ": !0, "object ": "clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},
        hasData: function (a) {
            return a = a.nodeType ? m.cache[a[m.expando]] : a[m.expando], !!a && !P(a)
        },
        data: function (a, b, c) {
            return Q(a, b, c)
        },
        removeData: function (a, b) {
            return R(a, b)
        },
        _data: function (a, b, c) {
            return Q(a, b, c, !0)
        },
        _removeData: function (a, b) {
            return R(a, b, !0)
        }
    }), m.fn.extend({
        data: function (a, b) {
            var c, d, e, f = this[0], g = f && f.attributes;
            if (void 0 === a) {
                if (this.length && (e = m.data(f), 1 === f.nodeType && !m._data(f, "parsedAttrs"))) {
                    c = g.length;
                    while (c--)g[c] && (d = g[c].name, 0 === d.indexOf("data-") && (d = m.camelCase(d.slice(5)), O(f, d, e[d])));
                    m._data(f, "parsedAttrs", !0)
                }
                return e
            }
            return "object" == typeof a ? this.each(function () {
                m.data(this, a)
            }) : arguments.length > 1 ? this.each(function () {
                m.data(this, a, b)
            }) : f ? O(f, a, m.data(f, a)) : void 0
        }, removeData: function (a) {
            return this.each(function () {
                m.removeData(this, a)
            })
        }
    }), m.extend({
        queue: function (a, b, c) {
            var d;
            return a ? (b = (b || "fx") + "queue", d = m._data(a, b), c && (!d || m.isArray(c) ? d = m._data(a, b, m.makeArray(c)) : d.push(c)), d || []) : void 0
        }, dequeue: function (a, b) {
            b = b || "fx";
            var c = m.queue(a, b), d = c.length, e = c.shift(), f = m._queueHooks(a, b), g = function () {
                m.dequeue(a, b)
            };
            "inprogress" === e && (e = c.shift(), d--), e && ("fx" === b && c.unshift("inprogress"), delete f.stop, e.call(a, g, f)), !d && f && f.empty.fire()
        }, _queueHooks: function (a, b) {
            var c = b + "queueHooks";
            return m._data(a, c) || m._data(a, c, {
                    empty: m.Callbacks("once memory").add(function () {
                        m._removeData(a, b + "queue"), m._removeData(a, c)
                    })
                })
        }
    }), m.fn.extend({
        queue: function (a, b) {
            var c = 2;
            return "string" != typeof a && (b = a, a = "fx", c--), arguments.length < c ? m.queue(this[0], a) : void 0 === b ? this : this.each(function () {
                var c = m.queue(this, a, b);
                m._queueHooks(this, a), "fx" === a && "inprogress" !== c[0] && m.dequeue(this, a)
            })
        }, dequeue: function (a) {
            return this.each(function () {
                m.dequeue(this, a)
            })
        }, clearQueue: function (a) {
            return this.queue(a || "fx", [])
        }, promise: function (a, b) {
            var c, d = 1, e = m.Deferred(), f = this, g = this.length, h = function () {
                --d || e.resolveWith(f, [f])
            };
            "string" != typeof a && (b = a, a = void 0), a = a || "fx";
            while (g--)c = m._data(f[g], a + "queueHooks"), c && c.empty && (d++, c.empty.add(h));
            return h(), e.promise(b)
        }
    });
    var S = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source, T = ["Top", "Right", "Bottom", "Left"], U = function (a, b) {
        return a = b || a, "none" === m.css(a, "display") || !m.contains(a.ownerDocument, a)
    }, V = m.access = function (a, b, c, d, e, f, g) {
        var h = 0, i = a.length, j = null == c;
        if ("object" === m.type(c)) {
            e = !0;
            for (h in c)m.access(a, b, h, c[h], !0, f, g)
        } else if (void 0 !== d && (e = !0, m.isFunction(d) || (g = !0), j && (g ? (b.call(a, d), b = null) : (j = b, b = function (a, b, c) {
                return j.call(m(a), c)
            })), b))for (; i > h; h++)b(a[h], c, g ? d : d.call(a[h], h, b(a[h], c)));
        return e ? a : j ? b.call(a) : i ? b(a[0], c) : f
    }, W = /^(?:checkbox|radio)$/i;
    !function () {
        var a = y.createElement("input"), b = y.createElement("div"), c = y.createDocumentFragment();
        if (b.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>", k.leadingWhitespace = 3 === b.firstChild.nodeType, k.tbody = !b.getElementsByTagName("tbody").length, k.htmlSerialize = !!b.getElementsByTagName("link").length, k.html5Clone = "<:nav></:nav>" !== y.createElement("nav").cloneNode(!0).outerHTML, a.type = "checkbox", a.checked = !0, c.appendChild(a), k.appendChecked = a.checked, b.innerHTML = "<textarea>x</textarea>", k.noCloneChecked = !!b.cloneNode(!0).lastChild.defaultValue, c.appendChild(b), b.innerHTML = "<input type='radio' checked='checked' name='t'/>", k.checkClone = b.cloneNode(!0).cloneNode(!0).lastChild.checked, k.noCloneEvent = !0, b.attachEvent && (b.attachEvent("onclick", function () {
                k.noCloneEvent = !1
            }), b.cloneNode(!0).click()), null == k.deleteExpando) {
            k.deleteExpando = !0;
            try {
                delete b.test
            } catch (d) {
                k.deleteExpando = !1
            }
        }
    }(), function () {
        var b, c, d = y.createElement("div");
        for (b in{
            submit: !0,
            change: !0,
            focusin: !0
        })c = "on" + b, (k[b + "Bubbles"] = c in a) || (d.setAttribute(c, "t"), k[b + "Bubbles"] = d.attributes[c].expando === !1);
        d = null
    }();
    var X = /^(?:input|select|textarea)$/i, Y = /^key/, Z = /^(?:mouse|pointer|contextmenu)|click/, $ = /^(?:focusinfocus|focusoutblur)$/, _ = /^([^.]*)(?:\.(.+)|)$/;

    function aa() {
        return !0
    }

    function ba() {
        return !1
    }

    function ca() {
        try {
            return y.activeElement
        } catch (a) {
        }
    }

    m.event = {
        global: {},
        add: function (a, b, c, d, e) {
            var f, g, h, i, j, k, l, n, o, p, q, r = m._data(a);
            if (r) {
                c.handler && (i = c, c = i.handler, e = i.selector), c.guid || (c.guid = m.guid++), (g = r.events) || (g = r.events = {}), (k = r.handle) || (k = r.handle = function (a) {
                    return typeof m === K || a && m.event.triggered === a.type ? void 0 : m.event.dispatch.apply(k.elem, arguments)
                }, k.elem = a), b = (b || "").match(E) || [""], h = b.length;
                while (h--)f = _.exec(b[h]) || [], o = q = f[1], p = (f[2] || "").split(".").sort(), o && (j = m.event.special[o] || {}, o = (e ? j.delegateType : j.bindType) || o, j = m.event.special[o] || {}, l = m.extend({
                    type: o,
                    origType: q,
                    data: d,
                    handler: c,
                    guid: c.guid,
                    selector: e,
                    needsContext: e && m.expr.match.needsContext.test(e),
                    namespace: p.join(".")
                }, i), (n = g[o]) || (n = g[o] = [], n.delegateCount = 0, j.setup && j.setup.call(a, d, p, k) !== !1 || (a.addEventListener ? a.addEventListener(o, k, !1) : a.attachEvent && a.attachEvent("on" + o, k))), j.add && (j.add.call(a, l), l.handler.guid || (l.handler.guid = c.guid)), e ? n.splice(n.delegateCount++, 0, l) : n.push(l), m.event.global[o] = !0);
                a = null
            }
        },
        remove: function (a, b, c, d, e) {
            var f, g, h, i, j, k, l, n, o, p, q, r = m.hasData(a) && m._data(a);
            if (r && (k = r.events)) {
                b = (b || "").match(E) || [""], j = b.length;
                while (j--)if (h = _.exec(b[j]) || [], o = q = h[1], p = (h[2] || "").split(".").sort(), o) {
                    l = m.event.special[o] || {}, o = (d ? l.delegateType : l.bindType) || o, n = k[o] || [], h = h[2] && new RegExp("(^|\\.)" + p.join("\\.(?:.*\\.|)") + "(\\.|$)"), i = f = n.length;
                    while (f--)g = n[f], !e && q !== g.origType || c && c.guid !== g.guid || h && !h.test(g.namespace) || d && d !== g.selector && ("**" !== d || !g.selector) || (n.splice(f, 1), g.selector && n.delegateCount--, l.remove && l.remove.call(a, g));
                    i && !n.length && (l.teardown && l.teardown.call(a, p, r.handle) !== !1 || m.removeEvent(a, o, r.handle), delete k[o])
                } else for (o in k)m.event.remove(a, o + b[j], c, d, !0);
                m.isEmptyObject(k) && (delete r.handle, m._removeData(a, "events"))
            }
        },
        trigger: function (b, c, d, e) {
            var f, g, h, i, k, l, n, o = [d || y], p = j.call(b, "type") ? b.type : b, q = j.call(b, "namespace") ? b.namespace.split(".") : [];
            if (h = l = d = d || y, 3 !== d.nodeType && 8 !== d.nodeType && !$.test(p + m.event.triggered) && (p.indexOf(".") >= 0 && (q = p.split("."), p = q.shift(), q.sort()), g = p.indexOf(":") < 0 && "on" + p, b = b[m.expando] ? b : new m.Event(p, "object" == typeof b && b), b.isTrigger = e ? 2 : 3, b.namespace = q.join("."), b.namespace_re = b.namespace ? new RegExp("(^|\\.)" + q.join("\\.(?:.*\\.|)") + "(\\.|$)") : null, b.result = void 0, b.target || (b.target = d), c = null == c ? [b] : m.makeArray(c, [b]), k = m.event.special[p] || {}, e || !k.trigger || k.trigger.apply(d, c) !== !1)) {
                if (!e && !k.noBubble && !m.isWindow(d)) {
                    for (i = k.delegateType || p, $.test(i + p) || (h = h.parentNode); h; h = h.parentNode)o.push(h), l = h;
                    l === (d.ownerDocument || y) && o.push(l.defaultView || l.parentWindow || a)
                }
                n = 0;
                while ((h = o[n++]) && !b.isPropagationStopped())b.type = n > 1 ? i : k.bindType || p, f = (m._data(h, "events") || {})[b.type] && m._data(h, "handle"), f && f.apply(h, c), f = g && h[g], f && f.apply && m.acceptData(h) && (b.result = f.apply(h, c), b.result === !1 && b.preventDefault());
                if (b.type = p, !e && !b.isDefaultPrevented() && (!k._default || k._default.apply(o.pop(), c) === !1) && m.acceptData(d) && g && d[p] && !m.isWindow(d)) {
                    l = d[g], l && (d[g] = null), m.event.triggered = p;
                    try {
                        d[p]()
                    } catch (r) {
                    }
                    m.event.triggered = void 0, l && (d[g] = l)
                }
                return b.result
            }
        },
        dispatch: function (a) {
            a = m.event.fix(a);
            var b, c, e, f, g, h = [], i = d.call(arguments), j = (m._data(this, "events") || {})[a.type] || [], k = m.event.special[a.type] || {};
            if (i[0] = a, a.delegateTarget = this, !k.preDispatch || k.preDispatch.call(this, a) !== !1) {
                h = m.event.handlers.call(this, a, j), b = 0;
                while ((f = h[b++]) && !a.isPropagationStopped()) {
                    a.currentTarget = f.elem, g = 0;
                    while ((e = f.handlers[g++]) && !a.isImmediatePropagationStopped())(!a.namespace_re || a.namespace_re.test(e.namespace)) && (a.handleObj = e, a.data = e.data, c = ((m.event.special[e.origType] || {}).handle || e.handler).apply(f.elem, i), void 0 !== c && (a.result = c) === !1 && (a.preventDefault(), a.stopPropagation()))
                }
                return k.postDispatch && k.postDispatch.call(this, a), a.result
            }
        },
        handlers: function (a, b) {
            var c, d, e, f, g = [], h = b.delegateCount, i = a.target;
            if (h && i.nodeType && (!a.button || "click" !== a.type))for (; i != this; i = i.parentNode || this)if (1 === i.nodeType && (i.disabled !== !0 || "click" !== a.type)) {
                for (e = [], f = 0; h > f; f++)d = b[f], c = d.selector + " ", void 0 === e[c] && (e[c] = d.needsContext ? m(c, this).index(i) >= 0 : m.find(c, this, null, [i]).length), e[c] && e.push(d);
                e.length && g.push({elem: i, handlers: e})
            }
            return h < b.length && g.push({elem: this, handlers: b.slice(h)}), g
        },
        fix: function (a) {
            if (a[m.expando])return a;
            var b, c, d, e = a.type, f = a, g = this.fixHooks[e];
            g || (this.fixHooks[e] = g = Z.test(e) ? this.mouseHooks : Y.test(e) ? this.keyHooks : {}), d = g.props ? this.props.concat(g.props) : this.props, a = new m.Event(f), b = d.length;
            while (b--)c = d[b], a[c] = f[c];
            return a.target || (a.target = f.srcElement || y), 3 === a.target.nodeType && (a.target = a.target.parentNode), a.metaKey = !!a.metaKey, g.filter ? g.filter(a, f) : a
        },
        props: "altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),
        fixHooks: {},
        keyHooks: {
            props: "char charCode key keyCode".split(" "), filter: function (a, b) {
                return null == a.which && (a.which = null != b.charCode ? b.charCode : b.keyCode), a
            }
        },
        mouseHooks: {
            props: "button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),
            filter: function (a, b) {
                var c, d, e, f = b.button, g = b.fromElement;
                return null == a.pageX && null != b.clientX && (d = a.target.ownerDocument || y, e = d.documentElement, c = d.body, a.pageX = b.clientX + (e && e.scrollLeft || c && c.scrollLeft || 0) - (e && e.clientLeft || c && c.clientLeft || 0), a.pageY = b.clientY + (e && e.scrollTop || c && c.scrollTop || 0) - (e && e.clientTop || c && c.clientTop || 0)), !a.relatedTarget && g && (a.relatedTarget = g === a.target ? b.toElement : g), a.which || void 0 === f || (a.which = 1 & f ? 1 : 2 & f ? 3 : 4 & f ? 2 : 0), a
            }
        },
        special: {
            load: {noBubble: !0}, focus: {
                trigger: function () {
                    if (this !== ca() && this.focus)try {
                        return this.focus(), !1
                    } catch (a) {
                    }
                }, delegateType: "focusin"
            }, blur: {
                trigger: function () {
                    return this === ca() && this.blur ? (this.blur(), !1) : void 0
                }, delegateType: "focusout"
            }, click: {
                trigger: function () {
                    return m.nodeName(this, "input") && "checkbox" === this.type && this.click ? (this.click(), !1) : void 0
                }, _default: function (a) {
                    return m.nodeName(a.target, "a")
                }
            }, beforeunload: {
                postDispatch: function (a) {
                    void 0 !== a.result && a.originalEvent && (a.originalEvent.returnValue = a.result)
                }
            }
        },
        simulate: function (a, b, c, d) {
            var e = m.extend(new m.Event, c, {type: a, isSimulated: !0, originalEvent: {}});
            d ? m.event.trigger(e, null, b) : m.event.dispatch.call(b, e), e.isDefaultPrevented() && c.preventDefault()
        }
    }, m.removeEvent = y.removeEventListener ? function (a, b, c) {
        a.removeEventListener && a.removeEventListener(b, c, !1)
    } : function (a, b, c) {
        var d = "on" + b;
        a.detachEvent && (typeof a[d] === K && (a[d] = null), a.detachEvent(d, c))
    }, m.Event = function (a, b) {
        return this instanceof m.Event ? (a && a.type ? (this.originalEvent = a, this.type = a.type, this.isDefaultPrevented = a.defaultPrevented || void 0 === a.defaultPrevented && a.returnValue === !1 ? aa : ba) : this.type = a, b && m.extend(this, b), this.timeStamp = a && a.timeStamp || m.now(), void(this[m.expando] = !0)) : new m.Event(a, b)
    }, m.Event.prototype = {
        isDefaultPrevented: ba,
        isPropagationStopped: ba,
        isImmediatePropagationStopped: ba,
        preventDefault: function () {
            var a = this.originalEvent;
            this.isDefaultPrevented = aa, a && (a.preventDefault ? a.preventDefault() : a.returnValue = !1)
        },
        stopPropagation: function () {
            var a = this.originalEvent;
            this.isPropagationStopped = aa, a && (a.stopPropagation && a.stopPropagation(), a.cancelBubble = !0)
        },
        stopImmediatePropagation: function () {
            var a = this.originalEvent;
            this.isImmediatePropagationStopped = aa, a && a.stopImmediatePropagation && a.stopImmediatePropagation(), this.stopPropagation()
        }
    }, m.each({
        mouseenter: "mouseover",
        mouseleave: "mouseout",
        pointerenter: "pointerover",
        pointerleave: "pointerout"
    }, function (a, b) {
        m.event.special[a] = {
            delegateType: b, bindType: b, handle: function (a) {
                var c, d = this, e = a.relatedTarget, f = a.handleObj;
                return (!e || e !== d && !m.contains(d, e)) && (a.type = f.origType, c = f.handler.apply(this, arguments), a.type = b), c
            }
        }
    }), k.submitBubbles || (m.event.special.submit = {
        setup: function () {
            return m.nodeName(this, "form") ? !1 : void m.event.add(this, "click._submit keypress._submit", function (a) {
                var b = a.target, c = m.nodeName(b, "input") || m.nodeName(b, "button") ? b.form : void 0;
                c && !m._data(c, "submitBubbles") && (m.event.add(c, "submit._submit", function (a) {
                    a._submit_bubble = !0
                }), m._data(c, "submitBubbles", !0))
            })
        }, postDispatch: function (a) {
            a._submit_bubble && (delete a._submit_bubble, this.parentNode && !a.isTrigger && m.event.simulate("submit", this.parentNode, a, !0))
        }, teardown: function () {
            return m.nodeName(this, "form") ? !1 : void m.event.remove(this, "._submit")
        }
    }), k.changeBubbles || (m.event.special.change = {
        setup: function () {
            return X.test(this.nodeName) ? (("checkbox" === this.type || "radio" === this.type) && (m.event.add(this, "propertychange._change", function (a) {
                "checked" === a.originalEvent.propertyName && (this._just_changed = !0)
            }), m.event.add(this, "click._change", function (a) {
                this._just_changed && !a.isTrigger && (this._just_changed = !1), m.event.simulate("change", this, a, !0)
            })), !1) : void m.event.add(this, "beforeactivate._change", function (a) {
                var b = a.target;
                X.test(b.nodeName) && !m._data(b, "changeBubbles") && (m.event.add(b, "change._change", function (a) {
                    !this.parentNode || a.isSimulated || a.isTrigger || m.event.simulate("change", this.parentNode, a, !0)
                }), m._data(b, "changeBubbles", !0))
            })
        }, handle: function (a) {
            var b = a.target;
            return this !== b || a.isSimulated || a.isTrigger || "radio" !== b.type && "checkbox" !== b.type ? a.handleObj.handler.apply(this, arguments) : void 0
        }, teardown: function () {
            return m.event.remove(this, "._change"), !X.test(this.nodeName)
        }
    }), k.focusinBubbles || m.each({focus: "focusin", blur: "focusout"}, function (a, b) {
        var c = function (a) {
            m.event.simulate(b, a.target, m.event.fix(a), !0)
        };
        m.event.special[b] = {
            setup: function () {
                var d = this.ownerDocument || this, e = m._data(d, b);
                e || d.addEventListener(a, c, !0), m._data(d, b, (e || 0) + 1)
            }, teardown: function () {
                var d = this.ownerDocument || this, e = m._data(d, b) - 1;
                e ? m._data(d, b, e) : (d.removeEventListener(a, c, !0), m._removeData(d, b))
            }
        }
    }), m.fn.extend({
        on: function (a, b, c, d, e) {
            var f, g;
            if ("object" == typeof a) {
                "string" != typeof b && (c = c || b, b = void 0);
                for (f in a)this.on(f, b, c, a[f], e);
                return this
            }
            if (null == c && null == d ? (d = b, c = b = void 0) : null == d && ("string" == typeof b ? (d = c, c = void 0) : (d = c, c = b, b = void 0)), d === !1)d = ba; else if (!d)return this;
            return 1 === e && (g = d, d = function (a) {
                return m().off(a), g.apply(this, arguments)
            }, d.guid = g.guid || (g.guid = m.guid++)), this.each(function () {
                m.event.add(this, a, d, c, b)
            })
        }, one: function (a, b, c, d) {
            return this.on(a, b, c, d, 1)
        }, off: function (a, b, c) {
            var d, e;
            if (a && a.preventDefault && a.handleObj)return d = a.handleObj, m(a.delegateTarget).off(d.namespace ? d.origType + "." + d.namespace : d.origType, d.selector, d.handler), this;
            if ("object" == typeof a) {
                for (e in a)this.off(e, b, a[e]);
                return this
            }
            return (b === !1 || "function" == typeof b) && (c = b, b = void 0), c === !1 && (c = ba), this.each(function () {
                m.event.remove(this, a, c, b)
            })
        }, trigger: function (a, b) {
            return this.each(function () {
                m.event.trigger(a, b, this)
            })
        }, triggerHandler: function (a, b) {
            var c = this[0];
            return c ? m.event.trigger(a, b, c, !0) : void 0
        }
    });
    function da(a) {
        var b = ea.split("|"), c = a.createDocumentFragment();
        if (c.createElement)while (b.length)c.createElement(b.pop());
        return c
    }

    var ea = "abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video", fa = / wjq\d+="(?:null|\d+)"/g, ga = new RegExp("<(?:" + ea + ")[\\s/>]", "i"), ha = /^\s+/, ia = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi, ja = /<([\w:]+)/, ka = /<tbody/i, la = /<|&#?\w+;/, ma = /<(?:script|style|link)/i, na = /checked\s*(?:[^=]|=\s*.checked.)/i, oa = /^$|\/(?:java|ecma)script/i, pa = /^true\/(.*)/, qa = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g, ra = {
        option: [1, "<select multiple='multiple'>", "</select>"],
        legend: [1, "<fieldset>", "</fieldset>"],
        area: [1, "<map>", "</map>"],
        param: [1, "<object>", "</object>"],
        thead: [1, "<table>", "</table>"],
        tr: [2, "<table><tbody>", "</tbody></table>"],
        col: [2, "<table><tbody></tbody><colgroup>", "</colgroup></table>"],
        td: [3, "<table><tbody><tr>", "</tr></tbody></table>"],
        _default: k.htmlSerialize ? [0, "", ""] : [1, "X<div>", "</div>"]
    }, sa = da(y), ta = sa.appendChild(y.createElement("div"));
    ra.optgroup = ra.option, ra.tbody = ra.tfoot = ra.colgroup = ra.caption = ra.thead, ra.th = ra.td;
    function ua(a, b) {
        var c, d, e = 0, f = typeof a.getElementsByTagName !== K ? a.getElementsByTagName(b || "*") : typeof a.querySelectorAll !== K ? a.querySelectorAll(b || "*") : void 0;
        if (!f)for (f = [], c = a.childNodes || a; null != (d = c[e]); e++)!b || m.nodeName(d, b) ? f.push(d) : m.merge(f, ua(d, b));
        return void 0 === b || b && m.nodeName(a, b) ? m.merge([a], f) : f
    }

    function va(a) {
        W.test(a.type) && (a.defaultChecked = a.checked)
    }

    function wa(a, b) {
        return m.nodeName(a, "table") && m.nodeName(11 !== b.nodeType ? b : b.firstChild, "tr") ? a.getElementsByTagName("tbody")[0] || a.appendChild(a.ownerDocument.createElement("tbody")) : a
    }

    function xa(a) {
        return a.type = (null !== m.find.attr(a, "type")) + "/" + a.type, a
    }

    function ya(a) {
        var b = pa.exec(a.type);
        return b ? a.type = b[1] : a.removeAttribute("type"), a
    }

    function za(a, b) {
        for (var c, d = 0; null != (c = a[d]); d++)m._data(c, "globalEval", !b || m._data(b[d], "globalEval"))
    }

    function Aa(a, b) {
        if (1 === b.nodeType && m.hasData(a)) {
            var c, d, e, f = m._data(a), g = m._data(b, f), h = f.events;
            if (h) {
                delete g.handle, g.events = {};
                for (c in h)for (d = 0, e = h[c].length; e > d; d++)m.event.add(b, c, h[c][d])
            }
            g.data && (g.data = m.extend({}, g.data))
        }
    }

    function Ba(a, b) {
        var c, d, e;
        if (1 === b.nodeType) {
            if (c = b.nodeName.toLowerCase(), !k.noCloneEvent && b[m.expando]) {
                e = m._data(b);
                for (d in e.events)m.removeEvent(b, d, e.handle);
                b.removeAttribute(m.expando)
            }
            "script" === c && b.text !== a.text ? (xa(b).text = a.text, ya(b)) : "object" === c ? (b.parentNode && (b.outerHTML = a.outerHTML), k.html5Clone && a.innerHTML && !m.trim(b.innerHTML) && (b.innerHTML = a.innerHTML)) : "input" === c && W.test(a.type) ? (b.defaultChecked = b.checked = a.checked, b.value !== a.value && (b.value = a.value)) : "option" === c ? b.defaultSelected = b.selected = a.defaultSelected : ("input" === c || "textarea" === c) && (b.defaultValue = a.defaultValue)
        }
    }

    m.extend({
        clone: function (a, b, c) {
            var d, e, f, g, h, i = m.contains(a.ownerDocument, a);
            if (k.html5Clone || m.isXMLDoc(a) || !ga.test("<" + a.nodeName + ">") ? f = a.cloneNode(!0) : (ta.innerHTML = a.outerHTML, ta.removeChild(f = ta.firstChild)), !(k.noCloneEvent && k.noCloneChecked || 1 !== a.nodeType && 11 !== a.nodeType || m.isXMLDoc(a)))for (d = ua(f), h = ua(a), g = 0; null != (e = h[g]); ++g)d[g] && Ba(e, d[g]);
            if (b)if (c)for (h = h || ua(a), d = d || ua(f), g = 0; null != (e = h[g]); g++)Aa(e, d[g]); else Aa(a, f);
            return d = ua(f, "script"), d.length > 0 && za(d, !i && ua(a, "script")), d = h = e = null, f
        }, buildFragment: function (a, b, c, d) {
            for (var e, f, g, h, i, j, l, n = a.length, o = da(b), p = [], q = 0; n > q; q++)if (f = a[q], f || 0 === f)if ("object" === m.type(f))m.merge(p, f.nodeType ? [f] : f); else if (la.test(f)) {
                h = h || o.appendChild(b.createElement("div")), i = (ja.exec(f) || ["", ""])[1].toLowerCase(), l = ra[i] || ra._default, h.innerHTML = l[1] + f.replace(ia, "<$1></$2>") + l[2], e = l[0];
                while (e--)h = h.lastChild;
                if (!k.leadingWhitespace && ha.test(f) && p.push(b.createTextNode(ha.exec(f)[0])), !k.tbody) {
                    f = "table" !== i || ka.test(f) ? "<table>" !== l[1] || ka.test(f) ? 0 : h : h.firstChild, e = f && f.childNodes.length;
                    while (e--)m.nodeName(j = f.childNodes[e], "tbody") && !j.childNodes.length && f.removeChild(j)
                }
                m.merge(p, h.childNodes), h.textContent = "";
                while (h.firstChild)h.removeChild(h.firstChild);
                h = o.lastChild
            } else p.push(b.createTextNode(f));
            h && o.removeChild(h), k.appendChecked || m.grep(ua(p, "input"), va), q = 0;
            while (f = p[q++])if ((!d || -1 === m.inArray(f, d)) && (g = m.contains(f.ownerDocument, f), h = ua(o.appendChild(f), "script"), g && za(h), c)) {
                e = 0;
                while (f = h[e++])oa.test(f.type || "") && c.push(f)
            }
            return h = null, o
        }, cleanData: function (a, b) {
            for (var d, e, f, g, h = 0, i = m.expando, j = m.cache, l = k.deleteExpando, n = m.event.special; null != (d = a[h]); h++)if ((b || m.acceptData(d)) && (f = d[i], g = f && j[f])) {
                if (g.events)for (e in g.events)n[e] ? m.event.remove(d, e) : m.removeEvent(d, e, g.handle);
                j[f] && (delete j[f], l ? delete d[i] : typeof d.removeAttribute !== K ? d.removeAttribute(i) : d[i] = null, c.push(f))
            }
        }
    }), m.fn.extend({
        text: function (a) {
            return V(this, function (a) {
                return void 0 === a ? m.text(this) : this.empty().append((this[0] && this[0].ownerDocument || y).createTextNode(a))
            }, null, a, arguments.length)
        }, append: function () {
            return this.domManip(arguments, function (a) {
                if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) {
                    var b = wa(this, a);
                    b.appendChild(a)
                }
            })
        }, prepend: function () {
            return this.domManip(arguments, function (a) {
                if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) {
                    var b = wa(this, a);
                    b.insertBefore(a, b.firstChild)
                }
            })
        }, before: function () {
            return this.domManip(arguments, function (a) {
                this.parentNode && this.parentNode.insertBefore(a, this)
            })
        }, after: function () {
            return this.domManip(arguments, function (a) {
                this.parentNode && this.parentNode.insertBefore(a, this.nextSibling)
            })
        }, remove: function (a, b) {
            for (var c, d = a ? m.filter(a, this) : this, e = 0; null != (c = d[e]); e++)b || 1 !== c.nodeType || m.cleanData(ua(c)), c.parentNode && (b && m.contains(c.ownerDocument, c) && za(ua(c, "script")), c.parentNode.removeChild(c));
            return this
        }, empty: function () {
            for (var a, b = 0; null != (a = this[b]); b++) {
                1 === a.nodeType && m.cleanData(ua(a, !1));
                while (a.firstChild)a.removeChild(a.firstChild);
                a.options && m.nodeName(a, "select") && (a.options.length = 0)
            }
            return this
        }, clone: function (a, b) {
            return a = null == a ? !1 : a, b = null == b ? a : b, this.map(function () {
                return m.clone(this, a, b)
            })
        }, html: function (a) {
            return V(this, function (a) {
                var b = this[0] || {}, c = 0, d = this.length;
                if (void 0 === a)return 1 === b.nodeType ? b.innerHTML.replace(fa, "") : void 0;
                if (!("string" != typeof a || ma.test(a) || !k.htmlSerialize && ga.test(a) || !k.leadingWhitespace && ha.test(a) || ra[(ja.exec(a) || ["", ""])[1].toLowerCase()])) {
                    a = a.replace(ia, "<$1></$2>");
                    try {
                        for (; d > c; c++)b = this[c] || {}, 1 === b.nodeType && (m.cleanData(ua(b, !1)), b.innerHTML = a);
                        b = 0
                    } catch (e) {
                    }
                }
                b && this.empty().append(a)
            }, null, a, arguments.length)
        }, replaceWith: function () {
            var a = arguments[0];
            return this.domManip(arguments, function (b) {
                a = this.parentNode, m.cleanData(ua(this)), a && a.replaceChild(b, this)
            }), a && (a.length || a.nodeType) ? this : this.remove()
        }, detach: function (a) {
            return this.remove(a, !0)
        }, domManip: function (a, b) {
            a = e.apply([], a);
            var c, d, f, g, h, i, j = 0, l = this.length, n = this, o = l - 1, p = a[0], q = m.isFunction(p);
            if (q || l > 1 && "string" == typeof p && !k.checkClone && na.test(p))return this.each(function (c) {
                var d = n.eq(c);
                q && (a[0] = p.call(this, c, d.html())), d.domManip(a, b)
            });
            if (l && (i = m.buildFragment(a, this[0].ownerDocument, !1, this), c = i.firstChild, 1 === i.childNodes.length && (i = c), c)) {
                for (g = m.map(ua(i, "script"), xa), f = g.length; l > j; j++)d = i, j !== o && (d = m.clone(d, !0, !0), f && m.merge(g, ua(d, "script"))), b.call(this[j], d, j);
                if (f)for (h = g[g.length - 1].ownerDocument, m.map(g, ya), j = 0; f > j; j++)d = g[j], oa.test(d.type || "") && !m._data(d, "globalEval") && m.contains(h, d) && (d.src ? m._evalUrl && m._evalUrl(d.src) : m.globalEval((d.text || d.textContent || d.innerHTML || "").replace(qa, "")));
                i = c = null
            }
            return this
        }
    }), m.each({
        appendTo: "append",
        prependTo: "prepend",
        insertBefore: "before",
        insertAfter: "after",
        replaceAll: "replaceWith"
    }, function (a, b) {
        m.fn[a] = function (a) {
            for (var c, d = 0, e = [], g = m(a), h = g.length - 1; h >= d; d++)c = d === h ? this : this.clone(!0), m(g[d])[b](c), f.apply(e, c.get());
            return this.pushStack(e)
        }
    });
    var Ca, Da = {};

    function Ea(b, c) {
        var d, e = m(c.createElement(b)).appendTo(c.body), f = a.getDefaultComputedStyle && (d = a.getDefaultComputedStyle(e[0])) ? d.display : m.css(e[0], "display");
        return e.detach(), f
    }

    function Fa(a) {
        var b = y, c = Da[a];
        return c || (c = Ea(a, b), "none" !== c && c || (Ca = (Ca || m("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement), b = (Ca[0].contentWindow || Ca[0].contentDocument).document, b.write(), b.close(), c = Ea(a, b), Ca.detach()), Da[a] = c), c
    }

    !function () {
        var a;
        k.shrinkWrapBlocks = function () {
            if (null != a)return a;
            a = !1;
            var b, c, d;
            return c = y.getElementsByTagName("body")[0], c && c.style ? (b = y.createElement("div"), d = y.createElement("div"), d.style.cssText = "position:absolute;border:0;width:0;height:0;top:0;left:-9999px", c.appendChild(d).appendChild(b), typeof b.style.zoom !== K && (b.style.cssText = "-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1", b.appendChild(y.createElement("div")).style.width = "5px", a = 3 !== b.offsetWidth), c.removeChild(d), a) : void 0
        }
    }();
    var Ga = /^margin/, Ha = new RegExp("^(" + S + ")(?!px)[a-z%]+$", "i"), Ia, Ja, Ka = /^(top|right|bottom|left)$/;
    a.getComputedStyle ? (Ia = function (b) {
        return b.ownerDocument.defaultView.opener ? b.ownerDocument.defaultView.getComputedStyle(b, null) : a.getComputedStyle(b, null)
    }, Ja = function (a, b, c) {
        var d, e, f, g, h = a.style;
        return c = c || Ia(a), g = c ? c.getPropertyValue(b) || c[b] : void 0, c && ("" !== g || m.contains(a.ownerDocument, a) || (g = m.style(a, b)), Ha.test(g) && Ga.test(b) && (d = h.width, e = h.minWidth, f = h.maxWidth, h.minWidth = h.maxWidth = h.width = g, g = c.width, h.width = d, h.minWidth = e, h.maxWidth = f)), void 0 === g ? g : g + ""
    }) : y.documentElement.currentStyle && (Ia = function (a) {
        return a.currentStyle
    }, Ja = function (a, b, c) {
        var d, e, f, g, h = a.style;
        return c = c || Ia(a), g = c ? c[b] : void 0, null == g && h && h[b] && (g = h[b]), Ha.test(g) && !Ka.test(b) && (d = h.left, e = a.runtimeStyle, f = e && e.left, f && (e.left = a.currentStyle.left), h.left = "fontSize" === b ? "1em" : g, g = h.pixelLeft + "px", h.left = d, f && (e.left = f)), void 0 === g ? g : g + "" || "auto"
    });
    function La(a, b) {
        return {
            get: function () {
                var c = a();
                if (null != c)return c ? void delete this.get : (this.get = b).apply(this, arguments)
            }
        }
    }

    !function () {
        var b, c, d, e, f, g, h;
        if (b = y.createElement("div"), b.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>", d = b.getElementsByTagName("a")[0], c = d && d.style) {
            c.cssText = "float:left;opacity:.5", k.opacity = "0.5" === c.opacity, k.cssFloat = !!c.cssFloat, b.style.backgroundClip = "content-box", b.cloneNode(!0).style.backgroundClip = "", k.clearCloneStyle = "content-box" === b.style.backgroundClip, k.boxSizing = "" === c.boxSizing || "" === c.MozBoxSizing || "" === c.WebkitBoxSizing, m.extend(k, {
                reliableHiddenOffsets: function () {
                    return null == g && i(), g
                }, boxSizingReliable: function () {
                    return null == f && i(), f
                }, pixelPosition: function () {
                    return null == e && i(), e
                }, reliableMarginRight: function () {
                    return null == h && i(), h
                }
            });
            function i() {
                var b, c, d, i;
                c = y.getElementsByTagName("body")[0], c && c.style && (b = y.createElement("div"), d = y.createElement("div"), d.style.cssText = "position:absolute;border:0;width:0;height:0;top:0;left:-9999px", c.appendChild(d).appendChild(b), b.style.cssText = "-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute", e = f = !1, h = !0, a.getComputedStyle && (e = "1%" !== (a.getComputedStyle(b, null) || {}).top, f = "4px" === (a.getComputedStyle(b, null) || {width: "4px"}).width, i = b.appendChild(y.createElement("div")), i.style.cssText = b.style.cssText = "-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0", i.style.marginRight = i.style.width = "0", b.style.width = "1px", h = !parseFloat((a.getComputedStyle(i, null) || {}).marginRight), b.removeChild(i)), b.innerHTML = "<table><tr><td></td><td>t</td></tr></table>", i = b.getElementsByTagName("td"), i[0].style.cssText = "margin:0;border:0;padding:0;display:none", g = 0 === i[0].offsetHeight, g && (i[0].style.display = "", i[1].style.display = "none", g = 0 === i[0].offsetHeight), c.removeChild(d))
            }
        }
    }(), m.swap = function (a, b, c, d) {
        var e, f, g = {};
        for (f in b)g[f] = a.style[f], a.style[f] = b[f];
        e = c.apply(a, d || []);
        for (f in b)a.style[f] = g[f];
        return e
    };
    var Ma = /alpha\([^)]*\)/i, Na = /opacity\s*=\s*([^)]*)/, Oa = /^(none|table(?!-c[ea]).+)/, Pa = new RegExp("^(" + S + ")(.*)$", "i"), Qa = new RegExp("^([+-])=(" + S + ")", "i"), Ra = {
        position: "absolute",
        visibility: "hidden",
        display: "block"
    }, Sa = {letterSpacing: "0", fontWeight: "400"}, Ta = ["Webkit", "O", "Moz", "ms"];

    function Ua(a, b) {
        if (b in a)return b;
        var c = b.charAt(0).toUpperCase() + b.slice(1), d = b, e = Ta.length;
        while (e--)if (b = Ta[e] + c, b in a)return b;
        return d
    }

    function Va(a, b) {
        for (var c, d, e, f = [], g = 0, h = a.length; h > g; g++)d = a[g], d.style && (f[g] = m._data(d, "olddisplay"), c = d.style.display, b ? (f[g] || "none" !== c || (d.style.display = ""), "" === d.style.display && U(d) && (f[g] = m._data(d, "olddisplay", Fa(d.nodeName)))) : (e = U(d), (c && "none" !== c || !e) && m._data(d, "olddisplay", e ? c : m.css(d, "display"))));
        for (g = 0; h > g; g++)d = a[g], d.style && (b && "none" !== d.style.display && "" !== d.style.display || (d.style.display = b ? f[g] || "" : "none"));
        return a
    }

    function Wa(a, b, c) {
        var d = Pa.exec(b);
        return d ? Math.max(0, d[1] - (c || 0)) + (d[2] || "px") : b
    }

    function Xa(a, b, c, d, e) {
        for (var f = c === (d ? "border" : "content") ? 4 : "width" === b ? 1 : 0, g = 0; 4 > f; f += 2)"margin" === c && (g += m.css(a, c + T[f], !0, e)), d ? ("content" === c && (g -= m.css(a, "padding" + T[f], !0, e)), "margin" !== c && (g -= m.css(a, "border" + T[f] + "Width", !0, e))) : (g += m.css(a, "padding" + T[f], !0, e), "padding" !== c && (g += m.css(a, "border" + T[f] + "Width", !0, e)));
        return g
    }

    function Ya(a, b, c) {
        var d = !0, e = "width" === b ? a.offsetWidth : a.offsetHeight, f = Ia(a), g = k.boxSizing && "border-box" === m.css(a, "boxSizing", !1, f);
        if (0 >= e || null == e) {
            if (e = Ja(a, b, f), (0 > e || null == e) && (e = a.style[b]), Ha.test(e))return e;
            d = g && (k.boxSizingReliable() || e === a.style[b]), e = parseFloat(e) || 0
        }
        return e + Xa(a, b, c || (g ? "border" : "content"), d, f) + "px"
    }

    m.extend({
        cssHooks: {
            opacity: {
                get: function (a, b) {
                    if (b) {
                        var c = Ja(a, "opacity");
                        return "" === c ? "1" : c
                    }
                }
            }
        },
        cssNumber: {
            columnCount: !0,
            fillOpacity: !0,
            flexGrow: !0,
            flexShrink: !0,
            fontWeight: !0,
            lineHeight: !0,
            opacity: !0,
            order: !0,
            orphans: !0,
            widows: !0,
            zIndex: !0,
            zoom: !0
        },
        cssProps: {"float": k.cssFloat ? "cssFloat" : "styleFloat"},
        style: function (a, b, c, d) {
            if (a && 3 !== a.nodeType && 8 !== a.nodeType && a.style) {
                var e, f, g, h = m.camelCase(b), i = a.style;
                if (b = m.cssProps[h] || (m.cssProps[h] = Ua(i, h)), g = m.cssHooks[b] || m.cssHooks[h], void 0 === c)return g && "get" in g && void 0 !== (e = g.get(a, !1, d)) ? e : i[b];
                if (f = typeof c, "string" === f && (e = Qa.exec(c)) && (c = (e[1] + 1) * e[2] + parseFloat(m.css(a, b)), f = "number"), null != c && c === c && ("number" !== f || m.cssNumber[h] || (c += "px"), k.clearCloneStyle || "" !== c || 0 !== b.indexOf("background") || (i[b] = "inherit"), !(g && "set" in g && void 0 === (c = g.set(a, c, d)))))try {
                    i[b] = c
                } catch (j) {
                }
            }
        },
        css: function (a, b, c, d) {
            var e, f, g, h = m.camelCase(b);
            return b = m.cssProps[h] || (m.cssProps[h] = Ua(a.style, h)), g = m.cssHooks[b] || m.cssHooks[h], g && "get" in g && (f = g.get(a, !0, c)), void 0 === f && (f = Ja(a, b, d)), "normal" === f && b in Sa && (f = Sa[b]), "" === c || c ? (e = parseFloat(f), c === !0 || m.isNumeric(e) ? e || 0 : f) : f
        }
    }), m.each(["height", "width"], function (a, b) {
        m.cssHooks[b] = {
            get: function (a, c, d) {
                return c ? Oa.test(m.css(a, "display")) && 0 === a.offsetWidth ? m.swap(a, Ra, function () {
                    return Ya(a, b, d)
                }) : Ya(a, b, d) : void 0
            }, set: function (a, c, d) {
                var e = d && Ia(a);
                return Wa(a, c, d ? Xa(a, b, d, k.boxSizing && "border-box" === m.css(a, "boxSizing", !1, e), e) : 0)
            }
        }
    }), k.opacity || (m.cssHooks.opacity = {
        get: function (a, b) {
            return Na.test((b && a.currentStyle ? a.currentStyle.filter : a.style.filter) || "") ? .01 * parseFloat(RegExp.$1) + "" : b ? "1" : ""
        }, set: function (a, b) {
            var c = a.style, d = a.currentStyle, e = m.isNumeric(b) ? "alpha(opacity=" + 100 * b + ")" : "", f = d && d.filter || c.filter || "";
            c.zoom = 1, (b >= 1 || "" === b) && "" === m.trim(f.replace(Ma, "")) && c.removeAttribute && (c.removeAttribute("filter"), "" === b || d && !d.filter) || (c.filter = Ma.test(f) ? f.replace(Ma, e) : f + " " + e)
        }
    }), m.cssHooks.marginRight = La(k.reliableMarginRight, function (a, b) {
        return b ? m.swap(a, {display: "inline-block"}, Ja, [a, "marginRight"]) : void 0
    }), m.each({margin: "", padding: "", border: "Width"}, function (a, b) {
        m.cssHooks[a + b] = {
            expand: function (c) {
                for (var d = 0, e = {}, f = "string" == typeof c ? c.split(" ") : [c]; 4 > d; d++)e[a + T[d] + b] = f[d] || f[d - 2] || f[0];
                return e
            }
        }, Ga.test(a) || (m.cssHooks[a + b].set = Wa)
    }), m.fn.extend({
        css: function (a, b) {
            return V(this, function (a, b, c) {
                var d, e, f = {}, g = 0;
                if (m.isArray(b)) {
                    for (d = Ia(a), e = b.length; e > g; g++)f[b[g]] = m.css(a, b[g], !1, d);
                    return f
                }
                return void 0 !== c ? m.style(a, b, c) : m.css(a, b)
            }, a, b, arguments.length > 1)
        }, show: function () {
            return Va(this, !0)
        }, hide: function () {
            return Va(this)
        }, toggle: function (a) {
            return "boolean" == typeof a ? a ? this.show() : this.hide() : this.each(function () {
                U(this) ? m(this).show() : m(this).hide()
            })
        }
    });
    function Za(a, b, c, d, e) {
        return new Za.prototype.init(a, b, c, d, e)
    }

    m.Tween = Za, Za.prototype = {
        constructor: Za, init: function (a, b, c, d, e, f) {
            this.elem = a, this.prop = c, this.easing = e || "swing", this.options = b, this.start = this.now = this.cur(), this.end = d, this.unit = f || (m.cssNumber[c] ? "" : "px")
        }, cur: function () {
            var a = Za.propHooks[this.prop];
            return a && a.get ? a.get(this) : Za.propHooks._default.get(this)
        }, run: function (a) {
            var b, c = Za.propHooks[this.prop];
            return this.options.duration ? this.pos = b = m.easing[this.easing](a, this.options.duration * a, 0, 1, this.options.duration) : this.pos = b = a, this.now = (this.end - this.start) * b + this.start, this.options.step && this.options.step.call(this.elem, this.now, this), c && c.set ? c.set(this) : Za.propHooks._default.set(this), this
        }
    }, Za.prototype.init.prototype = Za.prototype, Za.propHooks = {
        _default: {
            get: function (a) {
                var b;
                return null == a.elem[a.prop] || a.elem.style && null != a.elem.style[a.prop] ? (b = m.css(a.elem, a.prop, ""), b && "auto" !== b ? b : 0) : a.elem[a.prop]
            }, set: function (a) {
                m.fx.step[a.prop] ? m.fx.step[a.prop](a) : a.elem.style && (null != a.elem.style[m.cssProps[a.prop]] || m.cssHooks[a.prop]) ? m.style(a.elem, a.prop, a.now + a.unit) : a.elem[a.prop] = a.now
            }
        }
    }, Za.propHooks.scrollTop = Za.propHooks.scrollLeft = {
        set: function (a) {
            a.elem.nodeType && a.elem.parentNode && (a.elem[a.prop] = a.now)
        }
    }, m.easing = {
        linear: function (a) {
            return a
        }, swing: function (a) {
            return .5 - Math.cos(a * Math.PI) / 2
        }
    }, m.fx = Za.prototype.init, m.fx.step = {};
    var $a, _a, ab = /^(?:toggle|show|hide)$/, bb = new RegExp("^(?:([+-])=|)(" + S + ")([a-z%]*)$", "i"), cb = /queueHooks$/, db = [ib], eb = {
        "*": [function (a, b) {
            var c = this.createTween(a, b), d = c.cur(), e = bb.exec(b), f = e && e[3] || (m.cssNumber[a] ? "" : "px"), g = (m.cssNumber[a] || "px" !== f && +d) && bb.exec(m.css(c.elem, a)), h = 1, i = 20;
            if (g && g[3] !== f) {
                f = f || g[3], e = e || [], g = +d || 1;
                do h = h || ".5", g /= h, m.style(c.elem, a, g + f); while (h !== (h = c.cur() / d) && 1 !== h && --i)
            }
            return e && (g = c.start = +g || +d || 0, c.unit = f, c.end = e[1] ? g + (e[1] + 1) * e[2] : +e[2]), c
        }]
    };

    function fb() {
        return setTimeout(function () {
            $a = void 0
        }), $a = m.now()
    }

    function gb(a, b) {
        var c, d = {height: a}, e = 0;
        for (b = b ? 1 : 0; 4 > e; e += 2 - b)c = T[e], d["margin" + c] = d["padding" + c] = a;
        return b && (d.opacity = d.width = a), d
    }

    function hb(a, b, c) {
        for (var d, e = (eb[b] || []).concat(eb["*"]), f = 0, g = e.length; g > f; f++)if (d = e[f].call(c, b, a))return d
    }

    function ib(a, b, c) {
        var d, e, f, g, h, i, j, l, n = this, o = {}, p = a.style, q = a.nodeType && U(a), r = m._data(a, "fxshow");
        c.queue || (h = m._queueHooks(a, "fx"), null == h.unqueued && (h.unqueued = 0, i = h.empty.fire, h.empty.fire = function () {
            h.unqueued || i()
        }), h.unqueued++, n.always(function () {
            n.always(function () {
                h.unqueued--, m.queue(a, "fx").length || h.empty.fire()
            })
        })), 1 === a.nodeType && ("height" in b || "width" in b) && (c.overflow = [p.overflow, p.overflowX, p.overflowY], j = m.css(a, "display"), l = "none" === j ? m._data(a, "olddisplay") || Fa(a.nodeName) : j, "inline" === l && "none" === m.css(a, "float") && (k.inlineBlockNeedsLayout && "inline" !== Fa(a.nodeName) ? p.zoom = 1 : p.display = "inline-block")), c.overflow && (p.overflow = "hidden", k.shrinkWrapBlocks() || n.always(function () {
            p.overflow = c.overflow[0], p.overflowX = c.overflow[1], p.overflowY = c.overflow[2]
        }));
        for (d in b)if (e = b[d], ab.exec(e)) {
            if (delete b[d], f = f || "toggle" === e, e === (q ? "hide" : "show")) {
                if ("show" !== e || !r || void 0 === r[d])continue;
                q = !0
            }
            o[d] = r && r[d] || m.style(a, d)
        } else j = void 0;
        if (m.isEmptyObject(o))"inline" === ("none" === j ? Fa(a.nodeName) : j) && (p.display = j); else {
            r ? "hidden" in r && (q = r.hidden) : r = m._data(a, "fxshow", {}), f && (r.hidden = !q), q ? m(a).show() : n.done(function () {
                m(a).hide()
            }), n.done(function () {
                var b;
                m._removeData(a, "fxshow");
                for (b in o)m.style(a, b, o[b])
            });
            for (d in o)g = hb(q ? r[d] : 0, d, n), d in r || (r[d] = g.start, q && (g.end = g.start, g.start = "width" === d || "height" === d ? 1 : 0))
        }
    }

    function jb(a, b) {
        var c, d, e, f, g;
        for (c in a)if (d = m.camelCase(c), e = b[d], f = a[c], m.isArray(f) && (e = f[1], f = a[c] = f[0]), c !== d && (a[d] = f, delete a[c]), g = m.cssHooks[d], g && "expand" in g) {
            f = g.expand(f), delete a[d];
            for (c in f)c in a || (a[c] = f[c], b[c] = e)
        } else b[d] = e
    }

    function kb(a, b, c) {
        var d, e, f = 0, g = db.length, h = m.Deferred().always(function () {
            delete i.elem
        }), i = function () {
            if (e)return !1;
            for (var b = $a || fb(), c = Math.max(0, j.startTime + j.duration - b), d = c / j.duration || 0, f = 1 - d, g = 0, i = j.tweens.length; i > g; g++)j.tweens[g].run(f);
            return h.notifyWith(a, [j, f, c]), 1 > f && i ? c : (h.resolveWith(a, [j]), !1)
        }, j = h.promise({
            elem: a,
            props: m.extend({}, b),
            opts: m.extend(!0, {specialEasing: {}}, c),
            originalProperties: b,
            originalOptions: c,
            startTime: $a || fb(),
            duration: c.duration,
            tweens: [],
            createTween: function (b, c) {
                var d = m.Tween(a, j.opts, b, c, j.opts.specialEasing[b] || j.opts.easing);
                return j.tweens.push(d), d
            },
            stop: function (b) {
                var c = 0, d = b ? j.tweens.length : 0;
                if (e)return this;
                for (e = !0; d > c; c++)j.tweens[c].run(1);
                return b ? h.resolveWith(a, [j, b]) : h.rejectWith(a, [j, b]), this
            }
        }), k = j.props;
        for (jb(k, j.opts.specialEasing); g > f; f++)if (d = db[f].call(j, a, k, j.opts))return d;
        return m.map(k, hb, j), m.isFunction(j.opts.start) && j.opts.start.call(a, j), m.fx.timer(m.extend(i, {
            elem: a,
            anim: j,
            queue: j.opts.queue
        })), j.progress(j.opts.progress).done(j.opts.done, j.opts.complete).fail(j.opts.fail).always(j.opts.always)
    }

    m.Animation = m.extend(kb, {
        tweener: function (a, b) {
            m.isFunction(a) ? (b = a, a = ["*"]) : a = a.split(" ");
            for (var c, d = 0, e = a.length; e > d; d++)c = a[d], eb[c] = eb[c] || [], eb[c].unshift(b)
        }, prefilter: function (a, b) {
            b ? db.unshift(a) : db.push(a)
        }
    }), m.speed = function (a, b, c) {
        var d = a && "object" == typeof a ? m.extend({}, a) : {
            complete: c || !c && b || m.isFunction(a) && a,
            duration: a,
            easing: c && b || b && !m.isFunction(b) && b
        };
        return d.duration = m.fx.off ? 0 : "number" == typeof d.duration ? d.duration : d.duration in m.fx.speeds ? m.fx.speeds[d.duration] : m.fx.speeds._default, (null == d.queue || d.queue === !0) && (d.queue = "fx"), d.old = d.complete, d.complete = function () {
            m.isFunction(d.old) && d.old.call(this), d.queue && m.dequeue(this, d.queue)
        }, d
    }, m.fn.extend({
        fadeTo: function (a, b, c, d) {
            return this.filter(U).css("opacity", 0).show().end().animate({opacity: b}, a, c, d)
        }, animate: function (a, b, c, d) {
            var e = m.isEmptyObject(a), f = m.speed(b, c, d), g = function () {
                var b = kb(this, m.extend({}, a), f);
                (e || m._data(this, "finish")) && b.stop(!0)
            };
            return g.finish = g, e || f.queue === !1 ? this.each(g) : this.queue(f.queue, g)
        }, stop: function (a, b, c) {
            var d = function (a) {
                var b = a.stop;
                delete a.stop, b(c)
            };
            return "string" != typeof a && (c = b, b = a, a = void 0), b && a !== !1 && this.queue(a || "fx", []), this.each(function () {
                var b = !0, e = null != a && a + "queueHooks", f = m.timers, g = m._data(this);
                if (e)g[e] && g[e].stop && d(g[e]); else for (e in g)g[e] && g[e].stop && cb.test(e) && d(g[e]);
                for (e = f.length; e--;)f[e].elem !== this || null != a && f[e].queue !== a || (f[e].anim.stop(c), b = !1, f.splice(e, 1));
                (b || !c) && m.dequeue(this, a)
            })
        }, finish: function (a) {
            return a !== !1 && (a = a || "fx"), this.each(function () {
                var b, c = m._data(this), d = c[a + "queue"], e = c[a + "queueHooks"], f = m.timers, g = d ? d.length : 0;
                for (c.finish = !0, m.queue(this, a, []), e && e.stop && e.stop.call(this, !0), b = f.length; b--;)f[b].elem === this && f[b].queue === a && (f[b].anim.stop(!0), f.splice(b, 1));
                for (b = 0; g > b; b++)d[b] && d[b].finish && d[b].finish.call(this);
                delete c.finish
            })
        }
    }), m.each(["toggle", "show", "hide"], function (a, b) {
        var c = m.fn[b];
        m.fn[b] = function (a, d, e) {
            return null == a || "boolean" == typeof a ? c.apply(this, arguments) : this.animate(gb(b, !0), a, d, e)
        }
    }), m.each({
        slideDown: gb("show"),
        slideUp: gb("hide"),
        slideToggle: gb("toggle"),
        fadeIn: {opacity: "show"},
        fadeOut: {opacity: "hide"},
        fadeToggle: {opacity: "toggle"}
    }, function (a, b) {
        m.fn[a] = function (a, c, d) {
            return this.animate(b, a, c, d)
        }
    }), m.timers = [], m.fx.tick = function () {
        var a, b = m.timers, c = 0;
        for ($a = m.now(); c < b.length; c++)a = b[c], a() || b[c] !== a || b.splice(c--, 1);
        b.length || m.fx.stop(), $a = void 0
    }, m.fx.timer = function (a) {
        m.timers.push(a), a() ? m.fx.start() : m.timers.pop()
    }, m.fx.interval = 13, m.fx.start = function () {
        _a || (_a = setInterval(m.fx.tick, m.fx.interval))
    }, m.fx.stop = function () {
        clearInterval(_a), _a = null
    }, m.fx.speeds = {slow: 600, fast: 200, _default: 400}, m.fn.delay = function (a, b) {
        return a = m.fx ? m.fx.speeds[a] || a : a, b = b || "fx", this.queue(b, function (b, c) {
            var d = setTimeout(b, a);
            c.stop = function () {
                clearTimeout(d)
            }
        })
    }, function () {
        var a, b, c, d, e;
        b = y.createElement("div"), b.setAttribute("className", "t"), b.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>", d = b.getElementsByTagName("a")[0], c = y.createElement("select"), e = c.appendChild(y.createElement("option")), a = b.getElementsByTagName("input")[0], d.style.cssText = "top:1px", k.getSetAttribute = "t" !== b.className, k.style = /top/.test(d.getAttribute("style")), k.hrefNormalized = "/a" === d.getAttribute("href"), k.checkOn = !!a.value, k.optSelected = e.selected, k.enctype = !!y.createElement("form").enctype, c.disabled = !0, k.optDisabled = !e.disabled, a = y.createElement("input"), a.setAttribute("value", ""), k.input = "" === a.getAttribute("value"), a.value = "t", a.setAttribute("type", "radio"), k.radioValue = "t" === a.value
    }();
    var lb = /\r/g;
    m.fn.extend({
        val: function (a) {
            var b, c, d, e = this[0];
            {
                if (arguments.length)return d = m.isFunction(a), this.each(function (c) {
                    var e;
                    1 === this.nodeType && (e = d ? a.call(this, c, m(this).val()) : a, null == e ? e = "" : "number" == typeof e ? e += "" : m.isArray(e) && (e = m.map(e, function (a) {
                        return null == a ? "" : a + ""
                    })), b = m.valHooks[this.type] || m.valHooks[this.nodeName.toLowerCase()], b && "set" in b && void 0 !== b.set(this, e, "value") || (this.value = e))
                });
                if (e)return b = m.valHooks[e.type] || m.valHooks[e.nodeName.toLowerCase()], b && "get" in b && void 0 !== (c = b.get(e, "value")) ? c : (c = e.value, "string" == typeof c ? c.replace(lb, "") : null == c ? "" : c)
            }
        }
    }), m.extend({
        valHooks: {
            option: {
                get: function (a) {
                    var b = m.find.attr(a, "value");
                    return null != b ? b : m.trim(m.text(a))
                }
            }, select: {
                get: function (a) {
                    for (var b, c, d = a.options, e = a.selectedIndex, f = "select-one" === a.type || 0 > e, g = f ? null : [], h = f ? e + 1 : d.length, i = 0 > e ? h : f ? e : 0; h > i; i++)if (c = d[i], !(!c.selected && i !== e || (k.optDisabled ? c.disabled : null !== c.getAttribute("disabled")) || c.parentNode.disabled && m.nodeName(c.parentNode, "optgroup"))) {
                        if (b = m(c).val(), f)return b;
                        g.push(b)
                    }
                    return g
                }, set: function (a, b) {
                    var c, d, e = a.options, f = m.makeArray(b), g = e.length;
                    while (g--)if (d = e[g], m.inArray(m.valHooks.option.get(d), f) >= 0)try {
                        d.selected = c = !0
                    } catch (h) {
                        d.scrollHeight
                    } else d.selected = !1;
                    return c || (a.selectedIndex = -1), e
                }
            }
        }
    }), m.each(["radio", "checkbox"], function () {
        m.valHooks[this] = {
            set: function (a, b) {
                return m.isArray(b) ? a.checked = m.inArray(m(a).val(), b) >= 0 : void 0
            }
        }, k.checkOn || (m.valHooks[this].get = function (a) {
            return null === a.getAttribute("value") ? "on" : a.value
        })
    });
    var mb, nb, ob = m.expr.attrHandle, pb = /^(?:checked|selected)$/i, qb = k.getSetAttribute, rb = k.input;
    m.fn.extend({
        attr: function (a, b) {
            return V(this, m.attr, a, b, arguments.length > 1)
        }, removeAttr: function (a) {
            return this.each(function () {
                m.removeAttr(this, a)
            })
        }
    }), m.extend({
        attr: function (a, b, c) {
            var d, e, f = a.nodeType;
            if (a && 3 !== f && 8 !== f && 2 !== f)return typeof a.getAttribute === K ? m.prop(a, b, c) : (1 === f && m.isXMLDoc(a) || (b = b.toLowerCase(), d = m.attrHooks[b] || (m.expr.match.bool.test(b) ? nb : mb)), void 0 === c ? d && "get" in d && null !== (e = d.get(a, b)) ? e : (e = m.find.attr(a, b), null == e ? void 0 : e) : null !== c ? d && "set" in d && void 0 !== (e = d.set(a, c, b)) ? e : (a.setAttribute(b, c + ""), c) : void m.removeAttr(a, b))
        }, removeAttr: function (a, b) {
            var c, d, e = 0, f = b && b.match(E);
            if (f && 1 === a.nodeType)while (c = f[e++])d = m.propFix[c] || c, m.expr.match.bool.test(c) ? rb && qb || !pb.test(c) ? a[d] = !1 : a[m.camelCase("default-" + c)] = a[d] = !1 : m.attr(a, c, ""), a.removeAttribute(qb ? c : d)
        }, attrHooks: {
            type: {
                set: function (a, b) {
                    if (!k.radioValue && "radio" === b && m.nodeName(a, "input")) {
                        var c = a.value;
                        return a.setAttribute("type", b), c && (a.value = c), b
                    }
                }
            }
        }
    }), nb = {
        set: function (a, b, c) {
            return b === !1 ? m.removeAttr(a, c) : rb && qb || !pb.test(c) ? a.setAttribute(!qb && m.propFix[c] || c, c) : a[m.camelCase("default-" + c)] = a[c] = !0, c
        }
    }, m.each(m.expr.match.bool.source.match(/\w+/g), function (a, b) {
        var c = ob[b] || m.find.attr;
        ob[b] = rb && qb || !pb.test(b) ? function (a, b, d) {
            var e, f;
            return d || (f = ob[b], ob[b] = e, e = null != c(a, b, d) ? b.toLowerCase() : null, ob[b] = f), e
        } : function (a, b, c) {
            return c ? void 0 : a[m.camelCase("default-" + b)] ? b.toLowerCase() : null
        }
    }), rb && qb || (m.attrHooks.value = {
        set: function (a, b, c) {
            return m.nodeName(a, "input") ? void(a.defaultValue = b) : mb && mb.set(a, b, c)
        }
    }), qb || (mb = {
        set: function (a, b, c) {
            var d = a.getAttributeNode(c);
            return d || a.setAttributeNode(d = a.ownerDocument.createAttribute(c)), d.value = b += "", "value" === c || b === a.getAttribute(c) ? b : void 0
        }
    }, ob.id = ob.name = ob.coords = function (a, b, c) {
        var d;
        return c ? void 0 : (d = a.getAttributeNode(b)) && "" !== d.value ? d.value : null
    }, m.valHooks.button = {
        get: function (a, b) {
            var c = a.getAttributeNode(b);
            return c && c.specified ? c.value : void 0
        }, set: mb.set
    }, m.attrHooks.contenteditable = {
        set: function (a, b, c) {
            mb.set(a, "" === b ? !1 : b, c)
        }
    }, m.each(["width", "height"], function (a, b) {
        m.attrHooks[b] = {
            set: function (a, c) {
                return "" === c ? (a.setAttribute(b, "auto"), c) : void 0
            }
        }
    })), k.style || (m.attrHooks.style = {
        get: function (a) {
            return a.style.cssText || void 0
        }, set: function (a, b) {
            return a.style.cssText = b + ""
        }
    });
    var sb = /^(?:input|select|textarea|button|object)$/i, tb = /^(?:a|area)$/i;
    m.fn.extend({
        prop: function (a, b) {
            return V(this, m.prop, a, b, arguments.length > 1)
        }, removeProp: function (a) {
            return a = m.propFix[a] || a, this.each(function () {
                try {
                    this[a] = void 0, delete this[a]
                } catch (b) {
                }
            })
        }
    }), m.extend({
        propFix: {"for": "htmlFor", "class": "className"}, prop: function (a, b, c) {
            var d, e, f, g = a.nodeType;
            if (a && 3 !== g && 8 !== g && 2 !== g)return f = 1 !== g || !m.isXMLDoc(a), f && (b = m.propFix[b] || b, e = m.propHooks[b]), void 0 !== c ? e && "set" in e && void 0 !== (d = e.set(a, c, b)) ? d : a[b] = c : e && "get" in e && null !== (d = e.get(a, b)) ? d : a[b]
        }, propHooks: {
            tabIndex: {
                get: function (a) {
                    var b = m.find.attr(a, "tabindex");
                    return b ? parseInt(b, 10) : sb.test(a.nodeName) || tb.test(a.nodeName) && a.href ? 0 : -1
                }
            }
        }
    }), k.hrefNormalized || m.each(["href", "src"], function (a, b) {
        m.propHooks[b] = {
            get: function (a) {
                return a.getAttribute(b, 4)
            }
        }
    }), k.optSelected || (m.propHooks.selected = {
        get: function (a) {
            var b = a.parentNode;
            return b && (b.selectedIndex, b.parentNode && b.parentNode.selectedIndex), null
        }
    }), m.each(["tabIndex", "readOnly", "maxLength", "cellSpacing", "cellPadding", "rowSpan", "colSpan", "useMap", "frameBorder", "contentEditable"], function () {
        m.propFix[this.toLowerCase()] = this
    }), k.enctype || (m.propFix.enctype = "encoding");
    var ub = /[\t\r\n\f]/g;
    m.fn.extend({
        addClass: function (a) {
            var b, c, d, e, f, g, h = 0, i = this.length, j = "string" == typeof a && a;
            if (m.isFunction(a))return this.each(function (b) {
                m(this).addClass(a.call(this, b, this.className))
            });
            if (j)for (b = (a || "").match(E) || []; i > h; h++)if (c = this[h], d = 1 === c.nodeType && (c.className ? (" " + c.className + " ").replace(ub, " ") : " ")) {
                f = 0;
                while (e = b[f++])d.indexOf(" " + e + " ") < 0 && (d += e + " ");
                g = m.trim(d), c.className !== g && (c.className = g)
            }
            return this
        }, removeClass: function (a) {
            var b, c, d, e, f, g, h = 0, i = this.length, j = 0 === arguments.length || "string" == typeof a && a;
            if (m.isFunction(a))return this.each(function (b) {
                m(this).removeClass(a.call(this, b, this.className))
            });
            if (j)for (b = (a || "").match(E) || []; i > h; h++)if (c = this[h], d = 1 === c.nodeType && (c.className ? (" " + c.className + " ").replace(ub, " ") : "")) {
                f = 0;
                while (e = b[f++])while (d.indexOf(" " + e + " ") >= 0)d = d.replace(" " + e + " ", " ");
                g = a ? m.trim(d) : "", c.className !== g && (c.className = g)
            }
            return this
        }, toggleClass: function (a, b) {
            var c = typeof a;
            return "boolean" == typeof b && "string" === c ? b ? this.addClass(a) : this.removeClass(a) : this.each(m.isFunction(a) ? function (c) {
                m(this).toggleClass(a.call(this, c, this.className, b), b)
            } : function () {
                if ("string" === c) {
                    var b, d = 0, e = m(this), f = a.match(E) || [];
                    while (b = f[d++])e.hasClass(b) ? e.removeClass(b) : e.addClass(b)
                } else(c === K || "boolean" === c) && (this.className && m._data(this, "__className__", this.className), this.className = this.className || a === !1 ? "" : m._data(this, "__className__") || "")
            })
        }, hasClass: function (a) {
            for (var b = " " + a + " ", c = 0, d = this.length; d > c; c++)if (1 === this[c].nodeType && (" " + this[c].className + " ").replace(ub, " ").indexOf(b) >= 0)return !0;
            return !1
        }
    }), m.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "), function (a, b) {
        m.fn[b] = function (a, c) {
            return arguments.length > 0 ? this.on(b, null, a, c) : this.trigger(b)
        }
    }), m.fn.extend({
        hover: function (a, b) {
            return this.mouseenter(a).mouseleave(b || a)
        }, bind: function (a, b, c) {
            return this.on(a, null, b, c)
        }, unbind: function (a, b) {
            return this.off(a, null, b)
        }, delegate: function (a, b, c, d) {
            return this.on(b, a, c, d)
        }, undelegate: function (a, b, c) {
            return 1 === arguments.length ? this.off(a, "**") : this.off(b, a || "**", c)
        }
    });
    var vb = m.now(), wb = /\?/, xb = /(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;
    m.parseJSON = function (b) {
        if (a.JSON && a.JSON.parse)return a.JSON.parse(b + "");
        var c, d = null, e = m.trim(b + "");
        return e && !m.trim(e.replace(xb, function (a, b, e, f) {
            return c && b && (d = 0), 0 === d ? a : (c = e || b, d += !f - !e, "")
        })) ? Function("return " + e)() : m.error("Invalid JSON: " + b)
    }, m.parseXML = function (b) {
        var c, d;
        if (!b || "string" != typeof b)return null;
        try {
            a.DOMParser ? (d = new DOMParser, c = d.parseFromString(b, "text/xml")) : (c = new ActiveXObject("Microsoft.XMLDOM"), c.async = "false", c.loadXML(b))
        } catch (e) {
            c = void 0
        }
        return c && c.documentElement && !c.getElementsByTagName("parsererror").length || m.error("Invalid XML: " + b), c
    };
    var yb, zb, Ab = /#.*$/, Bb = /([?&])_=[^&]*/, Cb = /^(.*?):[ \t]*([^\r\n]*)\r?$/gm, Db = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/, Eb = /^(?:GET|HEAD)$/, Fb = /^\/\//, Gb = /^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/, Hb = {}, Ib = {}, Jb = "*/".concat("*");
    try {
        zb = location.href
    } catch (Kb) {
        zb = y.createElement("a"), zb.href = "", zb = zb.href
    }
    yb = Gb.exec(zb.toLowerCase()) || [];
    function Lb(a) {
        return function (b, c) {
            "string" != typeof b && (c = b, b = "*");
            var d, e = 0, f = b.toLowerCase().match(E) || [];
            if (m.isFunction(c))while (d = f[e++])"+" === d.charAt(0) ? (d = d.slice(1) || "*", (a[d] = a[d] || []).unshift(c)) : (a[d] = a[d] || []).push(c)
        }
    }

    function Mb(a, b, c, d) {
        var e = {}, f = a === Ib;

        function g(h) {
            var i;
            return e[h] = !0, m.each(a[h] || [], function (a, h) {
                var j = h(b, c, d);
                return "string" != typeof j || f || e[j] ? f ? !(i = j) : void 0 : (b.dataTypes.unshift(j), g(j), !1)
            }), i
        }

        return g(b.dataTypes[0]) || !e["*"] && g("*")
    }

    function Nb(a, b) {
        var c, d, e = m.ajaxSettings.flatOptions || {};
        for (d in b)void 0 !== b[d] && ((e[d] ? a : c || (c = {}))[d] = b[d]);
        return c && m.extend(!0, a, c), a
    }

    function Ob(a, b, c) {
        var d, e, f, g, h = a.contents, i = a.dataTypes;
        while ("*" === i[0])i.shift(), void 0 === e && (e = a.mimeType || b.getResponseHeader("Content-Type"));
        if (e)for (g in h)if (h[g] && h[g].test(e)) {
            i.unshift(g);
            break
        }
        if (i[0] in c)f = i[0]; else {
            for (g in c) {
                if (!i[0] || a.converters[g + " " + i[0]]) {
                    f = g;
                    break
                }
                d || (d = g)
            }
            f = f || d
        }
        return f ? (f !== i[0] && i.unshift(f), c[f]) : void 0
    }

    function Pb(a, b, c, d) {
        var e, f, g, h, i, j = {}, k = a.dataTypes.slice();
        if (k[1])for (g in a.converters)j[g.toLowerCase()] = a.converters[g];
        f = k.shift();
        while (f)if (a.responseFields[f] && (c[a.responseFields[f]] = b), !i && d && a.dataFilter && (b = a.dataFilter(b, a.dataType)), i = f, f = k.shift())if ("*" === f)f = i; else if ("*" !== i && i !== f) {
            if (g = j[i + " " + f] || j["* " + f], !g)for (e in j)if (h = e.split(" "), h[1] === f && (g = j[i + " " + h[0]] || j["* " + h[0]])) {
                g === !0 ? g = j[e] : j[e] !== !0 && (f = h[0], k.unshift(h[1]));
                break
            }
            if (g !== !0)if (g && a["throws"])b = g(b); else try {
                b = g(b)
            } catch (l) {
                return {state: "parsererror", error: g ? l : "No conversion from " + i + " to " + f}
            }
        }
        return {state: "success", data: b}
    }

    m.extend({
        active: 0,
        lastModified: {},
        etag: {},
        ajaxSettings: {
            url: zb,
            type: "GET",
            isLocal: Db.test(yb[1]),
            global: !0,
            processData: !0,
            async: !0,
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",
            accepts: {
                "*": Jb,
                text: "text/plain",
                html: "text/html",
                xml: "application/xml, text/xml",
                json: "application/json, text/javascript"
            },
            contents: {xml: /xml/, html: /html/, json: /json/},
            responseFields: {xml: "responseXML", text: "responseText", json: "responseJSON"},
            converters: {"* text": String, "text html": !0, "text json": m.parseJSON, "text xml": m.parseXML},
            flatOptions: {url: !0, context: !0}
        },
        ajaxSetup: function (a, b) {
            return b ? Nb(Nb(a, m.ajaxSettings), b) : Nb(m.ajaxSettings, a)
        },
        ajaxPrefilter: Lb(Hb),
        ajaxTransport: Lb(Ib),
        ajax: function (a, b) {
            "object" == typeof a && (b = a, a = void 0), b = b || {};
            var c, d, e, f, g, h, i, j, k = m.ajaxSetup({}, b), l = k.context || k, n = k.context && (l.nodeType || l.wjq) ? m(l) : m.event, o = m.Deferred(), p = m.Callbacks("once memory"), q = k.statusCode || {}, r = {}, s = {}, t = 0, u = "canceled", v = {
                readyState: 0,
                getResponseHeader: function (a) {
                    var b;
                    if (2 === t) {
                        if (!j) {
                            j = {};
                            while (b = Cb.exec(f))j[b[1].toLowerCase()] = b[2]
                        }
                        b = j[a.toLowerCase()]
                    }
                    return null == b ? null : b
                },
                getAllResponseHeaders: function () {
                    return 2 === t ? f : null
                },
                setRequestHeader: function (a, b) {
                    var c = a.toLowerCase();
                    return t || (a = s[c] = s[c] || a, r[a] = b), this
                },
                overrideMimeType: function (a) {
                    return t || (k.mimeType = a), this
                },
                statusCode: function (a) {
                    var b;
                    if (a)if (2 > t)for (b in a)q[b] = [q[b], a[b]]; else v.always(a[v.status]);
                    return this
                },
                abort: function (a) {
                    var b = a || u;
                    return i && i.abort(b), x(0, b), this
                }
            };
            if (o.promise(v).complete = p.add, v.success = v.done, v.error = v.fail, k.url = ((a || k.url || zb) + "").replace(Ab, "").replace(Fb, yb[1] + "//"), k.type = b.method || b.type || k.method || k.type, k.dataTypes = m.trim(k.dataType || "*").toLowerCase().match(E) || [""], null == k.crossDomain && (c = Gb.exec(k.url.toLowerCase()), k.crossDomain = !(!c || c[1] === yb[1] && c[2] === yb[2] && (c[3] || ("http:" === c[1] ? "80" : "443")) === (yb[3] || ("http:" === yb[1] ? "80" : "443")))), k.data && k.processData && "string" != typeof k.data && (k.data = m.param(k.data, k.traditional)), Mb(Hb, k, b, v), 2 === t)return v;
            h = m.event && k.global, h && 0 === m.active++ && m.event.trigger("ajaxStart"), k.type = k.type.toUpperCase(), k.hasContent = !Eb.test(k.type), e = k.url, k.hasContent || (k.data && (e = k.url += (wb.test(e) ? "&" : "?") + k.data, delete k.data), k.cache === !1 && (k.url = Bb.test(e) ? e.replace(Bb, "$1_=" + vb++) : e + (wb.test(e) ? "&" : "?") + "_=" + vb++)), k.ifModified && (m.lastModified[e] && v.setRequestHeader("If-Modified-Since", m.lastModified[e]), m.etag[e] && v.setRequestHeader("If-None-Match", m.etag[e])), (k.data && k.hasContent && k.contentType !== !1 || b.contentType) && v.setRequestHeader("Content-Type", k.contentType), v.setRequestHeader("Accept", k.dataTypes[0] && k.accepts[k.dataTypes[0]] ? k.accepts[k.dataTypes[0]] + ("*" !== k.dataTypes[0] ? ", " + Jb + "; q=0.01" : "") : k.accepts["*"]);
            for (d in k.headers)v.setRequestHeader(d, k.headers[d]);
            if (k.beforeSend && (k.beforeSend.call(l, v, k) === !1 || 2 === t))return v.abort();
            u = "abort";
            for (d in{success: 1, error: 1, complete: 1})v[d](k[d]);
            if (i = Mb(Ib, k, b, v)) {
                v.readyState = 1, h && n.trigger("ajaxSend", [v, k]), k.async && k.timeout > 0 && (g = setTimeout(function () {
                    v.abort("timeout")
                }, k.timeout));
                try {
                    t = 1, i.send(r, x)
                } catch (w) {
                    if (!(2 > t))throw w;
                    x(-1, w)
                }
            } else x(-1, "No Transport");
            function x(a, b, c, d) {
                var j, r, s, u, w, x = b;
                2 !== t && (t = 2, g && clearTimeout(g), i = void 0, f = d || "", v.readyState = a > 0 ? 4 : 0, j = a >= 200 && 300 > a || 304 === a, c && (u = Ob(k, v, c)), u = Pb(k, u, v, j), j ? (k.ifModified && (w = v.getResponseHeader("Last-Modified"), w && (m.lastModified[e] = w), w = v.getResponseHeader("etag"), w && (m.etag[e] = w)), 204 === a || "HEAD" === k.type ? x = "nocontent" : 304 === a ? x = "notmodified" : (x = u.state, r = u.data, s = u.error, j = !s)) : (s = x, (a || !x) && (x = "error", 0 > a && (a = 0))), v.status = a, v.statusText = (b || x) + "", j ? o.resolveWith(l, [r, x, v]) : o.rejectWith(l, [v, x, s]), v.statusCode(q), q = void 0, h && n.trigger(j ? "ajaxSuccess" : "ajaxError", [v, k, j ? r : s]), p.fireWith(l, [v, x]), h && (n.trigger("ajaxComplete", [v, k]), --m.active || m.event.trigger("ajaxStop")))
            }

            return v
        },
        getJSON: function (a, b, c) {
            return m.get(a, b, c, "json")
        },
        getScript: function (a, b) {
            return m.get(a, void 0, b, "script")
        }
    }), m.each(["get", "post"], function (a, b) {
        m[b] = function (a, c, d, e) {
            return m.isFunction(c) && (e = e || d, d = c, c = void 0), m.ajax({
                url: a,
                type: b,
                dataType: e,
                data: c,
                success: d
            })
        }
    }), m._evalUrl = function (a) {
        return m.ajax({url: a, type: "GET", dataType: "script", async: !1, global: !1, "throws": !0})
    }, m.fn.extend({
        wrapAll: function (a) {
            if (m.isFunction(a))return this.each(function (b) {
                m(this).wrapAll(a.call(this, b))
            });
            if (this[0]) {
                var b = m(a, this[0].ownerDocument).eq(0).clone(!0);
                this[0].parentNode && b.insertBefore(this[0]), b.map(function () {
                    var a = this;
                    while (a.firstChild && 1 === a.firstChild.nodeType)a = a.firstChild;
                    return a
                }).append(this)
            }
            return this
        }, wrapInner: function (a) {
            return this.each(m.isFunction(a) ? function (b) {
                m(this).wrapInner(a.call(this, b))
            } : function () {
                var b = m(this), c = b.contents();
                c.length ? c.wrapAll(a) : b.append(a)
            })
        }, wrap: function (a) {
            var b = m.isFunction(a);
            return this.each(function (c) {
                m(this).wrapAll(b ? a.call(this, c) : a)
            })
        }, unwrap: function () {
            return this.parent().each(function () {
                m.nodeName(this, "body") || m(this).replaceWith(this.childNodes)
            }).end()
        }
    }), m.expr.filters.hidden = function (a) {
        return a.offsetWidth <= 0 && a.offsetHeight <= 0 || !k.reliableHiddenOffsets() && "none" === (a.style && a.style.display || m.css(a, "display"))
    }, m.expr.filters.visible = function (a) {
        return !m.expr.filters.hidden(a)
    };
    var Qb = /%20/g, Rb = /\[\]$/, Sb = /\r?\n/g, Tb = /^(?:submit|button|image|reset|file)$/i, Ub = /^(?:input|select|textarea|keygen)/i;

    function Vb(a, b, c, d) {
        var e;
        if (m.isArray(b))m.each(b, function (b, e) {
            c || Rb.test(a) ? d(a, e) : Vb(a + "[" + ("object" == typeof e ? b : "") + "]", e, c, d)
        }); else if (c || "object" !== m.type(b))d(a, b); else for (e in b)Vb(a + "[" + e + "]", b[e], c, d)
    }

    m.param = function (a, b) {
        var c, d = [], e = function (a, b) {
            b = m.isFunction(b) ? b() : null == b ? "" : b, d[d.length] = encodeURIComponent(a) + "=" + encodeURIComponent(b)
        };
        if (void 0 === b && (b = m.ajaxSettings && m.ajaxSettings.traditional), m.isArray(a) || a.wjq && !m.isPlainObject(a))m.each(a, function () {
            e(this.name, this.value)
        }); else for (c in a)Vb(c, a[c], b, e);
        return d.join("&").replace(Qb, "+")
    }, m.fn.extend({
        serialize: function () {
            return m.param(this.serializeArray())
        }, serializeArray: function () {
            return this.map(function () {
                var a = m.prop(this, "elements");
                return a ? m.makeArray(a) : this
            }).filter(function () {
                var a = this.type;
                return this.name && !m(this).is(":disabled") && Ub.test(this.nodeName) && !Tb.test(a) && (this.checked || !W.test(a))
            }).map(function (a, b) {
                var c = m(this).val();
                return null == c ? null : m.isArray(c) ? m.map(c, function (a) {
                    return {name: b.name, value: a.replace(Sb, "\r\n")}
                }) : {name: b.name, value: c.replace(Sb, "\r\n")}
            }).get()
        }
    }), m.ajaxSettings.xhr = void 0 !== a.ActiveXObject ? function () {
        return !this.isLocal && /^(get|post|head|put|delete|options)$/i.test(this.type) && Zb() || $b()
    } : Zb;
    var Wb = 0, Xb = {}, Yb = m.ajaxSettings.xhr();
    a.attachEvent && a.attachEvent("onunload", function () {
        for (var a in Xb)Xb[a](void 0, !0)
    }), k.cors = !!Yb && "withCredentials" in Yb, Yb = k.ajax = !!Yb, Yb && m.ajaxTransport(function (a) {
        if (!a.crossDomain || k.cors) {
            var b;
            return {
                send: function (c, d) {
                    var e, f = a.xhr(), g = ++Wb;
                    if (f.open(a.type, a.url, a.async, a.username, a.password), a.xhrFields)for (e in a.xhrFields)f[e] = a.xhrFields[e];
                    a.mimeType && f.overrideMimeType && f.overrideMimeType(a.mimeType), a.crossDomain || c["X-Requested-With"] || (c["X-Requested-With"] = "XMLHttpRequest");
                    for (e in c)void 0 !== c[e] && f.setRequestHeader(e, c[e] + "");
                    f.send(a.hasContent && a.data || null), b = function (c, e) {
                        var h, i, j;
                        if (b && (e || 4 === f.readyState))if (delete Xb[g], b = void 0, f.onreadystatechange = m.noop, e)4 !== f.readyState && f.abort(); else {
                            j = {}, h = f.status, "string" == typeof f.responseText && (j.text = f.responseText);
                            try {
                                i = f.statusText
                            } catch (k) {
                                i = ""
                            }
                            h || !a.isLocal || a.crossDomain ? 1223 === h && (h = 204) : h = j.text ? 200 : 404
                        }
                        j && d(h, i, j, f.getAllResponseHeaders())
                    }, a.async ? 4 === f.readyState ? setTimeout(b) : f.onreadystatechange = Xb[g] = b : b()
                }, abort: function () {
                    b && b(void 0, !0)
                }
            }
        }
    });
    function Zb() {
        try {
            return new a.XMLHttpRequest
        } catch (b) {
        }
    }

    function $b() {
        try {
            return new a.ActiveXObject("Microsoft.XMLHTTP")
        } catch (b) {
        }
    }

    m.ajaxSetup({
        accepts: {script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},
        contents: {script: /(?:java|ecma)script/},
        converters: {
            "text script": function (a) {
                return m.globalEval(a), a
            }
        }
    }), m.ajaxPrefilter("script", function (a) {
        void 0 === a.cache && (a.cache = !1), a.crossDomain && (a.type = "GET", a.global = !1)
    }), m.ajaxTransport("script", function (a) {
        if (a.crossDomain) {
            var b, c = y.head || m("head")[0] || y.documentElement;
            return {
                send: function (d, e) {
                    b = y.createElement("script"), b.async = !0, a.scriptCharset && (b.charset = a.scriptCharset), b.src = a.url, b.onload = b.onreadystatechange = function (a, c) {
                        (c || !b.readyState || /loaded|complete/.test(b.readyState)) && (b.onload = b.onreadystatechange = null, b.parentNode && b.parentNode.removeChild(b), b = null, c || e(200, "success"))
                    }, c.insertBefore(b, c.firstChild)
                }, abort: function () {
                    b && b.onload(void 0, !0)
                }
            }
        }
    });
    var _b = [], ac = /(=)\?(?=&|$)|\?\?/;
    m.ajaxSetup({
        jsonp: "callback", jsonpCallback: function () {
            var a = _b.pop() || m.expando + "_" + vb++;
            return this[a] = !0, a
        }
    }), m.ajaxPrefilter("json jsonp", function (b, c, d) {
        var e, f, g, h = b.jsonp !== !1 && (ac.test(b.url) ? "url" : "string" == typeof b.data && !(b.contentType || "").indexOf("application/x-www-form-urlencoded") && ac.test(b.data) && "data");
        return h || "jsonp" === b.dataTypes[0] ? (e = b.jsonpCallback = m.isFunction(b.jsonpCallback) ? b.jsonpCallback() : b.jsonpCallback, h ? b[h] = b[h].replace(ac, "$1" + e) : b.jsonp !== !1 && (b.url += (wb.test(b.url) ? "&" : "?") + b.jsonp + "=" + e), b.converters["script json"] = function () {
            return g || m.error(e + " was not called"), g[0]
        }, b.dataTypes[0] = "json", f = a[e], a[e] = function () {
            g = arguments
        }, d.always(function () {
            a[e] = f, b[e] && (b.jsonpCallback = c.jsonpCallback, _b.push(e)), g && m.isFunction(f) && f(g[0]), g = f = void 0
        }), "script") : void 0
    }), m.parseHTML = function (a, b, c) {
        if (!a || "string" != typeof a)return null;
        "boolean" == typeof b && (c = b, b = !1), b = b || y;
        var d = u.exec(a), e = !c && [];
        return d ? [b.createElement(d[1])] : (d = m.buildFragment([a], b, e), e && e.length && m(e).remove(), m.merge([], d.childNodes))
    };
    var bc = m.fn.load;
    m.fn.load = function (a, b, c) {
        if ("string" != typeof a && bc)return bc.apply(this, arguments);
        var d, e, f, g = this, h = a.indexOf(" ");
        return h >= 0 && (d = m.trim(a.slice(h, a.length)), a = a.slice(0, h)), m.isFunction(b) ? (c = b, b = void 0) : b && "object" == typeof b && (f = "POST"), g.length > 0 && m.ajax({
            url: a,
            type: f,
            dataType: "html",
            data: b
        }).done(function (a) {
            e = arguments, g.html(d ? m("<div>").append(m.parseHTML(a)).find(d) : a)
        }).complete(c && function (a, b) {
                g.each(c, e || [a.responseText, b, a])
            }), this
    }, m.each(["ajaxStart", "ajaxStop", "ajaxComplete", "ajaxError", "ajaxSuccess", "ajaxSend"], function (a, b) {
        m.fn[b] = function (a) {
            return this.on(b, a)
        }
    }), m.expr.filters.animated = function (a) {
        return m.grep(m.timers, function (b) {
            return a === b.elem
        }).length
    };
    var cc = a.document.documentElement;

    function dc(a) {
        return m.isWindow(a) ? a : 9 === a.nodeType ? a.defaultView || a.parentWindow : !1
    }

    m.offset = {
        setOffset: function (a, b, c) {
            var d, e, f, g, h, i, j, k = m.css(a, "position"), l = m(a), n = {};
            "static" === k && (a.style.position = "relative"), h = l.offset(), f = m.css(a, "top"), i = m.css(a, "left"), j = ("absolute" === k || "fixed" === k) && m.inArray("auto", [f, i]) > -1, j ? (d = l.position(), g = d.top, e = d.left) : (g = parseFloat(f) || 0, e = parseFloat(i) || 0), m.isFunction(b) && (b = b.call(a, c, h)), null != b.top && (n.top = b.top - h.top + g), null != b.left && (n.left = b.left - h.left + e), "using" in b ? b.using.call(a, n) : l.css(n)
        }
    }, m.fn.extend({
        offset: function (a) {
            if (arguments.length)return void 0 === a ? this : this.each(function (b) {
                m.offset.setOffset(this, a, b)
            });
            var b, c, d = {top: 0, left: 0}, e = this[0], f = e && e.ownerDocument;
            if (f)return b = f.documentElement, m.contains(b, e) ? (typeof e.getBoundingClientRect !== K && (d = e.getBoundingClientRect()), c = dc(f), {
                top: d.top + (c.pageYOffset || b.scrollTop) - (b.clientTop || 0),
                left: d.left + (c.pageXOffset || b.scrollLeft) - (b.clientLeft || 0)
            }) : d
        }, position: function () {
            if (this[0]) {
                var a, b, c = {top: 0, left: 0}, d = this[0];
                return "fixed" === m.css(d, "position") ? b = d.getBoundingClientRect() : (a = this.offsetParent(), b = this.offset(), m.nodeName(a[0], "html") || (c = a.offset()), c.top += m.css(a[0], "borderTopWidth", !0), c.left += m.css(a[0], "borderLeftWidth", !0)), {
                    top: b.top - c.top - m.css(d, "marginTop", !0),
                    left: b.left - c.left - m.css(d, "marginLeft", !0)
                }
            }
        }, offsetParent: function () {
            return this.map(function () {
                var a = this.offsetParent || cc;
                while (a && !m.nodeName(a, "html") && "static" === m.css(a, "position"))a = a.offsetParent;
                return a || cc
            })
        }
    }), m.each({scrollLeft: "pageXOffset", scrollTop: "pageYOffset"}, function
        (a, b) {
        var c = /Y/.test(b);
        m.fn[a] = function (d) {
            return V(this, function (a, d, e) {
                var f = dc(a);
                return void 0 === e ? f ? b in f ? f[b] : f.document.documentElement[d] : a[d] : void(f ? f.scrollTo(c ? m(f).scrollLeft() : e, c ? e : m(f).scrollTop()) : a[d] = e)
            }, a, d, arguments.length, null)
        }
    }), m.each(["top", "left"], function (a, b) {
        m.cssHooks[b] = La(k.pixelPosition, function (a, c) {
            return c ? (c = Ja(a, b), Ha.test(c) ? m(a).position()[b] + "px" : c) : void 0
        })
    }), m.each({Height: "height", Width: "width"},
        function (a, b) {
            m.each({padding: "inner" + a, content: b, "": "outer" + a}, function (c, d) {
                m.fn[d] = function (d, e) {
                    var f = arguments.length && (c || "boolean" != typeof d), g = c || (d === !0 || e === !0 ? "margin" : "border");
                    return V(this, function (b, c, d) {
                        var e;
                        return m.isWindow(b) ? b.document.documentElement["client" + a] : 9 === b.nodeType ? (e = b.documentElement, Math.max(b.body["scroll" + a], e["scroll" + a], b.body["offset" + a], e["offset" + a], e["client" + a])) : void 0 === d ? m.css(b, c, g) : m.style(b, c, d, g)
                    }, b, f ? d : void 0, f, null)
                }
            })
        }), m.fn.size = function () {
        return this.length
    }, m.fn.andSelf = m.fn.addBack, "function" == typeof
        define && define.amd && define("wjq", [], function () {
        return m
    });

    var ec = a.wjq, fc = a.$;

    return m.noConflict = function (b) {
        return a.$ === m && (a.$ = fc), b && a.wjq === m && (a.wjq = ec), m
    }, typeof b === K && (a.wjq = a.$ = m), m


})(window, !0);

    /*!
 * jquery.sumoselect - v3.0.2
 * http://hemantnegi.github.io/jquery.sumoselect
 */

!function(e){"namespace sumo";e.fn.SumoSelect=function(t){var l=e.extend({placeholder:"Select Here",csvDispCount:3,captionFormat:"{0} Selected",captionFormatAllSelected:"{0} all selected!",floatWidth:400,forceCustomRendering:!1,nativeOnDevice:["Android","BlackBerry","iPhone","iPad","iPod","Opera Mini","IEMobile","Silk"],outputAsCSV:!1,csvSepChar:",",okCancelInMulti:!1,triggerChangeCombined:!0,selectAll:!1,search:!1,searchText:"Search...",noMatch:'No matches for "{0}"',prefix:"",locale:["OK","Cancel","Select All"],up:!1},t),s=this.each(function(){var t=this;!this.sumo&&e(this).is("select")&&(this.sumo={E:e(t),is_multi:e(t).attr("multiple"),select:"",caption:"",placeholder:"",optDiv:"",CaptionCont:"",ul:"",is_floating:!1,is_opened:!1,mob:!1,Pstate:[],createElems:function(){var t=this;return t.E.wrap('<div class="SumoSelect" tabindex="0">'),t.select=t.E.parent(),t.caption=e("<span>"),t.CaptionCont=e('<p class="CaptionCont"><label><i></i></label></p>').addClass("SelectBox").attr("style",t.E.attr("style")).prepend(t.caption),t.select.append(t.CaptionCont),t.is_multi||(l.okCancelInMulti=!1),t.E.attr("disabled")&&t.select.addClass("disabled").removeAttr("tabindex"),l.outputAsCSV&&t.is_multi&&t.E.attr("name")&&(t.select.append(e('<input class="HEMANT123" type="hidden" />').attr("name",t.E.attr("name")).val(t.getSelStr())),t.E.removeAttr("name")),t.isMobile()&&!l.forceCustomRendering?void t.setNativeMobile():(t.E.attr("name")&&t.select.addClass("sumo_"+t.E.attr("name")),t.E.addClass("SumoUnder").attr("tabindex","-1"),t.optDiv=e('<div class="optWrapper '+(l.up?"up":"")+'">'),t.floatingList(),t.ul=e('<ul class="options">'),t.optDiv.append(t.ul),l.selectAll&&t.SelAll(),l.search&&t.Search(),t.ul.append(t.prepItems(t.E.children())),t.is_multi&&t.multiSelelect(),t.select.append(t.optDiv),t.basicEvents(),void t.selAllState())},prepItems:function(t,l){var i=[],s=this;return e(t).each(function(t,n){n=e(n),i.push(n.is("optgroup")?e('<li class="group '+(n[0].disabled?"disabled":"")+'"><label>'+n.attr("label")+"</label><ul></ul><li>").find("ul").append(s.prepItems(n.children(),n[0].disabled)).end():s.createLi(n,l))}),i},createLi:function(t,l){var i=this;return t.attr("value")||t.attr("value",t.val()),li=e('<li class="opt"><label>'+t.text()+"</label></li>"),li.data("opt",t),t.data("li",li),i.is_multi&&li.prepend("<span><i></i></span>"),(t[0].disabled||l)&&(li=li.addClass("disabled")),i.onOptClick(li),t[0].selected&&li.addClass("selected"),t.attr("class")&&li.addClass(t.attr("class")),li},getSelStr:function(){return sopt=[],this.E.find("option:selected").each(function(){sopt.push(e(this).val())}),sopt.join(l.csvSepChar)},multiSelelect:function(){var t=this;t.optDiv.addClass("multiple"),t.okbtn=e('<p class="btnOk">'+l.locale[0]+"</p>").click(function(){l.triggerChangeCombined&&(changed=!1,t.E.find("option:selected").length!=t.Pstate.length?changed=!0:t.E.find("option").each(function(e,l){l.selected&&t.Pstate.indexOf(e)<0&&(changed=!0)}),changed&&(t.callChange(),t.setText())),t.hideOpts()}),t.cancelBtn=e('<p class="btnCancel">'+l.locale[1]+"</p>").click(function(){t._cnbtn(),t.hideOpts()}),t.optDiv.append(e('<div class="MultiControls">').append(t.okbtn).append(t.cancelBtn))},_cnbtn:function(){var e=this;e.E.find("option:selected").each(function(){this.selected=!1}),e.optDiv.find("li.selected").removeClass("selected");for(var t=0;t<e.Pstate.length;t++)e.E.find("option")[e.Pstate[t]].selected=!0,e.ul.find("li.opt").eq(e.Pstate[t]).addClass("selected");e.selAllState()},SelAll:function(){var t=this;t.is_multi&&(t.selAll=e('<p class="select-all"><span><i></i></span><label>'+l.locale[2]+"</label></p>"),t.selAll.on("click",function(){t.selAll.toggleClass("selected"),t.optDiv.find("li.opt").not(".hidden").each(function(l,i){i=e(i),t.selAll.hasClass("selected")?i.hasClass("selected")||i.trigger("click"):i.hasClass("selected")&&i.trigger("click")})}),t.optDiv.prepend(t.selAll))},Search:function(){var t=this,i=t.CaptionCont.addClass("search"),s=e('<p class="no-match">');t.ftxt=e('<input type="text" class="search-txt" value="" placeholder="'+l.searchText+'">').on("click",function(e){e.stopPropagation()}),i.append(t.ftxt),t.optDiv.children("ul").after(s),t.ftxt.on("keyup.sumo",function(){var i=t.optDiv.find("ul.options li.opt").each(function(l,i){i=e(i),i.text().toLowerCase().indexOf(t.ftxt.val().toLowerCase())>-1?i.removeClass("hidden"):i.addClass("hidden")}).not(".hidden");s.html(l.noMatch.replace(/\{0\}/g,t.ftxt.val())).toggle(!i.length),t.selAllState()})},selAllState:function(){var t=this;if(l.selectAll){var i=0,s=0;t.optDiv.find("li.opt").not(".hidden").each(function(t,l){e(l).hasClass("selected")&&i++,e(l).hasClass("disabled")||s++}),i==s?t.selAll.removeClass("partial").addClass("selected"):0==i?t.selAll.removeClass("selected partial"):t.selAll.addClass("partial")}},showOpts:function(){var t=this;t.E.attr("disabled")||(t.is_opened=!0,t.select.addClass("open"),t.ftxt?t.ftxt.focus():t.select.focus(),e(document).on("click.sumo",function(e){if(!t.select.is(e.target)&&0===t.select.has(e.target).length){if(!t.is_opened)return;t.hideOpts(),l.okCancelInMulti&&t._cnbtn()}}),t.is_floating&&(H=t.optDiv.children("ul").outerHeight()+2,t.is_multi&&(H+=parseInt(t.optDiv.css("padding-bottom"))),t.optDiv.css("height",H),e("body").addClass("sumoStopScroll")),t.setPstate())},setPstate:function(){var e=this;e.is_multi&&(e.is_floating||l.okCancelInMulti)&&(e.Pstate=[],e.E.find("option").each(function(t,l){l.selected&&e.Pstate.push(t)}))},callChange:function(){this.E.trigger("change").trigger("click")},hideOpts:function(){var t=this;t.is_opened&&(t.is_opened=!1,t.select.removeClass("open").find("ul li.sel").removeClass("sel"),e(document).off("click.sumo"),t.select.focus(),e("body").removeClass("sumoStopScroll"),l.search&&(t.ftxt.val(""),t.optDiv.find("ul.options li").removeClass("hidden"),t.optDiv.find(".no-match").toggle(!1)))},setOnOpen:function(){var e=this,t=e.optDiv.find("li.opt:not(.hidden)").eq(l.search?0:e.E[0].selectedIndex);e.optDiv.find("li.sel").removeClass("sel"),t.addClass("sel"),e.showOpts()},nav:function(e){var t,l=this,i=l.ul.find("li.opt:not(.disabled, .hidden)"),s=l.ul.find("li.opt.sel:not(.hidden)"),n=i.index(s);if(l.is_opened&&s.length){if(e&&n>0)t=i.eq(n-1);else{if(!(!e&&n<i.length-1&&n>-1))return;t=i.eq(n+1)}s.removeClass("sel"),s=t.addClass("sel");var o=l.ul,a=o.scrollTop(),c=s.position().top+a;c>=a+o.height()-s.outerHeight()&&o.scrollTop(c-o.height()+s.outerHeight()),a>c&&o.scrollTop(c)}else l.setOnOpen()},basicEvents:function(){var t=this;t.CaptionCont.click(function(e){t.E.trigger("click"),t.is_opened?t.hideOpts():t.showOpts(),e.stopPropagation()}),t.select.on("keydown.sumo",function(e){switch(e.which){case 38:t.nav(!0);break;case 40:t.nav(!1);break;case 32:if(l.search&&t.ftxt.is(e.target))return;case 13:t.is_opened?t.optDiv.find("ul li.sel").trigger("click"):t.setOnOpen();break;case 9:case 27:return l.okCancelInMulti&&t._cnbtn(),void t.hideOpts();default:return}e.preventDefault()}),e(window).on("resize.sumo",function(){t.floatingList()})},onOptClick:function(t){var i=this;t.click(function(){var t=e(this);t.hasClass("disabled")||(txt="",i.is_multi?(t.toggleClass("selected"),t.data("opt")[0].selected=t.hasClass("selected"),i.selAllState()):(t.parent().find("li.selected").removeClass("selected"),t.toggleClass("selected"),t.data("opt")[0].selected=!0),i.is_multi&&l.triggerChangeCombined&&(i.is_floating||l.okCancelInMulti)||(i.setText(),i.callChange()),i.is_multi||i.hideOpts())})},setText:function(){var t=this;if(t.placeholder="",t.is_multi){for(sels=t.E.find(":selected").not(":disabled"),i=0;i<sels.length;i++){if(i+1>=l.csvDispCount&&l.csvDispCount){sels.length==t.E.find("option").length&&l.captionFormatAllSelected?t.placeholder=l.captionFormatAllSelected.replace(/\{0\}/g,sels.length)+",":t.placeholder=l.captionFormat.replace(/\{0\}/g,sels.length)+",";break}t.placeholder+=e(sels[i]).text()+", "}t.placeholder=t.placeholder.replace(/,([^,]*)$/,"$1")}else t.placeholder=t.E.find(":selected").not(":disabled").text();return is_placeholder=!1,t.placeholder||(is_placeholder=!0,t.placeholder=t.E.attr("placeholder"),t.placeholder||(t.placeholder=t.E.find("option:disabled:selected").text())),t.placeholder=t.placeholder?l.prefix+" "+t.placeholder:l.placeholder,t.caption.html(t.placeholder),t.CaptionCont.attr("title",t.placeholder),csvField=t.select.find("input.HEMANT123"),csvField.length&&csvField.val(t.getSelStr()),is_placeholder?t.caption.addClass("placeholder"):t.caption.removeClass("placeholder"),t.placeholder},isMobile:function(){for(var e=navigator.userAgent||navigator.vendor||window.opera,t=0;t<l.nativeOnDevice.length;t++)if(e.toString().toLowerCase().indexOf(l.nativeOnDevice[t].toLowerCase())>0)return l.nativeOnDevice[t];return!1},setNativeMobile:function(){var e=this;e.E.addClass("SelectClass"),e.mob=!0,e.E.change(function(){e.setText()})},floatingList:function(){var t=this;t.is_floating=e(window).width()<=l.floatWidth,t.optDiv.toggleClass("isFloating",t.is_floating),t.is_floating||t.optDiv.css("height",""),t.optDiv.toggleClass("okCancelInMulti",l.okCancelInMulti&&!t.is_floating)},vRange:function(e){var t=this;if(opts=t.E.find("option"),opts.length<=e||0>e)throw"index out of bounds";return t},toggSel:function(t,l){var i=this;"number"==typeof l?(i.vRange(l),opt=i.E.find("option")[l]):opt=i.E.find('option[value="'+l+'"]')[0]||0,opt&&!opt.disabled&&opt.selected!=t&&(opt.selected=t,i.mob||e(opt).data("li").toggleClass("selected",t),i.callChange(),i.setPstate(),i.setText(),i.selAllState())},toggDis:function(e,t){var l=this.vRange(t);l.E.find("option")[t].disabled=e,e&&(l.E.find("option")[t].selected=!1),l.mob||l.optDiv.find("ul.options li").eq(t).toggleClass("disabled",e).removeClass("selected"),l.setText()},toggSumo:function(e){var t=this;return t.enabled=e,t.select.toggleClass("disabled",e),e?(t.E.attr("disabled","disabled"),t.select.removeAttr("tabindex")):(t.E.removeAttr("disabled"),t.select.attr("tabindex","0")),t},toggSelAll:function(t){var l=this;l.E.find("option").each(function(){l.E.find("option")[e(this).index()].disabled||(l.E.find("option")[e(this).index()].selected=t,l.mob||l.optDiv.find("ul.options li").eq(e(this).index()).toggleClass("selected",t),l.setText())}),!l.mob&&l.selAll&&l.selAll.removeClass("partial").toggleClass("selected",t),l.callChange(),l.setPstate()},reload:function(){var t=this.unload();return e(t).SumoSelect(l)},unload:function(){var e=this;return e.select.before(e.E),e.E.show(),l.outputAsCSV&&e.is_multi&&e.select.find("input.HEMANT123").length&&e.E.attr("name",e.select.find("input.HEMANT123").attr("name")),e.select.remove(),delete t.sumo,t},add:function(l,i,s){if("undefined"==typeof l)throw"No value to add";var n=this;if(opts=n.E.find("option"),"number"==typeof i&&(s=i,i=l),"undefined"==typeof i&&(i=l),opt=e("<option></option>").val(l).html(i),opts.length<s)throw"index out of bounds";return"undefined"==typeof s||opts.length==s?(n.E.append(opt),n.mob||n.ul.append(n.createLi(opt))):(opts.eq(s).before(opt),n.mob||n.ul.find("li.opt").eq(s).before(n.createLi(opt))),t},remove:function(e){var t=this.vRange(e);t.E.find("option").eq(e).remove(),t.mob||t.optDiv.find("ul.options li").eq(e).remove(),t.setText()},selectItem:function(e){this.toggSel(!0,e)},unSelectItem:function(e){this.toggSel(!1,e)},selectAll:function(){this.toggSelAll(!0)},unSelectAll:function(){this.toggSelAll(!1)},disableItem:function(e){this.toggDis(!0,e)},enableItem:function(e){this.toggDis(!1,e)},enabled:!0,enable:function(){return this.toggSumo(!1)},disable:function(){return this.toggSumo(!0)},init:function(){var e=this;return e.createElems(),e.setText(),e}},t.sumo.init())});return 1==s.length?s[0]:s}}(wjq);
    /* jQuery Custom Scroll plugin v0.6.6 | (c) 2015 Mostovoy Andrey | https://github.com/standy/custom-scroll/blob/master/LICENSE */
!function (t) {
    function i(i, n) {
        function s() {
            v.on("DOMMouseScroll mousewheel", function (i) {
                var o = t(this), r = this.scrollTop, e = this.scrollHeight, n = o.height(), s = "DOMMouseScroll" == i.type ? -40 * i.originalEvent.detail : i.originalEvent.wheelDelta, l = s > 0;
                (l ? 0 === r : r === e - n) && i.preventDefault();
            });
        }

        function l(o, r) {
            i["scroll" + r.Dir](0);
            var e = n.prefix + "bar" + r.suffix, s = i.children("." + e);
            s.length || (s = t(n.barHtml).addClass(e).appendTo(i)), s.on("mousedown touchstart", function (t) {
                t.preventDefault();
                var i = v["scroll" + r.Dir](), e = t[r.clientAxis] || t.originalEvent.changedTouches && t.originalEvent.changedTouches[0][r.clientAxis], n = a(o, r).ratio;
                y.on("mousemove.custom-scroll touchmove.custom-scroll", function (t) {
                    t.preventDefault();
                    var o = t[r.clientAxis] || t.originalEvent.changedTouches && t.originalEvent.changedTouches[0][r.clientAxis];
                    v["scroll" + r.Dir](i + (o - e) / n);
                }), y.on("mouseup.custom-scroll touchend.custom-scroll", function () {
                    y.off(".custom-scroll");
                });
            }), H[o] = s;
        }

        function a(t, o) {
            var r = 0 | v.prop("scroll" + o.Dim), e = i["inner" + o.Dim](), s = v["inner" + o.Dim](), l = e - n["offset" + o.Dir] - n["offset" + o.Dir2];
            m["x" == t ? "y" : "x"] || (l -= n["track" + o.Dim]);
            var a = Math.max(l * e / r | 0, n["barMin" + o.Dim]), c = (l - a) / (r - s);
            return {
                ratio: c,
                dim: e,
                scroll: l,
                total: r,
                bar: a
            };
        }

        function c() {
            t.each(u, d);
        }

        function d(t, o) {
            var r = a(t, o);
            if (r.total) {
                var e = v["scroll" + o.Dir]();
                if (p[t].scrollPos !== e || p[t].scroll !== r.scroll || p[t].total !== r.total) {
                    p[t] = r, p[t].scrollPos = e;
                    var s = r.bar >= r.scroll;
                    s !== m[t] && (i.toggleClass(n.prefix + "hidden" + o.suffix, s), m[t] = s);
                    var l = e * r.ratio;
                    0 > l && (l = 0), l > r.scroll - r.bar && (l = r.scroll - r.bar), H[t][o.dim](r.bar).css(o.dir, n["offset" + o.Dir] + l);
                }
            }
        }

        function h() {
            t.each(u, function (t) {
                H[t].remove();
            }), i.removeClass(n.prefix + "container").removeData("custom-scroll").css({
                padding: "",
                maxHeight: ""
            }), v.contents().appendTo(i), v.remove();
        }

        var f = i.data("custom-scroll");
        n = f ? f.options : t.extend({}, o, n);
        var u = {}, p = {}, m = {
            x: +n.vertical,
            y: +n.horizontal
        };
        if (n.horizontal && (u.x = e, p.x = {}), n.vertical && (u.y = r, p.y = {}), i.hasClass(n.prefix + "container") && f) return f.updateBars(),
            f;
        var v = i.children("." + n.prefix + "inner");
        v.length || (v = i.wrapInner('<div class="' + n.prefix + 'inner"></div>').children()),
            i.addClass(n.prefix + "container");
        var g = t('<div class="' + n.prefix + 'inner" />').width(100).height(100).appendTo("body").css({
            overflow: "scroll"
        })[0], x = g.offsetWidth - g.clientWidth, D = g.offsetHeight - g.clientHeight;
        g.parentElement.removeChild(g), n.vertical ? (v.css({
            paddingLeft: i.css("paddingLeft"),
            paddingRight: i.css("paddingRight"),
            marginRight: -x + "px"
        }), i.css({
            paddingLeft: 0,
            paddingRight: 0
        })) : v.css({
            overflowY: "hidden"
        }), n.horizontal ? (v.css({
            marginBottom: -D + "px",
            paddingBottom: D + "px"
        }), i.css({
            paddingTop: 0,
            paddingBottom: 0
        })) : v.css({
            overflowX: "hidden"
        });
        var b = i.css("maxHeight");
        parseInt(b) && (i.css("maxHeight", "none"), v.css("maxHeight", b)), i.scrollTop(0);
        var y = t("body"), H = {};
        t.each(u, l), v.on("scroll", c), c(), n.preventParentScroll && s();
        var T = {
            $container: i,
            $bar: H.y,
            $barX: H.x,
            $inner: v,
            destroy: h,
            updateBars: c,
            options: n
        };
        return i.data("custom-scroll", T), T;
    }

    t.fn.customScroll = function (r) {
        return this.length ? "destroy" === r ? (this.each(function () {
            var i = t(this).data("custom-scroll");
            i && i.destroy();
        }), this) : 1 === this.length ? i(this, r) : void this.each(function () {
            i(t(this), r);
        }) : t.extend(o, r);
    };
    var o = {
        prefix: "custom-scroll_",
        barMinHeight: 10,
        barMinWidth: 10,
        offsetTop: 0,
        offsetBottom: 0,
        offsetLeft: 0,
        offsetRight: 0,
        trackWidth: 10,
        trackHeight: 10,
        barHtml: "<div />",
        vertical: !0,
        horizontal: !0,
        preventParentScroll: !0
    }, r = {
        dim: "height",
        Dim: "Height",
        dir: "top",
        Dir: "Top",
        dir2: "bottom",
        Dir2: "Bottom",
        clientAxis: "clientY",
        suffix: "-y"
    }, e = {
        dim: "width",
        Dim: "Width",
        dir: "left",
        Dir: "Left",
        dir2: "right",
        Dir2: "Right",
        clientAxis: "clientX",
        suffix: "-x"
    };
}(wjq);
    /*
 * International Telephone Input v9.0.6
 * https://github.com/jackocnr/intl-tel-input.git
 * Licensed under the MIT license
 */
// wrap in UMD - see https://github.com/umdjs/umd/blob/master/jqueryPluginCommonjs.js
(function(factory) {
    if (typeof define === "function" && define.amd) {
        define([ "jquery" ], function($) {
            factory($, window, document);
        });
    } else if (typeof module === "object" && module.exports) {
        module.exports = factory(require("jquery"), window, document);
    } else {
        factory(wjq, window, document);
    }
})(function($, window, document, undefined) {
    "use strict";
    // these vars persist through all instances of the plugin
    var pluginName = "intlTelInput", id = 1, // give each instance it's own id for namespaced event handling
        defaults = {
            // whether or not to allow the dropdown
            allowDropdown: true,
            // if there is just a dial code in the input: remove it on blur, and re-add it on focus
            autoHideDialCode: true,
            // add or remove input placeholder with an example number for the selected country
            autoPlaceholder: true,
            // modify the auto placeholder
            customPlaceholder: null,
            // append menu to a specific element
            dropdownContainer: "",
            // don't display these countries
            excludeCountries: [],
            // format the input value during initialisation
            formatOnInit: true,
            // geoIp lookup function
            geoIpLookup: null,
            // initial country
            initialCountry: "",
            // don't insert international dial codes
            nationalMode: true,
            // number type to use for placeholders
            numberType: "MOBILE",
            // display only these countries
            onlyCountries: [],
            // the countries at the top of the list. defaults to united states and united kingdom
            preferredCountries: [ "us", "gb" ],
            // display the country dial code next to the selected flag so it's not part of the typed number
            separateDialCode: false,
            // specify the path to the libphonenumber script to enable validation/formatting
            utilsScript: ""
        }, keys = {
            UP: 38,
            DOWN: 40,
            ENTER: 13,
            ESC: 27,
            PLUS: 43,
            A: 65,
            Z: 90,
            SPACE: 32,
            TAB: 9
        };
    // keep track of if the window.load event has fired as impossible to check after the fact
    $(window).on("load", function() {
        // UPDATE: use a public static field so we can fudge it in the tests
        $.fn[pluginName].windowLoaded = true;
    });
    function Plugin(element, options) {
        this.telInput = $(element);
        this.options = $.extend({}, defaults, options);
        // event namespace
        this.ns = "." + pluginName + id++;
        // Chrome, FF, Safari, IE9+
        this.isGoodBrowser = Boolean(element.setSelectionRange);
        this.hadInitialPlaceholder = Boolean($(element).attr("placeholder"));
    }
    Plugin.prototype = {
        _init: function() {
            // if in nationalMode, disable options relating to dial codes
            if (this.options.nationalMode) {
                this.options.autoHideDialCode = false;
            }
            // if separateDialCode then doesn't make sense to A) insert dial code into input (autoHideDialCode), and B) display national numbers (because we're displaying the country dial code next to them)
            if (this.options.separateDialCode) {
                this.options.autoHideDialCode = this.options.nationalMode = false;
                // let's force this for now for simplicity - we can support this later if need be
                this.options.allowDropdown = true;
            }
            // we cannot just test screen size as some smartphones/website meta tags will report desktop resolutions
            // Note: for some reason jasmine breaks if you put this in the main Plugin function with the rest of these declarations
            // Note: to target Android Mobiles (and not Tablets), we must find "Android" and "Mobile"
            this.isMobile = /Android.+Mobile|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            if (this.isMobile) {
                // trigger the mobile dropdown css
                $("body").addClass("iti-mobile");
                // on mobile, we want a full screen dropdown, so we must append it to the body
                if (!this.options.dropdownContainer) {
                    this.options.dropdownContainer = "body";
                }
            }
            // we return these deferred objects from the _init() call so they can be watched, and then we resolve them when each specific request returns
            // Note: again, jasmine breaks when I put these in the Plugin function
            this.autoCountryDeferred = new $.Deferred();
            this.utilsScriptDeferred = new $.Deferred();
            // process all the data: onlyCountries, excludeCountries, preferredCountries etc
            this._processCountryData();
            // generate the markup
            this._generateMarkup();
            // set the initial state of the input value and the selected flag
            this._setInitialState();
            // start all of the event listeners: autoHideDialCode, input keydown, selectedFlag click
            this._initListeners();
            // utils script, and auto country
            this._initRequests();
            // return the deferreds
            return [ this.autoCountryDeferred, this.utilsScriptDeferred ];
        },
        /********************
         *  PRIVATE METHODS
         ********************/
        // prepare all of the country data, including onlyCountries, excludeCountries and preferredCountries options
        _processCountryData: function() {
            // process onlyCountries or excludeCountries array if present
            this._processAllCountries();
            // process the countryCodes map
            this._processCountryCodes();
            // process the preferredCountries
            this._processPreferredCountries();
        },
        // add a country code to this.countryCodes
        _addCountryCode: function(iso2, dialCode, priority) {
            if (!(dialCode in this.countryCodes)) {
                this.countryCodes[dialCode] = [];
            }
            var index = priority || 0;
            this.countryCodes[dialCode][index] = iso2;
        },
        // filter the given countries using the process function
        _filterCountries: function(countryArray, processFunc) {
            var i;
            // standardise case
            for (i = 0; i < countryArray.length; i++) {
                countryArray[i] = countryArray[i].toLowerCase();
            }
            // build instance country array
            this.countries = [];
            for (i = 0; i < allCountries.length; i++) {
                if (processFunc($.inArray(allCountries[i].iso2, countryArray))) {
                    this.countries.push(allCountries[i]);
                }
            }
        },
        // process onlyCountries or excludeCountries array if present
        _processAllCountries: function() {
            if (this.options.onlyCountries.length) {
                // process onlyCountries option
                this._filterCountries(this.options.onlyCountries, function(inArray) {
                    // if country is in array
                    return inArray != -1;
                });
            } else if (this.options.excludeCountries.length) {
                // process excludeCountries option
                this._filterCountries(this.options.excludeCountries, function(inArray) {
                    // if country is not in array
                    return inArray == -1;
                });
            } else {
                this.countries = allCountries;
            }
        },
        // process the countryCodes map
        _processCountryCodes: function() {
            this.countryCodes = {};
            for (var i = 0; i < this.countries.length; i++) {
                var c = this.countries[i];
                this._addCountryCode(c.iso2, c.dialCode, c.priority);
                // area codes
                if (c.areaCodes) {
                    for (var j = 0; j < c.areaCodes.length; j++) {
                        // full dial code is country code + dial code
                        this._addCountryCode(c.iso2, c.dialCode + c.areaCodes[j]);
                    }
                }
            }
        },
        // process preferred countries - iterate through the preferences, fetching the country data for each one
        _processPreferredCountries: function() {
            this.preferredCountries = [];
            for (var i = 0; i < this.options.preferredCountries.length; i++) {
                var countryCode = this.options.preferredCountries[i].toLowerCase(), countryData = this._getCountryData(countryCode, false, true);
                if (countryData) {
                    this.preferredCountries.push(countryData);
                }
            }
        },
        // generate all of the markup for the plugin: the selected flag overlay, and the dropdown
        _generateMarkup: function() {
            // prevent autocomplete as there's no safe, cross-browser event we can react to, so it can easily put the plugin in an inconsistent state e.g. the wrong flag selected for the autocompleted number, which on submit could mean the wrong number is saved (esp in nationalMode)
            this.telInput.attr("autocomplete", "off");
            // containers (mostly for positioning)
            var parentClass = "intl-tel-input";
            if (this.options.allowDropdown) {
                parentClass += " allow-dropdown";
            }
            if (this.options.separateDialCode) {
                parentClass += " separate-dial-code";
            }
            this.telInput.wrap($("<div>", {
                "class": parentClass
            }));
            this.flagsContainer = $("<div>", {
                "class": "flag-container"
            }).insertBefore(this.telInput);
            // currently selected flag (displayed to left of input)
            var selectedFlag = $("<div>", {
                "class": "selected-flag"
            });
            selectedFlag.appendTo(this.flagsContainer);
            this.selectedFlagInner = $("<div>", {
                "class": "iti-flag"
            }).appendTo(selectedFlag);
            if (this.options.separateDialCode) {
                this.selectedDialCode = $("<div>", {
                    "class": "selected-dial-code"
                }).appendTo(selectedFlag);
            }
            if (this.options.allowDropdown) {
                // make element focusable and tab naviagable
                selectedFlag.attr("tabindex", "0");
                // CSS triangle
                $("<div>", {
                    "class": "iti-arrow"
                }).appendTo(selectedFlag);
                // country dropdown: preferred countries, then divider, then all countries
                this.countryList = $("<ul>", {
                    "class": "country-list hide"
                });
                if (this.preferredCountries.length) {
                    this._appendListItems(this.preferredCountries, "preferred");
                    $("<li>", {
                        "class": "divider"
                    }).appendTo(this.countryList);
                }
                this._appendListItems(this.countries, "");
                // this is useful in lots of places
                this.countryListItems = this.countryList.children(".country");
                // create dropdownContainer markup
                if (this.options.dropdownContainer) {
                    this.dropdown = $("<div>", {
                        "class": "intl-tel-input iti-container"
                    }).append(this.countryList);
                } else {
                    this.countryList.appendTo(this.flagsContainer);
                }
            } else {
                // a little hack so we don't break anything
                this.countryListItems = $();
            }
        },
        // add a country <li> to the countryList <ul> container
        _appendListItems: function(countries, className) {
            // we create so many DOM elements, it is faster to build a temp string
            // and then add everything to the DOM in one go at the end
            var tmp = "";
            // for each country
            for (var i = 0; i < countries.length; i++) {
                var c = countries[i];
                // open the list item
                tmp += "<li class='country " + className + "' data-dial-code='" + c.dialCode + "' data-country-code='" + c.iso2 + "'>";
                // add the flag
                tmp += "<div class='flag-box'><div class='iti-flag " + c.iso2 + "'></div></div>";
                // and the country name and dial code
                tmp += "<span class='country-name'>" + c.name + "</span>";
                tmp += "<span class='dial-code'>+" + c.dialCode + "</span>";
                // close the list item
                tmp += "</li>";
            }
            this.countryList.append(tmp);
        },
        // set the initial state of the input value and the selected flag by:
        // 1. extracting a dial code from the given number
        // 2. using explicit initialCountry
        // 3. picking the first preferred country
        // 4. picking the first country
        _setInitialState: function() {
            var val = this.telInput.val();
            // if we already have a dial code we can go ahead and set the flag, else fall back to default
            if (this._getDialCode(val)) {
                this._updateFlagFromNumber(val, true);
            } else if (this.options.initialCountry !== "auto") {
                // see if we should select a flag
                if (this.options.initialCountry) {
                    this._setFlag(this.options.initialCountry, true);
                } else {
                    // no dial code and no initialCountry, so default to first in list
                    this.defaultCountry = this.preferredCountries.length ? this.preferredCountries[0].iso2 : this.countries[0].iso2;
                    if (!val) {
                        this._setFlag(this.defaultCountry, true);
                    }
                }
                // if empty and no nationalMode and no autoHideDialCode then insert the default dial code
                if (!val && !this.options.nationalMode && !this.options.autoHideDialCode && !this.options.separateDialCode) {
                    this.telInput.val("+" + this.selectedCountryData.dialCode);
                }
            }
            // NOTE: if initialCountry is set to auto, that will be handled separately
            // format
            if (val) {
                // this wont be run after _updateDialCode as that's only called if no val
                this._updateValFromNumber(val, this.options.formatOnInit);
            }
        },
        // initialise the main event listeners: input keyup, and click selected flag
        _initListeners: function() {
            this._initKeyListeners();
            if (this.options.autoHideDialCode) {
                this._initFocusListeners();
            }
            if (this.options.allowDropdown) {
                this._initDropdownListeners();
            }
        },
        // initialise the dropdown listeners
        _initDropdownListeners: function() {
            var that = this;
            // hack for input nested inside label: clicking the selected-flag to open the dropdown would then automatically trigger a 2nd click on the input which would close it again
            var label = this.telInput.closest("label");
            if (label.length) {
                label.on("click" + this.ns, function(e) {
                    // if the dropdown is closed, then focus the input, else ignore the click
                    if (that.countryList.hasClass("hide")) {
                        that.telInput.focus();
                    } else {
                        e.preventDefault();
                    }
                });
            }
            // toggle country dropdown on click
            var selectedFlag = this.selectedFlagInner.parent();
            selectedFlag.on("click" + this.ns, function(e) {
                // only intercept this event if we're opening the dropdown
                // else let it bubble up to the top ("click-off-to-close" listener)
                // we cannot just stopPropagation as it may be needed to close another instance
                if (that.countryList.hasClass("hide") && !that.telInput.prop("disabled") && !that.telInput.prop("readonly")) {
                    that._showDropdown();
                }
            });
            // open dropdown list if currently focused
            this.flagsContainer.on("keydown" + that.ns, function(e) {
                var isDropdownHidden = that.countryList.hasClass("hide");
                if (isDropdownHidden && (e.which == keys.UP || e.which == keys.DOWN || e.which == keys.SPACE || e.which == keys.ENTER)) {
                    // prevent form from being submitted if "ENTER" was pressed
                    e.preventDefault();
                    // prevent event from being handled again by document
                    e.stopPropagation();
                    that._showDropdown();
                }
                // allow navigation from dropdown to input on TAB
                if (e.which == keys.TAB) {
                    that._closeDropdown();
                }
            });
        },
        // init many requests: utils script / geo ip lookup
        _initRequests: function() {
            var that = this;
            // if the user has specified the path to the utils script, fetch it on window.load, else resolve
            if (this.options.utilsScript) {
                // if the plugin is being initialised after the window.load event has already been fired
                if ($.fn[pluginName].windowLoaded) {
                    $.fn[pluginName].loadUtils(this.options.utilsScript, this.utilsScriptDeferred);
                } else {
                    // wait until the load event so we don't block any other requests e.g. the flags image
                    $(window).on("load", function() {
                        $.fn[pluginName].loadUtils(that.options.utilsScript, that.utilsScriptDeferred);
                    });
                }
            } else {
                this.utilsScriptDeferred.resolve();
            }
            if (this.options.initialCountry === "auto") {
                this._loadAutoCountry();
            } else {
                this.autoCountryDeferred.resolve();
            }
        },
        // perform the geo ip lookup
        _loadAutoCountry: function() {
            var that = this;
            // 3 options:
            // 1) already loaded (we're done)
            // 2) not already started loading (start)
            // 3) already started loading (do nothing - just wait for loading callback to fire)
            if ($.fn[pluginName].autoCountry) {
                this.handleAutoCountry();
            } else if (!$.fn[pluginName].startedLoadingAutoCountry) {
                // don't do this twice!
                $.fn[pluginName].startedLoadingAutoCountry = true;
                if (typeof this.options.geoIpLookup === "function") {
                    this.options.geoIpLookup(function(countryCode) {
                        $.fn[pluginName].autoCountry = countryCode.toLowerCase();
                        // tell all instances the auto country is ready
                        // TODO: this should just be the current instances
                        // UPDATE: use setTimeout in case their geoIpLookup function calls this callback straight away (e.g. if they have already done the geo ip lookup somewhere else). Using setTimeout means that the current thread of execution will finish before executing this, which allows the plugin to finish initialising.
                        setTimeout(function() {
                            $(".intl-tel-input input").intlTelInput("handleAutoCountry");
                        });
                    });
                }
            }
        },
        // initialize any key listeners
        _initKeyListeners: function() {
            var that = this;
            // update flag on keyup
            // (keep this listener separate otherwise the setTimeout breaks all the tests)
            this.telInput.on("keyup" + this.ns, function() {
                that._updateFlagFromNumber(that.telInput.val());
            });
            // update flag on cut/paste events (now supported in all major browsers)
            this.telInput.on("cut" + this.ns + " paste" + this.ns, function() {
                // hack because "paste" event is fired before input is updated
                setTimeout(function() {
                    that._updateFlagFromNumber(that.telInput.val());
                });
            });
        },
        // adhere to the input's maxlength attr
        _cap: function(number) {
            var max = this.telInput.attr("maxlength");
            return max && number.length > max ? number.substr(0, max) : number;
        },
        // listen for mousedown, focus and blur
        _initFocusListeners: function() {
            var that = this;
            // mousedown decides where the cursor goes, so if we're focusing we must preventDefault as we'll be inserting the dial code, and we want the cursor to be at the end no matter where they click
            this.telInput.on("mousedown" + this.ns, function(e) {
                if (!that.telInput.is(":focus") && !that.telInput.val()) {
                    e.preventDefault();
                    // but this also cancels the focus, so we must trigger that manually
                    that.telInput.focus();
                }
            });
            // on focus: if empty, insert the dial code for the currently selected flag
            this.telInput.on("focus" + this.ns, function(e) {
                if (!that.telInput.val() && !that.telInput.prop("readonly") && that.selectedCountryData.dialCode) {
                    // insert the dial code
                    that.telInput.val("+" + that.selectedCountryData.dialCode);
                    // after auto-inserting a dial code, if the first key they hit is '+' then assume they are entering a new number, so remove the dial code. use keypress instead of keydown because keydown gets triggered for the shift key (required to hit the + key), and instead of keyup because that shows the new '+' before removing the old one
                    that.telInput.one("keypress.plus" + that.ns, function(e) {
                        if (e.which == keys.PLUS) {
                            that.telInput.val("");
                        }
                    });
                    // after tabbing in, make sure the cursor is at the end we must use setTimeout to get outside of the focus handler as it seems the selection happens after that
                    setTimeout(function() {
                        var input = that.telInput[0];
                        if (that.isGoodBrowser) {
                            var len = that.telInput.val().length;
                            input.setSelectionRange(len, len);
                        }
                    });
                }
            });
            // on blur or form submit: if just a dial code then remove it
            var form = this.telInput.prop("form");
            if (form) {
                $(form).on("submit" + this.ns, function() {
                    that._removeEmptyDialCode();
                });
            }
            this.telInput.on("blur" + this.ns, function() {
                that._removeEmptyDialCode();
            });
        },
        _removeEmptyDialCode: function() {
            var value = this.telInput.val(), startsPlus = value.charAt(0) == "+";
            if (startsPlus) {
                var numeric = this._getNumeric(value);
                // if just a plus, or if just a dial code
                if (!numeric || this.selectedCountryData.dialCode == numeric) {
                    this.telInput.val("");
                }
            }
            // remove the keypress listener we added on focus
            this.telInput.off("keypress.plus" + this.ns);
        },
        // extract the numeric digits from the given string
        _getNumeric: function(s) {
            return s.replace(/\D/g, "");
        },
        // show the dropdown
        _showDropdown: function() {
            this._setDropdownPosition();
            // update highlighting and scroll to active list item
            var activeListItem = this.countryList.children(".active");
            if (activeListItem.length) {
                this._highlightListItem(activeListItem);
                this._scrollTo(activeListItem);
            }
            // bind all the dropdown-related listeners: mouseover, click, click-off, keydown
            this._bindDropdownListeners();
            // update the arrow
            this.selectedFlagInner.children(".iti-arrow").addClass("up");
        },
        // decide where to position dropdown (depends on position within viewport, and scroll)
        _setDropdownPosition: function() {
            var that = this;
            if (this.options.dropdownContainer) {
                this.dropdown.appendTo(this.options.dropdownContainer);
            }
            // show the menu and grab the dropdown height
            this.dropdownHeight = this.countryList.removeClass("hide").outerHeight();
            if (!this.isMobile) {
                var pos = this.telInput.offset(), inputTop = pos.top, windowTop = $(window).scrollTop(), // dropdownFitsBelow = (dropdownBottom < windowBottom)
                    dropdownFitsBelow = inputTop + this.telInput.outerHeight() + this.dropdownHeight < windowTop + $(window).height(), dropdownFitsAbove = inputTop - this.dropdownHeight > windowTop;
                // by default, the dropdown will be below the input. If we want to position it above the input, we add the dropup class.
                this.countryList.toggleClass("dropup", !dropdownFitsBelow && dropdownFitsAbove);
                // if dropdownContainer is enabled, calculate postion
                if (this.options.dropdownContainer) {
                    // by default the dropdown will be directly over the input because it's not in the flow. If we want to position it below, we need to add some extra top value.
                    var extraTop = !dropdownFitsBelow && dropdownFitsAbove ? 0 : this.telInput.innerHeight();
                    // calculate placement
                    this.dropdown.css({
                        top: inputTop + extraTop,
                        left: pos.left
                    });
                    // close menu on window scroll
                    $(window).on("scroll" + this.ns, function() {
                        that._closeDropdown();
                    });
                }
            }
        },
        // we only bind dropdown listeners when the dropdown is open
        _bindDropdownListeners: function() {
            var that = this;
            // when mouse over a list item, just highlight that one
            // we add the class "highlight", so if they hit "enter" we know which one to select
            this.countryList.on("mouseover" + this.ns, ".country", function(e) {
                that._highlightListItem($(this));
            });
            // listen for country selection
            this.countryList.on("click" + this.ns, ".country", function(e) {
                that._selectListItem($(this));
            });
            // click off to close
            // (except when this initial opening click is bubbling up)
            // we cannot just stopPropagation as it may be needed to close another instance
            var isOpening = true;
            $("html").on("click" + this.ns, function(e) {
                if (!isOpening) {
                    that._closeDropdown();
                }
                isOpening = false;
            });
            // listen for up/down scrolling, enter to select, or letters to jump to country name.
            // use keydown as keypress doesn't fire for non-char keys and we want to catch if they
            // just hit down and hold it to scroll down (no keyup event).
            // listen on the document because that's where key events are triggered if no input has focus
            var query = "", queryTimer = null;
            $(document).on("keydown" + this.ns, function(e) {
                // prevent down key from scrolling the whole page,
                // and enter key from submitting a form etc
                e.preventDefault();
                if (e.which == keys.UP || e.which == keys.DOWN) {
                    // up and down to navigate
                    that._handleUpDownKey(e.which);
                } else if (e.which == keys.ENTER) {
                    // enter to select
                    that._handleEnterKey();
                } else if (e.which == keys.ESC) {
                    // esc to close
                    that._closeDropdown();
                } else if (e.which >= keys.A && e.which <= keys.Z || e.which == keys.SPACE) {
                    // upper case letters (note: keyup/keydown only return upper case letters)
                    // jump to countries that start with the query string
                    if (queryTimer) {
                        clearTimeout(queryTimer);
                    }
                    query += String.fromCharCode(e.which);
                    that._searchForCountry(query);
                    // if the timer hits 1 second, reset the query
                    queryTimer = setTimeout(function() {
                        query = "";
                    }, 1e3);
                }
            });
        },
        // highlight the next/prev item in the list (and ensure it is visible)
        _handleUpDownKey: function(key) {
            var current = this.countryList.children(".highlight").first();
            var next = key == keys.UP ? current.prev() : current.next();
            if (next.length) {
                // skip the divider
                if (next.hasClass("divider")) {
                    next = key == keys.UP ? next.prev() : next.next();
                }
                this._highlightListItem(next);
                this._scrollTo(next);
            }
        },
        // select the currently highlighted item
        _handleEnterKey: function() {
            var currentCountry = this.countryList.children(".highlight").first();
            if (currentCountry.length) {
                this._selectListItem(currentCountry);
            }
        },
        // find the first list item whose name starts with the query string
        _searchForCountry: function(query) {
            for (var i = 0; i < this.countries.length; i++) {
                if (this._startsWith(this.countries[i].name, query)) {
                    var listItem = this.countryList.children("[data-country-code=" + this.countries[i].iso2 + "]").not(".preferred");
                    // update highlighting and scroll
                    this._highlightListItem(listItem);
                    this._scrollTo(listItem, true);
                    break;
                }
            }
        },
        // check if (uppercase) string a starts with string b
        _startsWith: function(a, b) {
            return a.substr(0, b.length).toUpperCase() == b;
        },
        // update the input's value to the given val (format first if possible)
        // NOTE: this is called from _setInitialState, handleUtils and setNumber
        _updateValFromNumber: function(number, doFormat) {
            if (doFormat && window.intlTelInputUtils && this.selectedCountryData) {
                var format = !this.options.separateDialCode && (this.options.nationalMode || number.charAt(0) != "+") ? intlTelInputUtils.numberFormat.NATIONAL : intlTelInputUtils.numberFormat.INTERNATIONAL;
                number = intlTelInputUtils.formatNumber(number, this.selectedCountryData.iso2, format);
            }
            number = this._beforeSetNumber(number);
            this.telInput.val(number);
        },
        // check if need to select a new flag based on the given number
        // Note: called from _setInitialState, keyup handler, setNumber
        _updateFlagFromNumber: function(number, isInit) {
            // if we're in nationalMode and we already have US/Canada selected, make sure the number starts with a +1 so _getDialCode will be able to extract the area code
            // update: if we dont yet have selectedCountryData, but we're here (trying to update the flag from the number), that means we're initialising the plugin with a number that already has a dial code, so fine to ignore this bit
            if (number && this.options.nationalMode && this.selectedCountryData && this.selectedCountryData.dialCode == "1" && number.charAt(0) != "+") {
                if (number.charAt(0) != "1") {
                    number = "1" + number;
                }
                number = "+" + number;
            }
            // try and extract valid dial code from input
            var dialCode = this._getDialCode(number), countryCode = null;
            if (dialCode) {
                // check if one of the matching countries is already selected
                var countryCodes = this.countryCodes[this._getNumeric(dialCode)], alreadySelected = this.selectedCountryData && $.inArray(this.selectedCountryData.iso2, countryCodes) != -1;
                // if a matching country is not already selected (or this is an unknown NANP area code): choose the first in the list
                if (!alreadySelected || this._isUnknownNanp(number, dialCode)) {
                    // if using onlyCountries option, countryCodes[0] may be empty, so we must find the first non-empty index
                    for (var j = 0; j < countryCodes.length; j++) {
                        if (countryCodes[j]) {
                            countryCode = countryCodes[j];
                            break;
                        }
                    }
                }
            } else if (number.charAt(0) == "+" && this._getNumeric(number).length) {
                // invalid dial code, so empty
                // Note: use getNumeric here because the number has not been formatted yet, so could contain bad chars
                countryCode = "";
            } else if (!number || number == "+") {
                // empty, or just a plus, so default
                countryCode = this.defaultCountry;
            }
            if (countryCode !== null) {
                this._setFlag(countryCode, isInit);
            }
        },
        // check if the given number contains an unknown area code from the North American Numbering Plan i.e. the only dialCode that could be extracted was +1 (instead of say +1 702) and the actual number's length is >=4
        _isUnknownNanp: function(number, dialCode) {
            return dialCode == "+1" && this._getNumeric(number).length >= 4;
        },
        // remove highlighting from other list items and highlight the given item
        _highlightListItem: function(listItem) {
            this.countryListItems.removeClass("highlight");
            listItem.addClass("highlight");
        },
        // find the country data for the given country code
        // the ignoreOnlyCountriesOption is only used during init() while parsing the onlyCountries array
        _getCountryData: function(countryCode, ignoreOnlyCountriesOption, allowFail) {
            var countryList = ignoreOnlyCountriesOption ? allCountries : this.countries;
            for (var i = 0; i < countryList.length; i++) {
                if (countryList[i].iso2 == countryCode) {
                    return countryList[i];
                }
            }
            if (allowFail) {
                return null;
            } else {
                throw new Error("No country data for '" + countryCode + "'");
            }
        },
        // select the given flag, update the placeholder and the active list item
        // Note: called from _setInitialState, _updateFlagFromNumber, _selectListItem, setCountry
        _setFlag: function(countryCode, isInit) {
            var prevCountry = this.selectedCountryData && this.selectedCountryData.iso2 ? this.selectedCountryData : {};
            // do this first as it will throw an error and stop if countryCode is invalid
            this.selectedCountryData = countryCode ? this._getCountryData(countryCode, false, false) : {};
            // update the defaultCountry - we only need the iso2 from now on, so just store that
            if (this.selectedCountryData.iso2) {
                this.defaultCountry = this.selectedCountryData.iso2;
            }
            this.selectedFlagInner.attr("class", "iti-flag " + countryCode);
            // update the selected country's title attribute
            var title = countryCode ? this.selectedCountryData.name + ": +" + this.selectedCountryData.dialCode : "Unknown";
            this.selectedFlagInner.parent().attr("title", title);
            if (this.options.separateDialCode) {
                var dialCode = this.selectedCountryData.dialCode ? "+" + this.selectedCountryData.dialCode : "", parent = this.telInput.parent();
                if (prevCountry.dialCode) {
                    parent.removeClass("iti-sdc-" + (prevCountry.dialCode.length + 1));
                }
                if (dialCode) {
                    parent.addClass("iti-sdc-" + dialCode.length);
                }
                this.selectedDialCode.text(dialCode);
            }
            // and the input's placeholder
            this._updatePlaceholder();
            // update the active list item
            this.countryListItems.removeClass("active");
            if (countryCode) {
                this.countryListItems.find(".iti-flag." + countryCode).first().closest(".country").addClass("active");
            }
            // on change flag, trigger a custom event
            if (!isInit && prevCountry.iso2 !== countryCode) {
                this.telInput.trigger("countrychange", this.selectedCountryData);
            }
        },
        // update the input placeholder to an example number from the currently selected country
        _updatePlaceholder: function() {
            if (window.intlTelInputUtils && !this.hadInitialPlaceholder && this.options.autoPlaceholder && this.selectedCountryData) {
                var numberType = intlTelInputUtils.numberType[this.options.numberType], placeholder = this.selectedCountryData.iso2 ? intlTelInputUtils.getExampleNumber(this.selectedCountryData.iso2, this.options.nationalMode, numberType) : "";
                placeholder = this._beforeSetNumber(placeholder);
                if (typeof this.options.customPlaceholder === "function") {
                    placeholder = this.options.customPlaceholder(placeholder, this.selectedCountryData);
                }
                this.telInput.attr("placeholder", placeholder);
            }
        },
        // called when the user selects a list item from the dropdown
        _selectListItem: function(listItem) {
            // update selected flag and active list item
            this._setFlag(listItem.attr("data-country-code"));
            this._closeDropdown();
            this._updateDialCode(listItem.attr("data-dial-code"), true);
            // focus the input
            this.telInput.focus();
            // put cursor at end - this fix is required for FF and IE11 (with nationalMode=false i.e. auto inserting dial code), who try to put the cursor at the beginning the first time
            if (this.isGoodBrowser) {
                var len = this.telInput.val().length;
                this.telInput[0].setSelectionRange(len, len);
            }
        },
        // close the dropdown and unbind any listeners
        _closeDropdown: function() {
            this.countryList.addClass("hide");
            // update the arrow
            this.selectedFlagInner.children(".iti-arrow").removeClass("up");
            // unbind key events
            $(document).off(this.ns);
            // unbind click-off-to-close
            $("html").off(this.ns);
            // unbind hover and click listeners
            this.countryList.off(this.ns);
            // remove menu from container
            if (this.options.dropdownContainer) {
                if (!this.isMobile) {
                    $(window).off("scroll" + this.ns);
                }
                this.dropdown.detach();
            }
        },
        // check if an element is visible within it's container, else scroll until it is
        _scrollTo: function(element, middle) {
            var container = this.countryList, containerHeight = container.height(), containerTop = container.offset().top, containerBottom = containerTop + containerHeight, elementHeight = element.outerHeight(), elementTop = element.offset().top, elementBottom = elementTop + elementHeight, newScrollTop = elementTop - containerTop + container.scrollTop(), middleOffset = containerHeight / 2 - elementHeight / 2;
            if (elementTop < containerTop) {
                // scroll up
                if (middle) {
                    newScrollTop -= middleOffset;
                }
                container.scrollTop(newScrollTop);
            } else if (elementBottom > containerBottom) {
                // scroll down
                if (middle) {
                    newScrollTop += middleOffset;
                }
                var heightDifference = containerHeight - elementHeight;
                container.scrollTop(newScrollTop - heightDifference);
            }
        },
        // replace any existing dial code with the new one
        // Note: called from _selectListItem and setCountry
        _updateDialCode: function(newDialCode, hasSelectedListItem) {
            var inputVal = this.telInput.val(), newNumber;
            // save having to pass this every time
            newDialCode = "+" + newDialCode;
            if (inputVal.charAt(0) == "+") {
                // there's a plus so we're dealing with a replacement (doesn't matter if nationalMode or not)
                var prevDialCode = this._getDialCode(inputVal);
                if (prevDialCode) {
                    // current number contains a valid dial code, so replace it
                    newNumber = inputVal.replace(prevDialCode, newDialCode);
                } else {
                    // current number contains an invalid dial code, so ditch it
                    // (no way to determine where the invalid dial code ends and the rest of the number begins)
                    newNumber = newDialCode;
                }
            } else if (this.options.nationalMode || this.options.separateDialCode) {
                // don't do anything
                return;
            } else {
                // nationalMode is disabled
                if (inputVal) {
                    // there is an existing value with no dial code: prefix the new dial code
                    newNumber = newDialCode + inputVal;
                } else if (hasSelectedListItem || !this.options.autoHideDialCode) {
                    // no existing value and either they've just selected a list item, or autoHideDialCode is disabled: insert new dial code
                    newNumber = newDialCode;
                } else {
                    return;
                }
            }
            this.telInput.val(newNumber);
        },
        // try and extract a valid international dial code from a full telephone number
        // Note: returns the raw string inc plus character and any whitespace/dots etc
        _getDialCode: function(number) {
            var dialCode = "";
            // only interested in international numbers (starting with a plus)
            if (number.charAt(0) == "+") {
                var numericChars = "";
                // iterate over chars
                for (var i = 0; i < number.length; i++) {
                    var c = number.charAt(i);
                    // if char is number
                    if ($.isNumeric(c)) {
                        numericChars += c;
                        // if current numericChars make a valid dial code
                        if (this.countryCodes[numericChars]) {
                            // store the actual raw string (useful for matching later)
                            dialCode = number.substr(0, i + 1);
                        }
                        // longest dial code is 4 chars
                        if (numericChars.length == 4) {
                            break;
                        }
                    }
                }
            }
            return dialCode;
        },
        // get the input val, adding the dial code if separateDialCode is enabled
        _getFullNumber: function() {
            var prefix = this.options.separateDialCode ? "+" + this.selectedCountryData.dialCode : "";
            return prefix + this.telInput.val();
        },
        // remove the dial code if separateDialCode is enabled
        _beforeSetNumber: function(number) {
            if (this.options.separateDialCode) {
                var dialCode = this._getDialCode(number);
                if (dialCode) {
                    // US dialCode is "+1", which is what we want
                    // CA dialCode is "+1 123", which is wrong - should be "+1" (as it has multiple area codes)
                    // AS dialCode is "+1 684", which is what we want
                    // Solution: if the country has area codes, then revert to just the dial code
                    if (this.selectedCountryData.areaCodes !== null) {
                        dialCode = "+" + this.selectedCountryData.dialCode;
                    }
                    // a lot of numbers will have a space separating the dial code and the main number, and some NANP numbers will have a hyphen e.g. +1 684-733-1234 - in both cases we want to get rid of it
                    // NOTE: don't just trim all non-numerics as may want to preserve an open parenthesis etc
                    var start = number[dialCode.length] === " " || number[dialCode.length] === "-" ? dialCode.length + 1 : dialCode.length;
                    number = number.substr(start);
                }
            }
            return this._cap(number);
        },
        /********************
         *  PUBLIC METHODS
         ********************/
        // this is called when the geoip call returns
        handleAutoCountry: function() {
            if (this.options.initialCountry === "auto") {
                // we must set this even if there is an initial val in the input: in case the initial val is invalid and they delete it - they should see their auto country
                this.defaultCountry = $.fn[pluginName].autoCountry;
                // if there's no initial value in the input, then update the flag
                if (!this.telInput.val()) {
                    this.setCountry(this.defaultCountry);
                }
                this.autoCountryDeferred.resolve();
            }
        },
        // remove plugin
        destroy: function() {
            if (this.allowDropdown) {
                // make sure the dropdown is closed (and unbind listeners)
                this._closeDropdown();
                // click event to open dropdown
                this.selectedFlagInner.parent().off(this.ns);
                // label click hack
                this.telInput.closest("label").off(this.ns);
            }
            // unbind submit event handler on form
            if (this.options.autoHideDialCode) {
                var form = this.telInput.prop("form");
                if (form) {
                    $(form).off(this.ns);
                }
            }
            // unbind all events: key events, and focus/blur events if autoHideDialCode=true
            this.telInput.off(this.ns);
            // remove markup (but leave the original input)
            var container = this.telInput.parent();
            container.before(this.telInput).remove();
        },
        // get the extension from the current number
        getExtension: function() {
            if (window.intlTelInputUtils) {
                return intlTelInputUtils.getExtension(this._getFullNumber(), this.selectedCountryData.iso2);
            }
            return "";
        },
        // format the number to the given format
        getNumber: function(format) {
            if (window.intlTelInputUtils) {
                return intlTelInputUtils.formatNumber(this._getFullNumber(), this.selectedCountryData.iso2, format);
            }
            return "";
        },
        // get the type of the entered number e.g. landline/mobile
        getNumberType: function() {
            if (window.intlTelInputUtils) {
                return intlTelInputUtils.getNumberType(this._getFullNumber(), this.selectedCountryData.iso2);
            }
            return -99;
        },
        // get the country data for the currently selected flag
        getSelectedCountryData: function() {
            // if this is undefined, the plugin will return it's instance instead, so in that case an empty object makes more sense
            return this.selectedCountryData || {};
        },
        // get the validation error
        getValidationError: function() {
            if (window.intlTelInputUtils) {
                return intlTelInputUtils.getValidationError(this._getFullNumber(), this.selectedCountryData.iso2);
            }
            return -99;
        },
        // validate the input val - assumes the global function isValidNumber (from utilsScript)
        isValidNumber: function() {
            var val = $.trim(this._getFullNumber()), countryCode = this.options.nationalMode ? this.selectedCountryData.iso2 : "";
            return window.intlTelInputUtils ? intlTelInputUtils.isValidNumber(val, countryCode) : null;
        },
        // update the selected flag, and update the input val accordingly
        setCountry: function(countryCode) {
            countryCode = countryCode.toLowerCase();
            // check if already selected
            if (!this.selectedFlagInner.hasClass(countryCode)) {
                this._setFlag(countryCode);
                this._updateDialCode(this.selectedCountryData.dialCode, false);
            }
        },
        // set the input value and update the flag
        // NOTE: preventFormat arg is for public method
        setNumber: function(number, preventFormat) {
            // we must update the flag first, which updates this.selectedCountryData, which is used for formatting the number before displaying it
            this._updateFlagFromNumber(number);
            this._updateValFromNumber(number, !preventFormat);
        },
        // this is called when the utils request completes
        handleUtils: function() {
            // if the request was successful
            if (window.intlTelInputUtils) {
                // if there's an initial value in the input, then format it
                if (this.telInput.val()) {
                    this._updateValFromNumber(this.telInput.val(), this.options.formatOnInit);
                }
                this._updatePlaceholder();
            }
            this.utilsScriptDeferred.resolve();
        }
    };
    // using https://github.com/jquery-boilerplate/jquery-boilerplate/wiki/Extending-jQuery-Boilerplate
    // (adapted to allow public functions)
    $.fn[pluginName] = function(options) {
        var args = arguments;
        // Is the first parameter an object (options), or was omitted,
        // instantiate a new instance of the plugin.
        if (options === undefined || typeof options === "object") {
            // collect all of the deferred objects for all instances created with this selector
            var deferreds = [];
            this.each(function() {
                if (!$.data(this, "plugin_" + pluginName)) {
                    var instance = new Plugin(this, options);
                    var instanceDeferreds = instance._init();
                    // we now have 2 deffereds: 1 for auto country, 1 for utils script
                    deferreds.push(instanceDeferreds[0]);
                    deferreds.push(instanceDeferreds[1]);
                    $.data(this, "plugin_" + pluginName, instance);
                }
            });
            // return the promise from the "master" deferred object that tracks all the others
            return $.when.apply(null, deferreds);
        } else if (typeof options === "string" && options[0] !== "_") {
            // If the first parameter is a string and it doesn't start
            // with an underscore or "contains" the `init`-function,
            // treat this as a call to a public method.
            // Cache the method call to make it possible to return a value
            var returns;
            this.each(function() {
                var instance = $.data(this, "plugin_" + pluginName);
                // Tests that there's already a plugin-instance
                // and checks that the requested public method exists
                if (instance instanceof Plugin && typeof instance[options] === "function") {
                    // Call the method of our plugin instance,
                    // and pass it the supplied arguments.
                    returns = instance[options].apply(instance, Array.prototype.slice.call(args, 1));
                }
                // Allow instances to be destroyed via the 'destroy' method
                if (options === "destroy") {
                    $.data(this, "plugin_" + pluginName, null);
                }
            });
            // If the earlier cached method gives a value back return the value,
            // otherwise return this to preserve chainability.
            return returns !== undefined ? returns : this;
        }
    };
    /********************
     *  STATIC METHODS
     ********************/
    // get the country data object
    $.fn[pluginName].getCountryData = function() {
        return allCountries;
    };
    // load the utils script
    $.fn[pluginName].loadUtils = function(path, utilsScriptDeferred) {
        if (!$.fn[pluginName].loadedUtilsScript) {
            // don't do this twice! (dont just check if window.intlTelInputUtils exists as if init plugin multiple times in quick succession, it may not have finished loading yet)
            $.fn[pluginName].loadedUtilsScript = true;
            // dont use $.getScript as it prevents caching
            $.ajax({
                url: path,
                complete: function() {
                    // tell all instances that the utils request is complete
                    $(".intl-tel-input input").intlTelInput("handleUtils");
                },
                dataType: "script",
                cache: true
            });
        } else if (utilsScriptDeferred) {
            utilsScriptDeferred.resolve();
        }
    };
    // version
    $.fn[pluginName].version = "9.0.6";
    // Tell JSHint to ignore this warning: "character may get silently deleted by one or more browsers"
    // jshint -W100
    // Array of country objects for the flag dropdown.
    // Each contains a name, country code (ISO 3166-1 alpha-2) and dial code.
    // Originally from https://github.com/mledoze/countries
    // then with a couple of manual re-arrangements to be alphabetical
    // then changed Kazakhstan from +76 to +7
    // and Vatican City from +379 to +39 (see issue 50)
    // and Caribean Netherlands from +5997 to +599
    // and Curacao from +5999 to +599
    // Removed:  Kosovo, Pitcairn Islands, South Georgia
    // UPDATE Sept 12th 2015
    // List of regions that have iso2 country codes, which I have chosen to omit:
    // (based on this information: https://en.wikipedia.org/wiki/List_of_country_calling_codes)
    // AQ - Antarctica - all different country codes depending on which "base"
    // BV - Bouvet Island - no calling code
    // GS - South Georgia and the South Sandwich Islands - "inhospitable collection of islands" - same flag and calling code as Falkland Islands
    // HM - Heard Island and McDonald Islands - no calling code
    // PN - Pitcairn - tiny population (56), same calling code as New Zealand
    // TF - French Southern Territories - no calling code
    // UM - United States Minor Outlying Islands - no calling code
    // UPDATE the criteria of supported countries or territories (see issue 297)
    // Have an iso2 code: https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2
    // Have a country calling code: https://en.wikipedia.org/wiki/List_of_country_calling_codes
    // Have a flag
    // Must be supported by libphonenumber: https://github.com/googlei18n/libphonenumber
    // Update: converted objects to arrays to save bytes!
    // Update: added "priority" for countries with the same dialCode as others
    // Update: added array of area codes for countries with the same dialCode as others
    // So each country array has the following information:
    // [
    //    Country name,
    //    iso2 code,
    //    International dial code,
    //    Order (if >1 country with same dial code),
    //    Area codes (if >1 country with same dial code)
    // ]
    var allCountries = [ [ "Afghanistan ()", "af", "93" ], [ "Albania (Shqipri)", "al", "355" ], [ "Algeria ()", "dz", "213" ], [ "American Samoa", "as", "1684" ], [ "Andorra", "ad", "376" ], [ "Angola", "ao", "244" ], [ "Anguilla", "ai", "1264" ], [ "Antigua and Barbuda", "ag", "1268" ], [ "Argentina", "ar", "54" ], [ "Armenia ()", "am", "374" ], [ "Aruba", "aw", "297" ], [ "Australia", "au", "61", 0 ], [ "Austria (sterreich)", "at", "43" ], [ "Azerbaijan (Azrbaycan)", "az", "994" ], [ "Bahamas", "bs", "1242" ], [ "Bahrain ()", "bh", "973" ], [ "Bangladesh ()", "bd", "880" ], [ "Barbados", "bb", "1246" ], [ "Belarus ()", "by", "375" ], [ "Belgium (Belgi)", "be", "32" ], [ "Belize", "bz", "501" ], [ "Benin (Bnin)", "bj", "229" ], [ "Bermuda", "bm", "1441" ], [ "Bhutan ()", "bt", "975" ], [ "Bolivia", "bo", "591" ], [ "Bosnia and Herzegovina (  )", "ba", "387" ], [ "Botswana", "bw", "267" ], [ "Brazil (Brasil)", "br", "55" ], [ "British Indian Ocean Territory", "io", "246" ], [ "British Virgin Islands", "vg", "1284" ], [ "Brunei", "bn", "673" ], [ "Bulgaria ()", "bg", "359" ], [ "Burkina Faso", "bf", "226" ], [ "Burundi (Uburundi)", "bi", "257" ], [ "Cambodia ()", "kh", "855" ], [ "Cameroon (Cameroun)", "cm", "237" ], [ "Canada", "ca", "1", 1, [ "204", "226", "236", "249", "250", "289", "306", "343", "365", "387", "403", "416", "418", "431", "437", "438", "450", "506", "514", "519", "548", "579", "581", "587", "604", "613", "639", "647", "672", "705", "709", "742", "778", "780", "782", "807", "819", "825", "867", "873", "902", "905" ] ], [ "Cape Verde (Kabu Verdi)", "cv", "238" ], [ "Caribbean Netherlands", "bq", "599", 1 ], [ "Cayman Islands", "ky", "1345" ], [ "Central African Republic (Rpublique centrafricaine)", "cf", "236" ], [ "Chad (Tchad)", "td", "235" ], [ "Chile", "cl", "56" ], [ "China ()", "cn", "86" ], [ "Christmas Island", "cx", "61", 2 ], [ "Cocos (Keeling) Islands", "cc", "61", 1 ], [ "Colombia", "co", "57" ], [ "Comoros ( )", "km", "269" ], [ "Congo (DRC) (Jamhuri ya Kidemokrasia ya Kongo)", "cd", "243" ], [ "Congo (Republic) (Congo-Brazzaville)", "cg", "242" ], [ "Cook Islands", "ck", "682" ], [ "Costa Rica", "cr", "506" ], [ "Cte dIvoire", "ci", "225" ], [ "Croatia (Hrvatska)", "hr", "385" ], [ "Cuba", "cu", "53" ], [ "Curaao", "cw", "599", 0 ], [ "Cyprus ()", "cy", "357" ], [ "Czech Republic (esk republika)", "cz", "420" ], [ "Denmark (Danmark)", "dk", "45" ], [ "Djibouti", "dj", "253" ], [ "Dominica", "dm", "1767" ], [ "Dominican Republic (Repblica Dominicana)", "do", "1", 2, [ "809", "829", "849" ] ], [ "Ecuador", "ec", "593" ], [ "Egypt ()", "eg", "20" ], [ "El Salvador", "sv", "503" ], [ "Equatorial Guinea (Guinea Ecuatorial)", "gq", "240" ], [ "Eritrea", "er", "291" ], [ "Estonia (Eesti)", "ee", "372" ], [ "Ethiopia", "et", "251" ], [ "Falkland Islands (Islas Malvinas)", "fk", "500" ], [ "Faroe Islands (Froyar)", "fo", "298" ], [ "Fiji", "fj", "679" ], [ "Finland (Suomi)", "fi", "358", 0 ], [ "France", "fr", "33" ], [ "French Guiana (Guyane franaise)", "gf", "594" ], [ "French Polynesia (Polynsie franaise)", "pf", "689" ], [ "Gabon", "ga", "241" ], [ "Gambia", "gm", "220" ], [ "Georgia ()", "ge", "995" ], [ "Germany (Deutschland)", "de", "49" ], [ "Ghana (Gaana)", "gh", "233" ], [ "Gibraltar", "gi", "350" ], [ "Greece ()", "gr", "30" ], [ "Greenland (Kalaallit Nunaat)", "gl", "299" ], [ "Grenada", "gd", "1473" ], [ "Guadeloupe", "gp", "590", 0 ], [ "Guam", "gu", "1671" ], [ "Guatemala", "gt", "502" ], [ "Guernsey", "gg", "44", 1 ], [ "Guinea (Guine)", "gn", "224" ], [ "Guinea-Bissau (Guin Bissau)", "gw", "245" ], [ "Guyana", "gy", "592" ], [ "Haiti", "ht", "509" ], [ "Honduras", "hn", "504" ], [ "Hong Kong ()", "hk", "852" ], [ "Hungary (Magyarorszg)", "hu", "36" ], [ "Iceland (sland)", "is", "354" ], [ "India ()", "in", "91" ], [ "Indonesia", "id", "62" ], [ "Iran ()", "ir", "98" ], [ "Iraq ()", "iq", "964" ], [ "Ireland", "ie", "353" ], [ "Isle of Man", "im", "44", 2 ], [ "Israel ()", "il", "972" ], [ "Italy (Italia)", "it", "39", 0 ], [ "Jamaica", "jm", "1876" ], [ "Japan ()", "jp", "81" ], [ "Jersey", "je", "44", 3 ], [ "Jordan ()", "jo", "962" ], [ "Kazakhstan ()", "kz", "77", 1 ], [ "Kenya", "ke", "254" ], [ "Kiribati", "ki", "686" ], [ "Kosovo", "xk", "383" ], [ "Kuwait ()", "kw", "965" ], [ "Kyrgyzstan ()", "kg", "996" ], [ "Laos ()", "la", "856" ], [ "Latvia (Latvija)", "lv", "371" ], [ "Lebanon ()", "lb", "961" ], [ "Lesotho", "ls", "266" ], [ "Liberia", "lr", "231" ], [ "Libya ()", "ly", "218" ], [ "Liechtenstein", "li", "423" ], [ "Lithuania (Lietuva)", "lt", "370" ], [ "Luxembourg", "lu", "352" ], [ "Macau ()", "mo", "853" ], [ "Macedonia (FYROM) ()", "mk", "389" ], [ "Madagascar (Madagasikara)", "mg", "261" ], [ "Malawi", "mw", "265" ], [ "Malaysia", "my", "60" ], [ "Maldives", "mv", "960" ], [ "Mali", "ml", "223" ], [ "Malta", "mt", "356" ], [ "Marshall Islands", "mh", "692" ], [ "Martinique", "mq", "596" ], [ "Mauritania ()", "mr", "222" ], [ "Mauritius (Moris)", "mu", "230" ], [ "Mayotte", "yt", "262", 1 ], [ "Mexico (Mxico)", "mx", "52" ], [ "Micronesia", "fm", "691" ], [ "Moldova (Republica Moldova)", "md", "373" ], [ "Monaco", "mc", "377" ], [ "Mongolia ()", "mn", "976" ], [ "Montenegro (Crna Gora)", "me", "382" ], [ "Montserrat", "ms", "1664" ], [ "Morocco ()", "ma", "212", 0 ], [ "Mozambique (Moambique)", "mz", "258" ], [ "Myanmar (Burma) ()", "mm", "95" ], [ "Namibia (Namibi)", "na", "264" ], [ "Nauru", "nr", "674" ], [ "Nepal ()", "np", "977" ], [ "Netherlands (Nederland)", "nl", "31" ], [ "New Caledonia (Nouvelle-Caldonie)", "nc", "687" ], [ "New Zealand", "nz", "64" ], [ "Nicaragua", "ni", "505" ], [ "Niger (Nijar)", "ne", "227" ], [ "Nigeria", "ng", "234" ], [ "Niue", "nu", "683" ], [ "Norfolk Island", "nf", "672" ], [ "North Korea (   )", "kp", "850" ], [ "Northern Mariana Islands", "mp", "1670" ], [ "Norway (Norge)", "no", "47", 0 ], [ "Oman ()", "om", "968" ], [ "Pakistan ()", "pk", "92" ], [ "Palau", "pw", "680" ], [ "Palestine ()", "ps", "970" ], [ "Panama (Panam)", "pa", "507" ], [ "Papua New Guinea", "pg", "675" ], [ "Paraguay", "py", "595" ], [ "Peru (Per)", "pe", "51" ], [ "Philippines", "ph", "63" ], [ "Poland (Polska)", "pl", "48" ], [ "Portugal", "pt", "351" ], [ "Puerto Rico", "pr", "1", 3, [ "787", "939" ] ], [ "Qatar ()", "qa", "974" ], [ "Runion (La Runion)", "re", "262", 0 ], [ "Romania (Romnia)", "ro", "40" ], [ "Russia ()", "ru", "7", 0 ], [ "Rwanda", "rw", "250" ], [ "Saint Barthlemy (Saint-Barthlemy)", "bl", "590", 1 ], [ "Saint Helena", "sh", "290" ], [ "Saint Kitts and Nevis", "kn", "1869" ], [ "Saint Lucia", "lc", "1758" ], [ "Saint Martin (Saint-Martin (partie franaise))", "mf", "590", 2 ], [ "Saint Pierre and Miquelon (Saint-Pierre-et-Miquelon)", "pm", "508" ], [ "Saint Vincent and the Grenadines", "vc", "1784" ], [ "Samoa", "ws", "685" ], [ "San Marino", "sm", "378" ], [ "So Tom and Prncipe (So Tom e Prncipe)", "st", "239" ], [ "Saudi Arabia (  )", "sa", "966" ], [ "Senegal (Sngal)", "sn", "221" ], [ "Serbia ()", "rs", "381" ], [ "Seychelles", "sc", "248" ], [ "Sierra Leone", "sl", "232" ], [ "Singapore", "sg", "65" ], [ "Sint Maarten", "sx", "1721" ], [ "Slovakia (Slovensko)", "sk", "421" ], [ "Slovenia (Slovenija)", "si", "386" ], [ "Solomon Islands", "sb", "677" ], [ "Somalia (Soomaaliya)", "so", "252" ], [ "South Africa", "za", "27" ], [ "South Korea ()", "kr", "82" ], [ "South Sudan ( )", "ss", "211" ], [ "Spain (Espaa)", "es", "34" ], [ "Sri Lanka ( )", "lk", "94" ], [ "Sudan ()", "sd", "249" ], [ "Suriname", "sr", "597" ], [ "Svalbard and Jan Mayen", "sj", "47", 1 ], [ "Swaziland", "sz", "268" ], [ "Sweden (Sverige)", "se", "46" ], [ "Switzerland (Schweiz)", "ch", "41" ], [ "Syria ()", "sy", "963" ], [ "Taiwan ()", "tw", "886" ], [ "Tajikistan", "tj", "992" ], [ "Tanzania", "tz", "255" ], [ "Thailand ()", "th", "66" ], [ "Timor-Leste", "tl", "670" ], [ "Togo", "tg", "228" ], [ "Tokelau", "tk", "690" ], [ "Tonga", "to", "676" ], [ "Trinidad and Tobago", "tt", "1868" ], [ "Tunisia ()", "tn", "216" ], [ "Turkey (Trkiye)", "tr", "90" ], [ "Turkmenistan", "tm", "993" ], [ "Turks and Caicos Islands", "tc", "1649" ], [ "Tuvalu", "tv", "688" ], [ "U.S. Virgin Islands", "vi", "1340" ], [ "Uganda", "ug", "256" ], [ "Ukraine ()", "ua", "380" ], [ "United Arab Emirates (  )", "ae", "971" ], [ "United Kingdom", "gb", "44", 0 ], [ "United States", "us", "1", 0 ], [ "Uruguay", "uy", "598" ], [ "Uzbekistan (Ozbekiston)", "uz", "998" ], [ "Vanuatu", "vu", "678" ], [ "Vatican City (Citt del Vaticano)", "va", "39", 1 ], [ "Venezuela", "ve", "58" ], [ "Vietnam (Vit Nam)", "vn", "84" ], [ "Wallis and Futuna", "wf", "681" ], [ "Western Sahara ( )", "eh", "212", 1 ], [ "Yemen ()", "ye", "967" ], [ "Zambia", "zm", "260" ], [ "Zimbabwe", "zw", "263" ], [ "land Islands", "ax", "358", 1 ] ];
    // loop over all of the countries above
    for (var i = 0; i < allCountries.length; i++) {
        var c = allCountries[i];
        allCountries[i] = {
            name: c[0],
            iso2: c[1],
            dialCode: c[2],
            priority: c[3] || 0,
            areaCodes: c[4] || null
        };
    }
});
    !function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.io=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){module.exports=_dereq_("./lib/")},{"./lib/":2}],2:[function(_dereq_,module,exports){var url=_dereq_("./url");var parser=_dereq_("socket.io-parser");var Manager=_dereq_("./manager");var debug=_dereq_("debug")("socket.io-client");module.exports=exports=lookup;var cache=exports.managers={};function lookup(uri,opts){if(typeof uri=="object"){opts=uri;uri=undefined}opts=opts||{};var parsed=url(uri);var source=parsed.source;var id=parsed.id;var io;if(opts.forceNew||opts["force new connection"]||false===opts.multiplex){debug("ignoring socket cache for %s",source);io=Manager(source,opts)}else{if(!cache[id]){debug("new io instance for %s",source);cache[id]=Manager(source,opts)}io=cache[id]}return io.socket(parsed.path)}exports.protocol=parser.protocol;exports.connect=lookup;exports.Manager=_dereq_("./manager");exports.Socket=_dereq_("./socket")},{"./manager":3,"./socket":5,"./url":6,debug:10,"socket.io-parser":46}],3:[function(_dereq_,module,exports){var url=_dereq_("./url");var eio=_dereq_("engine.io-client");var Socket=_dereq_("./socket");var Emitter=_dereq_("component-emitter");var parser=_dereq_("socket.io-parser");var on=_dereq_("./on");var bind=_dereq_("component-bind");var object=_dereq_("object-component");var debug=_dereq_("debug")("socket.io-client:manager");var indexOf=_dereq_("indexof");var Backoff=_dereq_("backo2");module.exports=Manager;function Manager(uri,opts){if(!(this instanceof Manager))return new Manager(uri,opts);if(uri&&"object"==typeof uri){opts=uri;uri=undefined}opts=opts||{};opts.path=opts.path||"/socket.io";this.nsps={};this.subs=[];this.opts=opts;this.reconnection(opts.reconnection!==false);this.reconnectionAttempts(opts.reconnectionAttempts||Infinity);this.reconnectionDelay(opts.reconnectionDelay||1e3);this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3);this.randomizationFactor(opts.randomizationFactor||.5);this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==opts.timeout?2e4:opts.timeout);this.readyState="closed";this.uri=uri;this.connected=[];this.encoding=false;this.packetBuffer=[];this.encoder=new parser.Encoder;this.decoder=new parser.Decoder;this.autoConnect=opts.autoConnect!==false;if(this.autoConnect)this.open()}Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var nsp in this.nsps){this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)}};Manager.prototype.updateSocketIds=function(){for(var nsp in this.nsps){this.nsps[nsp].id=this.engine.id}};Emitter(Manager.prototype);Manager.prototype.reconnection=function(v){if(!arguments.length)return this._reconnection;this._reconnection=!!v;return this};Manager.prototype.reconnectionAttempts=function(v){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=v;return this};Manager.prototype.reconnectionDelay=function(v){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=v;this.backoff&&this.backoff.setMin(v);return this};Manager.prototype.randomizationFactor=function(v){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=v;this.backoff&&this.backoff.setJitter(v);return this};Manager.prototype.reconnectionDelayMax=function(v){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=v;this.backoff&&this.backoff.setMax(v);return this};Manager.prototype.timeout=function(v){if(!arguments.length)return this._timeout;this._timeout=v;return this};Manager.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};Manager.prototype.open=Manager.prototype.connect=function(fn){debug("readyState %s",this.readyState);if(~this.readyState.indexOf("open"))return this;debug("opening %s",this.uri);this.engine=eio(this.uri,this.opts);var socket=this.engine;var self=this;this.readyState="opening";this.skipReconnect=false;var openSub=on(socket,"open",function(){self.onopen();fn&&fn()});var errorSub=on(socket,"error",function(data){debug("connect_error");self.cleanup();self.readyState="closed";self.emitAll("connect_error",data);if(fn){var err=new Error("Connection error");err.data=data;fn(err)}else{self.maybeReconnectOnOpen()}});if(false!==this._timeout){var timeout=this._timeout;debug("connect attempt will timeout after %d",timeout);var timer=setTimeout(function(){debug("connect attempt timed out after %d",timeout);openSub.destroy();socket.close();socket.emit("error","timeout");self.emitAll("connect_timeout",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}this.subs.push(openSub);this.subs.push(errorSub);return this};Manager.prototype.onopen=function(){debug("open");this.cleanup();this.readyState="open";this.emit("open");var socket=this.engine;this.subs.push(on(socket,"data",bind(this,"ondata")));this.subs.push(on(this.decoder,"decoded",bind(this,"ondecoded")));this.subs.push(on(socket,"error",bind(this,"onerror")));this.subs.push(on(socket,"close",bind(this,"onclose")))};Manager.prototype.ondata=function(data){this.decoder.add(data)};Manager.prototype.ondecoded=function(packet){this.emit("packet",packet)};Manager.prototype.onerror=function(err){debug("error",err);this.emitAll("error",err)};Manager.prototype.socket=function(nsp){var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp);this.nsps[nsp]=socket;var self=this;socket.on("connect",function(){socket.id=self.engine.id;if(!~indexOf(self.connected,socket)){self.connected.push(socket)}})}return socket};Manager.prototype.destroy=function(socket){var index=indexOf(this.connected,socket);if(~index)this.connected.splice(index,1);if(this.connected.length)return;this.close()};Manager.prototype.packet=function(packet){debug("writing packet %j",packet);var self=this;if(!self.encoding){self.encoding=true;this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++){self.engine.write(encodedPackets[i])}self.encoding=false;self.processPacketQueue()})}else{self.packetBuffer.push(packet)}};Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}};Manager.prototype.cleanup=function(){var sub;while(sub=this.subs.shift())sub.destroy();this.packetBuffer=[];this.encoding=false;this.decoder.destroy()};Manager.prototype.close=Manager.prototype.disconnect=function(){this.skipReconnect=true;this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};Manager.prototype.onclose=function(reason){debug("close");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",reason);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts){debug("reconnect failed");this.backoff.reset();this.emitAll("reconnect_failed");this.reconnecting=false}else{var delay=this.backoff.duration();debug("will wait %dms before reconnect attempt",delay);this.reconnecting=true;var timer=setTimeout(function(){if(self.skipReconnect)return;debug("attempting reconnect");self.emitAll("reconnect_attempt",self.backoff.attempts);self.emitAll("reconnecting",self.backoff.attempts);if(self.skipReconnect)return;self.open(function(err){if(err){debug("reconnect attempt error");self.reconnecting=false;self.reconnect();self.emitAll("reconnect_error",err.data)}else{debug("reconnect success");self.onreconnect()}})},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}};Manager.prototype.onreconnect=function(){var attempt=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",attempt)}},{"./on":4,"./socket":5,"./url":6,backo2:7,"component-bind":8,"component-emitter":9,debug:10,"engine.io-client":11,indexof:42,"object-component":43,"socket.io-parser":46}],4:[function(_dereq_,module,exports){module.exports=on;function on(obj,ev,fn){obj.on(ev,fn);return{destroy:function(){obj.removeListener(ev,fn)}}}},{}],5:[function(_dereq_,module,exports){var parser=_dereq_("socket.io-parser");var Emitter=_dereq_("component-emitter");var toArray=_dereq_("to-array");var on=_dereq_("./on");var bind=_dereq_("component-bind");var debug=_dereq_("debug")("socket.io-client:socket");var hasBin=_dereq_("has-binary");module.exports=exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1};var emit=Emitter.prototype.emit;function Socket(io,nsp){this.io=io;this.nsp=nsp;this.json=this;this.ids=0;this.acks={};if(this.io.autoConnect)this.open();this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true}Emitter(Socket.prototype);Socket.prototype.subEvents=function(){if(this.subs)return;var io=this.io;this.subs=[on(io,"open",bind(this,"onopen")),on(io,"packet",bind(this,"onpacket")),on(io,"close",bind(this,"onclose"))]};Socket.prototype.open=Socket.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if("open"==this.io.readyState)this.onopen();return this};Socket.prototype.send=function(){var args=toArray(arguments);args.unshift("message");this.emit.apply(this,args);return this};Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev)){emit.apply(this,arguments);return this}var args=toArray(arguments);var parserType=parser.EVENT;if(hasBin(args)){parserType=parser.BINARY_EVENT}var packet={type:parserType,data:args};if("function"==typeof args[args.length-1]){debug("emitting packet with ack id %d",this.ids);this.acks[this.ids]=args.pop();packet.id=this.ids++}if(this.connected){this.packet(packet)}else{this.sendBuffer.push(packet)}return this};Socket.prototype.packet=function(packet){packet.nsp=this.nsp;this.io.packet(packet)};Socket.prototype.onopen=function(){debug("transport is open - connecting");if("/"!=this.nsp){this.packet({type:parser.CONNECT})}};Socket.prototype.onclose=function(reason){debug("close (%s)",reason);this.connected=false;this.disconnected=true;delete this.id;this.emit("disconnect",reason)};Socket.prototype.onpacket=function(packet){if(packet.nsp!=this.nsp)return;switch(packet.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:this.onevent(packet);break;case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:this.onack(packet);break;case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit("error",packet.data);break}};Socket.prototype.onevent=function(packet){var args=packet.data||[];debug("emitting event %j",args);if(null!=packet.id){debug("attaching ack callback to event");args.push(this.ack(packet.id))}if(this.connected){emit.apply(this,args)}else{this.receiveBuffer.push(args)}};Socket.prototype.ack=function(id){var self=this;var sent=false;return function(){if(sent)return;sent=true;var args=toArray(arguments);debug("sending ack %j",args);var type=hasBin(args)?parser.BINARY_ACK:parser.ACK;self.packet({type:type,id:id,data:args})}};Socket.prototype.onack=function(packet){debug("calling ack %s with %j",packet.id,packet.data);var fn=this.acks[packet.id];fn.apply(this,packet.data);delete this.acks[packet.id]};Socket.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit("connect");this.emitBuffered()};Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++){emit.apply(this,this.receiveBuffer[i])}this.receiveBuffer=[];for(i=0;i<this.sendBuffer.length;i++){this.packet(this.sendBuffer[i])}this.sendBuffer=[]};Socket.prototype.ondisconnect=function(){debug("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};Socket.prototype.destroy=function(){if(this.subs){for(var i=0;i<this.subs.length;i++){this.subs[i].destroy()}this.subs=null}this.io.destroy(this)};Socket.prototype.close=Socket.prototype.disconnect=function(){if(this.connected){debug("performing disconnect (%s)",this.nsp);this.packet({type:parser.DISCONNECT})}this.destroy();if(this.connected){this.onclose("io client disconnect")}return this}},{"./on":4,"component-bind":8,"component-emitter":9,debug:10,"has-binary":38,"socket.io-parser":46,"to-array":50}],6:[function(_dereq_,module,exports){(function(global){var parseuri=_dereq_("parseuri");var debug=_dereq_("debug")("socket.io-client:url");module.exports=url;function url(uri,loc){var obj=uri;var loc=loc||global.location;if(null==uri)uri=loc.protocol+"//"+loc.host;if("string"==typeof uri){if("/"==uri.charAt(0)){if("/"==uri.charAt(1)){uri=loc.protocol+uri}else{uri=loc.hostname+uri}}if(!/^(https?|wss?):\/\//.test(uri)){debug("protocol-less url %s",uri);if("undefined"!=typeof loc){uri=loc.protocol+"//"+uri}else{uri="https://"+uri}}debug("parse %s",uri);obj=parseuri(uri)}if(!obj.port){if(/^(http|ws)$/.test(obj.protocol)){obj.port="80"}else if(/^(http|ws)s$/.test(obj.protocol)){obj.port="443"}}obj.path=obj.path||"/";obj.id=obj.protocol+"://"+obj.host+":"+obj.port;obj.href=obj.protocol+"://"+obj.host+(loc&&loc.port==obj.port?"":":"+obj.port);return obj}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{debug:10,parseuri:44}],7:[function(_dereq_,module,exports){module.exports=Backoff;function Backoff(opts){opts=opts||{};this.ms=opts.min||100;this.max=opts.max||1e4;this.factor=opts.factor||2;this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0;this.attempts=0}Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random();var deviation=Math.floor(rand*this.jitter*ms);ms=(Math.floor(rand*10)&1)==0?ms-deviation:ms+deviation}return Math.min(ms,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(min){this.ms=min};Backoff.prototype.setMax=function(max){this.max=max};Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],8:[function(_dereq_,module,exports){var slice=[].slice;module.exports=function(obj,fn){if("string"==typeof fn)fn=obj[fn];if("function"!=typeof fn)throw new Error("bind() requires a function");var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}},{}],9:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],10:[function(_dereq_,module,exports){module.exports=debug;function debug(name){if(!debug.enabled(name))return function(){};return function(fmt){fmt=coerce(fmt);var curr=new Date;var ms=curr-(debug[name]||curr);debug[name]=curr;fmt=name+" "+fmt+" +"+debug.humanize(ms);window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}}debug.names=[];debug.skips=[];debug.enable=function(name){try{localStorage.debug=name}catch(e){}var split=(name||"").split(/[\s,]+/),len=split.length;for(var i=0;i<len;i++){name=split[i].replace("*",".*?");if(name[0]==="-"){debug.skips.push(new RegExp("^"+name.substr(1)+"$"))}else{debug.names.push(new RegExp("^"+name+"$"))}}};debug.disable=function(){debug.enable("")};debug.humanize=function(ms){var sec=1e3,min=60*1e3,hour=60*min;if(ms>=hour)return(ms/hour).toFixed(1)+"h";if(ms>=min)return(ms/min).toFixed(1)+"m";if(ms>=sec)return(ms/sec|0)+"s";return ms+"ms"};debug.enabled=function(name){for(var i=0,len=debug.skips.length;i<len;i++){if(debug.skips[i].test(name)){return false}}for(var i=0,len=debug.names.length;i<len;i++){if(debug.names[i].test(name)){return true}}return false};function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}try{if(window.localStorage)debug.enable(localStorage.debug)}catch(e){}},{}],11:[function(_dereq_,module,exports){module.exports=_dereq_("./lib/")},{"./lib/":12}],12:[function(_dereq_,module,exports){module.exports=_dereq_("./socket");module.exports.parser=_dereq_("engine.io-parser")},{"./socket":13,"engine.io-parser":25}],13:[function(_dereq_,module,exports){(function(global){var transports=_dereq_("./transports");var Emitter=_dereq_("component-emitter");var debug=_dereq_("debug")("engine.io-client:socket");var index=_dereq_("indexof");var parser=_dereq_("engine.io-parser");var parseuri=_dereq_("parseuri");var parsejson=_dereq_("parsejson");var parseqs=_dereq_("parseqs");module.exports=Socket;function noop(){}function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);opts=opts||{};if(uri&&"object"==typeof uri){opts=uri;uri=null}if(uri){uri=parseuri(uri);opts.host=uri.host;opts.secure=uri.protocol=="https"||uri.protocol=="wss";opts.port=uri.port;if(uri.query)opts.query=uri.query}this.secure=null!=opts.secure?opts.secure:global.location&&"https:"==location.protocol;if(opts.host){var pieces=opts.host.split(":");opts.hostname=pieces.shift();if(pieces.length){opts.port=pieces.pop()}else if(!opts.port){opts.port=this.secure?"443":"80"}}this.agent=opts.agent||false;this.hostname=opts.hostname||(global.location?location.hostname:"localhost");this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80);this.query=opts.query||{};if("string"==typeof this.query)this.query=parseqs.decode(this.query);this.upgrade=false!==opts.upgrade;this.path=(opts.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!opts.forceJSONP;this.jsonp=false!==opts.jsonp;this.forceBase64=!!opts.forceBase64;this.enablesXDR=!!opts.enablesXDR;this.timestampParam=opts.timestampParam||"t";this.timestampRequests=opts.timestampRequests;this.transports=opts.transports||["polling","websocket"];this.readyState="";this.writeBuffer=[];this.callbackBuffer=[];this.policyPort=opts.policyPort||843;this.rememberUpgrade=opts.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades;this.pfx=opts.pfx||null;this.key=opts.key||null;this.passphrase=opts.passphrase||null;this.cert=opts.cert||null;this.ca=opts.ca||null;this.ciphers=opts.ciphers||null;this.rejectUnauthorized=opts.rejectUnauthorized||null;this.open()}Socket.priorWebsocketSuccess=false;Emitter(Socket.prototype);Socket.protocol=parser.protocol;Socket.Socket=Socket;Socket.Transport=_dereq_("./transport");Socket.transports=_dereq_("./transports");Socket.parser=_dereq_("engine.io-parser");Socket.prototype.createTransport=function(name){debug('creating transport "%s"',name);var query=clone(this.query);query.EIO=parser.protocol;query.transport=name;if(this.id)query.sid=this.id;var transport=new transports[name]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:query,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized});return transport};function clone(obj){var o={};for(var i in obj){if(obj.hasOwnProperty(i)){o[i]=obj[i]}}return o}Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&this.transports.indexOf("websocket")!=-1){transport="websocket"}else if(0==this.transports.length){var self=this;setTimeout(function(){self.emit("error","No transports available")},0);return}else{transport=this.transports[0]}this.readyState="opening";var transport;try{transport=this.createTransport(transport)}catch(e){this.transports.shift();this.open();return}transport.open();this.setTransport(transport)};Socket.prototype.setTransport=function(transport){debug("setting transport %s",transport.name);var self=this;if(this.transport){debug("clearing existing transport %s",this.transport.name);this.transport.removeAllListeners()}this.transport=transport;transport.on("drain",function(){self.onDrain()}).on("packet",function(packet){self.onPacket(packet)}).on("error",function(e){self.onError(e)}).on("close",function(){self.onClose("transport close")})};Socket.prototype.probe=function(name){debug('probing transport "%s"',name);var transport=this.createTransport(name,{probe:1}),failed=false,self=this;Socket.priorWebsocketSuccess=false;function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}if(failed)return;debug('probe transport "%s" opened',name);transport.send([{type:"ping",data:"probe"}]);transport.once("packet",function(msg){if(failed)return;if("pong"==msg.type&&"probe"==msg.data){debug('probe transport "%s" pong',name);self.upgrading=true;self.emit("upgrading",transport);if(!transport)return;Socket.priorWebsocketSuccess="websocket"==transport.name;debug('pausing current transport "%s"',self.transport.name);self.transport.pause(function(){if(failed)return;if("closed"==self.readyState)return;debug("changing transport and sending upgrade packet");cleanup();self.setTransport(transport);transport.send([{type:"upgrade"}]);self.emit("upgrade",transport);transport=null;self.upgrading=false;self.flush()})}else{debug('probe transport "%s" failed',name);var err=new Error("probe error");err.transport=transport.name;self.emit("upgradeError",err)}})}function freezeTransport(){if(failed)return;failed=true;cleanup();transport.close();transport=null}function onerror(err){var error=new Error("probe error: "+err);error.transport=transport.name;freezeTransport();debug('probe transport "%s" failed because of error: %s',name,err);self.emit("upgradeError",error)}function onTransportClose(){onerror("transport closed")}function onclose(){onerror("socket closed")}function onupgrade(to){if(transport&&to.name!=transport.name){debug('"%s" works - aborting "%s"',to.name,transport.name);freezeTransport()}}function cleanup(){transport.removeListener("open",onTransportOpen);transport.removeListener("error",onerror);transport.removeListener("close",onTransportClose);self.removeListener("close",onclose);self.removeListener("upgrading",onupgrade)}transport.once("open",onTransportOpen);transport.once("error",onerror);transport.once("close",onTransportClose);this.once("close",onclose);this.once("upgrading",onupgrade);transport.open()};Socket.prototype.onOpen=function(){debug("socket open");this.readyState="open";Socket.priorWebsocketSuccess="websocket"==this.transport.name;this.emit("open");this.flush();if("open"==this.readyState&&this.upgrade&&this.transport.pause){debug("starting upgrade probes");for(var i=0,l=this.upgrades.length;i<l;i++){this.probe(this.upgrades[i])}}};Socket.prototype.onPacket=function(packet){if("opening"==this.readyState||"open"==this.readyState){debug('socket receive: type "%s", data "%s"',packet.type,packet.data);this.emit("packet",packet);this.emit("heartbeat");switch(packet.type){case"open":this.onHandshake(parsejson(packet.data));break;case"pong":this.setPing();break;case"error":var err=new Error("server error");err.code=packet.data;this.emit("error",err);break;case"message":this.emit("data",packet.data);this.emit("message",packet.data);break}}else{debug('packet received with socket readyState "%s"',this.readyState)}};Socket.prototype.onHandshake=function(data){this.emit("handshake",data);this.id=data.sid;this.transport.query.sid=data.sid;this.upgrades=this.filterUpgrades(data.upgrades);this.pingInterval=data.pingInterval;this.pingTimeout=data.pingTimeout;this.onOpen();if("closed"==this.readyState)return;this.setPing();this.removeListener("heartbeat",this.onHeartbeat);this.on("heartbeat",this.onHeartbeat)};Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){if("closed"==self.readyState)return;self.onClose("ping timeout")},timeout||self.pingInterval+self.pingTimeout)};Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer);self.pingIntervalTimer=setTimeout(function(){debug("writing ping packet - expecting pong within %sms",self.pingTimeout);self.ping();self.onHeartbeat(self.pingTimeout)},self.pingInterval)};Socket.prototype.ping=function(){this.sendPacket("ping")};Socket.prototype.onDrain=function(){for(var i=0;i<this.prevBufferLen;i++){if(this.callbackBuffer[i]){this.callbackBuffer[i]()}}this.writeBuffer.splice(0,this.prevBufferLen);this.callbackBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(this.writeBuffer.length==0){this.emit("drain")}else{this.flush()}};Socket.prototype.flush=function(){if("closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){debug("flushing %d packets in socket",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit("flush")}};Socket.prototype.write=Socket.prototype.send=function(msg,fn){this.sendPacket("message",msg,fn);return this};Socket.prototype.sendPacket=function(type,data,fn){if("closing"==this.readyState||"closed"==this.readyState){return}var packet={type:type,data:data};this.emit("packetCreate",packet);this.writeBuffer.push(packet);this.callbackBuffer.push(fn);this.flush()};Socket.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var self=this;function close(){self.onClose("forced close");debug("socket closing - telling transport to close");self.transport.close()}function cleanupAndClose(){self.removeListener("upgrade",cleanupAndClose);self.removeListener("upgradeError",cleanupAndClose);close()}function waitForUpgrade(){self.once("upgrade",cleanupAndClose);self.once("upgradeError",cleanupAndClose)}if(this.writeBuffer.length){this.once("drain",function(){if(this.upgrading){waitForUpgrade()}else{close()}})}else if(this.upgrading){waitForUpgrade()}else{close()}}return this};Socket.prototype.onError=function(err){debug("socket error %j",err);Socket.priorWebsocketSuccess=false;this.emit("error",err);this.onClose("transport error",err)};Socket.prototype.onClose=function(reason,desc){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){debug('socket close with reason: "%s"',reason);var self=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);setTimeout(function(){self.writeBuffer=[];self.callbackBuffer=[];self.prevBufferLen=0},0);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",reason,desc)}};Socket.prototype.filterUpgrades=function(upgrades){var filteredUpgrades=[];for(var i=0,j=upgrades.length;i<j;i++){if(~index(this.transports,upgrades[i]))filteredUpgrades.push(upgrades[i])}return filteredUpgrades}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./transport":14,"./transports":15,"component-emitter":9,debug:22,"engine.io-parser":25,indexof:42,parsejson:34,parseqs:35,parseuri:36}],14:[function(_dereq_,module,exports){var parser=_dereq_("engine.io-parser");var Emitter=_dereq_("component-emitter");module.exports=Transport;function Transport(opts){this.path=opts.path;this.hostname=opts.hostname;this.port=opts.port;this.secure=opts.secure;this.query=opts.query;this.timestampParam=opts.timestampParam;this.timestampRequests=opts.timestampRequests;this.readyState="";this.agent=opts.agent||false;this.socket=opts.socket;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized}Emitter(Transport.prototype);Transport.timestamps=0;Transport.prototype.onError=function(msg,desc){var err=new Error(msg);err.type="TransportError";err.description=desc;this.emit("error",err);return this};Transport.prototype.open=function(){if("closed"==this.readyState||""==this.readyState){this.readyState="opening";this.doOpen()}return this};Transport.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){this.doClose();this.onClose()}return this};Transport.prototype.send=function(packets){if("open"==this.readyState){this.write(packets)}else{throw new Error("Transport not open")}};Transport.prototype.onOpen=function(){this.readyState="open";this.writable=true;this.emit("open")};Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)};Transport.prototype.onPacket=function(packet){this.emit("packet",packet)};Transport.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},{"component-emitter":9,"engine.io-parser":25}],15:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_("xmlhttprequest");var XHR=_dereq_("./polling-xhr");var JSONP=_dereq_("./polling-jsonp");var websocket=_dereq_("./websocket");exports.polling=polling;exports.websocket=websocket;function polling(opts){var xhr;var xd=false;var xs=false;var jsonp=false!==opts.jsonp;if(global.location){var isSSL="https:"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}xd=opts.hostname!=location.hostname||port!=opts.port;xs=opts.secure!=isSSL}opts.xdomain=xd;opts.xscheme=xs;xhr=new XMLHttpRequest(opts);if("open"in xhr&&!opts.forceJSONP){return new XHR(opts)}else{if(!jsonp)throw new Error("JSONP disabled");return new JSONP(opts)}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(_dereq_,module,exports){(function(global){var Polling=_dereq_("./polling");var inherit=_dereq_("component-inherit");module.exports=JSONPPolling;var rNewline=/\n/g;var rEscapedNewline=/\\n/g;var callbacks;var index=0;function empty(){}function JSONPPolling(opts){Polling.call(this,opts);
this.query=this.query||{};if(!callbacks){if(!global.___eio)global.___eio=[];callbacks=global.___eio}this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)});this.query.j=this.index;if(global.document&&global.addEventListener){global.addEventListener("beforeunload",function(){if(self.script)self.script.onerror=empty},false)}}inherit(JSONPPolling,Polling);JSONPPolling.prototype.supportsBinary=false;JSONPPolling.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}Polling.prototype.doClose.call(this)};JSONPPolling.prototype.doPoll=function(){var self=this;var script=document.createElement("script");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}script.async=true;script.src=this.uri();script.onerror=function(e){self.onError("jsonp poll error",e)};var insertAt=document.getElementsByTagName("script")[0];insertAt.parentNode.insertBefore(script,insertAt);this.script=script;var isUAgecko="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);if(isUAgecko){setTimeout(function(){var iframe=document.createElement("iframe");document.body.appendChild(iframe);document.body.removeChild(iframe)},100)}};JSONPPolling.prototype.doWrite=function(data,fn){var self=this;if(!this.form){var form=document.createElement("form");var area=document.createElement("textarea");var id=this.iframeId="eio_iframe_"+this.index;var iframe;form.className="socketio";form.style.position="absolute";form.style.top="-1000px";form.style.left="-1000px";form.target=id;form.method="POST";form.setAttribute("accept-charset","utf-8");area.name="d";form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area}this.form.action=this.uri();function complete(){initIframe();fn()}function initIframe(){if(self.iframe){try{self.form.removeChild(self.iframe)}catch(e){self.onError("jsonp polling iframe removal error",e)}}try{var html='<iframe src="javascript:0" name="'+self.iframeId+'">';iframe=document.createElement(html)}catch(e){iframe=document.createElement("iframe");iframe.name=self.iframeId;iframe.src="javascript:0"}iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe}initIframe();data=data.replace(rEscapedNewline,"\\\n");this.area.value=data.replace(rNewline,"\\n");try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(self.iframe.readyState=="complete"){complete()}}}else{this.iframe.onload=complete}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling":18,"component-inherit":21}],17:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_("xmlhttprequest");var Polling=_dereq_("./polling");var Emitter=_dereq_("component-emitter");var inherit=_dereq_("component-inherit");var debug=_dereq_("debug")("engine.io-client:polling-xhr");module.exports=XHR;module.exports.Request=Request;function empty(){}function XHR(opts){Polling.call(this,opts);if(global.location){var isSSL="https:"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}this.xd=opts.hostname!=global.location.hostname||port!=opts.port;this.xs=opts.secure!=isSSL}}inherit(XHR,Polling);XHR.prototype.supportsBinary=true;XHR.prototype.request=function(opts){opts=opts||{};opts.uri=this.uri();opts.xd=this.xd;opts.xs=this.xs;opts.agent=this.agent||false;opts.supportsBinary=this.supportsBinary;opts.enablesXDR=this.enablesXDR;opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;return new Request(opts)};XHR.prototype.doWrite=function(data,fn){var isBinary=typeof data!=="string"&&data!==undefined;var req=this.request({method:"POST",data:data,isBinary:isBinary});var self=this;req.on("success",fn);req.on("error",function(err){self.onError("xhr post error",err)});this.sendXhr=req};XHR.prototype.doPoll=function(){debug("xhr poll");var req=this.request();var self=this;req.on("data",function(data){self.onData(data)});req.on("error",function(err){self.onError("xhr poll error",err)});this.pollXhr=req};function Request(opts){this.method=opts.method||"GET";this.uri=opts.uri;this.xd=!!opts.xd;this.xs=!!opts.xs;this.async=false!==opts.async;this.data=undefined!=opts.data?opts.data:null;this.agent=opts.agent;this.isBinary=opts.isBinary;this.supportsBinary=opts.supportsBinary;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.create()}Emitter(Request.prototype);Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts);var self=this;try{debug("xhr open %s: %s",this.method,this.uri);xhr.open(this.method,this.uri,this.async);if(this.supportsBinary){xhr.responseType="arraybuffer"}if("POST"==this.method){try{if(this.isBinary){xhr.setRequestHeader("Content-type","application/octet-stream")}else{xhr.setRequestHeader("Content-type","text/plain;charset=UTF-8")}}catch(e){}}if("withCredentials"in xhr){xhr.withCredentials=true}if(this.hasXDR()){xhr.onload=function(){self.onLoad()};xhr.onerror=function(){self.onError(xhr.responseText)}}else{xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;if(200==xhr.status||1223==xhr.status){self.onLoad()}else{setTimeout(function(){self.onError(xhr.status)},0)}}}debug("xhr data %s",this.data);xhr.send(this.data)}catch(e){setTimeout(function(){self.onError(e)},0);return}if(global.document){this.index=Request.requestsCount++;Request.requests[this.index]=this}};Request.prototype.onSuccess=function(){this.emit("success");this.cleanup()};Request.prototype.onData=function(data){this.emit("data",data);this.onSuccess()};Request.prototype.onError=function(err){this.emit("error",err);this.cleanup(true)};Request.prototype.cleanup=function(fromError){if("undefined"==typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=empty}else{this.xhr.onreadystatechange=empty}if(fromError){try{this.xhr.abort()}catch(e){}}if(global.document){delete Request.requests[this.index]}this.xhr=null};Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(e){}if(contentType==="application/octet-stream"){data=this.xhr.response}else{if(!this.supportsBinary){data=this.xhr.responseText}else{data="ok"}}}catch(e){this.onError(e)}if(null!=data){this.onData(data)}};Request.prototype.hasXDR=function(){return"undefined"!==typeof global.XDomainRequest&&!this.xs&&this.enablesXDR};Request.prototype.abort=function(){this.cleanup()};if(global.document){Request.requestsCount=0;Request.requests={};if(global.attachEvent){global.attachEvent("onunload",unloadHandler)}else if(global.addEventListener){global.addEventListener("beforeunload",unloadHandler,false)}}function unloadHandler(){for(var i in Request.requests){if(Request.requests.hasOwnProperty(i)){Request.requests[i].abort()}}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling":18,"component-emitter":9,"component-inherit":21,debug:22,xmlhttprequest:20}],18:[function(_dereq_,module,exports){var Transport=_dereq_("../transport");var parseqs=_dereq_("parseqs");var parser=_dereq_("engine.io-parser");var inherit=_dereq_("component-inherit");var debug=_dereq_("debug")("engine.io-client:polling");module.exports=Polling;var hasXHR2=function(){var XMLHttpRequest=_dereq_("xmlhttprequest");var xhr=new XMLHttpRequest({xdomain:false});return null!=xhr.responseType}();function Polling(opts){var forceBase64=opts&&opts.forceBase64;if(!hasXHR2||forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(Polling,Transport);Polling.prototype.name="polling";Polling.prototype.doOpen=function(){this.poll()};Polling.prototype.pause=function(onPause){var pending=0;var self=this;this.readyState="pausing";function pause(){debug("paused");self.readyState="paused";onPause()}if(this.polling||!this.writable){var total=0;if(this.polling){debug("we are currently polling - waiting to pause");total++;this.once("pollComplete",function(){debug("pre-pause polling complete");--total||pause()})}if(!this.writable){debug("we are currently writing - waiting to pause");total++;this.once("drain",function(){debug("pre-pause writing complete");--total||pause()})}}else{pause()}};Polling.prototype.poll=function(){debug("polling");this.polling=true;this.doPoll();this.emit("poll")};Polling.prototype.onData=function(data){var self=this;debug("polling got data %s",data);var callback=function(packet,index,total){if("opening"==self.readyState){self.onOpen()}if("close"==packet.type){self.onClose();return false}self.onPacket(packet)};parser.decodePayload(data,this.socket.binaryType,callback);if("closed"!=this.readyState){this.polling=false;this.emit("pollComplete");if("open"==this.readyState){this.poll()}else{debug('ignoring poll - transport state "%s"',this.readyState)}}};Polling.prototype.doClose=function(){var self=this;function close(){debug("writing close packet");self.write([{type:"close"}])}if("open"==this.readyState){debug("transport open - closing");close()}else{debug("transport not open - deferring close");this.once("open",close)}};Polling.prototype.write=function(packets){var self=this;this.writable=false;var callbackfn=function(){self.writable=true;self.emit("drain")};var self=this;parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})};Polling.prototype.uri=function(){var query=this.query||{};var schema=this.secure?"https":"http";var port="";if(false!==this.timestampRequests){query[this.timestampParam]=+new Date+"-"+Transport.timestamps++}if(!this.supportsBinary&&!query.sid){query.b64=1}query=parseqs.encode(query);if(this.port&&("https"==schema&&this.port!=443||"http"==schema&&this.port!=80)){port=":"+this.port}if(query.length){query="?"+query}return schema+"://"+this.hostname+port+this.path+query}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,xmlhttprequest:20}],19:[function(_dereq_,module,exports){var Transport=_dereq_("../transport");var parser=_dereq_("engine.io-parser");var parseqs=_dereq_("parseqs");var inherit=_dereq_("component-inherit");var debug=_dereq_("debug")("engine.io-client:websocket");var WebSocket=_dereq_("ws");module.exports=WS;function WS(opts){var forceBase64=opts&&opts.forceBase64;if(forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(WS,Transport);WS.prototype.name="websocket";WS.prototype.supportsBinary=true;WS.prototype.doOpen=function(){if(!this.check()){return}var self=this;var uri=this.uri();var protocols=void 0;var opts={agent:this.agent};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;this.ws=new WebSocket(uri,protocols,opts);if(this.ws.binaryType===undefined){this.supportsBinary=false}this.ws.binaryType="arraybuffer";this.addEventListeners()};WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()};this.ws.onclose=function(){self.onClose()};this.ws.onmessage=function(ev){self.onData(ev.data)};this.ws.onerror=function(e){self.onError("websocket error",e)}};if("undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)){WS.prototype.onData=function(data){var self=this;setTimeout(function(){Transport.prototype.onData.call(self,data)},0)}}WS.prototype.write=function(packets){var self=this;this.writable=false;for(var i=0,l=packets.length;i<l;i++){parser.encodePacket(packets[i],this.supportsBinary,function(data){try{self.ws.send(data)}catch(e){debug("websocket closed before onclose event")}})}function ondrain(){self.writable=true;self.emit("drain")}setTimeout(ondrain,0)};WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)};WS.prototype.doClose=function(){if(typeof this.ws!=="undefined"){this.ws.close()}};WS.prototype.uri=function(){var query=this.query||{};var schema=this.secure?"wss":"ws";var port="";if(this.port&&("wss"==schema&&this.port!=443||"ws"==schema&&this.port!=80)){port=":"+this.port}if(this.timestampRequests){query[this.timestampParam]=+new Date}if(!this.supportsBinary){query.b64=1}query=parseqs.encode(query);if(query.length){query="?"+query}return schema+"://"+this.hostname+port+this.path+query};WS.prototype.check=function(){return!!WebSocket&&!("__initialize"in WebSocket&&this.name===WS.prototype.name)}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,ws:37}],20:[function(_dereq_,module,exports){var hasCORS=_dereq_("has-cors");module.exports=function(opts){var xdomain=opts.xdomain;var xscheme=opts.xscheme;var enablesXDR=opts.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!xdomain||hasCORS)){return new XMLHttpRequest}}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!xscheme&&enablesXDR){return new XDomainRequest}}catch(e){}if(!xdomain){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}},{"has-cors":40}],21:[function(_dereq_,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype;a.prototype=new fn;a.prototype.constructor=a}},{}],22:[function(_dereq_,module,exports){exports=module.exports=_dereq_("./debug");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function useColors(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff);if(!useColors)return args;var c="color: "+this.color;args=[args[0],c,"color: inherit"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if("%"===match)return;index++;if("%c"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){localStorage.removeItem("debug")}else{localStorage.debug=namespaces}}catch(e){}}function load(){var r;try{r=localStorage.debug}catch(e){}return r}exports.enable(load())},{"./debug":23}],23:[function(_dereq_,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=_dereq_("ms");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if("string"!==typeof args[0]){args=["%o"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match==="%")return match;index++;var formatter=exports.formatters[format];if("function"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if("function"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||"").split(/[\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\*/g,".*?");if(namespaces[0]==="-"){exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$"))}else{exports.names.push(new RegExp("^"+namespaces+"$"))}}}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:24}],24:[function(_dereq_,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if("string"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){var match=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"h":return n*h;case"minutes":case"minute":case"m":return n*m;case"seconds":case"second":case"s":return n*s;case"ms":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+"d";if(ms>=h)return Math.round(ms/h)+"h";if(ms>=m)return Math.round(ms/m)+"m";if(ms>=s)return Math.round(ms/s)+"s";return ms+"ms"}function long(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+" "+name;return Math.ceil(ms/n)+" "+name+"s"}},{}],25:[function(_dereq_,module,exports){(function(global){var keys=_dereq_("./keys");var hasBinary=_dereq_("has-binary");var sliceBuffer=_dereq_("arraybuffer.slice");var base64encoder=_dereq_("base64-arraybuffer");var after=_dereq_("after");var utf8=_dereq_("utf8");var isAndroid=navigator.userAgent.match(/Android/i);var isPhantomJS=/PhantomJS/i.test(navigator.userAgent);var dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var packetslist=keys(packets);var err={type:"error",data:"parser error"};var Blob=_dereq_("blob");exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){if("function"==typeof supportsBinary){callback=supportsBinary;supportsBinary=false}if("function"==typeof utf8encode){callback=utf8encode;utf8encode=null}var data=packet.data===undefined?undefined:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer){return encodeArrayBuffer(packet,supportsBinary,callback)}else if(Blob&&data instanceof global.Blob){return encodeBlob(packet,supportsBinary,callback)}if(data&&data.base64){return encodeBase64Object(packet,callback)}var encoded=packets[packet.type];if(undefined!==packet.data){encoded+=utf8encode?utf8.encode(String(packet.data)):String(packet.data)}return callback(""+encoded)};function encodeBase64Object(packet,callback){var message="b"+exports.packets[packet.type]+packet.data.data;return callback(message)}function encodeArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var data=packet.data;var contentArray=new Uint8Array(data);var resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++){resultBuffer[i+1]=contentArray[i]}return callback(resultBuffer.buffer)}function encodeBlobAsArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var fr=new FileReader;fr.onload=function(){packet.data=fr.result;exports.encodePacket(packet,supportsBinary,true,callback)};return fr.readAsArrayBuffer(packet.data)}function encodeBlob(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}if(dontSendBlobs){return encodeBlobAsArrayBuffer(packet,supportsBinary,callback)}var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}exports.encodeBase64Packet=function(packet,callback){var message="b"+exports.packets[packet.type];if(Blob&&packet.data instanceof Blob){var fr=new FileReader;fr.onload=function(){var b64=fr.result.split(",")[1];callback(message+b64)};return fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){var typed=new Uint8Array(packet.data);var basic=new Array(typed.length);for(var i=0;i<typed.length;i++){basic[i]=typed[i]}b64data=String.fromCharCode.apply(null,basic)}message+=global.btoa(b64data);return callback(message)};exports.decodePacket=function(data,binaryType,utf8decode){if(typeof data=="string"||data===undefined){if(data.charAt(0)=="b"){return exports.decodeBase64Packet(data.substr(1),binaryType)}if(utf8decode){try{data=utf8.decode(data)}catch(e){return err}}var type=data.charAt(0);if(Number(type)!=type||!packetslist[type]){return err}if(data.length>1){return{type:packetslist[type],data:data.substring(1)}}else{return{type:packetslist[type]}}}var asArray=new Uint8Array(data);var type=asArray[0];var rest=sliceBuffer(data,1);if(Blob&&binaryType==="blob"){rest=new Blob([rest])}return{type:packetslist[type],data:rest}};exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!global.ArrayBuffer){return{type:type,data:{base64:true,data:msg.substr(1)}}}var data=base64encoder.decode(msg.substr(1));if(binaryType==="blob"&&Blob){data=new Blob([data])}return{type:type,data:data}};exports.encodePayload=function(packets,supportsBinary,callback){if(typeof supportsBinary=="function"){callback=supportsBinary;supportsBinary=null}var isBinary=hasBinary(packets);if(supportsBinary&&isBinary){if(Blob&&!dontSendBlobs){return exports.encodePayloadAsBlob(packets,callback)}return exports.encodePayloadAsArrayBuffer(packets,callback)}if(!packets.length){return callback("0:")}function setLengthHeader(message){return message.length+":"+message}function encodeOne(packet,doneCallback){exports.encodePacket(packet,!isBinary?false:supportsBinary,true,function(message){doneCallback(null,setLengthHeader(message))})}map(packets,encodeOne,function(err,results){return callback(results.join(""))})};function map(ary,each,done){var result=new Array(ary.length);var next=after(ary.length,done);var eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg;cb(error,result)})};for(var i=0;i<ary.length;i++){eachWithIndex(i,ary[i],next)}}exports.decodePayload=function(data,binaryType,callback){if(typeof data!="string"){return exports.decodePayloadAsBinary(data,binaryType,callback)}if(typeof binaryType==="function"){callback=binaryType;binaryType=null}var packet;if(data==""){return callback(err,0,1)}var length="",n,msg;for(var i=0,l=data.length;i<l;i++){var chr=data.charAt(i);if(":"!=chr){length+=chr}else{if(""==length||length!=(n=Number(length))){return callback(err,0,1)}msg=data.substr(i+1,n);if(length!=msg.length){return callback(err,0,1)}if(msg.length){packet=exports.decodePacket(msg,binaryType,true);if(err.type==packet.type&&err.data==packet.data){return callback(err,0,1)}var ret=callback(packet,i+n,l);if(false===ret)return}i+=n;length=""}}if(length!=""){return callback(err,0,1)}};exports.encodePayloadAsArrayBuffer=function(packets,callback){if(!packets.length){return callback(new ArrayBuffer(0))}function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(data){return doneCallback(null,data)})}map(packets,encodeOne,function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;if(typeof p==="string"){len=p.length}else{len=p.byteLength}return acc+len.toString().length+len+2},0);var resultArray=new Uint8Array(totalLength);var bufferIndex=0;encodedPackets.forEach(function(p){var isString=typeof p==="string";var ab=p;if(isString){var view=new Uint8Array(p.length);for(var i=0;i<p.length;i++){view[i]=p.charCodeAt(i)}ab=view.buffer}if(isString){resultArray[bufferIndex++]=0}else{resultArray[bufferIndex++]=1}var lenStr=ab.byteLength.toString();for(var i=0;i<lenStr.length;i++){resultArray[bufferIndex++]=parseInt(lenStr[i])}resultArray[bufferIndex++]=255;var view=new Uint8Array(ab);for(var i=0;i<view.length;i++){resultArray[bufferIndex++]=view[i]}});return callback(resultArray.buffer)})};exports.encodePayloadAsBlob=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(encoded){var binaryIdentifier=new Uint8Array(1);binaryIdentifier[0]=1;if(typeof encoded==="string"){var view=new Uint8Array(encoded.length);for(var i=0;i<encoded.length;i++){view[i]=encoded.charCodeAt(i)}encoded=view.buffer;binaryIdentifier[0]=0}var len=encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size;var lenStr=len.toString();var lengthAry=new Uint8Array(lenStr.length+1);for(var i=0;i<lenStr.length;i++){lengthAry[i]=parseInt(lenStr[i])}lengthAry[lenStr.length]=255;if(Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})}map(packets,encodeOne,function(err,results){return callback(new Blob(results))})};exports.decodePayloadAsBinary=function(data,binaryType,callback){if(typeof binaryType==="function"){callback=binaryType;binaryType=null}var bufferTail=data;var buffers=[];var numberTooLong=false;while(bufferTail.byteLength>0){var tailArray=new Uint8Array(bufferTail);var isString=tailArray[0]===0;var msgLength="";for(var i=1;;i++){if(tailArray[i]==255)break;if(msgLength.length>310){numberTooLong=true;break}msgLength+=tailArray[i]}if(numberTooLong)return callback(err,0,1);bufferTail=sliceBuffer(bufferTail,2+msgLength.length);msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString){try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg="";for(var i=0;i<typed.length;i++){msg+=String.fromCharCode(typed[i])}}}buffers.push(msg);bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,true),i,total)})}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./keys":26,after:27,"arraybuffer.slice":28,"base64-arraybuffer":29,blob:30,"has-binary":31,utf8:33}],26:[function(_dereq_,module,exports){module.exports=Object.keys||function keys(obj){var arr=[];var has=Object.prototype.hasOwnProperty;for(var i in obj){if(has.call(obj,i)){arr.push(i)}}return arr}},{}],27:[function(_dereq_,module,exports){module.exports=after;function after(count,callback,err_cb){var bail=false;err_cb=err_cb||noop;proxy.count=count;return count===0?callback():proxy;function proxy(err,result){if(proxy.count<=0){throw new Error("after called too many times")}--proxy.count;if(err){bail=true;callback(err);callback=err_cb}else if(proxy.count===0&&!bail){callback(null,result)}}}function noop(){}},{}],28:[function(_dereq_,module,exports){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;start=start||0;end=end||bytes;if(arraybuffer.slice){return arraybuffer.slice(start,end)}if(start<0){start+=bytes}if(end<0){end+=bytes}if(end>bytes){end=bytes}if(start>=bytes||start>=end||bytes===0){return new ArrayBuffer(0)}var abv=new Uint8Array(arraybuffer);var result=new Uint8Array(end-start);for(var i=start,ii=0;i<end;i++,ii++){result[ii]=abv[i]}return result.buffer}},{}],29:[function(_dereq_,module,exports){(function(chars){"use strict";exports.encode=function(arraybuffer){var bytes=new Uint8Array(arraybuffer),i,len=bytes.length,base64="";for(i=0;i<len;i+=3){base64+=chars[bytes[i]>>2];base64+=chars[(bytes[i]&3)<<4|bytes[i+1]>>4];base64+=chars[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64+=chars[bytes[i+2]&63]}if(len%3===2){base64=base64.substring(0,base64.length-1)+"="}else if(len%3===1){base64=base64.substring(0,base64.length-2)+"=="}return base64};exports.decode=function(base64){var bufferLength=base64.length*.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;if(base64[base64.length-1]==="="){bufferLength--;if(base64[base64.length-2]==="="){bufferLength--}}var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4){encoded1=chars.indexOf(base64[i]);encoded2=chars.indexOf(base64[i+1]);encoded3=chars.indexOf(base64[i+2]);encoded4=chars.indexOf(base64[i+3]);bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}return arraybuffer}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],30:[function(_dereq_,module,exports){(function(global){var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder;var blobSupported=function(){try{var b=new Blob(["hi"]);return b.size==2}catch(e){return false}}();var blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;function BlobBuilderConstructor(ary,options){options=options||{};var bb=new BlobBuilder;for(var i=0;i<ary.length;i++){bb.append(ary[i])}return options.type?bb.getBlob(options.type):bb.getBlob()}module.exports=function(){if(blobSupported){return global.Blob}else if(blobBuilderSupported){return BlobBuilderConstructor}else{return undefined}}()}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],31:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_("isarray");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&"object"==typeof obj){if(obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(obj.hasOwnProperty(key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{isarray:32}],32:[function(_dereq_,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)=="[object Array]"}},{}],33:[function(_dereq_,module,exports){(function(global){(function(root){var freeExports=typeof exports=="object"&&exports;var freeModule=typeof module=="object"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var stringFromCharCode=String.fromCharCode;function ucs2decode(string){var output=[];var counter=0;var length=string.length;var value;var extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){var length=array.length;var index=-1;var value;var output="";while(++index<length){value=array[index];if(value>65535){value-=65536;
output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value)}return output}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint){if((codePoint&4294967168)==0){return stringFromCharCode(codePoint)}var symbol="";if((codePoint&4294965248)==0){symbol=stringFromCharCode(codePoint>>6&31|192)}else if((codePoint&4294901760)==0){symbol=stringFromCharCode(codePoint>>12&15|224);symbol+=createByte(codePoint,6)}else if((codePoint&4292870144)==0){symbol=stringFromCharCode(codePoint>>18&7|240);symbol+=createByte(codePoint,12);symbol+=createByte(codePoint,6)}symbol+=stringFromCharCode(codePoint&63|128);return symbol}function utf8encode(string){var codePoints=ucs2decode(string);var length=codePoints.length;var index=-1;var codePoint;var byteString="";while(++index<length){codePoint=codePoints[index];byteString+=encodeCodePoint(codePoint)}return byteString}function readContinuationByte(){if(byteIndex>=byteCount){throw Error("Invalid byte index")}var continuationByte=byteArray[byteIndex]&255;byteIndex++;if((continuationByte&192)==128){return continuationByte&63}throw Error("Invalid continuation byte")}function decodeSymbol(){var byte1;var byte2;var byte3;var byte4;var codePoint;if(byteIndex>byteCount){throw Error("Invalid byte index")}if(byteIndex==byteCount){return false}byte1=byteArray[byteIndex]&255;byteIndex++;if((byte1&128)==0){return byte1}if((byte1&224)==192){var byte2=readContinuationByte();codePoint=(byte1&31)<<6|byte2;if(codePoint>=128){return codePoint}else{throw Error("Invalid continuation byte")}}if((byte1&240)==224){byte2=readContinuationByte();byte3=readContinuationByte();codePoint=(byte1&15)<<12|byte2<<6|byte3;if(codePoint>=2048){return codePoint}else{throw Error("Invalid continuation byte")}}if((byte1&248)==240){byte2=readContinuationByte();byte3=readContinuationByte();byte4=readContinuationByte();codePoint=(byte1&15)<<18|byte2<<12|byte3<<6|byte4;if(codePoint>=65536&&codePoint<=1114111){return codePoint}}throw Error("Invalid UTF-8 detected")}var byteArray;var byteCount;var byteIndex;function utf8decode(byteString){byteArray=ucs2decode(byteString);byteCount=byteArray.length;byteIndex=0;var codePoints=[];var tmp;while((tmp=decodeSymbol())!==false){codePoints.push(tmp)}return ucs2encode(codePoints)}var utf8={version:"2.0.0",encode:utf8encode,decode:utf8decode};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){define(function(){return utf8})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=utf8}else{var object={};var hasOwnProperty=object.hasOwnProperty;for(var key in utf8){hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}}}else{root.utf8=utf8}})(this)}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],34:[function(_dereq_,module,exports){(function(global){var rvalidchars=/^[\],:{}\s]*$/;var rvalidescape=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rvalidtokens=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;var rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g;var rtrimLeft=/^\s+/;var rtrimRight=/\s+$/;module.exports=function parsejson(data){if("string"!=typeof data||!data){return null}data=data.replace(rtrimLeft,"").replace(rtrimRight,"");if(global.JSON&&JSON.parse){return JSON.parse(data)}if(rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))){return new Function("return "+data)()}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],35:[function(_dereq_,module,exports){exports.encode=function(obj){var str="";for(var i in obj){if(obj.hasOwnProperty(i)){if(str.length)str+="&";str+=encodeURIComponent(i)+"="+encodeURIComponent(obj[i])}}return str};exports.decode=function(qs){var qry={};var pairs=qs.split("&");for(var i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split("=");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],36:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];module.exports=function parseuri(str){var src=str,b=str.indexOf("["),e=str.indexOf("]");if(b!=-1&&e!=-1){str=str.substring(0,b)+str.substring(b,e).replace(/:/g,";")+str.substring(e,str.length)}var m=re.exec(str||""),uri={},i=14;while(i--){uri[parts[i]]=m[i]||""}if(b!=-1&&e!=-1){uri.source=src;uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,":");uri.authority=uri.authority.replace("[","").replace("]","").replace(/;/g,":");uri.ipv6uri=true}return uri}},{}],37:[function(_dereq_,module,exports){var global=function(){return this}();var WebSocket=global.WebSocket||global.MozWebSocket;module.exports=WebSocket?ws:null;function ws(uri,protocols,opts){var instance;if(protocols){instance=new WebSocket(uri,protocols)}else{instance=new WebSocket(uri)}return instance}if(WebSocket)ws.prototype=WebSocket.prototype},{}],38:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_("isarray");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&"object"==typeof obj){if(obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{isarray:39}],39:[function(_dereq_,module,exports){module.exports=_dereq_(32)},{}],40:[function(_dereq_,module,exports){var global=_dereq_("global");try{module.exports="XMLHttpRequest"in global&&"withCredentials"in new global.XMLHttpRequest}catch(err){module.exports=false}},{global:41}],41:[function(_dereq_,module,exports){module.exports=function(){return this}()},{}],42:[function(_dereq_,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],43:[function(_dereq_,module,exports){var has=Object.prototype.hasOwnProperty;exports.keys=Object.keys||function(obj){var keys=[];for(var key in obj){if(has.call(obj,key)){keys.push(key)}}return keys};exports.values=function(obj){var vals=[];for(var key in obj){if(has.call(obj,key)){vals.push(obj[key])}}return vals};exports.merge=function(a,b){for(var key in b){if(has.call(b,key)){a[key]=b[key]}}return a};exports.length=function(obj){return exports.keys(obj).length};exports.isEmpty=function(obj){return 0==exports.length(obj)}},{}],44:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];module.exports=function parseuri(str){var m=re.exec(str||""),uri={},i=14;while(i--){uri[parts[i]]=m[i]||""}return uri}},{}],45:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_("isarray");var isBuf=_dereq_("./is-buffer");exports.deconstructPacket=function(packet){var buffers=[];var packetData=packet.data;function _deconstructPacket(data){if(!data)return data;if(isBuf(data)){var placeholder={_placeholder:true,num:buffers.length};buffers.push(data);return placeholder}else if(isArray(data)){var newData=new Array(data.length);for(var i=0;i<data.length;i++){newData[i]=_deconstructPacket(data[i])}return newData}else if("object"==typeof data&&!(data instanceof Date)){var newData={};for(var key in data){newData[key]=_deconstructPacket(data[key])}return newData}return data}var pack=packet;pack.data=_deconstructPacket(packetData);pack.attachments=buffers.length;return{packet:pack,buffers:buffers}};exports.reconstructPacket=function(packet,buffers){var curPlaceHolder=0;function _reconstructPacket(data){if(data&&data._placeholder){var buf=buffers[data.num];return buf}else if(isArray(data)){for(var i=0;i<data.length;i++){data[i]=_reconstructPacket(data[i])}return data}else if(data&&"object"==typeof data){for(var key in data){data[key]=_reconstructPacket(data[key])}return data}return data}packet.data=_reconstructPacket(packet.data);packet.attachments=undefined;return packet};exports.removeBlobs=function(data,callback){function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){if(containingObject){containingObject[curKey]=this.result}else{bloblessData=this.result}if(!--pendingBlobs){callback(bloblessData)}};fileReader.readAsArrayBuffer(obj)}else if(isArray(obj)){for(var i=0;i<obj.length;i++){_removeBlobs(obj[i],i,obj)}}else if(obj&&"object"==typeof obj&&!isBuf(obj)){for(var key in obj){_removeBlobs(obj[key],key,obj)}}}var pendingBlobs=0;var bloblessData=data;_removeBlobs(bloblessData);if(!pendingBlobs){callback(bloblessData)}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./is-buffer":47,isarray:48}],46:[function(_dereq_,module,exports){var debug=_dereq_("debug")("socket.io-parser");var json=_dereq_("json3");var isArray=_dereq_("isarray");var Emitter=_dereq_("component-emitter");var binary=_dereq_("./binary");var isBuf=_dereq_("./is-buffer");exports.protocol=4;exports.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"];exports.CONNECT=0;exports.DISCONNECT=1;exports.EVENT=2;exports.ACK=3;exports.ERROR=4;exports.BINARY_EVENT=5;exports.BINARY_ACK=6;exports.Encoder=Encoder;exports.Decoder=Decoder;function Encoder(){}Encoder.prototype.encode=function(obj,callback){debug("encoding packet %j",obj);if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){encodeAsBinary(obj,callback)}else{var encoding=encodeAsString(obj);callback([encoding])}};function encodeAsString(obj){var str="";var nsp=false;str+=obj.type;if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){str+=obj.attachments;str+="-"}if(obj.nsp&&"/"!=obj.nsp){nsp=true;str+=obj.nsp}if(null!=obj.id){if(nsp){str+=",";nsp=false}str+=obj.id}if(null!=obj.data){if(nsp)str+=",";str+=json.stringify(obj.data)}debug("encoded %j as %s",obj,str);return str}function encodeAsBinary(obj,callback){function writeEncoding(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData);var pack=encodeAsString(deconstruction.packet);var buffers=deconstruction.buffers;buffers.unshift(pack);callback(buffers)}binary.removeBlobs(obj,writeEncoding)}function Decoder(){this.reconstructor=null}Emitter(Decoder.prototype);Decoder.prototype.add=function(obj){var packet;if("string"==typeof obj){packet=decodeString(obj);if(exports.BINARY_EVENT==packet.type||exports.BINARY_ACK==packet.type){this.reconstructor=new BinaryReconstructor(packet);if(this.reconstructor.reconPack.attachments===0){this.emit("decoded",packet)}}else{this.emit("decoded",packet)}}else if(isBuf(obj)||obj.base64){if(!this.reconstructor){throw new Error("got binary data when not reconstructing a packet")}else{packet=this.reconstructor.takeBinaryData(obj);if(packet){this.reconstructor=null;this.emit("decoded",packet)}}}else{throw new Error("Unknown type: "+obj)}};function decodeString(str){var p={};var i=0;p.type=Number(str.charAt(0));if(null==exports.types[p.type])return error();if(exports.BINARY_EVENT==p.type||exports.BINARY_ACK==p.type){var buf="";while(str.charAt(++i)!="-"){buf+=str.charAt(i);if(i==str.length)break}if(buf!=Number(buf)||str.charAt(i)!="-"){throw new Error("Illegal attachments")}p.attachments=Number(buf)}if("/"==str.charAt(i+1)){p.nsp="";while(++i){var c=str.charAt(i);if(","==c)break;p.nsp+=c;if(i==str.length)break}}else{p.nsp="/"}var next=str.charAt(i+1);if(""!==next&&Number(next)==next){p.id="";while(++i){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}p.id+=str.charAt(i);if(i==str.length)break}p.id=Number(p.id)}if(str.charAt(++i)){try{p.data=json.parse(str.substr(i))}catch(e){return error()}}debug("decoded %s as %j",str,p);return p}Decoder.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function BinaryReconstructor(packet){this.reconPack=packet;this.buffers=[]}BinaryReconstructor.prototype.takeBinaryData=function(binData){this.buffers.push(binData);if(this.buffers.length==this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return packet}return null};BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function error(data){return{type:exports.ERROR,data:"parser error"}}},{"./binary":45,"./is-buffer":47,"component-emitter":9,debug:10,isarray:48,json3:49}],47:[function(_dereq_,module,exports){(function(global){module.exports=isBuf;function isBuf(obj){return global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],48:[function(_dereq_,module,exports){module.exports=_dereq_(32)},{}],49:[function(_dereq_,module,exports){(function(window){var getClass={}.toString,isProperty,forEach,undef;var isLoader=typeof define==="function"&&define.amd;var nativeJSON=typeof JSON=="object"&&JSON;var JSON3=typeof exports=="object"&&exports&&!exports.nodeType&&exports;if(JSON3&&nativeJSON){JSON3.stringify=nativeJSON.stringify;JSON3.parse=nativeJSON.parse}else{JSON3=window.JSON=nativeJSON||{}}var isExtended=new Date(-0xc782b5b800cec);try{isExtended=isExtended.getUTCFullYear()==-109252&&isExtended.getUTCMonth()===0&&isExtended.getUTCDate()===1&&isExtended.getUTCHours()==10&&isExtended.getUTCMinutes()==37&&isExtended.getUTCSeconds()==6&&isExtended.getUTCMilliseconds()==708}catch(exception){}function has(name){if(has[name]!==undef){return has[name]}var isSupported;if(name=="bug-string-char-index"){isSupported="a"[0]!="a"}else if(name=="json"){isSupported=has("json-stringify")&&has("json-parse")}else{var value,serialized='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if(name=="json-stringify"){var stringify=JSON3.stringify,stringifySupported=typeof stringify=="function"&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported=stringify(0)==="0"&&stringify(new Number)==="0"&&stringify(new String)=='""'&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&stringify(value)==="1"&&stringify([value])=="[1]"&&stringify([undef])=="[null]"&&stringify(null)=="null"&&stringify([undef,getClass,null])=="[null,null,null]"&&stringify({a:[value,true,false,null,"\x00\b\n\f\r	"]})==serialized&&stringify(null,value)==="1"&&stringify([1,2],null,1)=="[\n 1,\n 2\n]"&&stringify(new Date(-864e13))=='"-271821-04-20T00:00:00.000Z"'&&stringify(new Date(864e13))=='"+275760-09-13T00:00:00.000Z"'&&stringify(new Date(-621987552e5))=='"-000001-01-01T00:00:00.000Z"'&&stringify(new Date(-1))=='"1969-12-31T23:59:59.999Z"'}catch(exception){stringifySupported=false}}isSupported=stringifySupported}if(name=="json-parse"){var parse=JSON3.parse;if(typeof parse=="function"){try{if(parse("0")===0&&!parse(false)){value=parse(serialized);var parseSupported=value["a"].length==5&&value["a"][0]===1;if(parseSupported){try{parseSupported=!parse('"	"')}catch(exception){}if(parseSupported){try{parseSupported=parse("01")!==1}catch(exception){}}if(parseSupported){try{parseSupported=parse("1.")!==1}catch(exception){}}}}}catch(exception){parseSupported=false}}isSupported=parseSupported}}return has[name]=!!isSupported}if(!has("json")){var functionClass="[object Function]";var dateClass="[object Date]";var numberClass="[object Number]";var stringClass="[object String]";var arrayClass="[object Array]";var booleanClass="[object Boolean]";var charIndexBuggy=has("bug-string-char-index");if(!isExtended){var floor=Math.floor;var Months=[0,31,59,90,120,151,181,212,243,273,304,334];var getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)}}if(!(isProperty={}.hasOwnProperty)){isProperty=function(property){var members={},constructor;if((members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass){isProperty=function(property){var original=this.__proto__,result=property in(this.__proto__=null,this);this.__proto__=original;return result}}else{constructor=members.constructor;isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}}members=null;return isProperty.call(this,property)}}var PrimitiveTypes={"boolean":1,number:1,string:1,undefined:1};var isHostType=function(object,property){var type=typeof object[property];return type=="object"?!!object[property]:!PrimitiveTypes[type]};forEach=function(object,callback){var size=0,Properties,members,property;(Properties=function(){this.valueOf=0}).prototype.valueOf=0;members=new Properties;for(property in members){if(isProperty.call(members,property)){size++}}Properties=members=null;if(!size){members=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"];forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,length;var hasProperty=!isFunction&&typeof object.constructor!="function"&&isHostType(object,"hasOwnProperty")?object.hasOwnProperty:isProperty;for(property in object){if(!(isFunction&&property=="prototype")&&hasProperty.call(object,property)){callback(property)}}for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}}else if(size==2){forEach=function(object,callback){var members={},isFunction=getClass.call(object)==functionClass,property;for(property in object){if(!(isFunction&&property=="prototype")&&!isProperty.call(members,property)&&(members[property]=1)&&isProperty.call(object,property)){callback(property)}}}}else{forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,isConstructor;for(property in object){if(!(isFunction&&property=="prototype")&&isProperty.call(object,property)&&!(isConstructor=property==="constructor")){callback(property)}}if(isConstructor||isProperty.call(object,property="constructor")){callback(property)}}}return forEach(object,callback)};if(!has("json-stringify")){var Escapes={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"};var leadingZeroes="000000";var toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)};var unicodePrefix="\\u00";var quote=function(value){var result='"',index=0,length=value.length,isLarge=length>10&&charIndexBuggy,symbols;if(isLarge){symbols=value.split("")}for(;index<length;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(charCode<32){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break}result+=isLarge?symbols[index]:charIndexBuggy?value.charAt(index):value[index]}}return result+'"'};var serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if(typeof value=="object"&&value){className=getClass.call(value);if(className==dateClass&&!isProperty.call(value,"toJSON")){if(value>-1/0&&value<1/0){if(getDay){date=floor(value/864e5);for(year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month);time=(value%864e5+864e5)%864e5;hours=floor(time/36e5)%24;minutes=floor(time/6e4)%60;seconds=floor(time/1e3)%60;milliseconds=time%1e3}else{year=value.getUTCFullYear();month=value.getUTCMonth();date=value.getUTCDate();hours=value.getUTCHours();minutes=value.getUTCMinutes();seconds=value.getUTCSeconds();milliseconds=value.getUTCMilliseconds()}value=(year<=0||year>=1e4?(year<0?"-":"+")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+"-"+toPaddedString(2,month+1)+"-"+toPaddedString(2,date)+"T"+toPaddedString(2,hours)+":"+toPaddedString(2,minutes)+":"+toPaddedString(2,seconds)+"."+toPaddedString(3,milliseconds)+"Z"}else{value=null}}else if(typeof value.toJSON=="function"&&(className!=numberClass&&className!=stringClass&&className!=arrayClass||isProperty.call(value,"toJSON"))){value=value.toJSON(property)}}if(callback){value=callback.call(object,property,value)}if(value===null){return"null"}className=getClass.call(value);if(className==booleanClass){return""+value}else if(className==numberClass){return value>-1/0&&value<1/0?""+value:"null"}else if(className==stringClass){return quote(""+value)}if(typeof value=="object"){for(length=stack.length;length--;){if(stack[length]===value){throw TypeError()}}stack.push(value);results=[];prefix=indentation;indentation+=whitespace;if(className==arrayClass){for(index=0,length=value.length;index<length;index++){element=serialize(index,value,callback,properties,whitespace,indentation,stack);results.push(element===undef?"null":element)}result=results.length?whitespace?"[\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"]":"["+results.join(",")+"]":"[]"}else{forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);if(element!==undef){results.push(quote(property)+":"+(whitespace?" ":"")+element)}});result=results.length?whitespace?"{\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"}":"{"+results.join(",")+"}":"{}"}stack.pop();return result}};JSON3.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(typeof filter=="function"||typeof filter=="object"&&filter){if((className=getClass.call(filter))==functionClass){callback=filter}else if(className==arrayClass){properties={};for(var index=0,length=filter.length,value;index<length;value=filter[index++],(className=getClass.call(value),className==stringClass||className==numberClass)&&(properties[value]=1));}}if(width){if((className=getClass.call(width))==numberClass){if((width-=width%1)>0){for(whitespace="",width>10&&(width=10);whitespace.length<width;whitespace+=" ");}}else if(className==stringClass){whitespace=width.length<=10?width:width.slice(0,10)}}return serialize("",(value={},value[""]=source,value),callback,properties,whitespace,"",[])}}if(!has("json-parse")){var fromCharCode=String.fromCharCode;var Unescapes={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"};var Index,Source;var abort=function(){Index=Source=null;throw SyntaxError()};var lex=function(){var source=Source,length=source.length,value,begin,position,isSigned,charCode;while(Index<length){charCode=source.charCodeAt(Index);switch(charCode){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:value=charIndexBuggy?source.charAt(Index):source[Index];Index++;return value;case 34:for(value="@",Index++;Index<length;){charCode=source.charCodeAt(Index);if(charCode<32){abort()}else if(charCode==92){charCode=source.charCodeAt(++Index);switch(charCode){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode];Index++;break;case 117:begin=++Index;for(position=Index+4;Index<position;Index++){charCode=source.charCodeAt(Index);if(!(charCode>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70)){abort()}}value+=fromCharCode("0x"+source.slice(begin,Index));break;default:abort()}}else{if(charCode==34){break}charCode=source.charCodeAt(Index);begin=Index;while(charCode>=32&&charCode!=92&&charCode!=34){charCode=source.charCodeAt(++Index)}value+=source.slice(begin,Index)}}if(source.charCodeAt(Index)==34){Index++;return value}abort();default:begin=Index;if(charCode==45){isSigned=true;charCode=source.charCodeAt(++Index)}if(charCode>=48&&charCode<=57){if(charCode==48&&(charCode=source.charCodeAt(Index+1),charCode>=48&&charCode<=57)){abort()}isSigned=false;for(;Index<length&&(charCode=source.charCodeAt(Index),charCode>=48&&charCode<=57);Index++);if(source.charCodeAt(Index)==46){position=++Index;for(;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}charCode=source.charCodeAt(Index);if(charCode==101||charCode==69){charCode=source.charCodeAt(++Index);if(charCode==43||charCode==45){Index++}for(position=Index;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}return+source.slice(begin,Index)}if(isSigned){abort()}if(source.slice(Index,Index+4)=="true"){Index+=4;return true}else if(source.slice(Index,Index+5)=="false"){Index+=5;return false}else if(source.slice(Index,Index+4)=="null"){Index+=4;return null}abort()}}return"$"};var get=function(value){var results,hasMembers;if(value=="$"){abort()}if(typeof value=="string"){if((charIndexBuggy?value.charAt(0):value[0])=="@"){return value.slice(1)}if(value=="["){results=[];for(;;hasMembers||(hasMembers=true)){value=lex();if(value=="]"){break}if(hasMembers){if(value==","){value=lex();if(value=="]"){abort()}}else{abort()}}if(value==","){abort()}results.push(get(value))}return results}else if(value=="{"){results={};for(;;hasMembers||(hasMembers=true)){value=lex();if(value=="}"){break}if(hasMembers){if(value==","){value=lex();if(value=="}"){abort()}}else{abort()}}if(value==","||typeof value!="string"||(charIndexBuggy?value.charAt(0):value[0])!="@"||lex()!=":"){abort()}results[value.slice(1)]=get(lex())}return results}abort()}return value};var update=function(source,property,callback){var element=walk(source,property,callback);if(element===undef){delete source[property]}else{source[property]=element}};var walk=function(source,property,callback){var value=source[property],length;if(typeof value=="object"&&value){if(getClass.call(value)==arrayClass){for(length=value.length;length--;){update(value,length,callback)}}else{forEach(value,function(property){update(value,property,callback)})}}return callback.call(source,property,value)};JSON3.parse=function(source,callback){var result,value;Index=0;Source=""+source;result=get(lex());if(lex()!="$"){abort()}Index=Source=null;return callback&&getClass.call(callback)==functionClass?walk((value={},value[""]=result,value),"",callback):result}}}if(isLoader){define(function(){return JSON3})}})(this)},{}],50:[function(_dereq_,module,exports){module.exports=toArray;function toArray(list,index){var array=[];index=index||0;for(var i=index||0;i<list.length;i++){array[i-index]=list[i]}return array}},{}]},{},[1])(1)});
    /* Drag and Drop*/
(function (e) {
    "function" == typeof define && define.amd ? define(["wjq"], e) : e(wjq);
})(function (e) {
    function t(t, s) {
        var n, a, o, r = t.nodeName.toLowerCase();
        return "area" === r ? (n = t.parentNode, a = n.name, t.href && a && "map" === n.nodeName.toLowerCase() ? (o = e("img[usemap='#" + a + "']")[0],
        !!o && i(o)) : !1) : (/^(input|select|textarea|button|object)$/.test(r) ? !t.disabled : "a" === r ? t.href || s : s) && i(t);
    }

    function i(t) {
        return e.expr.filters.visible(t) && !e(t).parents().addBack().filter(function () {
                return "hidden" === e.css(this, "visibility");
            }).length;
    }

    e.ui = e.ui || {}, e.extend(e.ui, {
        version: "1.11.4",
        keyCode: {
            BACKSPACE: 8,
            COMMA: 188,
            DELETE: 46,
            DOWN: 40,
            END: 35,
            ENTER: 13,
            ESCAPE: 27,
            HOME: 36,
            LEFT: 37,
            PAGE_DOWN: 34,
            PAGE_UP: 33,
            PERIOD: 190,
            RIGHT: 39,
            SPACE: 32,
            TAB: 9,
            UP: 38
        }
    }), e.fn.extend({
        scrollParent: function (t) {
            var i = this.css("position"), s = "absolute" === i, n = t ? /(auto|scroll|hidden)/ : /(auto|scroll)/, a = this.parents().filter(function () {
                var t = e(this);
                return s && "static" === t.css("position") ? !1 : n.test(t.css("overflow") + t.css("overflow-y") + t.css("overflow-x"));
            }).eq(0);
            return "fixed" !== i && a.length ? a : e(this[0].ownerDocument || document);
        },
        uniqueId: function () {
            var e = 0;
            return function () {
                return this.each(function () {
                    this.id || (this.id = "ui-id-" + ++e);
                });
            };
        }(),
        removeUniqueId: function () {
            return this.each(function () {
                /^ui-id-\d+$/.test(this.id) && e(this).removeAttr("id");
            });
        }
    }), e.extend(e.expr[":"], {
        data: e.expr.createPseudo ? e.expr.createPseudo(function (t) {
            return function (i) {
                return !!e.data(i, t);
            };
        }) : function (t, i, s) {
            return !!e.data(t, s[3]);
        },
        focusable: function (i) {
            return t(i, !isNaN(e.attr(i, "tabindex")));
        },
        tabbable: function (i) {
            var s = e.attr(i, "tabindex"), n = isNaN(s);
            return (n || s >= 0) && t(i, !n);
        }
    }), e("<a>").outerWidth(1).wjq || e.each(["Width", "Height"], function (t, i) {
        function s(t, i, s, a) {
            return e.each(n, function () {
                i -= parseFloat(e.css(t, "padding" + this)) || 0, s && (i -= parseFloat(e.css(t, "border" + this + "Width")) || 0),
                a && (i -= parseFloat(e.css(t, "margin" + this)) || 0);
            }), i;
        }

        var n = "Width" === i ? ["Left", "Right"] : ["Top", "Bottom"], a = i.toLowerCase(), o = {
            innerWidth: e.fn.innerWidth,
            innerHeight: e.fn.innerHeight,
            outerWidth: e.fn.outerWidth,
            outerHeight: e.fn.outerHeight
        };
        e.fn["inner" + i] = function (t) {
            return void 0 === t ? o["inner" + i].call(this) : this.each(function () {
                e(this).css(a, s(this, t) + "px");
            });
        }, e.fn["outer" + i] = function (t, n) {
            return "number" != typeof t ? o["outer" + i].call(this, t) : this.each(function () {
                e(this).css(a, s(this, t, !0, n) + "px");
            });
        };
    }), e.fn.addBack || (e.fn.addBack = function (e) {
        return this.add(null == e ? this.prevObject : this.prevObject.filter(e));
    }), e("<a>").data("a-b", "a").removeData("a-b").data("a-b") && (e.fn.removeData = function (t) {
        return function (i) {
            return arguments.length ? t.call(this, e.camelCase(i)) : t.call(this);
        };
    }(e.fn.removeData)), e.ui.ie = !!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),
        e.fn.extend({
            focus: function (t) {
                return function (i, s) {
                    return "number" == typeof i ? this.each(function () {
                        var t = this;
                        setTimeout(function () {
                            e(t).focus(), s && s.call(t);
                        }, i);
                    }) : t.apply(this, arguments);
                };
            }(e.fn.focus),
            disableSelection: function () {
                var e = "onselectstart" in document.createElement("div") ? "selectstart" : "mousedown";
                return function () {
                    return this.bind(e + ".ui-disableSelection", function (e) {
                        e.preventDefault();
                    });
                };
            }(),
            enableSelection: function () {
                return this.unbind(".ui-disableSelection");
            },
            zIndex: function (t) {
                if (void 0 !== t) return this.css("zIndex", t);
                if (this.length) for (var i, s, n = e(this[0]); n.length && n[0] !== document;) {
                    if (i = n.css("position"), ("absolute" === i || "relative" === i || "fixed" === i) && (s = parseInt(n.css("zIndex"), 10),
                        !isNaN(s) && 0 !== s)) return s;
                    n = n.parent();
                }
                return 0;
            }
        }), e.ui.plugin = {
        add: function (t, i, s) {
            var n, a = e.ui[t].prototype;
            for (n in s) a.plugins[n] = a.plugins[n] || [], a.plugins[n].push([i, s[n]]);
        },
        call: function (e, t, i, s) {
            var n, a = e.plugins[t];
            if (a && (s || e.element[0].parentNode && 11 !== e.element[0].parentNode.nodeType)) for (n = 0; a.length > n; n++) e.options[a[n][0]] && a[n][1].apply(e.element, i);
        }
    };
    var s = 0, n = Array.prototype.slice;
    e.cleanData = function (t) {
        return function (i) {
            var s, n, a;
            for (a = 0; null != (n = i[a]); a++) try {
                s = e._data(n, "events"), s && s.remove && e(n).triggerHandler("remove");
            } catch (o) {
            }
            t(i);
        };
    }(e.cleanData), e.widget = function (t, i, s) {
        var n, a, o, r, h = {}, l = t.split(".")[0];
        return t = t.split(".")[1], n = l + "-" + t, s || (s = i, i = e.Widget), e.expr[":"][n.toLowerCase()] = function (t) {
            return !!e.data(t, n);
        }, e[l] = e[l] || {}, a = e[l][t], o = e[l][t] = function (e, t) {
            return this._createWidget ? (arguments.length && this._createWidget(e, t), void 0) : new o(e, t);
        }, e.extend(o, a, {
            version: s.version,
            _proto: e.extend({}, s),
            _childConstructors: []
        }), r = new i(), r.options = e.widget.extend({}, r.options), e.each(s, function (t, s) {
            return e.isFunction(s) ? (h[t] = function () {
                var e = function () {
                    return i.prototype[t].apply(this, arguments);
                }, n = function (e) {
                    return i.prototype[t].apply(this, e);
                };
                return function () {
                    var t, i = this._super, a = this._superApply;
                    return this._super = e, this._superApply = n, t = s.apply(this, arguments), this._super = i,
                        this._superApply = a, t;
                };
            }(), void 0) : (h[t] = s, void 0);
        }), o.prototype = e.widget.extend(r, {
            widgetEventPrefix: a ? r.widgetEventPrefix || t : t
        }, h, {
            constructor: o,
            namespace: l,
            widgetName: t,
            widgetFullName: n
        }), a ? (e.each(a._childConstructors, function (t, i) {
            var s = i.prototype;
            e.widget(s.namespace + "." + s.widgetName, o, i._proto);
        }), delete a._childConstructors) : i._childConstructors.push(o), e.widget.bridge(t, o),
            o;
    }, e.widget.extend = function (t) {
        for (var i, s, a = n.call(arguments, 1), o = 0, r = a.length; r > o; o++) for (i in a[o]) s = a[o][i],
        a[o].hasOwnProperty(i) && void 0 !== s && (t[i] = e.isPlainObject(s) ? e.isPlainObject(t[i]) ? e.widget.extend({}, t[i], s) : e.widget.extend({}, s) : s);
        return t;
    }, e.widget.bridge = function (t, i) {
        var s = i.prototype.widgetFullName || t;
        e.fn[t] = function (a) {
            var o = "string" == typeof a, r = n.call(arguments, 1), h = this;
            return o ? this.each(function () {
                var i, n = e.data(this, s);
                return "instance" === a ? (h = n, !1) : n ? e.isFunction(n[a]) && "_" !== a.charAt(0) ? (i = n[a].apply(n, r),
                    i !== n && void 0 !== i ? (h = i && i.wjq ? h.pushStack(i.get()) : i, !1) : void 0) : e.error("no such method '" + a + "' for " + t + " widget instance") : e.error("cannot call methods on " + t + " prior to initialization; " + "attempted to call method '" + a + "'");
            }) : (r.length && (a = e.widget.extend.apply(null, [a].concat(r))), this.each(function () {
                var t = e.data(this, s);
                t ? (t.option(a || {}), t._init && t._init()) : e.data(this, s, new i(a, this));
            })), h;
        };
    }, e.Widget = function () {
    }, e.Widget._childConstructors = [], e.Widget.prototype = {
        widgetName: "widget",
        widgetEventPrefix: "",
        defaultElement: "<div>",
        options: {
            disabled: !1,
            create: null
        },
        _createWidget: function (t, i) {
            i = e(i || this.defaultElement || this)[0], this.element = e(i), this.uuid = s++,
                this.eventNamespace = "." + this.widgetName + this.uuid, this.bindings = e(), this.hoverable = e(),
                this.focusable = e(), i !== this && (e.data(i, this.widgetFullName, this), this._on(!0, this.element, {
                remove: function (e) {
                    e.target === i && this.destroy();
                }
            }), this.document = e(i.style ? i.ownerDocument : i.document || i), this.window = e(this.document[0].defaultView || this.document[0].parentWindow)),
                this.options = e.widget.extend({}, this.options, this._getCreateOptions(), t), this._create(),
                this._trigger("create", null, this._getCreateEventData()), this._init();
        },
        _getCreateOptions: e.noop,
        _getCreateEventData: e.noop,
        _create: e.noop,
        _init: e.noop,
        destroy: function () {
            this._destroy(), this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),
                this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName + "-disabled " + "ui-state-disabled"),
                this.bindings.unbind(this.eventNamespace), this.hoverable.removeClass("ui-state-hover"),
                this.focusable.removeClass("ui-state-focus");
        },
        _destroy: e.noop,
        widget: function () {
            return this.element;
        },
        option: function (t, i) {
            var s, n, a, o = t;
            if (0 === arguments.length) return e.widget.extend({}, this.options);
            if ("string" == typeof t) if (o = {}, s = t.split("."), t = s.shift(), s.length) {
                for (n = o[t] = e.widget.extend({}, this.options[t]), a = 0; s.length - 1 > a; a++) n[s[a]] = n[s[a]] || {},
                    n = n[s[a]];
                if (t = s.pop(), 1 === arguments.length) return void 0 === n[t] ? null : n[t];
                n[t] = i;
            } else {
                if (1 === arguments.length) return void 0 === this.options[t] ? null : this.options[t];
                o[t] = i;
            }
            return this._setOptions(o), this;
        },
        _setOptions: function (e) {
            var t;
            for (t in e) this._setOption(t, e[t]);
            return this;
        },
        _setOption: function (e, t) {
            return this.options[e] = t, "disabled" === e && (this.widget().toggleClass(this.widgetFullName + "-disabled", !!t),
            t && (this.hoverable.removeClass("ui-state-hover"), this.focusable.removeClass("ui-state-focus"))),
                this;
        },
        enable: function () {
            return this._setOptions({
                disabled: !1
            });
        },
        disable: function () {
            return this._setOptions({
                disabled: !0
            });
        },
        _on: function (t, i, s) {
            var n, a = this;
            "boolean" != typeof t && (s = i, i = t, t = !1), s ? (i = n = e(i), this.bindings = this.bindings.add(i)) : (s = i,
                i = this.element, n = this.widget()), e.each(s, function (s, o) {
                function r() {
                    return t || a.options.disabled !== !0 && !e(this).hasClass("ui-state-disabled") ? ("string" == typeof o ? a[o] : o).apply(a, arguments) : void 0;
                }

                "string" != typeof o && (r.guid = o.guid = o.guid || r.guid || e.guid++);
                var h = s.match(/^([\w:-]*)\s*(.*)$/), l = h[1] + a.eventNamespace, u = h[2];
                u ? n.delegate(u, l, r) : i.bind(l, r);
            });
        },
        _off: function (t, i) {
            i = (i || "").split(" ").join(this.eventNamespace + " ") + this.eventNamespace,
                t.unbind(i).undelegate(i), this.bindings = e(this.bindings.not(t).get()), this.focusable = e(this.focusable.not(t).get()),
                this.hoverable = e(this.hoverable.not(t).get());
        },
        _delay: function (e, t) {
            function i() {
                return ("string" == typeof e ? s[e] : e).apply(s, arguments);
            }

            var s = this;
            return setTimeout(i, t || 0);
        },
        _hoverable: function (t) {
            this.hoverable = this.hoverable.add(t), this._on(t, {
                mouseenter: function (t) {
                    e(t.currentTarget).addClass("ui-state-hover");
                },
                mouseleave: function (t) {
                    e(t.currentTarget).removeClass("ui-state-hover");
                }
            });
        },
        _focusable: function (t) {
            this.focusable = this.focusable.add(t), this._on(t, {
                focusin: function (t) {
                    e(t.currentTarget).addClass("ui-state-focus");
                },
                focusout: function (t) {
                    e(t.currentTarget).removeClass("ui-state-focus");
                }
            });
        },
        _trigger: function (t, i, s) {
            var n, a, o = this.options[t];
            if (s = s || {}, i = e.Event(i), i.type = (t === this.widgetEventPrefix ? t : this.widgetEventPrefix + t).toLowerCase(),
                    i.target = this.element[0], a = i.originalEvent) for (n in a) n in i || (i[n] = a[n]);
            return this.element.trigger(i, s), !(e.isFunction(o) && o.apply(this.element[0], [i].concat(s)) === !1 || i.isDefaultPrevented());
        }
    }, e.each({
        show: "fadeIn",
        hide: "fadeOut"
    }, function (t, i) {
        e.Widget.prototype["_" + t] = function (s, n, a) {
            "string" == typeof n && (n = {
                effect: n
            });
            var o, r = n ? n === !0 || "number" == typeof n ? i : n.effect || i : t;
            n = n || {}, "number" == typeof n && (n = {
                duration: n
            }), o = !e.isEmptyObject(n), n.complete = a, n.delay && s.delay(n.delay), o && e.effects && e.effects.effect[r] ? s[t](n) : r !== t && s[r] ? s[r](n.duration, n.easing, a) : s.queue(function (i) {
                e(this)[t](), a && a.call(s[0]), i();
            });
        };
    }), e.widget;
    var a = !1;
    e(document).mouseup(function () {
        a = !1;
    }), e.widget("ui.mouse", {
        version: "1.11.4",
        options: {
            cancel: "input,textarea,button,select,option",
            distance: 1,
            delay: 0
        },
        _mouseInit: function () {
            var t = this;
            this.element.bind("mousedown." + this.widgetName, function (e) {
                return t._mouseDown(e);
            }).bind("click." + this.widgetName, function (i) {
                return !0 === e.data(i.target, t.widgetName + ".preventClickEvent") ? (e.removeData(i.target, t.widgetName + ".preventClickEvent"),
                    i.stopImmediatePropagation(), !1) : void 0;
            }), this.started = !1;
        },
        _mouseDestroy: function () {
            this.element.unbind("." + this.widgetName), this._mouseMoveDelegate && this.document.unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate);
        },
        _mouseDown: function (t) {
            if (!a) {
                this._mouseMoved = !1, this._mouseStarted && this._mouseUp(t), this._mouseDownEvent = t;
                var i = this, s = 1 === t.which, n = "string" == typeof this.options.cancel && t.target.nodeName ? e(t.target).closest(this.options.cancel).length : !1;
                return s && !n && this._mouseCapture(t) ? (this.mouseDelayMet = !this.options.delay,
                this.mouseDelayMet || (this._mouseDelayTimer = setTimeout(function () {
                    i.mouseDelayMet = !0;
                }, this.options.delay)), this._mouseDistanceMet(t) && this._mouseDelayMet(t) && (this._mouseStarted = this._mouseStart(t) !== !1,
                    !this._mouseStarted) ? (t.preventDefault(), !0) : (!0 === e.data(t.target, this.widgetName + ".preventClickEvent") && e.removeData(t.target, this.widgetName + ".preventClickEvent"),
                    this._mouseMoveDelegate = function (e) {
                        return i._mouseMove(e);
                    }, this._mouseUpDelegate = function (e) {
                    return i._mouseUp(e);
                }, this.document.bind("mousemove." + this.widgetName, this._mouseMoveDelegate).bind("mouseup." + this.widgetName, this._mouseUpDelegate),
                    t.preventDefault(), a = !0, !0)) : !0;
            }
        },
        _mouseMove: function (t) {
            if (this._mouseMoved) {
                if (e.ui.ie && (!document.documentMode || 9 > document.documentMode) && !t.button) return this._mouseUp(t);
                if (!t.which) return this._mouseUp(t);
            }
            return (t.which || t.button) && (this._mouseMoved = !0), this._mouseStarted ? (this._mouseDrag(t),
                t.preventDefault()) : (this._mouseDistanceMet(t) && this._mouseDelayMet(t) && (this._mouseStarted = this._mouseStart(this._mouseDownEvent, t) !== !1,
                this._mouseStarted ? this._mouseDrag(t) : this._mouseUp(t)), !this._mouseStarted);
        },
        _mouseUp: function (t) {
            return this.document.unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate),
            this._mouseStarted && (this._mouseStarted = !1, t.target === this._mouseDownEvent.target && e.data(t.target, this.widgetName + ".preventClickEvent", !0),
                this._mouseStop(t)), a = !1, !1;
        },
        _mouseDistanceMet: function (e) {
            return Math.max(Math.abs(this._mouseDownEvent.pageX - e.pageX), Math.abs(this._mouseDownEvent.pageY - e.pageY)) >= this.options.distance;
        },
        _mouseDelayMet: function () {
            return this.mouseDelayMet;
        },
        _mouseStart: function () {
        },
        _mouseDrag: function () {
        },
        _mouseStop: function () {
        },
        _mouseCapture: function () {
            return !0;
        }
    }), e.widget("ui.draggable", e.ui.mouse, {
        version: "1.11.4",
        widgetEventPrefix: "drag",
        options: {
            addClasses: !0,
            appendTo: "parent",
            axis: !1,
            connectToSortable: !1,
            containment: !1,
            cursor: "auto",
            cursorAt: !1,
            grid: !1,
            handle: !1,
            helper: "original",
            iframeFix: !1,
            opacity: !1,
            refreshPositions: !1,
            revert: !1,
            revertDuration: 500,
            scope: "default",
            scroll: !0,
            scrollSensitivity: 20,
            scrollSpeed: 20,
            snap: !1,
            snapMode: "both",
            snapTolerance: 20,
            stack: !1,
            zIndex: !1,
            drag: null,
            start: null,
            stop: null
        },
        _create: function () {
            "original" === this.options.helper && this._setPositionRelative(), this.options.addClasses && this.element.addClass("ui-draggable"),
            this.options.disabled && this.element.addClass("ui-draggable-disabled"), this._setHandleClassName(),
                this._mouseInit();
        },
        _setOption: function (e, t) {
            this._super(e, t), "handle" === e && (this._removeHandleClassName(), this._setHandleClassName());
        },
        _destroy: function () {
            return (this.helper || this.element).is(".ui-draggable-dragging") ? (this.destroyOnClear = !0,
                void 0) : (this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),
                this._removeHandleClassName(), this._mouseDestroy(), void 0);
        },
        _mouseCapture: function (t) {
            var i = this.options;
            return this._blurActiveElement(t), this.helper || i.disabled || e(t.target).closest(".ui-resizable-handle").length > 0 ? !1 : (this.handle = this._getHandle(t),
                this.handle ? (this._blockFrames(i.iframeFix === !0 ? "iframe" : i.iframeFix), !0) : !1);
        },
        _blockFrames: function (t) {
            this.iframeBlocks = this.document.find(t).map(function () {
                var t = e(this);
                return e("<div>").css("position", "absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0];
            });
        },
        _unblockFrames: function () {
            this.iframeBlocks && (this.iframeBlocks.remove(), delete this.iframeBlocks);
        },
        _blurActiveElement: function (t) {
            var i = this.document[0];
            if (this.handleElement.is(t.target)) try {
                i.activeElement && "body" !== i.activeElement.nodeName.toLowerCase() && e(i.activeElement).blur();
            } catch (s) {
            }
        },
        _mouseStart: function (t) {
            var i = this.options;
            return this.helper = this._createHelper(t), this.helper.addClass("ui-draggable-dragging"),
                this._cacheHelperProportions(), e.ui.ddmanager && (e.ui.ddmanager.current = this),
                this._cacheMargins(), this.cssPosition = this.helper.css("position"), this.scrollParent = this.helper.scrollParent(!0),
                this.offsetParent = this.helper.offsetParent(), this.hasFixedAncestor = this.helper.parents().filter(function () {
                    return "fixed" === e(this).css("position");
                }).length > 0, this.positionAbs = this.element.offset(), this._refreshOffsets(t),
                this.originalPosition = this.position = this._generatePosition(t, !1), this.originalPageX = t.pageX,
                this.originalPageY = t.pageY, i.cursorAt && this._adjustOffsetFromHelper(i.cursorAt),
                this._setContainment(), this._trigger("start", t) === !1 ? (this._clear(), !1) : (this._cacheHelperProportions(),
            e.ui.ddmanager && !i.dropBehaviour && e.ui.ddmanager.prepareOffsets(this, t), this._normalizeRightBottom(),
                this._mouseDrag(t, !0), e.ui.ddmanager && e.ui.ddmanager.dragStart(this, t), !0);
        },
        _refreshOffsets: function (e) {
            this.offset = {
                top: this.positionAbs.top - this.margins.top,
                left: this.positionAbs.left - this.margins.left,
                scroll: !1,
                parent: this._getParentOffset(),
                relative: this._getRelativeOffset()
            }, this.offset.click = {
                left: e.pageX - this.offset.left,
                top: e.pageY - this.offset.top
            };
        },
        _mouseDrag: function (t, i) {
            if (this.hasFixedAncestor && (this.offset.parent = this._getParentOffset()), this.position = this._generatePosition(t, !0),
                    this.positionAbs = this._convertPositionTo("absolute"), !i) {
                var s = this._uiHash();
                if (this._trigger("drag", t, s) === !1) return this._mouseUp({}), !1;
                this.position = s.position;
            }
            return this.helper[0].style.left = this.position.left + "px", this.helper[0].style.top = this.position.top + "px",
            e.ui.ddmanager && e.ui.ddmanager.drag(this, t), !1;
        },
        _mouseStop: function (t) {
            var i = this, s = !1;
            return e.ui.ddmanager && !this.options.dropBehaviour && (s = e.ui.ddmanager.drop(this, t)),
            this.dropped && (s = this.dropped, this.dropped = !1), "invalid" === this.options.revert && !s || "valid" === this.options.revert && s || this.options.revert === !0 || e.isFunction(this.options.revert) && this.options.revert.call(this.element, s) ? e(this.helper).animate(this.originalPosition, parseInt(this.options.revertDuration, 10), function () {
                i._trigger("stop", t) !== !1 && i._clear();
            }) : this._trigger("stop", t) !== !1 && this._clear(), !1;
        },
        _mouseUp: function (t) {
            return this._unblockFrames(), e.ui.ddmanager && e.ui.ddmanager.dragStop(this, t),
            this.handleElement.is(t.target) && this.element.focus(), e.ui.mouse.prototype._mouseUp.call(this, t);
        },
        cancel: function () {
            return this.helper.is(".ui-draggable-dragging") ? this._mouseUp({}) : this._clear(),
                this;
        },
        _getHandle: function (t) {
            return this.options.handle ? !!e(t.target).closest(this.element.find(this.options.handle)).length : !0;
        },
        _setHandleClassName: function () {
            this.handleElement = this.options.handle ? this.element.find(this.options.handle) : this.element,
                this.handleElement.addClass("ui-draggable-handle");
        },
        _removeHandleClassName: function () {
            this.handleElement.removeClass("ui-draggable-handle");
        },
        _createHelper: function (t) {
            var i = this.options, s = e.isFunction(i.helper), n = s ? e(i.helper.apply(this.element[0], [t])) : "clone" === i.helper ? this.element.clone().removeAttr("id") : this.element;
            return n.parents("body").length || n.appendTo("parent" === i.appendTo ? this.element[0].parentNode : i.appendTo),
            s && n[0] === this.element[0] && this._setPositionRelative(), n[0] === this.element[0] || /(fixed|absolute)/.test(n.css("position")) || n.css("position", "absolute"),
                n;
        },
        _setPositionRelative: function () {
            /^(?:r|a|f)/.test(this.element.css("position")) || (this.element[0].style.position = "relative");
        },
        _adjustOffsetFromHelper: function (t) {
            "string" == typeof t && (t = t.split(" ")), e.isArray(t) && (t = {
                left: +t[0],
                top: +t[1] || 0
            }), "left" in t && (this.offset.click.left = t.left + this.margins.left), "right" in t && (this.offset.click.left = this.helperProportions.width - t.right + this.margins.left),
            "top" in t && (this.offset.click.top = t.top + this.margins.top), "bottom" in t && (this.offset.click.top = this.helperProportions.height - t.bottom + this.margins.top);
        },
        _isRootNode: function (e) {
            return /(html|body)/i.test(e.tagName) || e === this.document[0];
        },
        _getParentOffset: function () {
            var t = this.offsetParent.offset(), i = this.document[0];
            return "absolute" === this.cssPosition && this.scrollParent[0] !== i && e.contains(this.scrollParent[0], this.offsetParent[0]) && (t.left += this.scrollParent.scrollLeft(),
                t.top += this.scrollParent.scrollTop()), this._isRootNode(this.offsetParent[0]) && (t = {
                top: 0,
                left: 0
            }), {
                top: t.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
                left: t.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
            };
        },
        _getRelativeOffset: function () {
            if ("relative" !== this.cssPosition) return {
                top: 0,
                left: 0
            };
            var e = this.element.position(), t = this._isRootNode(this.scrollParent[0]);
            return {
                top: e.top - (parseInt(this.helper.css("top"), 10) || 0) + (t ? 0 : this.scrollParent.scrollTop()),
                left: e.left - (parseInt(this.helper.css("left"), 10) || 0) + (t ? 0 : this.scrollParent.scrollLeft())
            };
        },
        _cacheMargins: function () {
            this.margins = {
                left: parseInt(this.element.css("marginLeft"), 10) || 0,
                top: parseInt(this.element.css("marginTop"), 10) || 0,
                right: parseInt(this.element.css("marginRight"), 10) || 0,
                bottom: parseInt(this.element.css("marginBottom"), 10) || 0
            };
        },
        _cacheHelperProportions: function () {
            this.helperProportions = {
                width: this.helper.outerWidth(),
                height: this.helper.outerHeight()
            };
        },
        _setContainment: function () {
            var t, i, s, n = this.options, a = this.document[0];
            return this.relativeContainer = null, n.containment ? "window" === n.containment ? (this.containment = [e(window).scrollLeft() - this.offset.relative.left - this.offset.parent.left, e(window).scrollTop() - this.offset.relative.top - this.offset.parent.top, e(window).scrollLeft() + e(window).width() - this.helperProportions.width - this.margins.left, e(window).scrollTop() + (e(window).height() || a.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top],
                void 0) : "document" === n.containment ? (this.containment = [0, 0, e(a).width() - this.helperProportions.width - this.margins.left, (e(a).height() || a.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top],
                void 0) : n.containment.constructor === Array ? (this.containment = n.containment,
                void 0) : ("parent" === n.containment && (n.containment = this.helper[0].parentNode),
                i = e(n.containment), s = i[0], s && (t = /(scroll|auto)/.test(i.css("overflow")),
                this.containment = [(parseInt(i.css("borderLeftWidth"), 10) || 0) + (parseInt(i.css("paddingLeft"), 10) || 0), (parseInt(i.css("borderTopWidth"), 10) || 0) + (parseInt(i.css("paddingTop"), 10) || 0), (t ? Math.max(s.scrollWidth, s.offsetWidth) : s.offsetWidth) - (parseInt(i.css("borderRightWidth"), 10) || 0) - (parseInt(i.css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left - this.margins.right, (t ? Math.max(s.scrollHeight, s.offsetHeight) : s.offsetHeight) - (parseInt(i.css("borderBottomWidth"), 10) || 0) - (parseInt(i.css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top - this.margins.bottom],
                this.relativeContainer = i), void 0) : (this.containment = null, void 0);
        },
        _convertPositionTo: function (e, t) {
            t || (t = this.position);
            var i = "absolute" === e ? 1 : -1, s = this._isRootNode(this.scrollParent[0]);
            return {
                top: t.top + this.offset.relative.top * i + this.offset.parent.top * i - ("fixed" === this.cssPosition ? -this.offset.scroll.top : s ? 0 : this.offset.scroll.top) * i,
                left: t.left + this.offset.relative.left * i + this.offset.parent.left * i - ("fixed" === this.cssPosition ? -this.offset.scroll.left : s ? 0 : this.offset.scroll.left) * i
            };
        },
        _generatePosition: function (e, t) {
            var i, s, n, a, o = this.options, r = this._isRootNode(this.scrollParent[0]), h = e.pageX, l = e.pageY;
            return r && this.offset.scroll || (this.offset.scroll = {
                top: this.scrollParent.scrollTop(),
                left: this.scrollParent.scrollLeft()
            }), t && (this.containment && (this.relativeContainer ? (s = this.relativeContainer.offset(),
                i = [this.containment[0] + s.left, this.containment[1] + s.top, this.containment[2] + s.left, this.containment[3] + s.top]) : i = this.containment,
            e.pageX - this.offset.click.left < i[0] && (h = i[0] + this.offset.click.left),
            e.pageY - this.offset.click.top < i[1] && (l = i[1] + this.offset.click.top), e.pageX - this.offset.click.left > i[2] && (h = i[2] + this.offset.click.left),
            e.pageY - this.offset.click.top > i[3] && (l = i[3] + this.offset.click.top)), o.grid && (n = o.grid[1] ? this.originalPageY + Math.round((l - this.originalPageY) / o.grid[1]) * o.grid[1] : this.originalPageY,
                l = i ? n - this.offset.click.top >= i[1] || n - this.offset.click.top > i[3] ? n : n - this.offset.click.top >= i[1] ? n - o.grid[1] : n + o.grid[1] : n,
                a = o.grid[0] ? this.originalPageX + Math.round((h - this.originalPageX) / o.grid[0]) * o.grid[0] : this.originalPageX,
                h = i ? a - this.offset.click.left >= i[0] || a - this.offset.click.left > i[2] ? a : a - this.offset.click.left >= i[0] ? a - o.grid[0] : a + o.grid[0] : a),
            "y" === o.axis && (h = this.originalPageX), "x" === o.axis && (l = this.originalPageY)),
            {
                top: l - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + ("fixed" === this.cssPosition ? -this.offset.scroll.top : r ? 0 : this.offset.scroll.top),
                left: h - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + ("fixed" === this.cssPosition ? -this.offset.scroll.left : r ? 0 : this.offset.scroll.left)
            };
        },
        _clear: function () {
            this.helper.removeClass("ui-draggable-dragging"), this.helper[0] === this.element[0] || this.cancelHelperRemoval || this.helper.remove(),
                this.helper = null, this.cancelHelperRemoval = !1, this.destroyOnClear && this.destroy();
        },
        _normalizeRightBottom: function () {
            "y" !== this.options.axis && "auto" !== this.helper.css("right") && (this.helper.width(this.helper.width()),
                this.helper.css("right", "auto")), "x" !== this.options.axis && "auto" !== this.helper.css("bottom") && (this.helper.height(this.helper.height()),
                this.helper.css("bottom", "auto"));
        },
        _trigger: function (t, i, s) {
            return s = s || this._uiHash(), e.ui.plugin.call(this, t, [i, s, this], !0), /^(drag|start|stop)/.test(t) && (this.positionAbs = this._convertPositionTo("absolute"),
                s.offset = this.positionAbs), e.Widget.prototype._trigger.call(this, t, i, s);
        },
        plugins: {},
        _uiHash: function () {
            return {
                helper: this.helper,
                position: this.position,
                originalPosition: this.originalPosition,
                offset: this.positionAbs
            };
        }
    }), e.ui.plugin.add("draggable", "connectToSortable", {
        start: function (t, i, s) {
            var n = e.extend({}, i, {
                item: s.element
            });
            s.sortables = [], e(s.options.connectToSortable).each(function () {
                var i = e(this).sortable("instance");
                i && !i.options.disabled && (s.sortables.push(i), i.refreshPositions(), i._trigger("activate", t, n));
            });
        },
        stop: function (t, i, s) {
            var n = e.extend({}, i, {
                item: s.element
            });
            s.cancelHelperRemoval = !1, e.each(s.sortables, function () {
                var e = this;
                e.isOver ? (e.isOver = 0, s.cancelHelperRemoval = !0, e.cancelHelperRemoval = !1,
                    e._storedCSS = {
                        position: e.placeholder.css("position"),
                        top: e.placeholder.css("top"),
                        left: e.placeholder.css("left")
                    }, e._mouseStop(t), e.options.helper = e.options._helper) : (e.cancelHelperRemoval = !0,
                    e._trigger("deactivate", t, n));
            });
        },
        drag: function (t, i, s) {
            e.each(s.sortables, function () {
                var n = !1, a = this;
                a.positionAbs = s.positionAbs, a.helperProportions = s.helperProportions, a.offset.click = s.offset.click,
                a._intersectsWith(a.containerCache) && (n = !0, e.each(s.sortables, function () {
                    return this.positionAbs = s.positionAbs, this.helperProportions = s.helperProportions,
                        this.offset.click = s.offset.click, this !== a && this._intersectsWith(this.containerCache) && e.contains(a.element[0], this.element[0]) && (n = !1),
                        n;
                })), n ? (a.isOver || (a.isOver = 1, s._parent = i.helper.parent(), a.currentItem = i.helper.appendTo(a.element).data("ui-sortable-item", !0),
                    a.options._helper = a.options.helper, a.options.helper = function () {
                    return i.helper[0];
                }, t.target = a.currentItem[0], a._mouseCapture(t, !0), a._mouseStart(t, !0, !0),
                    a.offset.click.top = s.offset.click.top, a.offset.click.left = s.offset.click.left,
                    a.offset.parent.left -= s.offset.parent.left - a.offset.parent.left, a.offset.parent.top -= s.offset.parent.top - a.offset.parent.top,
                    s._trigger("toSortable", t), s.dropped = a.element, e.each(s.sortables, function () {
                    this.refreshPositions();
                }), s.currentItem = s.element, a.fromOutside = s), a.currentItem && (a._mouseDrag(t),
                    i.position = a.position)) : a.isOver && (a.isOver = 0, a.cancelHelperRemoval = !0,
                    a.options._revert = a.options.revert, a.options.revert = !1, a._trigger("out", t, a._uiHash(a)),
                    a._mouseStop(t, !0), a.options.revert = a.options._revert, a.options.helper = a.options._helper,
                a.placeholder && a.placeholder.remove(), i.helper.appendTo(s._parent), s._refreshOffsets(t),
                    i.position = s._generatePosition(t, !0), s._trigger("fromSortable", t), s.dropped = !1,
                    e.each(s.sortables, function () {
                        this.refreshPositions();
                    }));
            });
        }
    }), e.ui.plugin.add("draggable", "cursor", {
        start: function (t, i, s) {
            var n = e("body"), a = s.options;
            n.css("cursor") && (a._cursor = n.css("cursor")), n.css("cursor", a.cursor);
        },
        stop: function (t, i, s) {
            var n = s.options;
            n._cursor && e("body").css("cursor", n._cursor);
        }
    }), e.ui.plugin.add("draggable", "opacity", {
        start: function (t, i, s) {
            var n = e(i.helper), a = s.options;
            n.css("opacity") && (a._opacity = n.css("opacity")), n.css("opacity", a.opacity);
        },
        stop: function (t, i, s) {
            var n = s.options;
            n._opacity && e(i.helper).css("opacity", n._opacity);
        }
    }), e.ui.plugin.add("draggable", "scroll", {
        start: function (e, t, i) {
            i.scrollParentNotHidden || (i.scrollParentNotHidden = i.helper.scrollParent(!1)),
            i.scrollParentNotHidden[0] !== i.document[0] && "HTML" !== i.scrollParentNotHidden[0].tagName && (i.overflowOffset = i.scrollParentNotHidden.offset());
        },
        drag: function (t, i, s) {
            var n = s.options, a = !1, o = s.scrollParentNotHidden[0], r = s.document[0];
            o !== r && "HTML" !== o.tagName ? (n.axis && "x" === n.axis || (s.overflowOffset.top + o.offsetHeight - t.pageY < n.scrollSensitivity ? o.scrollTop = a = o.scrollTop + n.scrollSpeed : t.pageY - s.overflowOffset.top < n.scrollSensitivity && (o.scrollTop = a = o.scrollTop - n.scrollSpeed)),
            n.axis && "y" === n.axis || (s.overflowOffset.left + o.offsetWidth - t.pageX < n.scrollSensitivity ? o.scrollLeft = a = o.scrollLeft + n.scrollSpeed : t.pageX - s.overflowOffset.left < n.scrollSensitivity && (o.scrollLeft = a = o.scrollLeft - n.scrollSpeed))) : (n.axis && "x" === n.axis || (t.pageY - e(r).scrollTop() < n.scrollSensitivity ? a = e(r).scrollTop(e(r).scrollTop() - n.scrollSpeed) : e(window).height() - (t.pageY - e(r).scrollTop()) < n.scrollSensitivity && (a = e(r).scrollTop(e(r).scrollTop() + n.scrollSpeed))),
            n.axis && "y" === n.axis || (t.pageX - e(r).scrollLeft() < n.scrollSensitivity ? a = e(r).scrollLeft(e(r).scrollLeft() - n.scrollSpeed) : e(window).width() - (t.pageX - e(r).scrollLeft()) < n.scrollSensitivity && (a = e(r).scrollLeft(e(r).scrollLeft() + n.scrollSpeed)))),
            a !== !1 && e.ui.ddmanager && !n.dropBehaviour && e.ui.ddmanager.prepareOffsets(s, t);
        }
    }), e.ui.plugin.add("draggable", "snap", {
        start: function (t, i, s) {
            var n = s.options;
            s.snapElements = [], e(n.snap.constructor !== String ? n.snap.items || ":data(ui-draggable)" : n.snap).each(function () {
                var t = e(this), i = t.offset();
                this !== s.element[0] && s.snapElements.push({
                    item: this,
                    width: t.outerWidth(),
                    height: t.outerHeight(),
                    top: i.top,
                    left: i.left
                });
            });
        },
        drag: function (t, i, s) {
            var n, a, o, r, h, l, u, c, d, p, f = s.options, m = f.snapTolerance, g = i.offset.left, v = g + s.helperProportions.width, b = i.offset.top, y = b + s.helperProportions.height;
            for (d = s.snapElements.length - 1; d >= 0; d--) h = s.snapElements[d].left - s.margins.left,
                l = h + s.snapElements[d].width, u = s.snapElements[d].top - s.margins.top, c = u + s.snapElements[d].height,
                h - m > v || g > l + m || u - m > y || b > c + m || !e.contains(s.snapElements[d].item.ownerDocument, s.snapElements[d].item) ? (s.snapElements[d].snapping && s.options.snap.release && s.options.snap.release.call(s.element, t, e.extend(s._uiHash(), {
                    snapItem: s.snapElements[d].item
                })), s.snapElements[d].snapping = !1) : ("inner" !== f.snapMode && (n = m >= Math.abs(u - y),
                    a = m >= Math.abs(c - b), o = m >= Math.abs(h - v), r = m >= Math.abs(l - g), n && (i.position.top = s._convertPositionTo("relative", {
                    top: u - s.helperProportions.height,
                    left: 0
                }).top), a && (i.position.top = s._convertPositionTo("relative", {
                    top: c,
                    left: 0
                }).top), o && (i.position.left = s._convertPositionTo("relative", {
                    top: 0,
                    left: h - s.helperProportions.width
                }).left), r && (i.position.left = s._convertPositionTo("relative", {
                    top: 0,
                    left: l
                }).left)), p = n || a || o || r, "outer" !== f.snapMode && (n = m >= Math.abs(u - b),
                    a = m >= Math.abs(c - y), o = m >= Math.abs(h - g), r = m >= Math.abs(l - v), n && (i.position.top = s._convertPositionTo("relative", {
                    top: u,
                    left: 0
                }).top), a && (i.position.top = s._convertPositionTo("relative", {
                    top: c - s.helperProportions.height,
                    left: 0
                }).top), o && (i.position.left = s._convertPositionTo("relative", {
                    top: 0,
                    left: h
                }).left), r && (i.position.left = s._convertPositionTo("relative", {
                    top: 0,
                    left: l - s.helperProportions.width
                }).left)), !s.snapElements[d].snapping && (n || a || o || r || p) && s.options.snap.snap && s.options.snap.snap.call(s.element, t, e.extend(s._uiHash(), {
                    snapItem: s.snapElements[d].item
                })), s.snapElements[d].snapping = n || a || o || r || p);
        }
    }), e.ui.plugin.add("draggable", "stack", {
        start: function (t, i, s) {
            var n, a = s.options, o = e.makeArray(e(a.stack)).sort(function (t, i) {
                return (parseInt(e(t).css("zIndex"), 10) || 0) - (parseInt(e(i).css("zIndex"), 10) || 0);
            });
            o.length && (n = parseInt(e(o[0]).css("zIndex"), 10) || 0, e(o).each(function (t) {
                e(this).css("zIndex", n + t);
            }), this.css("zIndex", n + o.length));
        }
    }), e.ui.plugin.add("draggable", "zIndex", {
        start: function (t, i, s) {
            var n = e(i.helper), a = s.options;
            n.css("zIndex") && (a._zIndex = n.css("zIndex")), n.css("zIndex", a.zIndex);
        },
        stop: function (t, i, s) {
            var n = s.options;
            n._zIndex && e(i.helper).css("zIndex", n._zIndex);
        }
    }), e.ui.draggable;
});
    /*
 * Fingerprintjs2 1.4.0 - Modern & flexible browser fingerprint library v2
 * https://github.com/Valve/fingerprintjs2
 * Copyright (c) 2015 Valentin Vasilyev (valentin.vasilyev@outlook.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL VALENTIN VASILYEV BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

(function (name, context, definition) {
    "use strict";
    if (typeof module !== "undefined" && module.exports) {
        module.exports = definition();
    }
    else if (typeof define === "function" && define.amd) {
        define(definition);
    }
    else {
        context[name] = definition();
    }
})("Fingerprint2", this, function () {
    "use strict";
    // This will only be polyfilled for IE8 and older
    // Taken from Mozilla MDC
    if (!Array.prototype.indexOf) {
        Array.prototype.indexOf = function (searchElement, fromIndex) {
            var k;
            if (this == null) {
                throw new TypeError("'this' is null or undefined");
            }
            var O = Object(this);
            var len = O.length >>> 0;
            if (len === 0) {
                return -1;
            }
            var n = +fromIndex || 0;
            if (Math.abs(n) === Infinity) {
                n = 0;
            }
            if (n >= len) {
                return -1;
            }
            k = Math.max(n >= 0 ? n : len - Math.abs(n), 0);
            while (k < len) {
                if (k in O && O[k] === searchElement) {
                    return k;
                }
                k++;
            }
            return -1;
        };
    }
    var Fingerprint2 = function (options) {
        var defaultOptions = {
            swfContainerId: "fingerprintjs2",
            swfPath: "flash/compiled/FontList.swf",
            detectScreenOrientation: true,
            sortPluginsFor: [/palemoon/i]
        };
        this.options = this.extend(options, defaultOptions);
        this.nativeForEach = Array.prototype.forEach;
        this.nativeMap = Array.prototype.map;
    };
    Fingerprint2.prototype = {
        extend: function (source, target) {
            if (source == null) {
                return target;
            }
            for (var k in source) {
                if (source[k] != null && target[k] !== source[k]) {
                    target[k] = source[k];
                }
            }
            return target;
        },
        log: function (msg) {
            if (window.console) {

            }
        },
        get: function (done) {
            var keys = [];
            keys = this.userAgentKey(keys);
            keys = this.languageKey(keys);
            keys = this.colorDepthKey(keys);
            keys = this.pixelRatioKey(keys);
            keys = this.screenResolutionKey(keys);
            keys = this.availableScreenResolutionKey(keys);
            keys = this.timezoneOffsetKey(keys);
            keys = this.sessionStorageKey(keys);
            keys = this.localStorageKey(keys);
            keys = this.indexedDbKey(keys);
            keys = this.addBehaviorKey(keys);
            keys = this.openDatabaseKey(keys);
            keys = this.cpuClassKey(keys);
            keys = this.platformKey(keys);
            keys = this.doNotTrackKey(keys);
            keys = this.pluginsKey(keys);
            keys = this.canvasKey(keys);
            keys = this.webglKey(keys);
            keys = this.adBlockKey(keys);
            keys = this.hasLiedLanguagesKey(keys);
            keys = this.hasLiedResolutionKey(keys);
            keys = this.hasLiedOsKey(keys);
            keys = this.hasLiedBrowserKey(keys);
            keys = this.touchSupportKey(keys);
            var that = this;
            this.fontsKey(keys, function (newKeys) {
                var values = [];
                that.each(newKeys, function (pair) {
                    var value = pair.value;
                    if (typeof pair.value.join !== "undefined") {
                        value = pair.value.join(";");
                    }
                    values.push(value);
                });
                var murmur = that.x64hash128(values.join("~~~"), 31);
                return done(murmur, newKeys);
            });
        },
        userAgentKey: function (keys) {
            if (!this.options.excludeUserAgent) {
                keys.push({key: "user_agent", value: this.getUserAgent()});
            }
            return keys;
        },
        // for tests
        getUserAgent: function () {
            return navigator.userAgent;
        },
        languageKey: function (keys) {
            if (!this.options.excludeLanguage) {
                // IE 9,10 on Windows 10 does not have the `navigator.language` property any longer
                keys.push({key: "language", value: navigator.language || navigator.userLanguage || navigator.browserLanguage || navigator.systemLanguage || ""});
            }
            return keys;
        },
        colorDepthKey: function (keys) {
            if (!this.options.excludeColorDepth) {
                keys.push({key: "color_depth", value: screen.colorDepth});
            }
            return keys;
        },
        pixelRatioKey: function (keys) {
            if (!this.options.excludePixelRatio) {
                keys.push({key: "pixel_ratio", value: this.getPixelRatio()});
            }
            return keys;
        },
        getPixelRatio: function () {
            return window.devicePixelRatio || "";
        },
        screenResolutionKey: function (keys) {
            if (!this.options.excludeScreenResolution) {
                return this.getScreenResolution(keys);
            }
            return keys;
        },
        getScreenResolution: function (keys) {
            var resolution;
            if (this.options.detectScreenOrientation) {
                resolution = (screen.height > screen.width) ? [screen.height, screen.width] : [screen.width, screen.height];
            } else {
                resolution = [screen.width, screen.height];
            }
            if (typeof resolution !== "undefined") { // headless browsers
                keys.push({key: "resolution", value: resolution});
            }
            return keys;
        },
        availableScreenResolutionKey: function (keys) {
            if (!this.options.excludeAvailableScreenResolution) {
                return this.getAvailableScreenResolution(keys);
            }
            return keys;
        },
        getAvailableScreenResolution: function (keys) {
            var available;
            if (screen.availWidth && screen.availHeight) {
                if (this.options.detectScreenOrientation) {
                    available = (screen.availHeight > screen.availWidth) ? [screen.availHeight, screen.availWidth] : [screen.availWidth, screen.availHeight];
                } else {
                    available = [screen.availHeight, screen.availWidth];
                }
            }
            if (typeof available !== "undefined") { // headless browsers
                keys.push({key: "available_resolution", value: available});
            }
            return keys;
        },
        timezoneOffsetKey: function (keys) {
            if (!this.options.excludeTimezoneOffset) {
                keys.push({key: "timezone_offset", value: new Date().getTimezoneOffset()});
            }
            return keys;
        },
        sessionStorageKey: function (keys) {
            if (!this.options.excludeSessionStorage && this.hasSessionStorage()) {
                keys.push({key: "session_storage", value: 1});
            }
            return keys;
        },
        localStorageKey: function (keys) {
            if (!this.options.excludeSessionStorage && this.hasLocalStorage()) {
                keys.push({key: "local_storage", value: 1});
            }
            return keys;
        },
        indexedDbKey: function (keys) {
            if (!this.options.excludeIndexedDB && this.hasIndexedDB()) {
                keys.push({key: "indexed_db", value: 1});
            }
            return keys;
        },
        addBehaviorKey: function (keys) {
            //body might not be defined at this point or removed programmatically
            if (document.body && !this.options.excludeAddBehavior && document.body.addBehavior) {
                keys.push({key: "add_behavior", value: 1});
            }
            return keys;
        },
        openDatabaseKey: function (keys) {
            if (!this.options.excludeOpenDatabase && window.openDatabase) {
                keys.push({key: "open_database", value: 1});
            }
            return keys;
        },
        cpuClassKey: function (keys) {
            if (!this.options.excludeCpuClass) {
                keys.push({key: "cpu_class", value: this.getNavigatorCpuClass()});
            }
            return keys;
        },
        platformKey: function (keys) {
            if (!this.options.excludePlatform) {
                keys.push({key: "navigator_platform", value: this.getNavigatorPlatform()});
            }
            return keys;
        },
        doNotTrackKey: function (keys) {
            if (!this.options.excludeDoNotTrack) {
                keys.push({key: "do_not_track", value: this.getDoNotTrack()});
            }
            return keys;
        },
        canvasKey: function (keys) {
            if (!this.options.excludeCanvas && this.isCanvasSupported()) {
                keys.push({key: "canvas", value: this.getCanvasFp()});
            }
            return keys;
        },
        webglKey: function (keys) {
            if (this.options.excludeWebGL) {
                if (typeof NODEBUG === "undefined") {
                    this.log("Skipping WebGL fingerprinting per excludeWebGL configuration option");
                }
                return keys;
            }
            if (!this.isWebGlSupported()) {
                if (typeof NODEBUG === "undefined") {
                    this.log("Skipping WebGL fingerprinting because it is not supported in this browser");
                }
                return keys;
            }
            keys.push({key: "webgl", value: this.getWebglFp()});
            return keys;
        },
        adBlockKey: function (keys) {
            if (!this.options.excludeAdBlock) {
                keys.push({key: "adblock", value: this.getAdBlock()});
            }
            return keys;
        },
        hasLiedLanguagesKey: function (keys) {
            if (!this.options.excludeHasLiedLanguages) {
                keys.push({key: "has_lied_languages", value: this.getHasLiedLanguages()});
            }
            return keys;
        },
        hasLiedResolutionKey: function (keys) {
            if (!this.options.excludeHasLiedResolution) {
                keys.push({key: "has_lied_resolution", value: this.getHasLiedResolution()});
            }
            return keys;
        },
        hasLiedOsKey: function (keys) {
            if (!this.options.excludeHasLiedOs) {
                keys.push({key: "has_lied_os", value: this.getHasLiedOs()});
            }
            return keys;
        },
        hasLiedBrowserKey: function (keys) {
            if (!this.options.excludeHasLiedBrowser) {
                keys.push({key: "has_lied_browser", value: this.getHasLiedBrowser()});
            }
            return keys;
        },
        fontsKey: function (keys, done) {
            if (this.options.excludeJsFonts) {
                return this.flashFontsKey(keys, done);
            }
            return this.jsFontsKey(keys, done);
        },
        // flash fonts (will increase fingerprinting time 20X to ~ 130-150ms)
        flashFontsKey: function (keys, done) {
            if (this.options.excludeFlashFonts) {
                if (typeof NODEBUG === "undefined") {
                    this.log("Skipping flash fonts detection per excludeFlashFonts configuration option");
                }
                return done(keys);
            }
            // we do flash if swfobject is loaded
            if (!this.hasSwfObjectLoaded()) {
                if (typeof NODEBUG === "undefined") {
                    this.log("Swfobject is not detected, Flash fonts enumeration is skipped");
                }
                return done(keys);
            }
            if (!this.hasMinFlashInstalled()) {
                if (typeof NODEBUG === "undefined") {
                    this.log("Flash is not installed, skipping Flash fonts enumeration");
                }
                return done(keys);
            }
            if (typeof this.options.swfPath === "undefined") {
                if (typeof NODEBUG === "undefined") {
                    this.log("To use Flash fonts detection, you must pass a valid swfPath option, skipping Flash fonts enumeration");
                }
                return done(keys);
            }
            this.loadSwfAndDetectFonts(function (fonts) {
                keys.push({key: "swf_fonts", value: fonts.join(";")});
                done(keys);
            });
        },
        // kudos to http://www.lalit.org/lab/javascript-css-font-detect/
        jsFontsKey: function (keys, done) {
            var that = this;
            // doing js fonts detection in a pseudo-async fashion
            return setTimeout(function () {

                // a font will be compared against all the three default fonts.
                // and if it doesn't match all 3 then that font is not available.
                var baseFonts = ["monospace", "sans-serif", "serif"];

                var fontList = [
                    "Andale Mono", "Arial", "Arial Black", "Arial Hebrew", "Arial MT", "Arial Narrow", "Arial Rounded MT Bold", "Arial Unicode MS",
                    "Bitstream Vera Sans Mono", "Book Antiqua", "Bookman Old Style",
                    "Calibri", "Cambria", "Cambria Math", "Century", "Century Gothic", "Century Schoolbook", "Comic Sans", "Comic Sans MS", "Consolas", "Courier", "Courier New",
                    "Garamond", "Geneva", "Georgia",
                    "Helvetica", "Helvetica Neue",
                    "Impact",
                    "Lucida Bright", "Lucida Calligraphy", "Lucida Console", "Lucida Fax", "LUCIDA GRANDE", "Lucida Handwriting", "Lucida Sans", "Lucida Sans Typewriter", "Lucida Sans Unicode",
                    "Microsoft Sans Serif", "Monaco", "Monotype Corsiva", "MS Gothic", "MS Outlook", "MS PGothic", "MS Reference Sans Serif", "MS Sans Serif", "MS Serif", "MYRIAD", "MYRIAD PRO",
                    "Palatino", "Palatino Linotype",
                    "Segoe Print", "Segoe Script", "Segoe UI", "Segoe UI Light", "Segoe UI Semibold", "Segoe UI Symbol",
                    "Tahoma", "Times", "Times New Roman", "Times New Roman PS", "Trebuchet MS",
                    "Verdana", "Wingdings", "Wingdings 2", "Wingdings 3"
                ];
                var extendedFontList = [
                    "Abadi MT Condensed Light", "Academy Engraved LET", "ADOBE CASLON PRO", "Adobe Garamond", "ADOBE GARAMOND PRO", "Agency FB", "Aharoni", "Albertus Extra Bold", "Albertus Medium", "Algerian", "Amazone BT", "American Typewriter",
                    "American Typewriter Condensed", "AmerType Md BT", "Andalus", "Angsana New", "AngsanaUPC", "Antique Olive", "Aparajita", "Apple Chancery", "Apple Color Emoji", "Apple SD Gothic Neo", "Arabic Typesetting", "ARCHER",
                    "ARNO PRO", "Arrus BT", "Aurora Cn BT", "AvantGarde Bk BT", "AvantGarde Md BT", "AVENIR", "Ayuthaya", "Bandy", "Bangla Sangam MN", "Bank Gothic", "BankGothic Md BT", "Baskerville",
                    "Baskerville Old Face", "Batang", "BatangChe", "Bauer Bodoni", "Bauhaus 93", "Bazooka", "Bell MT", "Bembo", "Benguiat Bk BT", "Berlin Sans FB", "Berlin Sans FB Demi", "Bernard MT Condensed", "BernhardFashion BT", "BernhardMod BT", "Big Caslon", "BinnerD",
                    "Blackadder ITC", "BlairMdITC TT", "Bodoni 72", "Bodoni 72 Oldstyle", "Bodoni 72 Smallcaps", "Bodoni MT", "Bodoni MT Black", "Bodoni MT Condensed", "Bodoni MT Poster Compressed",
                    "Bookshelf Symbol 7", "Boulder", "Bradley Hand", "Bradley Hand ITC", "Bremen Bd BT", "Britannic Bold", "Broadway", "Browallia New", "BrowalliaUPC", "Brush Script MT", "Californian FB", "Calisto MT", "Calligrapher", "Candara",
                    "CaslonOpnface BT", "Castellar", "Centaur", "Cezanne", "CG Omega", "CG Times", "Chalkboard", "Chalkboard SE", "Chalkduster", "Charlesworth", "Charter Bd BT", "Charter BT", "Chaucer",
                    "ChelthmITC Bk BT", "Chiller", "Clarendon", "Clarendon Condensed", "CloisterBlack BT", "Cochin", "Colonna MT", "Constantia", "Cooper Black", "Copperplate", "Copperplate Gothic", "Copperplate Gothic Bold",
                    "Copperplate Gothic Light", "CopperplGoth Bd BT", "Corbel", "Cordia New", "CordiaUPC", "Cornerstone", "Coronet", "Cuckoo", "Curlz MT", "DaunPenh", "Dauphin", "David", "DB LCD Temp", "DELICIOUS", "Denmark",
                    "DFKai-SB", "Didot", "DilleniaUPC", "DIN", "DokChampa", "Dotum", "DotumChe", "Ebrima", "Edwardian Script ITC", "Elephant", "English 111 Vivace BT", "Engravers MT", "EngraversGothic BT", "Eras Bold ITC", "Eras Demi ITC", "Eras Light ITC", "Eras Medium ITC",
                    "EucrosiaUPC", "Euphemia", "Euphemia UCAS", "EUROSTILE", "Exotc350 Bd BT", "FangSong", "Felix Titling", "Fixedsys", "FONTIN", "Footlight MT Light", "Forte",
                    "FrankRuehl", "Fransiscan", "Freefrm721 Blk BT", "FreesiaUPC", "Freestyle Script", "French Script MT", "FrnkGothITC Bk BT", "Fruitger", "FRUTIGER",
                    "Futura", "Futura Bk BT", "Futura Lt BT", "Futura Md BT", "Futura ZBlk BT", "FuturaBlack BT", "Gabriola", "Galliard BT", "Gautami", "Geeza Pro", "Geometr231 BT", "Geometr231 Hv BT", "Geometr231 Lt BT", "GeoSlab 703 Lt BT",
                    "GeoSlab 703 XBd BT", "Gigi", "Gill Sans", "Gill Sans MT", "Gill Sans MT Condensed", "Gill Sans MT Ext Condensed Bold", "Gill Sans Ultra Bold", "Gill Sans Ultra Bold Condensed", "Gisha", "Gloucester MT Extra Condensed", "GOTHAM", "GOTHAM BOLD",
                    "Goudy Old Style", "Goudy Stout", "GoudyHandtooled BT", "GoudyOLSt BT", "Gujarati Sangam MN", "Gulim", "GulimChe", "Gungsuh", "GungsuhChe", "Gurmukhi MN", "Haettenschweiler", "Harlow Solid Italic", "Harrington", "Heather", "Heiti SC", "Heiti TC", "HELV",
                    "Herald", "High Tower Text", "Hiragino Kaku Gothic ProN", "Hiragino Mincho ProN", "Hoefler Text", "Humanst 521 Cn BT", "Humanst521 BT", "Humanst521 Lt BT", "Imprint MT Shadow", "Incised901 Bd BT", "Incised901 BT",
                    "Incised901 Lt BT", "INCONSOLATA", "Informal Roman", "Informal011 BT", "INTERSTATE", "IrisUPC", "Iskoola Pota", "JasmineUPC", "Jazz LET", "Jenson", "Jester", "Jokerman", "Juice ITC", "Kabel Bk BT", "Kabel Ult BT", "Kailasa", "KaiTi", "Kalinga", "Kannada Sangam MN",
                    "Kartika", "Kaufmann Bd BT", "Kaufmann BT", "Khmer UI", "KodchiangUPC", "Kokila", "Korinna BT", "Kristen ITC", "Krungthep", "Kunstler Script", "Lao UI", "Latha", "Leelawadee", "Letter Gothic", "Levenim MT", "LilyUPC", "Lithograph", "Lithograph Light", "Long Island",
                    "Lydian BT", "Magneto", "Maiandra GD", "Malayalam Sangam MN", "Malgun Gothic",
                    "Mangal", "Marigold", "Marion", "Marker Felt", "Market", "Marlett", "Matisse ITC", "Matura MT Script Capitals", "Meiryo", "Meiryo UI", "Microsoft Himalaya", "Microsoft JhengHei", "Microsoft New Tai Lue", "Microsoft PhagsPa", "Microsoft Tai Le",
                    "Microsoft Uighur", "Microsoft YaHei", "Microsoft Yi Baiti", "MingLiU", "MingLiU_HKSCS", "MingLiU_HKSCS-ExtB", "MingLiU-ExtB", "Minion", "Minion Pro", "Miriam", "Miriam Fixed", "Mistral", "Modern", "Modern No. 20", "Mona Lisa Solid ITC TT", "Mongolian Baiti",
                    "MONO", "MoolBoran", "Mrs Eaves", "MS LineDraw", "MS Mincho", "MS PMincho", "MS Reference Specialty", "MS UI Gothic", "MT Extra", "MUSEO", "MV Boli",
                    "Nadeem", "Narkisim", "NEVIS", "News Gothic", "News GothicMT", "NewsGoth BT", "Niagara Engraved", "Niagara Solid", "Noteworthy", "NSimSun", "Nyala", "OCR A Extended", "Old Century", "Old English Text MT", "Onyx", "Onyx BT", "OPTIMA", "Oriya Sangam MN",
                    "OSAKA", "OzHandicraft BT", "Palace Script MT", "Papyrus", "Parchment", "Party LET", "Pegasus", "Perpetua", "Perpetua Titling MT", "PetitaBold", "Pickwick", "Plantagenet Cherokee", "Playbill", "PMingLiU", "PMingLiU-ExtB",
                    "Poor Richard", "Poster", "PosterBodoni BT", "PRINCETOWN LET", "Pristina", "PTBarnum BT", "Pythagoras", "Raavi", "Rage Italic", "Ravie", "Ribbon131 Bd BT", "Rockwell", "Rockwell Condensed", "Rockwell Extra Bold", "Rod", "Roman", "Sakkal Majalla",
                    "Santa Fe LET", "Savoye LET", "Sceptre", "Script", "Script MT Bold", "SCRIPTINA", "Serifa", "Serifa BT", "Serifa Th BT", "ShelleyVolante BT", "Sherwood",
                    "Shonar Bangla", "Showcard Gothic", "Shruti", "Signboard", "SILKSCREEN", "SimHei", "Simplified Arabic", "Simplified Arabic Fixed", "SimSun", "SimSun-ExtB", "Sinhala Sangam MN", "Sketch Rockwell", "Skia", "Small Fonts", "Snap ITC", "Snell Roundhand", "Socket",
                    "Souvenir Lt BT", "Staccato222 BT", "Steamer", "Stencil", "Storybook", "Styllo", "Subway", "Swis721 BlkEx BT", "Swiss911 XCm BT", "Sylfaen", "Synchro LET", "System", "Tamil Sangam MN", "Technical", "Teletype", "Telugu Sangam MN", "Tempus Sans ITC",
                    "Terminal", "Thonburi", "Traditional Arabic", "Trajan", "TRAJAN PRO", "Tristan", "Tubular", "Tunga", "Tw Cen MT", "Tw Cen MT Condensed", "Tw Cen MT Condensed Extra Bold",
                    "TypoUpright BT", "Unicorn", "Univers", "Univers CE 55 Medium", "Univers Condensed", "Utsaah", "Vagabond", "Vani", "Vijaya", "Viner Hand ITC", "VisualUI", "Vivaldi", "Vladimir Script", "Vrinda", "Westminster", "WHITNEY", "Wide Latin",
                    "ZapfEllipt BT", "ZapfHumnst BT", "ZapfHumnst Dm BT", "Zapfino", "Zurich BlkEx BT", "Zurich Ex BT", "ZWAdobeF"];

                if (that.options.extendedJsFonts) {
                    fontList = fontList.concat(extendedFontList);
                }

                //we use m or w because these two characters take up the maximum width.
                // And we use a LLi so that the same matching fonts can get separated
                var testString = "mmmmmmmmmmlli";

                //we test using 72px font size, we may use any size. I guess larger the better.
                var testSize = "72px";

                var h = document.getElementsByTagName("body")[0];

                // div to load spans for the base fonts
                var baseFontsDiv = document.createElement("div");

                // div to load spans for the fonts to detect
                var fontsDiv = document.createElement("div");

                var defaultWidth = {};
                var defaultHeight = {};

                // creates a span where the fonts will be loaded
                var createSpan = function () {
                    var s = document.createElement("span");
                    /*
                     * We need this css as in some weird browser this
                     * span elements shows up for a microSec which creates a
                     * bad user experience
                     */
                    s.style.position = "absolute";
                    s.style.left = "-9999px";
                    s.style.fontSize = testSize;
                    s.innerHTML = testString;
                    return s;
                };

                // creates a span and load the font to detect and a base font for fallback
                var createSpanWithFonts = function (fontToDetect, baseFont) {
                    var s = createSpan();
                    s.style.fontFamily = "'" + fontToDetect + "'," + baseFont;
                    return s;
                };

                // creates spans for the base fonts and adds them to baseFontsDiv
                var initializeBaseFontsSpans = function () {
                    var spans = [];
                    for (var index = 0, length = baseFonts.length; index < length; index++) {
                        var s = createSpan();
                        s.style.fontFamily = baseFonts[index];
                        baseFontsDiv.appendChild(s);
                        spans.push(s);
                    }
                    return spans;
                };

                // creates spans for the fonts to detect and adds them to fontsDiv
                var initializeFontsSpans = function () {
                    var spans = {};
                    for (var i = 0, l = fontList.length; i < l; i++) {
                        var fontSpans = [];
                        for (var j = 0, numDefaultFonts = baseFonts.length; j < numDefaultFonts; j++) {
                            var s = createSpanWithFonts(fontList[i], baseFonts[j]);
                            fontsDiv.appendChild(s);
                            fontSpans.push(s);
                        }
                        spans[fontList[i]] = fontSpans; // Stores {fontName : [spans for that font]}
                    }
                    return spans;
                };

                // checks if a font is available
                var isFontAvailable = function (fontSpans) {
                    var detected = false;
                    for (var i = 0; i < baseFonts.length; i++) {
                        detected = (fontSpans[i].offsetWidth !== defaultWidth[baseFonts[i]] || fontSpans[i].offsetHeight !== defaultHeight[baseFonts[i]]);
                        if (detected) {
                            return detected;
                        }
                    }
                    return detected;
                };

                // create spans for base fonts
                var baseFontsSpans = initializeBaseFontsSpans();

                // add the spans to the DOM
                h.appendChild(baseFontsDiv);

                // get the default width for the three base fonts
                for (var index = 0, length = baseFonts.length; index < length; index++) {
                    defaultWidth[baseFonts[index]] = baseFontsSpans[index].offsetWidth; // width for the default font
                    defaultHeight[baseFonts[index]] = baseFontsSpans[index].offsetHeight; // height for the default font
                }

                // create spans for fonts to detect
                var fontsSpans = initializeFontsSpans();

                // add all the spans to the DOM
                h.appendChild(fontsDiv);

                // check available fonts
                var available = [];
                for (var i = 0, l = fontList.length; i < l; i++) {
                    if (isFontAvailable(fontsSpans[fontList[i]])) {
                        available.push(fontList[i]);
                    }
                }

                // remove spans from DOM
                h.removeChild(fontsDiv);
                h.removeChild(baseFontsDiv);

                keys.push({key: "js_fonts", value: available});
                done(keys);
            }, 1);
        },
        pluginsKey: function (keys) {
            if (!this.options.excludePlugins) {
                if (this.isIE()) {
                    if (!this.options.excludeIEPlugins) {
                        keys.push({key: "ie_plugins", value: this.getIEPlugins()});
                    }
                } else {
                    keys.push({key: "regular_plugins", value: this.getRegularPlugins()});
                }
            }
            return keys;
        },
        getRegularPlugins: function () {
            var plugins = [];
            for (var i = 0, l = navigator.plugins.length; i < l; i++) {
                plugins.push(navigator.plugins[i]);
            }
            // sorting plugins only for those user agents, that we know randomize the plugins
            // every time we try to enumerate them
            if (this.pluginsShouldBeSorted()) {
                plugins = plugins.sort(function (a, b) {
                    if (a.name > b.name) {
                        return 1;
                    }
                    if (a.name < b.name) {
                        return -1;
                    }
                    return 0;
                });
            }
            return this.map(plugins, function (p) {
                var mimeTypes = this.map(p, function (mt) {
                    return [mt.type, mt.suffixes].join("~");
                }).join(",");
                return [p.name, p.description, mimeTypes].join("::");
            }, this);
        },
        getIEPlugins: function () {
            var result = [];
            if ((Object.getOwnPropertyDescriptor && Object.getOwnPropertyDescriptor(window, "ActiveXObject")) || ("ActiveXObject" in window)) {
                var names = [
                    "AcroPDF.PDF", // Adobe PDF reader 7+
                    "Adodb.Stream",
                    "AgControl.AgControl", // Silverlight
                    "DevalVRXCtrl.DevalVRXCtrl.1",
                    "MacromediaFlashPaper.MacromediaFlashPaper",
                    "Msxml2.DOMDocument",
                    "Msxml2.XMLHTTP",
                    "PDF.PdfCtrl", // Adobe PDF reader 6 and earlier, brrr
                    "QuickTime.QuickTime", // QuickTime
                    "QuickTimeCheckObject.QuickTimeCheck.1",
                    "RealPlayer",
                    "RealPlayer.RealPlayer(tm) ActiveX Control (32-bit)",
                    "RealVideo.RealVideo(tm) ActiveX Control (32-bit)",
                    "Scripting.Dictionary",
                    "SWCtl.SWCtl", // ShockWave player
                    "Shell.UIHelper",
                    "ShockwaveFlash.ShockwaveFlash", //flash plugin
                    "Skype.Detection",
                    "TDCCtl.TDCCtl",
                    "WMPlayer.OCX", // Windows media player
                    "rmocx.RealPlayer G2 Control",
                    "rmocx.RealPlayer G2 Control.1"
                ];
                // starting to detect plugins in IE
                result = this.map(names, function (name) {
                    try {
                        new ActiveXObject(name); // eslint-disable-no-new
                        return name;
                    } catch (e) {
                        return null;
                    }
                });
            }
            if (navigator.plugins) {
                result = result.concat(this.getRegularPlugins());
            }
            return result;
        },
        pluginsShouldBeSorted: function () {
            var should = false;
            for (var i = 0, l = this.options.sortPluginsFor.length; i < l; i++) {
                var re = this.options.sortPluginsFor[i];
                if (navigator.userAgent.match(re)) {
                    should = true;
                    break;
                }
            }
            return should;
        },
        touchSupportKey: function (keys) {
            if (!this.options.excludeTouchSupport) {
                keys.push({key: "touch_support", value: this.getTouchSupport()});
            }
            return keys;
        },
        hasSessionStorage: function () {
            try {
                return !!window.sessionStorage;
            } catch (e) {
                return true; // SecurityError when referencing it means it exists
            }
        },
        // https://bugzilla.mozilla.org/show_bug.cgi?id=781447
        hasLocalStorage: function () {
            try {
                return !!window.localStorage;
            } catch (e) {
                return true; // SecurityError when referencing it means it exists
            }
        },
        hasIndexedDB: function () {
            return !!window.indexedDB;
        },
        getNavigatorCpuClass: function () {
            if (navigator.cpuClass) {
                return navigator.cpuClass;
            } else {
                return "unknown";
            }
        },
        getNavigatorPlatform: function () {
            if (navigator.platform) {
                return navigator.platform;
            } else {
                return "unknown";
            }
        },
        getDoNotTrack: function () {
            if (navigator.doNotTrack) {
                return navigator.doNotTrack;
            } else {
                return "unknown";
            }
        },
        // This is a crude and primitive touch screen detection.
        // It's not possible to currently reliably detect the  availability of a touch screen
        // with a JS, without actually subscribing to a touch event.
        // http://www.stucox.com/blog/you-cant-detect-a-touchscreen/
        // https://github.com/Modernizr/Modernizr/issues/548
        // method returns an array of 3 values:
        // maxTouchPoints, the success or failure of creating a TouchEvent,
        // and the availability of the 'ontouchstart' property
        getTouchSupport: function () {
            var maxTouchPoints = 0;
            var touchEvent = false;
            if (typeof navigator.maxTouchPoints !== "undefined") {
                maxTouchPoints = navigator.maxTouchPoints;
            } else if (typeof navigator.msMaxTouchPoints !== "undefined") {
                maxTouchPoints = navigator.msMaxTouchPoints;
            }
            try {
                document.createEvent("TouchEvent");
                touchEvent = true;
            } catch (_) { /* squelch */
            }
            var touchStart = "ontouchstart" in window;
            return [maxTouchPoints, touchEvent, touchStart];
        },
        // https://www.browserleaks.com/canvas#how-does-it-work
        getCanvasFp: function () {
            var result = [];
            // Very simple now, need to make it more complex (geo shapes etc)
            var canvas = document.createElement("canvas");
            canvas.width = 2000;
            canvas.height = 200;
            canvas.style.display = "inline";
            var ctx = canvas.getContext("2d");
            // detect browser support of canvas winding
            // http://blogs.adobe.com/webplatform/2013/01/30/winding-rules-in-canvas/
            // https://github.com/Modernizr/Modernizr/blob/master/feature-detects/canvas/winding.js
            ctx.rect(0, 0, 10, 10);
            ctx.rect(2, 2, 6, 6);
            result.push("canvas winding:" + ((ctx.isPointInPath(5, 5, "evenodd") === false) ? "yes" : "no"));

            ctx.textBaseline = "alphabetic";
            ctx.fillStyle = "#f60";
            ctx.fillRect(125, 1, 62, 20);
            ctx.fillStyle = "#069";
            // https://github.com/Valve/fingerprintjs2/issues/66
            if (this.options.dontUseFakeFontInCanvas) {
                ctx.font = "11pt Arial";
            } else {
                ctx.font = "11pt no-real-font-123";
            }
            ctx.fillText("Cwm fjordbank glyphs vext quiz, \ud83d\ude03", 2, 15);
            ctx.fillStyle = "rgba(102, 204, 0, 0.2)";
            ctx.font = "18pt Arial";
            ctx.fillText("Cwm fjordbank glyphs vext quiz, \ud83d\ude03", 4, 45);

            // canvas blending
            // http://blogs.adobe.com/webplatform/2013/01/28/blending-features-in-canvas/
            // http://jsfiddle.net/NDYV8/16/
            ctx.globalCompositeOperation = "multiply";
            ctx.fillStyle = "rgb(255,0,255)";
            ctx.beginPath();
            ctx.arc(50, 50, 50, 0, Math.PI * 2, true);
            ctx.closePath();
            ctx.fill();
            ctx.fillStyle = "rgb(0,255,255)";
            ctx.beginPath();
            ctx.arc(100, 50, 50, 0, Math.PI * 2, true);
            ctx.closePath();
            ctx.fill();
            ctx.fillStyle = "rgb(255,255,0)";
            ctx.beginPath();
            ctx.arc(75, 100, 50, 0, Math.PI * 2, true);
            ctx.closePath();
            ctx.fill();
            ctx.fillStyle = "rgb(255,0,255)";
            // canvas winding
            // http://blogs.adobe.com/webplatform/2013/01/30/winding-rules-in-canvas/
            // http://jsfiddle.net/NDYV8/19/
            ctx.arc(75, 75, 75, 0, Math.PI * 2, true);
            ctx.arc(75, 75, 25, 0, Math.PI * 2, true);
            ctx.fill("evenodd");

            result.push("canvas fp:" + canvas.toDataURL());
            return result.join("~");
        },

        getWebglFp: function () {
            var gl;
            var fa2s = function (fa) {
                gl.clearColor(0.0, 0.0, 0.0, 1.0);
                gl.enable(gl.DEPTH_TEST);
                gl.depthFunc(gl.LEQUAL);
                gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
                return "[" + fa[0] + ", " + fa[1] + "]";
            };
            var maxAnisotropy = function (gl) {
                var anisotropy, ext = gl.getExtension("EXT_texture_filter_anisotropic") || gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic") || gl.getExtension("MOZ_EXT_texture_filter_anisotropic");
                return ext ? (anisotropy = gl.getParameter(ext.MAX_TEXTURE_MAX_ANISOTROPY_EXT), 0 === anisotropy && (anisotropy = 2), anisotropy) : null;
            };
            gl = this.getWebglCanvas();
            if (!gl) {
                return null;
            }
            // WebGL fingerprinting is a combination of techniques, found in MaxMind antifraud script & Augur fingerprinting.
            // First it draws a gradient object with shaders and convers the image to the Base64 string.
            // Then it enumerates all WebGL extensions & capabilities and appends them to the Base64 string, resulting in a huge WebGL string, potentially very unique on each device
            // Since iOS supports webgl starting from version 8.1 and 8.1 runs on several graphics chips, the results may be different across ios devices, but we need to verify it.
            var result = [];
            var vShaderTemplate = "attribute vec2 attrVertex;varying vec2 varyinTexCoordinate;uniform vec2 uniformOffset;void main(){varyinTexCoordinate=attrVertex+uniformOffset;gl_Position=vec4(attrVertex,0,1);}";
            var fShaderTemplate = "precision mediump float;varying vec2 varyinTexCoordinate;void main() {gl_FragColor=vec4(varyinTexCoordinate,0,1);}";
            var vertexPosBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, vertexPosBuffer);
            var vertices = new Float32Array([-.2, -.9, 0, .4, -.26, 0, 0, .732134444, 0]);
            gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
            vertexPosBuffer.itemSize = 3;
            vertexPosBuffer.numItems = 3;
            var program = gl.createProgram(), vshader = gl.createShader(gl.VERTEX_SHADER);
            gl.shaderSource(vshader, vShaderTemplate);
            gl.compileShader(vshader);
            var fshader = gl.createShader(gl.FRAGMENT_SHADER);
            gl.shaderSource(fshader, fShaderTemplate);
            gl.compileShader(fshader);
            gl.attachShader(program, vshader);
            gl.attachShader(program, fshader);
            gl.linkProgram(program);
            gl.useProgram(program);
            program.vertexPosAttrib = gl.getAttribLocation(program, "attrVertex");
            program.offsetUniform = gl.getUniformLocation(program, "uniformOffset");
            gl.enableVertexAttribArray(program.vertexPosArray);
            gl.vertexAttribPointer(program.vertexPosAttrib, vertexPosBuffer.itemSize, gl.FLOAT, !1, 0, 0);
            gl.uniform2f(program.offsetUniform, 1, 1);
            gl.drawArrays(gl.TRIANGLE_STRIP, 0, vertexPosBuffer.numItems);
            if (gl.canvas != null) {
                result.push(gl.canvas.toDataURL());
            }
            result.push("extensions:" + gl.getSupportedExtensions().join(";"));
            result.push("webgl aliased line width range:" + fa2s(gl.getParameter(gl.ALIASED_LINE_WIDTH_RANGE)));
            result.push("webgl aliased point size range:" + fa2s(gl.getParameter(gl.ALIASED_POINT_SIZE_RANGE)));
            result.push("webgl alpha bits:" + gl.getParameter(gl.ALPHA_BITS));
            result.push("webgl antialiasing:" + (gl.getContextAttributes().antialias ? "yes" : "no"));
            result.push("webgl blue bits:" + gl.getParameter(gl.BLUE_BITS));
            result.push("webgl depth bits:" + gl.getParameter(gl.DEPTH_BITS));
            result.push("webgl green bits:" + gl.getParameter(gl.GREEN_BITS));
            result.push("webgl max anisotropy:" + maxAnisotropy(gl));
            result.push("webgl max combined texture image units:" + gl.getParameter(gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS));
            result.push("webgl max cube map texture size:" + gl.getParameter(gl.MAX_CUBE_MAP_TEXTURE_SIZE));
            result.push("webgl max fragment uniform vectors:" + gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS));
            result.push("webgl max render buffer size:" + gl.getParameter(gl.MAX_RENDERBUFFER_SIZE));
            result.push("webgl max texture image units:" + gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS));
            result.push("webgl max texture size:" + gl.getParameter(gl.MAX_TEXTURE_SIZE));
            result.push("webgl max varying vectors:" + gl.getParameter(gl.MAX_VARYING_VECTORS));
            result.push("webgl max vertex attribs:" + gl.getParameter(gl.MAX_VERTEX_ATTRIBS));
            result.push("webgl max vertex texture image units:" + gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS));
            result.push("webgl max vertex uniform vectors:" + gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS));
            result.push("webgl max viewport dims:" + fa2s(gl.getParameter(gl.MAX_VIEWPORT_DIMS)));
            result.push("webgl red bits:" + gl.getParameter(gl.RED_BITS));
            result.push("webgl renderer:" + gl.getParameter(gl.RENDERER));
            result.push("webgl shading language version:" + gl.getParameter(gl.SHADING_LANGUAGE_VERSION));
            result.push("webgl stencil bits:" + gl.getParameter(gl.STENCIL_BITS));
            result.push("webgl vendor:" + gl.getParameter(gl.VENDOR));
            result.push("webgl version:" + gl.getParameter(gl.VERSION));

            if (!gl.getShaderPrecisionFormat) {
                if (typeof NODEBUG === "undefined") {
                    this.log("WebGL fingerprinting is incomplete, because your browser does not support getShaderPrecisionFormat");
                }
                return result.join("~");
            }

            result.push("webgl vertex shader high float precision:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_FLOAT).precision);
            result.push("webgl vertex shader high float precision rangeMin:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_FLOAT).rangeMin);
            result.push("webgl vertex shader high float precision rangeMax:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_FLOAT).rangeMax);
            result.push("webgl vertex shader medium float precision:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_FLOAT).precision);
            result.push("webgl vertex shader medium float precision rangeMin:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_FLOAT).rangeMin);
            result.push("webgl vertex shader medium float precision rangeMax:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_FLOAT).rangeMax);
            result.push("webgl vertex shader low float precision:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_FLOAT).precision);
            result.push("webgl vertex shader low float precision rangeMin:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_FLOAT).rangeMin);
            result.push("webgl vertex shader low float precision rangeMax:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_FLOAT).rangeMax);
            result.push("webgl fragment shader high float precision:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT).precision);
            result.push("webgl fragment shader high float precision rangeMin:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT).rangeMin);
            result.push("webgl fragment shader high float precision rangeMax:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT).rangeMax);
            result.push("webgl fragment shader medium float precision:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT).precision);
            result.push("webgl fragment shader medium float precision rangeMin:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT).rangeMin);
            result.push("webgl fragment shader medium float precision rangeMax:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT).rangeMax);
            result.push("webgl fragment shader low float precision:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_FLOAT).precision);
            result.push("webgl fragment shader low float precision rangeMin:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_FLOAT).rangeMin);
            result.push("webgl fragment shader low float precision rangeMax:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_FLOAT).rangeMax);
            result.push("webgl vertex shader high int precision:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_INT).precision);
            result.push("webgl vertex shader high int precision rangeMin:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_INT).rangeMin);
            result.push("webgl vertex shader high int precision rangeMax:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_INT).rangeMax);
            result.push("webgl vertex shader medium int precision:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_INT).precision);
            result.push("webgl vertex shader medium int precision rangeMin:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_INT).rangeMin);
            result.push("webgl vertex shader medium int precision rangeMax:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_INT).rangeMax);
            result.push("webgl vertex shader low int precision:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_INT).precision);
            result.push("webgl vertex shader low int precision rangeMin:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_INT).rangeMin);
            result.push("webgl vertex shader low int precision rangeMax:" + gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.LOW_INT).rangeMax);
            result.push("webgl fragment shader high int precision:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_INT).precision);
            result.push("webgl fragment shader high int precision rangeMin:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_INT).rangeMin);
            result.push("webgl fragment shader high int precision rangeMax:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_INT).rangeMax);
            result.push("webgl fragment shader medium int precision:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_INT).precision);
            result.push("webgl fragment shader medium int precision rangeMin:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_INT).rangeMin);
            result.push("webgl fragment shader medium int precision rangeMax:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_INT).rangeMax);
            result.push("webgl fragment shader low int precision:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_INT).precision);
            result.push("webgl fragment shader low int precision rangeMin:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_INT).rangeMin);
            result.push("webgl fragment shader low int precision rangeMax:" + gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.LOW_INT).rangeMax);
            return result.join("~");
        },
        getAdBlock: function () {
            var ads = document.createElement("div");
            ads.innerHTML = "&nbsp;";
            ads.className = "adsbox";
            var result = false;
            try {
                // body may not exist, that's why we need try/catch
                document.body.appendChild(ads);
                result = document.getElementsByClassName("adsbox")[0].offsetHeight === 0;
                document.body.removeChild(ads);
            } catch (e) {
                result = false;
            }
            return result;
        },
        getHasLiedLanguages: function () {
            //We check if navigator.language is equal to the first language of navigator.languages
            if (typeof navigator.languages !== "undefined") {
                try {
                    var firstLanguages = navigator.languages[0].substr(0, 2);
                    if (firstLanguages !== navigator.language.substr(0, 2)) {
                        return true;
                    }
                } catch (err) {
                    return true;
                }
            }
            return false;
        },
        getHasLiedResolution: function () {
            if (screen.width < screen.availWidth) {
                return true;
            }
            if (screen.height < screen.availHeight) {
                return true;
            }
            return false;
        },
        getHasLiedOs: function () {
            var userAgent = navigator.userAgent.toLowerCase();
            var oscpu = navigator.oscpu;
            var platform = navigator.platform.toLowerCase();
            var os;
            //We extract the OS from the user agent (respect the order of the if else if statement)
            if (userAgent.indexOf("windows phone") >= 0) {
                os = "Windows Phone";
            } else if (userAgent.indexOf("win") >= 0) {
                os = "Windows";
            } else if (userAgent.indexOf("android") >= 0) {
                os = "Android";
            } else if (userAgent.indexOf("linux") >= 0) {
                os = "Linux";
            } else if (userAgent.indexOf("iphone") >= 0 || userAgent.indexOf("ipad") >= 0) {
                os = "iOS";
            } else if (userAgent.indexOf("mac") >= 0) {
                os = "Mac";
            } else {
                os = "Other";
            }
            // We detect if the person uses a mobile device
            var mobileDevice;
            if (("ontouchstart" in window) ||
                (navigator.maxTouchPoints > 0) ||
                (navigator.msMaxTouchPoints > 0)) {
                mobileDevice = true;
            } else {
                mobileDevice = false;
            }

            if (mobileDevice && os !== "Windows Phone" && os !== "Android" && os !== "iOS" && os !== "Other") {
                return true;
            }

            // We compare oscpu with the OS extracted from the UA
            if (typeof oscpu !== "undefined") {
                oscpu = oscpu.toLowerCase();
                if (oscpu.indexOf("win") >= 0 && os !== "Windows" && os !== "Windows Phone") {
                    return true;
                } else if (oscpu.indexOf("linux") >= 0 && os !== "Linux" && os !== "Android") {
                    return true;
                } else if (oscpu.indexOf("mac") >= 0 && os !== "Mac" && os !== "iOS") {
                    return true;
                } else if (oscpu.indexOf("win") === 0 && oscpu.indexOf("linux") === 0 && oscpu.indexOf("mac") >= 0 && os !== "other") {
                    return true;
                }
            }

            //We compare platform with the OS extracted from the UA
            if (platform.indexOf("win") >= 0 && os !== "Windows" && os !== "Windows Phone") {
                return true;
            } else if ((platform.indexOf("linux") >= 0 || platform.indexOf("android") >= 0 || platform.indexOf("pike") >= 0) && os !== "Linux" && os !== "Android") {
                return true;
            } else if ((platform.indexOf("mac") >= 0 || platform.indexOf("ipad") >= 0 || platform.indexOf("ipod") >= 0 || platform.indexOf("iphone") >= 0) && os !== "Mac" && os !== "iOS") {
                return true;
            } else if (platform.indexOf("win") === 0 && platform.indexOf("linux") === 0 && platform.indexOf("mac") >= 0 && os !== "other") {
                return true;
            }

            if (typeof navigator.plugins === "undefined" && os !== "Windows" && os !== "Windows Phone") {
                //We are are in the case where the person uses ie, therefore we can infer that it's windows
                return true;
            }

            return false;
        },
        getHasLiedBrowser: function () {
            var userAgent = navigator.userAgent.toLowerCase();
            var productSub = navigator.productSub;

            //we extract the browser from the user agent (respect the order of the tests)
            var browser;
            if (userAgent.indexOf("firefox") >= 0) {
                browser = "Firefox";
            } else if (userAgent.indexOf("opera") >= 0 || userAgent.indexOf("opr") >= 0) {
                browser = "Opera";
            } else if (userAgent.indexOf("chrome") >= 0) {
                browser = "Chrome";
            } else if (userAgent.indexOf("safari") >= 0) {
                browser = "Safari";
            } else if (userAgent.indexOf("trident") >= 0) {
                browser = "Internet Explorer";
            } else {
                browser = "Other";
            }

            if ((browser === "Chrome" || browser === "Safari" || browser === "Opera") && productSub !== "20030107") {
                return true;
            }

            var tempRes = eval.toString().length;
            if (tempRes === 37 && browser !== "Safari" && browser !== "Firefox" && browser !== "Other") {
                return true;
            } else if (tempRes === 39 && browser !== "Internet Explorer" && browser !== "Other") {
                return true;
            } else if (tempRes === 33 && browser !== "Chrome" && browser !== "Opera" && browser !== "Other") {
                return true;
            }

            //We create an error to see how it is handled
            var errFirefox;
            try {
                throw "a";
            } catch (err) {
                try {
                    err.toSource();
                    errFirefox = true;
                } catch (errOfErr) {
                    errFirefox = false;
                }
            }
            if (errFirefox && browser !== "Firefox" && browser !== "Other") {
                return true;
            }
            return false;
        },
        isCanvasSupported: function () {
            var elem = document.createElement("canvas");
            return !!(elem.getContext && elem.getContext("2d"));
        },
        isWebGlSupported: function () {
            // code taken from Modernizr
            if (!this.isCanvasSupported()) {
                return false;
            }

            var canvas = document.createElement("canvas"),
                glContext;

            try {
                glContext = canvas.getContext && (canvas.getContext("webgl") || canvas.getContext("experimental-webgl"));
            } catch (e) {
                glContext = false;
            }

            return !!window.WebGLRenderingContext && !!glContext;
        },
        isIE: function () {
            if (navigator.appName === "Microsoft Internet Explorer") {
                return true;
            } else if (navigator.appName === "Netscape" && /Trident/.test(navigator.userAgent)) { // IE 11
                return true;
            }
            return false;
        },
        hasSwfObjectLoaded: function () {
            return typeof window.swfobject !== "undefined";
        },
        hasMinFlashInstalled: function () {
            return swfobject.hasFlashPlayerVersion("9.0.0");
        },
        addFlashDivNode: function () {
            var node = document.createElement("div");
            node.setAttribute("id", this.options.swfContainerId);
            document.body.appendChild(node);
        },
        loadSwfAndDetectFonts: function (done) {
            var hiddenCallback = "___fp_swf_loaded";
            window[hiddenCallback] = function (fonts) {
                done(fonts);
            };
            var id = this.options.swfContainerId;
            this.addFlashDivNode();
            var flashvars = {onReady: hiddenCallback};
            var flashparams = {allowScriptAccess: "always", menu: "false"};
            swfobject.embedSWF(this.options.swfPath, id, "1", "1", "9.0.0", false, flashvars, flashparams, {});
        },
        getWebglCanvas: function () {
            var canvas = document.createElement("canvas");
            var gl = null;
            try {
                gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
            } catch (e) { /* squelch */
            }
            if (!gl) {
                gl = null;
            }
            return gl;
        },
        each: function (obj, iterator, context) {
            if (obj === null) {
                return;
            }
            if (this.nativeForEach && obj.forEach === this.nativeForEach) {
                obj.forEach(iterator, context);
            } else if (obj.length === +obj.length) {
                for (var i = 0, l = obj.length; i < l; i++) {
                    if (iterator.call(context, obj[i], i, obj) === {}) {
                        return;
                    }
                }
            } else {
                for (var key in obj) {
                    if (obj.hasOwnProperty(key)) {
                        if (iterator.call(context, obj[key], key, obj) === {}) {
                            return;
                        }
                    }
                }
            }
        },

        map: function (obj, iterator, context) {
            var results = [];
            // Not using strict equality so that this acts as a
            // shortcut to checking for `null` and `undefined`.
            if (obj == null) {
                return results;
            }
            if (this.nativeMap && obj.map === this.nativeMap) {
                return obj.map(iterator, context);
            }
            this.each(obj, function (value, index, list) {
                results[results.length] = iterator.call(context, value, index, list);
            });
            return results;
        },

        /// MurmurHash3 related functions

        //
        // Given two 64bit ints (as an array of two 32bit ints) returns the two
        // added together as a 64bit int (as an array of two 32bit ints).
        //
        x64Add: function (m, n) {
            m = [m[0] >>> 16, m[0] & 0xffff, m[1] >>> 16, m[1] & 0xffff];
            n = [n[0] >>> 16, n[0] & 0xffff, n[1] >>> 16, n[1] & 0xffff];
            var o = [0, 0, 0, 0];
            o[3] += m[3] + n[3];
            o[2] += o[3] >>> 16;
            o[3] &= 0xffff;
            o[2] += m[2] + n[2];
            o[1] += o[2] >>> 16;
            o[2] &= 0xffff;
            o[1] += m[1] + n[1];
            o[0] += o[1] >>> 16;
            o[1] &= 0xffff;
            o[0] += m[0] + n[0];
            o[0] &= 0xffff;
            return [(o[0] << 16) | o[1], (o[2] << 16) | o[3]];
        },

        //
        // Given two 64bit ints (as an array of two 32bit ints) returns the two
        // multiplied together as a 64bit int (as an array of two 32bit ints).
        //
        x64Multiply: function (m, n) {
            m = [m[0] >>> 16, m[0] & 0xffff, m[1] >>> 16, m[1] & 0xffff];
            n = [n[0] >>> 16, n[0] & 0xffff, n[1] >>> 16, n[1] & 0xffff];
            var o = [0, 0, 0, 0];
            o[3] += m[3] * n[3];
            o[2] += o[3] >>> 16;
            o[3] &= 0xffff;
            o[2] += m[2] * n[3];
            o[1] += o[2] >>> 16;
            o[2] &= 0xffff;
            o[2] += m[3] * n[2];
            o[1] += o[2] >>> 16;
            o[2] &= 0xffff;
            o[1] += m[1] * n[3];
            o[0] += o[1] >>> 16;
            o[1] &= 0xffff;
            o[1] += m[2] * n[2];
            o[0] += o[1] >>> 16;
            o[1] &= 0xffff;
            o[1] += m[3] * n[1];
            o[0] += o[1] >>> 16;
            o[1] &= 0xffff;
            o[0] += (m[0] * n[3]) + (m[1] * n[2]) + (m[2] * n[1]) + (m[3] * n[0]);
            o[0] &= 0xffff;
            return [(o[0] << 16) | o[1], (o[2] << 16) | o[3]];
        },
        //
        // Given a 64bit int (as an array of two 32bit ints) and an int
        // representing a number of bit positions, returns the 64bit int (as an
        // array of two 32bit ints) rotated left by that number of positions.
        //
        x64Rotl: function (m, n) {
            n %= 64;
            if (n === 32) {
                return [m[1], m[0]];
            }
            else if (n < 32) {
                return [(m[0] << n) | (m[1] >>> (32 - n)), (m[1] << n) | (m[0] >>> (32 - n))];
            }
            else {
                n -= 32;
                return [(m[1] << n) | (m[0] >>> (32 - n)), (m[0] << n) | (m[1] >>> (32 - n))];
            }
        },
        //
        // Given a 64bit int (as an array of two 32bit ints) and an int
        // representing a number of bit positions, returns the 64bit int (as an
        // array of two 32bit ints) shifted left by that number of positions.
        //
        x64LeftShift: function (m, n) {
            n %= 64;
            if (n === 0) {
                return m;
            }
            else if (n < 32) {
                return [(m[0] << n) | (m[1] >>> (32 - n)), m[1] << n];
            }
            else {
                return [m[1] << (n - 32), 0];
            }
        },
        //
        // Given two 64bit ints (as an array of two 32bit ints) returns the two
        // xored together as a 64bit int (as an array of two 32bit ints).
        //
        x64Xor: function (m, n) {
            return [m[0] ^ n[0], m[1] ^ n[1]];
        },
        //
        // Given a block, returns murmurHash3's final x64 mix of that block.
        // (`[0, h[0] >>> 1]` is a 33 bit unsigned right shift. This is the
        // only place where we need to right shift 64bit ints.)
        //
        x64Fmix: function (h) {
            h = this.x64Xor(h, [0, h[0] >>> 1]);
            h = this.x64Multiply(h, [0xff51afd7, 0xed558ccd]);
            h = this.x64Xor(h, [0, h[0] >>> 1]);
            h = this.x64Multiply(h, [0xc4ceb9fe, 0x1a85ec53]);
            h = this.x64Xor(h, [0, h[0] >>> 1]);
            return h;
        },

        //
        // Given a string and an optional seed as an int, returns a 128 bit
        // hash using the x64 flavor of MurmurHash3, as an unsigned hex.
        //
        x64hash128: function (key, seed) {
            key = key || "";
            seed = seed || 0;
            var remainder = key.length % 16;
            var bytes = key.length - remainder;
            var h1 = [0, seed];
            var h2 = [0, seed];
            var k1 = [0, 0];
            var k2 = [0, 0];
            var c1 = [0x87c37b91, 0x114253d5];
            var c2 = [0x4cf5ad43, 0x2745937f];
            for (var i = 0; i < bytes; i = i + 16) {
                k1 = [((key.charCodeAt(i + 4) & 0xff)) | ((key.charCodeAt(i + 5) & 0xff) << 8) | ((key.charCodeAt(i + 6) & 0xff) << 16) | ((key.charCodeAt(i + 7) & 0xff) << 24), ((key.charCodeAt(i) & 0xff)) | ((key.charCodeAt(i + 1) & 0xff) << 8) | ((key.charCodeAt(i + 2) & 0xff) << 16) | ((key.charCodeAt(i + 3) & 0xff) << 24)];
                k2 = [((key.charCodeAt(i + 12) & 0xff)) | ((key.charCodeAt(i + 13) & 0xff) << 8) | ((key.charCodeAt(i + 14) & 0xff) << 16) | ((key.charCodeAt(i + 15) & 0xff) << 24), ((key.charCodeAt(i + 8) & 0xff)) | ((key.charCodeAt(i + 9) & 0xff) << 8) | ((key.charCodeAt(i + 10) & 0xff) << 16) | ((key.charCodeAt(i + 11) & 0xff) << 24)];
                k1 = this.x64Multiply(k1, c1);
                k1 = this.x64Rotl(k1, 31);
                k1 = this.x64Multiply(k1, c2);
                h1 = this.x64Xor(h1, k1);
                h1 = this.x64Rotl(h1, 27);
                h1 = this.x64Add(h1, h2);
                h1 = this.x64Add(this.x64Multiply(h1, [0, 5]), [0, 0x52dce729]);
                k2 = this.x64Multiply(k2, c2);
                k2 = this.x64Rotl(k2, 33);
                k2 = this.x64Multiply(k2, c1);
                h2 = this.x64Xor(h2, k2);
                h2 = this.x64Rotl(h2, 31);
                h2 = this.x64Add(h2, h1);
                h2 = this.x64Add(this.x64Multiply(h2, [0, 5]), [0, 0x38495ab5]);
            }
            k1 = [0, 0];
            k2 = [0, 0];
            switch (remainder) {
                case 15:
                    k2 = this.x64Xor(k2, this.x64LeftShift([0, key.charCodeAt(i + 14)], 48));
                case 14:
                    k2 = this.x64Xor(k2, this.x64LeftShift([0, key.charCodeAt(i + 13)], 40));
                case 13:
                    k2 = this.x64Xor(k2, this.x64LeftShift([0, key.charCodeAt(i + 12)], 32));
                case 12:
                    k2 = this.x64Xor(k2, this.x64LeftShift([0, key.charCodeAt(i + 11)], 24));
                case 11:
                    k2 = this.x64Xor(k2, this.x64LeftShift([0, key.charCodeAt(i + 10)], 16));
                case 10:
                    k2 = this.x64Xor(k2, this.x64LeftShift([0, key.charCodeAt(i + 9)], 8));
                case 9:
                    k2 = this.x64Xor(k2, [0, key.charCodeAt(i + 8)]);
                    k2 = this.x64Multiply(k2, c2);
                    k2 = this.x64Rotl(k2, 33);
                    k2 = this.x64Multiply(k2, c1);
                    h2 = this.x64Xor(h2, k2);
                case 8:
                    k1 = this.x64Xor(k1, this.x64LeftShift([0, key.charCodeAt(i + 7)], 56));
                case 7:
                    k1 = this.x64Xor(k1, this.x64LeftShift([0, key.charCodeAt(i + 6)], 48));
                case 6:
                    k1 = this.x64Xor(k1, this.x64LeftShift([0, key.charCodeAt(i + 5)], 40));
                case 5:
                    k1 = this.x64Xor(k1, this.x64LeftShift([0, key.charCodeAt(i + 4)], 32));
                case 4:
                    k1 = this.x64Xor(k1, this.x64LeftShift([0, key.charCodeAt(i + 3)], 24));
                case 3:
                    k1 = this.x64Xor(k1, this.x64LeftShift([0, key.charCodeAt(i + 2)], 16));
                case 2:
                    k1 = this.x64Xor(k1, this.x64LeftShift([0, key.charCodeAt(i + 1)], 8));
                case 1:
                    k1 = this.x64Xor(k1, [0, key.charCodeAt(i)]);
                    k1 = this.x64Multiply(k1, c1);
                    k1 = this.x64Rotl(k1, 31);
                    k1 = this.x64Multiply(k1, c2);
                    h1 = this.x64Xor(h1, k1);
            }
            h1 = this.x64Xor(h1, [0, key.length]);
            h2 = this.x64Xor(h2, [0, key.length]);
            h1 = this.x64Add(h1, h2);
            h2 = this.x64Add(h2, h1);
            h1 = this.x64Fmix(h1);
            h2 = this.x64Fmix(h2);
            h1 = this.x64Add(h1, h2);
            h2 = this.x64Add(h2, h1);
            return ("00000000" + (h1[0] >>> 0).toString(16)).slice(-8) + ("00000000" + (h1[1] >>> 0).toString(16)).slice(-8) + ("00000000" + (h2[0] >>> 0).toString(16)).slice(-8) + ("00000000" + (h2[1] >>> 0).toString(16)).slice(-8);
        }
    };
    Fingerprint2.VERSION = "1.4.0";
    return Fingerprint2;
});

    /*! EmojioneArea v3.0.4 | MIT license */
!function (a, b, c) {
    "use strict";
    var d = 0, e = {}, f = {}, g = b.emojione, h = [];

    function i(a) {
        g ? a() : h.push(a)
    }

    var j = "data:image/gif;base64,R0lGODlhAQABAJH/AP///wAAAMDAwAAAACH5BAEAAAIALAAAAAABAAEAAAICVAEAOw==", k = [].slice, l = "emojionearea", m = 0;

    function n(a, b, d) {
        var f = !0, g = 1;
        if (b) {
            b = b.toLowerCase();
            do {
                var h = 1 == g ? "@" + b : b;
                e[a.id][h] && e[a.id][h].length && c.each(e[a.id][h], function (b, c) {
                    return f = c.apply(a, d || []) !== !1
                })
            } while (f && g--)
        }
        return f
    }

    function o(a, b, d, e) {
        e = e || function (a, b) {
                return c(b.currentTarget)
            }, c.each(d, function (g, h) {
            g = c.isArray(d) ? h : g, (f[a.id][h] || (f[a.id][h] = [])).push([b, g, e])
        })
    }

    function p(a, b, c) {
        return a.replace("{name}", c || "").replace("{img}", g.imagePathPNG + (2 > m ? b.toUpperCase() : b) + ".png").replace("{uni}", b).replace("{alt}", g.convert(b))
    }

    function q(a, b, c) {
        return a.replace(/:?\+?[\w_\-]+:?/g, function (a) {
            a = ":" + a.replace(/:$/, "").replace(/^:/, "") + ":";
            var d = g.emojioneList[a];
            return d ? (m > 3 && (d = d.unicode), p(b, d[d.length - 1], a)) : c ? "" : a
        })
    }

    function r(c) {
        var d, e;
        if (b.getSelection) {
            if (d = b.getSelection(), d.getRangeAt && d.rangeCount) {
                e = d.getRangeAt(0), e.deleteContents();
                var f = a.createElement("div");
                f.innerHTML = c;
                var g = a.createDocumentFragment(), h, i;
                while (h = f.firstChild)i = g.appendChild(h);
                e.insertNode(g), i && (e = e.cloneRange(), e.setStartAfter(i), e.collapse(!0), d.removeAllRanges(), d.addRange(e))
            }
        } else a.selection && "Control" != a.selection.type && a.selection.createRange().pasteHTML(c)
    }

    var s = {
        attributes: {dir: "ltr", spellcheck: !1, autocomplete: "off", autocorrect: "off", autocapitalize: "off"},
        placeholder: null,
        emojiPlaceholder: ":smiley:",
        container: null,
        hideSource: !0,
        shortnames: !0,
        sprite: !0,
        pickerPosition: "top",
        filtersPosition: "top",
        hidePickerOnBlur: !0,
        buttonTitle: "Use the TAB key to insert emoji faster",
        tones: !0,
        tonesStyle: "bullet",
        inline: null,
        saveEmojisAs: "unicode",
        shortcuts: !0,
        autocomplete: !0,
        autocompleteTones: !1,
        standalone: !1,
        filters: {
            tones: {
                title: "Diversity",
                emoji: "santa runner surfer swimmer lifter ear nose point_up_2 point_down point_left point_right punch wave ok_hand thumbsup thumbsdown clap open_hands boy girl man woman cop bride_with_veil person_with_blond_hair man_with_gua_pi_mao man_with_turban older_man grandma baby construction_worker princess angel information_desk_person guardsman dancer nail_care massage haircut muscle spy hand_splayed middle_finger vulcan no_good ok_woman bow raising_hand raised_hands person_frowning person_with_pouting_face pray rowboat bicyclist mountain_bicyclist walking bath metal point_up basketball_player fist raised_hand v writing_hand"
            },
            smileys_people: {
                icon: "yum",
                title: "Smileys & People",
                emoji: "grinning grimacing grin joy smiley smile sweat_smile laughing innocent wink blush slight_smile upside_down relaxed yum relieved heart_eyes kissing_heart kissing kissing_smiling_eyes kissing_closed_eyes stuck_out_tongue_winking_eye stuck_out_tongue_closed_eyes stuck_out_tongue money_mouth nerd sunglasses hugging smirk no_mouth neutral_face expressionless unamused rolling_eyes thinking flushed disappointed worried angry rage pensive confused slight_frown frowning2 persevere confounded tired_face weary triumph open_mouth scream fearful cold_sweat hushed frowning anguished cry disappointed_relieved sleepy sweat sob dizzy_face astonished zipper_mouth mask thermometer_face head_bandage sleeping zzz poop smiling_imp imp japanese_ogre japanese_goblin skull ghost alien robot smiley_cat smile_cat joy_cat heart_eyes_cat smirk_cat kissing_cat scream_cat crying_cat_face pouting_cat raised_hands clap wave thumbsup thumbsdown punch fist v ok_hand raised_hand open_hands muscle pray point_up point_up_2 point_down point_left point_right middle_finger hand_splayed metal vulcan writing_hand nail_care lips tongue ear nose eye eyes bust_in_silhouette busts_in_silhouette speaking_head baby boy girl man woman person_with_blond_hair older_man older_woman man_with_gua_pi_mao man_with_turban cop construction_worker guardsman spy santa angel princess bride_with_veil walking runner dancer dancers couple two_men_holding_hands two_women_holding_hands bow information_desk_person no_good ok_woman raising_hand person_with_pouting_face person_frowning haircut massage couple_with_heart couple_ww couple_mm couplekiss kiss_ww kiss_mm family family_mwg family_mwgb family_mwbb family_mwgg family_wwb family_wwg family_wwgb family_wwbb family_wwgg family_mmb family_mmg family_mmgb family_mmbb family_mmgg womans_clothes shirt jeans necktie dress bikini kimono lipstick kiss footprints high_heel sandal boot mans_shoe athletic_shoe womans_hat tophat helmet_with_cross mortar_board crown school_satchel pouch purse handbag briefcase eyeglasses dark_sunglasses ring closed_umbrella"
            },
            animals_nature: {
                icon: "hamster",
                title: "Animals & Nature",
                emoji: "dog cat mouse hamster rabbit bear panda_face koala tiger lion_face cow pig pig_nose frog octopus monkey_face see_no_evil hear_no_evil speak_no_evil monkey chicken penguin bird baby_chick hatching_chick hatched_chick wolf boar horse unicorn bee bug snail beetle ant spider scorpion crab snake turtle tropical_fish fish blowfish dolphin whale whale2 crocodile leopard tiger2 water_buffalo ox cow2 dromedary_camel camel elephant goat ram sheep racehorse pig2 rat mouse2 rooster turkey dove dog2 poodle cat2 rabbit2 chipmunk feet dragon dragon_face cactus christmas_tree evergreen_tree deciduous_tree palm_tree seedling herb shamrock four_leaf_clover bamboo tanabata_tree leaves fallen_leaf maple_leaf ear_of_rice hibiscus sunflower rose tulip blossom cherry_blossom bouquet mushroom chestnut jack_o_lantern shell spider_web earth_americas earth_africa earth_asia full_moon waning_gibbous_moon last_quarter_moon waning_crescent_moon new_moon waxing_crescent_moon first_quarter_moon waxing_gibbous_moon new_moon_with_face full_moon_with_face first_quarter_moon_with_face last_quarter_moon_with_face sun_with_face crescent_moon star star2 dizzy sparkles comet sunny white_sun_small_cloud partly_sunny white_sun_cloud white_sun_rain_cloud cloud cloud_rain thunder_cloud_rain cloud_lightning zap fire boom snowflake cloud_snow snowman2 snowman wind_blowing_face dash cloud_tornado fog umbrella2 umbrella droplet sweat_drops ocean"
            },
            food_drink: {
                icon: "pizza",
                title: "Food & Drink",
                emoji: "green_apple apple pear tangerine lemon banana watermelon grapes strawberry melon cherries peach pineapple tomato eggplant hot_pepper corn sweet_potato honey_pot bread cheese poultry_leg meat_on_bone fried_shrimp egg hamburger fries hotdog pizza spaghetti taco burrito ramen stew fish_cake sushi bento curry rice_ball rice rice_cracker oden dango shaved_ice ice_cream icecream cake birthday custard candy lollipop chocolate_bar popcorn doughnut cookie beer beers wine_glass cocktail tropical_drink champagne sake tea coffee baby_bottle fork_and_knife fork_knife_plate"
            },
            activity: {
                icon: "basketball",
                title: "Activity",
                emoji: "soccer basketball football baseball tennis volleyball rugby_football 8ball golf golfer ping_pong badminton hockey field_hockey cricket ski skier snowboarder ice_skate bow_and_arrow fishing_pole_and_fish rowboat swimmer surfer bath basketball_player lifter bicyclist mountain_bicyclist horse_racing levitate trophy running_shirt_with_sash medal military_medal reminder_ribbon rosette ticket tickets performing_arts art circus_tent microphone headphones musical_score musical_keyboard saxophone trumpet guitar violin clapper video_game space_invader dart game_die slot_machine bowling"
            },
            travel_places: {
                icon: "rocket",
                title: "Travel & Places",
                emoji: "red_car taxi blue_car bus trolleybus race_car police_car ambulance fire_engine minibus truck articulated_lorry tractor motorcycle bike rotating_light oncoming_police_car oncoming_bus oncoming_automobile oncoming_taxi aerial_tramway mountain_cableway suspension_railway railway_car train monorail bullettrain_side bullettrain_front light_rail mountain_railway steam_locomotive train2 metro tram station helicopter airplane_small airplane airplane_departure airplane_arriving sailboat motorboat speedboat ferry cruise_ship rocket satellite_orbital seat anchor construction fuelpump busstop vertical_traffic_light traffic_light checkered_flag ship ferris_wheel roller_coaster carousel_horse construction_site foggy tokyo_tower factory fountain rice_scene mountain mountain_snow mount_fuji volcano japan camping tent park motorway railway_track sunrise sunrise_over_mountains desert beach island city_sunset city_dusk cityscape night_with_stars bridge_at_night milky_way stars sparkler fireworks rainbow homes european_castle japanese_castle stadium statue_of_liberty house house_with_garden house_abandoned office department_store post_office european_post_office hospital bank hotel convenience_store school love_hotel wedding classical_building church mosque synagogue kaaba shinto_shrine"
            },
            objects: {
                icon: "bulb",
                title: "Objects",
                emoji: "watch iphone calling computer keyboard desktop printer mouse_three_button trackball joystick compression minidisc floppy_disk cd dvd vhs camera camera_with_flash video_camera movie_camera projector film_frames telephone_receiver telephone pager fax tv radio microphone2 level_slider control_knobs stopwatch timer alarm_clock clock hourglass_flowing_sand hourglass satellite battery electric_plug bulb flashlight candle wastebasket oil money_with_wings dollar yen euro pound moneybag credit_card gem scales wrench hammer hammer_pick tools pick nut_and_bolt gear chains gun bomb knife dagger crossed_swords shield smoking skull_crossbones coffin urn amphora crystal_ball prayer_beads barber alembic telescope microscope hole pill syringe thermometer label bookmark toilet shower bathtub key key2 couch sleeping_accommodation bed door bellhop frame_photo map beach_umbrella moyai shopping_bags balloon flags ribbon gift confetti_ball tada dolls wind_chime crossed_flags izakaya_lantern envelope envelope_with_arrow incoming_envelope e-mail love_letter postbox mailbox_closed mailbox mailbox_with_mail mailbox_with_no_mail package postal_horn inbox_tray outbox_tray scroll page_with_curl bookmark_tabs bar_chart chart_with_upwards_trend chart_with_downwards_trend page_facing_up date calendar calendar_spiral card_index card_box ballot_box file_cabinet clipboard notepad_spiral file_folder open_file_folder dividers newspaper2 newspaper notebook closed_book green_book blue_book orange_book notebook_with_decorative_cover ledger books book link paperclip paperclips scissors triangular_ruler straight_ruler pushpin round_pushpin triangular_flag_on_post flag_white flag_black closed_lock_with_key lock unlock lock_with_ink_pen pen_ballpoint pen_fountain black_nib pencil pencil2 crayon paintbrush mag mag_right"
            },
            symbols: {
                icon: "heartpulse",
                title: "Symbols",
                emoji: "heart yellow_heart green_heart blue_heart purple_heart broken_heart heart_exclamation two_hearts revolving_hearts heartbeat heartpulse sparkling_heart cupid gift_heart heart_decoration peace cross star_and_crescent om_symbol wheel_of_dharma star_of_david six_pointed_star menorah yin_yang orthodox_cross place_of_worship ophiuchus aries taurus gemini cancer leo virgo libra scorpius sagittarius capricorn aquarius pisces id atom u7a7a u5272 radioactive biohazard mobile_phone_off vibration_mode u6709 u7121 u7533 u55b6 u6708 eight_pointed_black_star vs accept white_flower ideograph_advantage secret congratulations u5408 u6e80 u7981 a b ab cl o2 sos no_entry name_badge no_entry_sign x o anger hotsprings no_pedestrians do_not_litter no_bicycles non-potable_water underage no_mobile_phones exclamation grey_exclamation question grey_question bangbang interrobang 100 low_brightness high_brightness trident fleur-de-lis part_alternation_mark warning children_crossing beginner recycle u6307 chart sparkle eight_spoked_asterisk negative_squared_cross_mark white_check_mark diamond_shape_with_a_dot_inside cyclone loop globe_with_meridians m atm sa passport_control customs baggage_claim left_luggage wheelchair no_smoking wc parking potable_water mens womens baby_symbol restroom put_litter_in_its_place cinema signal_strength koko ng ok up cool new free zero one two three four five six seven eight nine ten 1234 arrow_forward pause_button play_pause stop_button record_button track_next track_previous fast_forward rewind twisted_rightwards_arrows repeat repeat_one arrow_backward arrow_up_small arrow_down_small arrow_double_up arrow_double_down arrow_right arrow_left arrow_up arrow_down arrow_upper_right arrow_lower_right arrow_lower_left arrow_upper_left arrow_up_down left_right_arrow arrows_counterclockwise arrow_right_hook leftwards_arrow_with_hook arrow_heading_up arrow_heading_down hash asterisk information_source abc abcd capital_abcd symbols musical_note notes wavy_dash curly_loop heavy_check_mark arrows_clockwise heavy_plus_sign heavy_minus_sign heavy_division_sign heavy_multiplication_x heavy_dollar_sign currency_exchange copyright registered tm end back on top soon ballot_box_with_check radio_button white_circle black_circle red_circle large_blue_circle small_orange_diamond small_blue_diamond large_orange_diamond large_blue_diamond small_red_triangle black_small_square white_small_square black_large_square white_large_square small_red_triangle_down black_medium_square white_medium_square black_medium_small_square white_medium_small_square black_square_button white_square_button speaker sound loud_sound mute mega loudspeaker bell no_bell black_joker mahjong spades clubs hearts diamonds flower_playing_cards thought_balloon anger_right speech_balloon clock1 clock2 clock3 clock4 clock5 clock6 clock7 clock8 clock9 clock10 clock11 clock12 clock130 clock230 clock330 clock430 clock530 clock630 clock730 clock830 clock930 clock1030 clock1130 clock1230 eye_in_speech_bubble"
            },
            flags: {
                icon: "flag_gb",
                title: "Flags",
                emoji: "ac af al dz ad ao ai ag ar am aw au at az bs bh bd bb by be bz bj bm bt bo ba bw br bn bg bf bi cv kh cm ca ky cf td flag_cl cn co km cg flag_cd cr hr cu cy cz dk dj dm do ec eg sv gq er ee et fk fo fj fi fr pf ga gm ge de gh gi gr gl gd gu gt gn gw gy ht hn hk hu is in flag_id ir iq ie il it ci jm jp je jo kz ke ki xk kw kg la lv lb ls lr ly li lt lu mo mk mg mw my mv ml mt mh mr mu mx fm md mc mn me ms ma mz mm na nr np nl nc nz ni ne flag_ng nu kp no om pk pw ps pa pg py pe ph pl pt pr qa ro ru rw sh kn lc vc ws sm st flag_sa sn rs sc sl sg sk si sb so za kr es lk sd sr sz se ch sy tw tj tz th tl tg to tt tn tr flag_tm flag_tm ug ua ae gb us vi uy uz vu va ve vn wf eh ye zm zw re ax ta io bq cx cc gg im yt nf pn bl pm gs tk bv hm sj um ic ea cp dg as aq vg ck cw eu gf tf gp mq mp sx ss tc "
            }
        }
    };

    function t(a) {
        return "object" == typeof a
    }

    function u(a) {
        if (a.filters) {
            var b = s.filters;
            c.each(a.filters, function (a, d) {
                return !t(d) || c.isEmptyObject(d) ? void delete b[a] : void c.each(d, function (c, d) {
                    b[a][c] = d
                })
            }), a.filters = b
        }
        return c.extend({}, s, a)
    }

    var v, w;
    b.getSelection && a.createRange ? (v = function (a) {
        var c = b.getSelection().getRangeAt(0), d = c.cloneRange();
        return d.selectNodeContents(a), d.setEnd(c.startContainer, c.startOffset), d.toString().length
    }, w = function (c, d) {
        var e = 0, f = a.createRange();
        f.setStart(c, 0), f.collapse(!0);
        var g = [c], h, i = !1, j = !1;
        while (!j && (h = g.pop()))if (3 == h.nodeType) {
            var k = e + h.length;
            !i && d >= e && k >= d && (f.setStart(h, d - e), f.setEnd(h, d - e), j = !0), e = k
        } else {
            var l = h.childNodes.length;
            while (l--)g.push(h.childNodes[l])
        }
        d = b.getSelection(), d.removeAllRanges(), d.addRange(f)
    }) : a.selection && a.body.createTextRange && (v = function (b) {
        var c = a.selection.createRange(), d = a.body.createTextRange();
        d.moveToElementText(b), d.setEndPoint("EndToStart", c);
        var e = d.text.length;
        return e + c.text.length
    }, w = function (b, c) {
        var d = a.body.createTextRange();
        d.moveToElementText(b), d.collapse(!0), d.moveEnd("character", c), d.moveStart("character", c), d.select()
    });
    var x, y = b.emojioneVersion || "2.1.4", z = "https://cdnjs.cloudflare.com/ajax/libs/emojione/";

    function A() {
        var a = g.cacheBustParam;
        return t(g.jsEscapeMap) ? "?v=1.2.4" === a ? "2.0.0" : "?v=2.0.1" === a ? "2.1.0" : "?v=2.1.1" === a ? "2.1.1" : "?v=2.1.2" === a ? "2.1.2" : "?v=2.1.3" === a ? "2.1.3" : "2.1.4" : "1.5.2"
    }

    function B(a) {
        switch (a) {
            case"1.5.2":
                return 0;
            case"2.0.0":
                return 1;
            case"2.1.0":
            case"2.1.1":
                return 2;
            case"2.1.2":
                return 3;
            case"2.1.3":
            case"2.1.4":
            default:
                return 4
        }
    }

    !g || B(A()) < 2 ? c.getScript(z + y + "/lib/js/emojione.min.js", function () {
        g = b.emojione, y = A(), m = B(y), z += y + "/assets";
        var d = z + "/sprites/emojione.sprites.css";
        a.createStyleSheet ? a.createStyleSheet(d) : c("<link/>", {rel: "stylesheet", href: d}).appendTo("head");
        while (h.length)h.shift().call()
    }) : (y = A(), m = B(y), z += y + "/assets"), i(function () {
        g.imagePathPNG = z + "/png/", x = new RegExp("<object[^>]*>.*?</object>|<span[^>]*>.*?</span>|<(?:object|embed|svg|img|div|span|p|a)[^>]*>|(" + g.unicodeRegexp + ")", "gi")
    });
    function C(a, b) {
        return a.replace(x, function (a) {
            var c = g[0 === m ? "jsecapeMap" : "jsEscapeMap"];
            return "undefined" != typeof a && a in c ? p(b, c[a]) : a
        })
    }

    function D(a, b) {
        return a = a.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#x27;").replace(/`/g, "&#x60;").replace(/(?:\r\n|\r|\n)/g, "\n").replace(/(\n+)/g, "<div>$1</div>").replace(/\n/g, "<br/>").replace(/<br\/><\/div>/g, "</div>"), b.shortnames && (a = g.shortnameToUnicode(a)), C(a, b.emojiTemplate).replace(/\t/g, "&nbsp;&nbsp;&nbsp;&nbsp;").replace(/  /g, "&nbsp;&nbsp;")
    }

    function E(a, b) {
        switch (a = a.replace(/<img[^>]*alt="([^"]+)"[^>]*>/gi, "$1").replace(/\n|\r/g, "").replace(/<br[^>]*>/gi, "\n").replace(/(?:<(?:div|p|ol|ul|li|pre|code|object)[^>]*>)+/gi, "<div>").replace(/(?:<\/(?:div|p|ol|ul|li|pre|code|object)>)+/gi, "</div>").replace(/\n<div><\/div>/gi, "\n").replace(/<div><\/div>\n/gi, "\n").replace(/(?:<div>)+<\/div>/gi, "\n").replace(/([^\n])<\/div><div>/gi, "$1\n").replace(/(?:<\/div>)+/gi, "</div>").replace(/([^\n])<\/div>([^\n])/gi, "$1\n$2").replace(/<\/div>/gi, "").replace(/([^\n])<div>/gi, "$1\n").replace(/\n<div>/gi, "\n").replace(/<div>\n/gi, "\n\n").replace(/<(?:[^>]+)?>/g, "").replace(/&#8291;/g, "").replace(/&nbsp;/g, " ").replace(/&lt;/g, "<").replace(/&gt;/g, ">").replace(/&quot;/g, '"').replace(/&#x27;/g, "'").replace(/&#x60;/g, "`").replace(/&amp;/g, "&"), b.saveEmojisAs) {
            case"image":
                a = C(a, b.emojiTemplate);
                break;
            case"shortname":
                a = g.toShort(a)
        }
        return a
    }

    function F() {
        var a = this, b = a.editor[0].offsetWidth - a.editor[0].clientWidth, c = parseInt(a.button.css("marginRight"));
        c !== b && (a.button.css({marginRight: b}), a.floatingPicker && a.picker.css({right: parseInt(a.picker.css("right")) - c + b}))
    }

    function G() {
        var a = this;
        if (!a.sprite && a.lasyEmoji[0]) {
            var b = a.picker.offset().top, d = b + a.picker.height() + 20;
            a.lasyEmoji.each(function () {
                var a = c(this), e = a.offset().top;
                e > b && d > e && a.attr("src", a.data("src")).removeClass("lazy-emoji")
            }), a.lasyEmoji = a.lasyEmoji.filter(".lazy-emoji")
        }
    }

    function H(a, b) {
        return (b ? "" : ".") + l + (a ? "-" + a : "")
    }

    function I(a) {
        var b = c("<div/>", t(a) ? a : {"class": H(a, !0)});
        return c.each(k.call(arguments).slice(1), function (a, d) {
            c.isFunction(d) && (d = d.call(b)), d && c(d).appendTo(b)
        }), b
    }

    function J(d, e, f) {
        f = u(f), d.sprite = f.sprite && 3 > m, d.inline = null === f.inline ? e.is("INPUT") : f.inline, d.shortnames = f.shortnames, d.saveEmojisAs = f.saveEmojisAs, d.standalone = f.standalone, d.emojiTemplate = '<img alt="{alt}" class="emojione' + (d.sprite ? '-{uni}" src="' + j + '"/>' : 'emoji" src="{img}"/>');
        var h = f.pickerPosition;
        d.floatingPicker = "top" === h || "bottom" === h;
        var i = e.is("TEXTAREA") || e.is("INPUT") ? "val" : "text", k, p, s, x, y, z, A, B, C, J = I({
            "class": l + (d.standalone ? " " + l + "-standalone " : " ") + (e.attr("class") || ""),
            role: "application"
        }, k = d.editor = I("editor").attr({
            contenteditable: !d.standalone,
            placeholder: f.placeholder || e.data("placeholder") || e.attr("placeholder") || "",
            tabindex: 0
        }), p = d.button = I("button", I("button-open"), I("button-close")).attr("title", f.buttonTitle), s = d.picker = I("picker", I("wrapper", y = I("filters"), C = I("scroll-area", A = I("emojis-list"), x = I("tones", function () {
            if (f.tones) {
                this.addClass(H("tones-" + f.tonesStyle, !0));
                for (var a = 0; 5 >= a; a++)this.append(c("<i/>", {
                    "class": "btn-tone btn-tone-" + a + (a ? "" : " active"),
                    "data-skin": a,
                    role: "button"
                }))
            }
        })))).addClass(H("picker-position-" + f.pickerPosition, !0)).addClass(H("filters-position-" + f.filtersPosition, !0)).addClass("hidden"));
        if (c.each(f.attributes, function (a, b) {
                k.attr(a, b)
            }), c.each(f.filters, function (a, b) {
                var e = 0;
                if ("tones" !== a)c("<i/>", {
                    "class": H("filter", !0) + " " + H("filter-" + a, !0),
                    "data-filter": a,
                    title: b.title
                }).wrapInner(q(b.icon, d.sprite ? '<i class="emojione-{uni}"/>' : '<img class="emojioneemoji" src="{img}"/>')).appendTo(y); else {
                    if (!f.tones)return;
                    e = 5
                }
                do {
                    var g = I("category").attr({
                        name: a,
                        "data-tone": e
                    }).appendTo(A), h = b.emoji.replace(/[\s,;]+/g, "|");
                    e > 0 && (g.hide(), h = h.split("|").join("_tone" + e + "|") + "_tone" + e), h = q(h, d.sprite ? '<i class="emojibtn" role="button" data-name="{name}"><i class="emojione-{uni}"></i></i>' : '<i class="emojibtn" role="button" data-name="{name}"><img class="emojioneemoji lazy-emoji" data-src="{img}"/></i>', !0).split("|").join(""), g.html(h), c("<h1/>").text(b.title).prependTo(g)
                } while (--e > 0)
            }), f.filters = null, d.sprite || (d.lasyEmoji = A.find(".lazy-emoji")), z = y.find(H("filter")), z.eq(0).addClass("active"), B = A.find(H("category")), f.container ? c(f.container).wrapInner(J) : J.insertAfter(e), f.hideSource && e.hide(), d.setText(e[i]()), e[i](d.getText()), F.apply(d), d.standalone && !d.getText().length) {
            var K = c(e).data("emoji-placeholder") || f.emojiPlaceholder;
            d.setText(K), k.addClass("has-placeholder")
        }
        o(d, A.find(".emojibtn"), {click: "emojibtn.click"}), o(d, b, {resize: "!resize"}), o(d, x.children(), {click: "tone.click"}), o(d, [s, p], {mousedown: "!mousedown"}, k), o(d, p, {click: "button.click"}), o(d, k, {paste: "!paste"}, k), o(d, k, ["focus", "blur"], function () {
            return d.stayFocused ? !1 : k
        }), o(d, s, {
            mousedown: "picker.mousedown",
            mouseup: "picker.mouseup",
            click: "picker.click",
            keyup: "picker.keyup",
            keydown: "picker.keydown",
            keypress: "picker.keypress"
        }), o(d, k, ["mousedown", "mouseup", "click", "keyup", "keydown", "keypress"]), o(d, s.find(".emojionearea-filter"), {click: "filter.click"});
        var L = !1;
        if (C.on("scroll", function () {
                if (!L && (G.call(d), C.is(":not(.skinnable)"))) {
                    var a = B.eq(0), b = C.offset().top;
                    B.each(function (d, e) {
                        return c(e).offset().top - b >= 10 ? !1 : void(a = c(e))
                    });
                    var e = z.filter('[data-filter="' + a.attr("name") + '"]');
                    e[0] && !e.is(".active") && (z.removeClass("active"), e.addClass("active"))
                }
            }), d.on("@filter.click", function (a) {
                var b = a.is(".active");
                if (C.is(".skinnable")) {
                    if (b)return;
                    x.children().eq(0).click()
                }
                L = !0, b || (z.filter(".active").removeClass("active"), a.addClass("active"));
                var c = B.filter('[name="' + a.data("filter") + '"]').offset().top, e = C.scrollTop(), f = C.offset().top;
                C.stop().animate({scrollTop: c + e - f - 2}, 200, "swing", function () {
                    G.call(d), L = !1
                })
            }).on("@picker.show", G).on("@tone.click", function (a) {
                x.children().removeClass("active");
                var b = a.addClass("active").data("skin");
                b ? (C.addClass("skinnable"), B.hide().filter("[data-tone=" + b + "]").show()) : (C.removeClass("skinnable"), B.hide().filter("[data-tone=0]").show()), G.call(d)
            }).on("@button.click", function (a) {
                a.is(".active") ? d.hidePicker() : d.showPicker()
            }).on("@!paste", function (a) {
                d.stayFocused = !0, r("<span>&#8291;</span>");
                var e = v(a[0]), f = a.scrollTop(), g = c("<div/>", {contenteditable: !0}).css({
                    position: "fixed",
                    left: "-999px",
                    width: "1px",
                    height: "1px",
                    top: "20px",
                    overflow: "hidden"
                }).appendTo(c("BODY")).focus();
                b.setTimeout(function () {
                    var b = "caret-" + (new Date).getTime();
                    a.focus(), w(a[0], e);
                    var h = E(g.html().replace(/\r\n|\n|\r/g, "<br>"), d), i = D(h, d);
                    r(i), g.remove(), r('<i id="' + b + '"></i>'), a.scrollTop(f);
                    var j = c("#" + b), k = j.offset().top - a.offset().top, l = a.height();
                    (f + k >= l || f > k) && a.scrollTop(f + k - 2 * l / 3), j.remove(), d.stayFocused = !1, F.apply(d), n(d, "paste", [a, h, i])
                }, 200)
            }).on("@emojibtn.click", function (a) {
                k.removeClass("has-placeholder"), J.is(".focused") || k.focus(), d.standalone ? (k.html(q(a.data("name"), d.emojiTemplate)), d.trigger("blur")) : (v(k[0]), r(q(a.data("name"), d.emojiTemplate)))
            }).on("@!resize @keyup @emojibtn.click", F).on("@!mousedown", function (a, b) {
                return J.is(".focused") || a.focus(), b.preventDefault(), !1
            }).on("@change", function () {
                var a = d.editor.html().replace(/<\/?(?:div|span|p)[^>]*>/gi, "");
                a.length && !/^<br[^>]*>$/i.test(a) || d.editor.html(d.content = ""), e[i](d.getText())
            }).on("@focus", function () {
                J.addClass("focused")
            }).on("@blur", function () {
                J.removeClass("focused"), f.hidePickerOnBlur && d.hidePicker();
                var a = d.editor.html();
                d.content !== a ? (d.content = a, n(d, "change", [d.editor]), e.blur().trigger("change")) : e.blur()
            }), f.shortcuts && d.on("@keydown", function (a, b) {
                b.ctrlKey || (9 == b.which ? (b.preventDefault(), p.click()) : 27 == b.which && (b.preventDefault(), p.is(".active") && d.hidePicker()))
            }), t(f.events) && !c.isEmptyObject(f.events) && c.each(f.events, function (a, b) {
                d.on(a.replace(/_/g, "."), b)
            }), f.autocomplete) {
            var M = function () {
                var a = {};
                f.shortcuts && (a.onKeydown = function (a, b) {
                    return a.ctrlKey || 13 != a.which ? void 0 : b.KEY_ENTER
                });
                var b = c.map(g.emojioneList, function (a, b) {
                    return f.autocompleteTones ? b : /_tone[12345]/.test(b) ? null : b
                });
                b.sort(), k.textcomplete([{
                    id: l, match: /(:[\-+\w]*)$/, search: function (a, d) {
                        d(c.map(b, function (b) {
                            return 0 === b.indexOf(a) ? b : null
                        }))
                    }, template: function (a) {
                        return q(a, d.emojiTemplate) + " " + a.replace(/:/g, "")
                    }, replace: function (a) {
                        return q(a, d.emojiTemplate)
                    }, cache: !0, maxCount: 15, index: 1
                }], a)
            };
            c.fn.textcomplete ? M() : c.getScript("https://cdn.rawgit.com/yuku-t/jquery-textcomplete/v1.3.4/dist/jquery.textcomplete.js", M)
        }
        d.inline && (J.addClass(H("inline", !0)), d.on("@keydown", function (a, b) {
            13 == b.which && b.preventDefault()
        })), /firefox/i.test(navigator.userAgent) && a.execCommand("enableObjectResizing", !1, !1)
    }

    var K = function (a, b) {
        var c = this;
        e[c.id = ++d] = {}, f[c.id] = {}, i(function () {
            J(c, a, b)
        })
    };

    function L(a, b) {
        b = b.replace(/^@/, "");
        var d = a.id;
        f[d][b] && (c.each(f[d][b], function (d, e) {
            c.each(c.isArray(e[0]) ? e[0] : [e[0]], function (d, f) {
                c(f).on(e[1], function () {
                    var d = k.call(arguments), f = c.isFunction(e[2]) ? e[2].apply(a, [b].concat(d)) : e[2];
                    f && n(a, b, [f].concat(d))
                })
            })
        }), f[d][b] = null)
    }

    K.prototype.on = function (a, b) {
        if (a && c.isFunction(b)) {
            var d = this;
            c.each(a.toLowerCase().split(" "), function (a, c) {
                L(d, c), (e[d.id][c] || (e[d.id][c] = [])).push(b)
            })
        }
        return this
    }, K.prototype.off = function (a, b) {
        if (a) {
            var d = this.id;
            c.each(a.toLowerCase().replace(/_/g, ".").split(" "), function (a, f) {
                e[d][f] && !/^@/.test(f) && (b ? c.each(e[d][f], function (a, c) {
                    c === b && (e[d][f] = e[d][f].splice(a, 1))
                }) : e[d][f] = [])
            })
        }
        return this
    }, K.prototype.trigger = function () {
        var a = k.call(arguments), b = [this].concat(a.slice(0, 1));
        return b.push(a.slice(1)), n.apply(this, b)
    }, K.prototype.setText = function (a) {
        var b = this;
        return i(function () {
            b.editor.html(D(a, b)), b.content = b.editor.html(), n(b, "change", [b.editor]), F.apply(b)
        }), b
    }, K.prototype.getText = function () {
        return E(this.editor.html(), this)
    }, K.prototype.showPicker = function () {
        var a = this;
        return a._sh_timer && b.clearTimeout(a._sh_timer), a.picker.removeClass("hidden"), a._sh_timer = b.setTimeout(function () {
            a.button.addClass("active")
        }, 50), n(a, "picker.show", [a.picker]), a
    }, K.prototype.hidePicker = function () {
        var a = this;
        return a._sh_timer && b.clearTimeout(a._sh_timer), a.button.removeClass("active"), a._sh_timer = b.setTimeout(function () {
            a.picker.addClass("hidden")
        }, 500), n(a, "picker.hide", [a.picker]), a
    }, c.fn.emojioneArea = function (a) {
        return this.each(function () {
            return this.emojioneArea ? this.emojioneArea : (c.data(this, "emojioneArea", this.emojioneArea = new K(c(this), a)), this.emojioneArea)
        })
    }
}(document, window, wjq);
//# sourceMappingURL=emojionearea.min.map

    function PozvonimcomWidgetEvent(type, message, context, exception) {
    if (!PozvonimcomWidgetRootConfig.sendEvents) {
        return true;
    }
    context = context || {};
    if (type == 'ERROR') {
        context.error = {
            columnNumber: exception.columnNumber || null,
            fileName: exception.fileName || null,
            lineNumber: exception.lineNumber || null,
            message: exception.message || null,
            name: exception.name || null,
            stack: exception.stack || null
        };
        if (typeof console != undefined) {
            console.error(exception);
        }
    }

    context.id = PozvonimcomWidgetRootConfig.widget_id;
    context.user_id = PozvonimcomWidgetRootConfig.user_id;
    context.site_id = PozvonimcomWidgetRootConfig.site_id;
    context.location = window.location.toString();
    context.version = '1.0.1';
    context.userAgent = navigator.userAgent;
    wjq.ajax({
        // url: PozvonimcomWidgetRootConfig.apiPath + '/event',
        url: PozvonimcomWidgetRootConfig.apiHiloadPath + '/stats.php',
        data: {type: type, message: message, context: context},
        method: 'POST',
        async: true,
        cache: false,
        timeout: 30000,
        dataType: 'json',
        xhrFields: {withCredentials: true},
        crossDomain: true
    });
}
var PVE = PozvonimcomWidgetEvent;
    function PozvonimcomWidgetPrototype(window, document, wjq) {
        var loStorage;
        var AudioPlayer = function() {
	this.play = function(file) {
		if (typeof Audio !== 'undefined') {
			var audio = new Audio();
            audio.src = opts.cdnPath + file;
            audio.autoplay = true;
		}
	}
	return this;
}
        this.audioPlayer = new AudioPlayer;
        (function ($) {
    $.extend({
        getCookie: function (name, def) {
            var matches = document.cookie.match(new RegExp("(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"));
            return matches ? decodeURIComponent(matches[1]) : def
        },
        setCookie: function (name, value, options) {
            options = options || {};
            if (typeof options.expires === 'number') {
                var days = options.expires, t = options.expires = new Date();
                t.setTime(+t + days * 864e+5);
            }
            return (document.cookie = [
                name, '=', encodeURIComponent(value),
                options.expires ? '; expires=' + options.expires.toUTCString() : '',
                options.path ? '; path=' + options.path : '/',
                options.domain ? '; domain=' + options.domain : '',
                options.secure ? '; secure' : ''
            ].join(''));
        }
    });
})(wjq);
if (true) {
    !function (window, undefined) {

        var utils = {

            isArray: Array.isArray || function (value) {
                return Object.prototype.toString.call(value) === '[object Array]';
            },

            isPlainObj: function (value) {
                return value === Object(value);
            },

            toArray: function (value) {
                return Array.prototype.slice.call(value);
            },

            // Convert arguments to an Array (`utils.toArray`) and prepend `element`.
            prepareArgs: function (args, element) {
                args = utils.toArray(args);
                args.unshift(element);
                return args;
            },

            getObjKeyByValue: function (obj, value) {
                for (var key in obj) {
                    if (obj.hasOwnProperty(key)) {
                        if (obj[key] === value) return key;
                    }
                }
            },

            // Prepares the return value to enable chaining.
            prepareReturn: function (type) {
                return window[utils.getObjKeyByValue(types, type)];
            },

            // Returns fallback if the value is undefined, otherwise value.
            retrieve: function (value, fallback) {
                return value == null ? fallback : value;
            },

            serialize: function (data) {
                return JSON.stringify(data);
            },

            unserialize: function (data) {
                if (data == null) return undefined;
                return JSON.parse(data);
            }

        };

        var _storage = function () {
            return _storage.get.apply(this, arguments);
        };

        var host = {
            storage: function () {
                return storage.get.apply(storage, arguments);
            },
            session: function () {
                return session.get.apply(session, arguments);
            }
        };

        _storage.set = function (type, key, value) {

            if (utils.isPlainObj(key)) {

                for (var k in key) {
                    if (key.hasOwnProperty(k)) type.setItem(k, utils.serialize(key[k]));
                }

            } else type.setItem(key, utils.serialize(value));

            return utils.prepareReturn(type); // to enable chaining

        };

        _storage.invert = function (type, key) {
            return this.set(type, key, !(this.get(type, key)));
        };

        _storage.add = function (type, key, value) {
            return this.set(type, key, this.get(type, key) + parseInt(value, 10));
        };

        _storage.increase = function (type, key, value) {
            return this.add(type, key, utils.retrieve(value, 1));
        };

        _storage.decrease = function (type, key, value) {
            return this.add(type, key, -utils.retrieve(value, 1));
        };

        _storage.concat = function (type, key, string) { // append?
            return this.set(type, key, this.get(type, key) + string);
        };

        _storage.push = function (type, key, value) {

            var args = utils.toArray(arguments),
                arr = this.get(type, key, []);

            args.splice(0, 2);
            arr.push.apply(arr, args);

            return this.set(type, key, arr);

        };

        _storage.extend = function (type, key, k, v) { // variables?

            var value = this.get(type, key, {});

            if (utils.isPlainObj(k)) {

                for (var _k in k) {
                    if (k.hasOwnProperty(_k)) value[_k] = k[_k];
                }

            } else value[k] = v;

            return this.set(type, key, value);

        };

        _storage.remove = function (type, keys) {

            keys = utils.isArray(keys) ? keys : utils.toArray(arguments);

            for (var i = 0, l = keys.length; i < l; i++) {
                delete type[keys[i]];
            }

            return utils.prepareReturn(type);

        };

        _storage.empty = function (type) {

            type.clear();

            return utils.prepareReturn(type);

        };

        _storage.get = function (type, keys, fallback) {

            fallback = fallback || undefined;

            if (utils.isArray(keys)) {
                var result = {};

                for (var i = 0, l = keys.length; i < l; i++) {
                    var key = keys[i];
                    result[key] = this.get(type, key, fallback);
                }

                return result;
            } else return utils.retrieve(utils.unserialize(type.getItem(keys)), fallback);

        };

        _storage.all = function (type) {

            var obj = {};

            for (var i = 0, l = type.length; i < l; i++) {
                var key = type.key(i);
                obj[key] = utils.unserialize(type.getItem(key));
            }

            return obj;
        };

        var methods = 'set invert add increase decrease concat push extend remove empty get all'.split(' '); // Methods of _storage that need to be copied to storage and session.
        
        var types = {};
        try {
            types['storage'] = localStorage;
            types['session'] = sessionStorage;
        } catch (securityError) {
            if (securityError.name == 'SecurityError') {
                console.warn('Cookies .    pozvonim.com   .');
                types['storage'] = null;
                types['session'] = null;                
            } else {
                throw securityError;
            }
        }

        for (var i = 0, l = methods.length; i < l; i++) {

            var method = methods[i];

            for (var name in types) {

                if (!(types.hasOwnProperty(name))) continue;

                var storeType = types[name];
                if (storeType) {                    
                    host[name][method] = function (method, storeType) {
                        return function () {
                            var args = utils.prepareArgs(arguments, storeType);
                            return _storage[method].apply(_storage, args);                            
                        };
                    }(method, storeType);
                } else {
                    host[name][method] = function (method, storeType) {
                        return function () {
                            return null;
                        };
                    }(method, storeType);
                }
            }
        }
        loStorage = {
            storage: host.storage,
            session: host.session
        };
    }(window);
}
        (function ($) {
    var templateSettings = {
        evaluate: /<%([\s\S]+?)%>/g,
        interpolate: /<%=([\s\S]+?)%>/g,
        escape: /<%-([\s\S]+?)%>/g
    };
    var noMatch = /(.)^/;
    var escapes = {"'": "'", '\\': '\\', '\r': 'r', '\n': 'n', '\u2028': 'u2028', '\u2029': 'u2029'};
    var escapeRegExp = /\\|'|\r|\n|\u2028|\u2029/g;
    var escapeChar = function (match) {
        return '\\' + escapes[match];
    };
    $.extend({
        template: function (text, settings, oldSettings) {
            if (!settings && oldSettings) settings = oldSettings;
            settings = $.extend({}, settings, templateSettings);
            var matcher = new RegExp([
                    (settings.escape || noMatch).source,
                    (settings.interpolate || noMatch).source,
                    (settings.evaluate || noMatch).source
                ].join('|') + '|$', 'g');
            var index = 0;
            var source = "__p+='";
            text.replace(matcher, function (match, escape, interpolate, evaluate, offset) {
                source += text.slice(index, offset).replace(escapeRegExp, escapeChar);
                index = offset + match.length;
                if (escape) {
                    source += "'+\n((__t=(" + escape + "))==null?'':_.escape(__t))+\n'";
                } else if (interpolate) {
                    source += "'+\n((__t=(" + interpolate + "))==null?'':__t)+\n'";
                } else if (evaluate) {
                    source += "';\n" + evaluate + "\n__p+='";
                }
                return match;
            });
            source += "';\n";
            if (!settings.variable) source = 'with(obj||{}){\n' + source + '}\n';
            source = "var __t,__p='',__j=Array.prototype.join," +
                "print=function(){__p+=__j.call(arguments,'');};\n" +
                source + 'return __p;\n';
            var render;
            try {
                render = new Function(settings.variable || 'obj', '$', source);
            } catch (e) {
                e.source = source;
                throw e;
            }
            var template = function (data) {
                return render.call(this, data, $);
            };
            var argument = settings.variable || 'obj';
            template.source = 'function(' + argument + '){\n' + source + '}';
            return template;
        }
    });
})(wjq);
        (function ($) {
    $.fn.drags = function (opt) {
        opt = $.extend({}, opt);
        var $window = $(window),
            $drag,
            width,
            height,
            x, y,
            touchpos,
            animated = false,
            timer = false,
            move = function (e) {
                var pageY, pageX;
                if (e.type == 'touchmove') {
                    if (typeof touchpos !== 'undefined') {                        
                        pageX = e.originalEvent.touches[touchpos].pageX;
                        pageY = e.originalEvent.touches[touchpos].pageY;
                    }
                    e.preventDefault();
                } else {
                    pageX = e.pageX;
                    pageY = e.pageY;
                    if (e.buttons == 0) {
                        up.bind(this)(e);
                    }
                }
                if (timer === false) {
                    timer = window.setTimeout(function () {
                        opt.move.apply($drag, [e]);
                        timer = false;
                    }, 100);
                }
                $drag.offset({top: pageY + y - height, left: pageX + x - width});
            },
            down = function (e) {
                var pageY, pageX;
                if (e.type == 'touchstart') {
                    for (var i = 0; i < e.originalEvent.touches.length; i++) {
                        var touch = e.originalEvent.touches[i];
                        touchpos = i;
                        pageX = touch.pageX;
                        pageY = touch.pageY;
                        break;
                    }
                } else {
                    pageX = e.pageX;
                    pageY = e.pageY;
                }
                $drag = $(this).addClass('pozvonim-dragging');

                width = $drag.outerWidth();
                height = $drag.outerHeight();

                y = $drag.offset().top + height - pageY;
                x = $drag.offset().left + width - pageX;

                animated = $drag.hasClass('pozvonim-animated');
                if (animated) {
                    $drag.removeClass('pozvonim-animated');
                }
                opt.start.apply($drag, [e]);

                $window.on('mouseup', up);
                $window.on('touchend', up);
                $window.on('mousemove', move);
                $window.on('touchmove', move);

                if (e.type != 'touchstart') {
                    e.preventDefault();
                }
            },
            up = function (e) {
                $drag.removeClass('pozvonim-dragging');
                if (animated) {
                    $drag.addClass('pozvonim-animated');
                }

                opt.stop.apply($drag, [e]);


                $window.off('mouseup touchend', up);
                $window.off('mousemove touchmove', move);
            };

        return $(this).on('mousedown touchstart', down);

    }
})(wjq);
        (function ($) {
    $.extend({
        Utils: {
            padZero: function (num, size) {
                if (num.toString().length >= size) {
                    return num;
                }
                return ( Math.pow(10, size) + Math.floor(num) ).toString().substring(1);
            },
            regexCheck: function (value, regexList) {
                var result = false,
                    check = function (index, item) {
                        if (value.match(item)) {
                            result = true;
                            return false;
                        }
                    };
                $.each(regexList, check);
                return result;
            },
            regexEscape: function (literal_string) {
                return literal_string.replace(/[-[\]{}()*+!<=:?.\/\\^$|#\s,]/g, '\\$&');
            },
            pluralDigits: function (number, options) {
                var config = [2, 0, 1, 1, 1, 2];
                number = Math.round(number);
                return options[
                    number % 100 > 4 && 20 > number % 100 ?
                        2 :
                        config[5 > number % 10 ? number % 10 : 5]]
            },
            windowSize: function (window, document) {
                var w = window,
                    d = document,
                    e = d.documentElement,
                    g = d.getElementsByTagName('body')[0],
                    x = w.innerWidth || e.clientWidth || g.clientWidth,
                    y = w.innerHeight || e.clientHeight || g.clientHeight;


                return {width: x, height: y};
            },
            fullscreen: function (a) {
                var c = {};
                window.scrollTo(0,0);
                c.elem = a.element, c.currentViewportWidth = window.innerWidth,
                    c.currentViewportHeight = window.innerHeight,
                a.pos && (c.pos = a.pos), c.currentViewportWidth < c.currentViewportHeight ? (c.startElemWidth = c.elem.clientWidth || a.elemWidthPortrait,
                    c.startElemHeight = c.elem.clientHeight || a.elemHeightPortrait, c.totalViewportWidth = a.viewportWidthPortrait,
                a.posPortrait && (c.pos = a.posPortrait)) : (c.startElemWidth = c.elem.clientWidth || a.elemWidthLandscape,
                    c.startElemHeight = c.elem.clientHeight || a.elemHeightLandscape, c.totalViewportWidth = a.viewportWidthLandscape
                    , a.posLandscape && (c.pos = a.posLandscape)), c.scale = c.currentViewportWidth / c.totalViewportWidth,
                    c.resultElemWidth = c.scale * c.startElemWidth,
                    c.resultElemHeight = c.scale * c.startElemHeight, c.positionCorrectionX = (c.resultElemWidth - c.startElemWidth) / 2;
                    c.positionCorrectionY = (c.resultElemHeight - c.startElemHeight) / 2;
               /// if (!scale){
                c.elem.style.cssText += "-moz-transform: scale(" + c.scale + "," + c.scale + ");";
                c.elem.style.cssText += "-ms-transform: scale(" + c.scale + "," + c.scale + ");";
                c.elem.style.cssText += "-webkit-transform: scale(" + c.scale + "," + c.scale + ");";
                c.elem.style.cssText += "-o-transform: scale(" + c.scale + "," + c.scale + ") ;";
                c.elem.style.cssText += "transform: scale(" + c.scale + "," + c.scale + ");";
            ///}
               c.elem.style.cssText += "left: 0px !important;";
               c.elem.style.cssText += "top: 0px !important;";
                c.elem.style.cssText += 'width:' + (window.innerWidth/c.scale) + 'px !important;';
                c.elem.style.cssText += 'height:' + (window.innerHeight/c.scale) + 'px !important; -webkit-font-smoothing: subpixel-antialiased;';
                // console.log(c);

            },
            scale: function (a) {

                var c = {};

                c.elem = a.element, c.currentViewportWidth = window.innerWidth,
                    c.currentViewportHeight = window.innerHeight,
                a.pos && (c.pos = a.pos), c.currentViewportWidth < c.currentViewportHeight ? (c.startElemWidth = (opts.callback.mobile_button_size == 0 ? 120 : 70),
                    c.startElemHeight = (opts.callback.mobile_button_size == 0 ? 120 : 70), c.totalViewportWidth = a.viewportWidthPortrait,
                a.posPortrait && (c.pos = a.posPortrait)) : (c.startElemWidth = (opts.callback.mobile_button_size == 0 ? 120 : 70),
                    c.startElemHeight = (opts.callback.mobile_button_size == 0 ? 120 : 70), c.totalViewportWidth = a.viewportWidthLandscape,
                a.posLandscape && (c.pos = a.posLandscape)), c.scale = c.currentViewportWidth / c.totalViewportWidth,
                    c.resultElemWidth = c.scale * c.startElemWidth,
                    c.resultElemHeight = c.scale * c.startElemHeight,
                    c.positionCorrectionX = (c.resultElemWidth - c.startElemWidth) / 2,
                    c.positionCorrectionY = (c.resultElemHeight - c.startElemHeight) / 2;
                    c.elem.style.cssText += "width:"+c.resultElemWidth+"px;height:"+c.resultElemHeight+"px;";


                void 0 != c.pos.right && (c.elem.style.cssText += "right:" + ((c.pos.right * c.scale + c.positionCorrectionX) + (document.documentElement.clientWidth - (window.pageXOffset + window.innerWidth)))  + "px !important;");
                if(opts.site_id==11408){
                    void 0 != c.pos.bottom && (c.elem.style.cssText += "top:" + ((   (window.pageYOffset + window.innerHeight)) - (c.pos.bottom * c.scale + c.positionCorrectionY + c.resultElemHeight *2)) + "px !important;");
                } else if( opts.site_id==41460){
                    void 0 != c.pos.bottom && (c.elem.style.cssText += "top:" + ((   (window.pageYOffset + window.innerHeight)) - (c.pos.bottom * c.scale + c.positionCorrectionY + c.resultElemHeight)) + "px !important;");
                } else {

                    void 0 != c.pos.bottom && (c.elem.style.cssText += "bottom:" + ((c.pos.bottom * c.scale + c.positionCorrectionY) + (document.documentElement.clientHeight - (window.pageYOffset + window.innerHeight))) + "px !important;");
                }
                void 0 != c.pos.left && (c.elem.style.cssText += "left:" + ((c.pos.left * c.scale + c.positionCorrectionX) + window.pageXOffset) + "px !important;");
                void 0 != c.pos.top && (c.elem.style.cssText += "top:" + ((c.pos.top * c.scale + c.positionCorrectionY) +  window.pageYOffset) + "px !important;");
            }
        }
    });
})(wjq);
        (function ($, undefined) {
    "use strict";
    $.ajaxPrefilter(function (options, origOptions, jqXHR) {
        if (options.iframe) {
            options.originalURL = options.url;
            return "iframe";
        }
    });
    $.ajaxTransport("iframe", function (options, origOptions, jqXHR) {
        var form = null,
            iframe = null,
            name = "iframe-" + $.now(),
            files = $(options.files).filter(":file:enabled"),
            markers = null,
            accepts = null;

        function cleanUp() {
            files.each(function (i, file) {
                var $file = $(file);
                $file.data("clone").replaceWith($file);
            });
            form.remove();
            iframe.one("load", function () {
                iframe.remove();
            });
            iframe.attr("src", "javascript:false;");
        }

        options.dataTypes.shift();
        options.data = origOptions.data;

        if (files.length) {
            form = $("<form enctype='multipart/form-data' method='post'></form>").hide().attr({action: options.originalURL, target: name});
            if (typeof(options.data) === "string" && options.data.length > 0) {
                $.error("data must not be serialized");
            }
            $.each(options.data || {}, function (name, value) {
                if ($.isPlainObject(value)) {
                    name = value.name;
                    value = value.value;
                }
                $("<input type='hidden' />").attr({name: name, value: value}).appendTo(form);
            });
            $("<input type='hidden' value='IFrame' name='X-Requested-With' />").appendTo(form);
            if (options.dataTypes[0] && options.accepts[options.dataTypes[0]]) {
                accepts = options.accepts[options.dataTypes[0]] +
                    (options.dataTypes[0] !== "*" ? ", */*; q=0.01" : "");
            } else {
                accepts = options.accepts["*"];
            }
            $("<input type='hidden' name='X-HTTP-Accept'>").attr("value", accepts).appendTo(form);
            markers = files.after(function (idx) {
                var $this = $(this),
                    $clone = $this.clone().prop("disabled", true);
                $this.data("clone", $clone);
                return $clone;
            }).next();
            files.appendTo(form);

            return {
                send: function (headers, completeCallback) {
                    iframe = $("<iframe src='javascript:false;' name='" + name +
                        "' id='" + name + "' style='display:none'></iframe>");

                    iframe.one("load", function () {
                        iframe.one("load", function () {


                            var type = null,
                                status = 200,
                                statusText = "OK",
                                content = {
                                    html: '',
                                    text: null
                                };

                            cleanUp();
                            completeCallback(status, statusText, content, null);
                        });
                        form[0].submit();
                    });
                    $("body").append(form, iframe);
                },
                abort: function () {
                    if (iframe !== null) {
                        iframe.unbind("load").attr("src", "javascript:false;");
                        cleanUp();
                    }
                }

            };
        }
    });

})(wjq);
        var FeedbackCall = function(config,callId,api,$container,context) {
    this.config = config;
    this.api = api;
    this.callId = callId;
    this.container = $container;    
    this.context = context;
    this.currentQuestion = 0;    
    this.showFeedbackBefore = function() {        
        this.context.activate('feedback-before',true);
    }.bind(this);
    this.showFeedbackAfter = function() {
        this.context.activate('feedback-after',true);
    }.bind(this);
    this.showQuestion = function(no) {
        var question = this.config.questions[no];
        if (question) {
            this.context.activate('feedback-question-' + question.questionId,true);
            self.context.remapTab('pozvonim-element-call','feedback-question-' + question.questionId);
            self.context.remapTab('pozvonim-element-final','feedback-question-' + question.questionId);
        }
    }.bind(this);
    this.showNextQuestion = function() {
        if (this.currentQuestion < this.config.questions.length) {
            this.showQuestion(this.currentQuestion);
            this.currentQuestion++;
        } else {
            this.showFeedbackAfter();
        }
    }.bind(this);
    this.initFeedbackBefore = function() {
        this.container.find(
            '#feedback-before button[type="button"]'
        ).on('click',function(){
            this.showNextQuestion();
        }.bind(this));
        self.context.remapTab('pozvonim-element-call','feedback-before');
        self.context.remapTab('pozvonim-element-final','feedback-before');
    }.bind(this);
    this.initFeedbackAfter = function() {
        this.container.find(
            '#feedback-after button[type="button"]'
        ).on('click',function(){
            self.context.remapTab('pozvonim-element-call',null);
            self.context.remapTab('pozvonim-element-final',null);
            self.context.activate('pozvonim-element-call');
        }.bind(this));
        self.context.remapTab('pozvonim-element-call','feedback-before');
        self.context.remapTab('pozvonim-element-final','feedback-before');
    }.bind(this);
    this.initQuestion = function(question) {
        var $question = this.container.find('#feedback-question-' + question.questionId);
        $question.find('button[type="button"]').on('click',function(){
            this.showNextQuestion();
        }.bind(this));
        if (question.answer_type === 'select') {            
            $question.find('.field__sumo-select').SumoSelect({ forceCustomRendering: true  });
        }
        $question.find('button[type="button"]').on('click',function(question,$question,event) {
            var $form = $question.find('form');
            var data = {
                callId: this.callId
            };
            $form.serializeArray().forEach(function(item){
                if (!data[item.name]) {
                    data[item.name] = [];
                }
                data[item.name].push(item.value);
            });
            this.api.feedback(question.clauseId,question.questionId,data);
        }.bind(this,question,$question));
    }.bind(this);
    this.initQuestions = function() {
        this.config.questions.forEach(function(question){
            this.initQuestion(question);
        }.bind(this));
    }.bind(this);
    this.initQuestions();
    this.initFeedbackBefore();
    this.initFeedbackAfter();
    this.showFeedbackBefore();
    return this;
}
var FeedbackCallManager = function (widget) {
    this.widget = widget;
    this.api = this.widget.api;
    this.feedback = null;
    this.socketConnection = null;
    this.container = this.api.Element.feedback;
    this.activateFeedbackForm = function(feedback,callId) {
        this.container.html($.template(template.feedback)(feedback));
        var defaultContext = this.widget.elWidget.find('.callback__box.callback__box--current');
        this.feedback = new FeedbackCall(feedback,callId,this.api,this.container,this.widget.context);
        this.api.show();
    }.bind(this);
    this.processCall = function (respond, callLog) {
        var isEnabled = false;
        if (callLog.callAction == 'hangup call') {
            if (respond.feedback.enable && callLog.call) {
                if (respond.feedback.communication_time <= callLog.call.time) {
                    if (callLog.call.dispositionA == 'ANSWERED' && callLog.call.dispositionB == 'ANSWERED') {                        
                        isEnabled = true;
                    }
                }
            }
        }   
        if (isEnabled) {                
            this.activateFeedbackForm(respond.feedback,respond.id);
        }
    }.bind(this);
    this.api.on('call.success.respond', function (respond) {
        this.socketConnection = this.api.getWsConnection();
        this.socketConnection.off('notify-call-log');
        this.socketConnection.on('notify-call-log', function (respond, callLog) {
            this.processCall(respond, callLog);
        }.bind(this, respond));
        this.socketConnection.emit('subscribe-call-logs', {
            callId: respond.id,
        });
    }.bind(this));    
    return this;
}

        var template={};template.callback='<!DOCTYPE html> <html lang="ru" class="no-js"> <head>     <meta charset="UTF-8"/>     <meta http-equiv="x-ua-compatible" content="ie=edge">     <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, maximum-scale=1.0"/>     <title></title> </head> <body>  <link href=\'https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=latin,cyrillic-ext\' rel=\'stylesheet\' type=\'text/css\'>  <style type="text/css">      @font-face {     font-family: \'pozvonim 1\';         src: url(\'<%= cdnPath %>/callback/static/fonts/pozvonim-1.eot\');         src: url(\'<%= cdnPath %>/callback/static/fonts/pozvonim-1.eot?#iefix\') format(\'embedded-opentype\'),              url(\'<%= cdnPath %>/callback/static/fonts/pozvonim-1.woff\') format(\'woff\'),              url(\'<%= cdnPath %>/callback/static/fonts/pozvonim-1.ttf\') format(\'truetype\'),              url(\'<%= cdnPath %>/callback/static/fonts/pozvonim-1.svg#pozvonim-1\') format(\'svg\');         font-weight: normal;         font-style: normal;     }     [class*=\'pvm-icon-\']:before{         display: inline-block;         font-family: \'pozvonim 1\';         font-style: normal;         font-weight: normal;         line-height: 1;         -webkit-font-smoothing: antialiased;         -moz-osx-font-smoothing: grayscale;     }     .pvm-icon-close:before{content:\'A\';}     .pvm-icon-upload_question:before{content:\'B\';}     .pvm-icon-upload_file:before{content:\'C\';}     .pvm-icon-upload_button:before{content:\'D\';}      /*! normalize.css v4.1.1 | MIT License | github.com/necolas/normalize.css */     /** 1. Change the default font family in all browsers (opinionated). 2. Correct the line height in all browsers. 3. Prevent adjustments of font size after orientation changes in IE and iOS. */     html {         font-family: sans-serif; /* 1 */         line-height: 1.15; /* 2 */         -ms-text-size-adjust: 100%; /* 3 */         -webkit-text-size-adjust: 100%; /* 3 */         -webkit-font-smoothing: subpixel-antialiased;         font-smoothing: subpixel-antialiased;         -webkit-backface-visibility: hidden;         backface-visibility: hidden;     }      /** Remove the margin in all browsers (opinionated). */     body {         margin: 0;         -webkit-font-smoothing: subpixel-antialiased;         font-smoothing: subpixel-antialiased;         -webkit-backface-visibility: hidden;         backface-visibility: hidden;     }      /* HTML5 display definitions ========================================================================== */     /** Add the correct display in IE 9-. 1. Add the correct display in Edge, IE, and Firefox. 2. Add the correct display in IE. */     article, aside, details, figcaption, figure, footer, header, main, menu, nav, section, summary { /* 1 */         display: block;     }      /** Add the correct display in IE 9-. */     audio, canvas, progress, video {         display: inline-block;     }      /** Add the correct display in iOS 4-7. */     audio:not([controls]) {         display: none;         height: 0;     }      /** Add the correct vertical alignment in Chrome, Firefox, and Opera. */     progress {         vertical-align: baseline;     }      /** Add the correct display in IE 10-. 1. Add the correct display in IE. */     template, [hidden] {         display: none;     }      /* Links ========================================================================== */     /** 1. Remove the gray background on active links in IE 10. 2. Remove gaps in links underline in iOS 8+ and Safari 8+. */     a {         background-color: transparent; /* 1 */         -webkit-text-decoration-skip: objects; /* 2 */     }      /** Remove the outline on focused links when they are also active or hovered in all browsers (opinionated). */     a:active, a:hover {         outline-width: 0;     }      /* Text-level semantics ========================================================================== */     /** 1. Remove the bottom border in Firefox 39-. 2. Add the correct text decoration in Chrome, Edge, IE, Opera, and Safari. */     abbr[title] {         border-bottom: none; /* 1 */         text-decoration: underline; /* 2 */         text-decoration: underline dotted; /* 2 */     }      /** Prevent the duplicate application of `bolder` by the next rule in Safari 6. */     b, strong {         font-weight: inherit;     }      /** Add the correct font weight in Chrome, Edge, and Safari. */     b, strong {         font-weight: bolder;     }      /** Add the correct font style in Android 4.3-. */     dfn {         font-style: italic;     }      /** Correct the font size and margin on `h1` elements within `section` and `article` contexts in Chrome, Firefox, and Safari. */     h1 {         font-size: 2em;         margin: 0.67em 0;     }      /** Add the correct background and color in IE 9-. */     mark {         background-color: #ff0;         color: #000;     }      /** Add the correct font size in all browsers. */     small {         font-size: 80%;     }      /** Prevent `sub` and `sup` elements from affecting the line height in all browsers. */     sub, sup {         font-size: 75%;         line-height: 0;         position: relative;         vertical-align: baseline;     }      sub {         bottom: -0.25em;     }      sup {         top: -0.5em;     }      /* Embedded content ========================================================================== */     /** Remove the border on images inside links in IE 10-. */     img {         border-style: none;     }      /** Hide the overflow in IE. */     svg:not(:root) {         overflow: hidden;     }      /* Grouping content ========================================================================== */     /** 1. Correct the inheritance and scaling of font size in all browsers. 2. Correct the odd `em` font sizing in all browsers. */     code, kbd, pre, samp {         font-family: monospace, monospace; /* 1 */         font-size: 1em; /* 2 */     }      /** Add the correct margin in IE 8. */     figure {         margin: 1em 40px;     }      /** 1. Add the correct box sizing in Firefox. 2. Show the overflow in Edge and IE. */     hr {         -webkit-box-sizing: content-box;         box-sizing: content-box; /* 1 */         height: 0; /* 1 */         overflow: visible; /* 2 */     }      /* Forms ========================================================================== */     /** 1. Change font properties to `inherit` in all browsers (opinionated). 2. Remove the margin in Firefox and Safari. */     button, input, optgroup, select, textarea {         font: inherit; /* 1 */         margin: 0; /* 2 */     }      /** Restore the font weight unset by the previous rule. */     optgroup {         font-weight: bold;     }      /** Show the overflow in IE. 1. Show the overflow in Edge. */     button, input { /* 1 */         overflow: visible;     }      /** Remove the inheritance of text transform in Edge, Firefox, and IE. 1. Remove the inheritance of text transform in Firefox. */     button, select { /* 1 */         text-transform: none;     }      /** 1. Prevent a WebKit bug where (2) destroys native `audio` and `video` controls in Android 4. 2. Correct the inability to style clickable types in iOS and Safari. */     button, html [type="button"], [type="reset"], [type="submit"] {         -webkit-appearance: button; /* 2 */     }      /** Remove the inner border and padding in Firefox. */     button::-moz-focus-inner, [type="button"]::-moz-focus-inner, [type="reset"]::-moz-focus-inner, [type="submit"]::-moz-focus-inner {         border-style: none;         padding: 0;     }      /** Restore the focus styles unset by the previous rule. */     button:-moz-focusring, [type="button"]:-moz-focusring, [type="reset"]:-moz-focusring, [type="submit"]:-moz-focusring {         outline: 1px dotted ButtonText;     }      /** Change the border, margin, and padding in all browsers (opinionated). */     fieldset {         border: 1px solid #c0c0c0;         margin: 0 2px;         padding: 0.35em 0.625em 0.75em;     }      /** 1. Correct the text wrapping in Edge and IE. 2. Correct the color inheritance from `fieldset` elements in IE. 3. Remove the padding so developers are not caught out when they zero out `fieldset` elements in all browsers. */     legend {         -webkit-box-sizing: border-box;         box-sizing: border-box; /* 1 */         color: inherit; /* 2 */         display: table; /* 1 */         max-width: 100%; /* 1 */         padding: 0; /* 3 */         white-space: normal; /* 1 */     }      /** Remove the default vertical scrollbar in IE. */     textarea {         overflow: auto;     }      /** 1. Add the correct box sizing in IE 10-. 2. Remove the padding in IE 10-. */     [type="checkbox"], [type="radio"] {         -webkit-box-sizing: border-box;         box-sizing: border-box; /* 1 */         padding: 0; /* 2 */     }      /** Correct the cursor style of increment and decrement buttons in Chrome. */     [type="number"]::-webkit-inner-spin-button, [type="number"]::-webkit-outer-spin-button {         height: auto;     }      /** 1. Correct the odd appearance in Chrome and Safari. 2. Correct the outline style in Safari. */     [type="search"] {         -webkit-appearance: textfield; /* 1 */         outline-offset: -2px; /* 2 */     }      /** Remove the inner padding and cancel buttons in Chrome and Safari on OS X. */     [type="search"]::-webkit-search-cancel-button, [type="search"]::-webkit-search-decoration {         -webkit-appearance: none;     }      /** Correct the text style of placeholders in Chrome, Edge, and Safari. */     ::-webkit-input-placeholder {         color: inherit;         opacity: 0.54;     }      /** 1. Correct the inability to style clickable types in iOS and Safari. 2. Change font properties to `inherit` in Safari. */     ::-webkit-file-upload-button {         -webkit-appearance: button; /* 1 */         font: inherit; /* 2 */     }      .intl-tel-input {         position: relative;         display: inline-block;     }      .intl-tel-input * {         -webkit-box-sizing: border-box;         box-sizing: border-box;         -moz-box-sizing: border-box;     }      .intl-tel-input .hide {         display: none;     }      .intl-tel-input .v-hide {         visibility: hidden;     }      .intl-tel-input input, .intl-tel-input input[type=text], .intl-tel-input input[type=tel] {         position: relative;         z-index: 0;         margin-top: 0 !important;         margin-bottom: 0 !important;         padding-right: 36px;         margin-right: 0;     }      .intl-tel-input .flag-container {         position: absolute;         top: 0;         bottom: 0;         right: 0;         padding: .0625rem;     }      .intl-tel-input .selected-flag {         z-index: 1;         position: relative;         width: 36px;         height: 100%;         padding: 0 0 0 8px;     }      .intl-tel-input .selected-flag .iti-flag {         position: absolute;         top: 0;         bottom: 0;         margin: auto;     }      .intl-tel-input .selected-flag .iti-arrow {         position: absolute;         top: 50%;         margin-top: -.125rem;         right: .375rem;         width: 0;         height: 0;         border-left: .1875rem solid transparent;         border-right: .1875rem solid transparent;         border-top: .25rem solid #555;     }      .intl-tel-input .selected-flag .iti-arrow.up {         border-top: none;         border-bottom: .25rem solid #555;     }      .intl-tel-input .flag-container.active .country-list {         display: block;     }      .intl-tel-input .country-list {         display: none;         position: absolute;         z-index: 2;         list-style: none;         text-align: left;         padding: 0;         margin: 0 0 0 -1px;         -webkit-box-shadow: 1px 1px 4px rgba(0, 0, 0, 0.2);         box-shadow: 1px 1px 4px rgba(0, 0, 0, 0.2);         background-color: white;         border: 1px solid #CCC;         white-space: nowrap;         max-height: 200px;         overflow-y: scroll;overflow-x: hidden;         background-color: <%= callback.window_style.phone_background %>;         border: 1px solid <%= callback.window_style.phone_border %>;         color: <%= callback.window_style.phone_color %>;     }      .intl-tel-input .country-list.dropup {         bottom: 100%;         margin-bottom: -1px;     }      .intl-tel-input .country-list .flag-box {         display: inline-block;         width: 20px;     }      @media (max-width: 500px) {         .intl-tel-input .country-list {             white-space: normal;         }     }      .intl-tel-input .country-list .divider {         padding-bottom: 5px;         margin-bottom: 5px;         border-bottom: 1px solid #CCC;     }      .intl-tel-input .country-list .country {         padding: 5px 10px;     }      .intl-tel-input .country-list .country .dial-code {         color: #999;     }      .intl-tel-input .country-list .country.highlight {         background-color: rgba(0, 0, 0, 0.05);     }      .intl-tel-input .country-list .flag-box, .intl-tel-input .country-list .country-name, .intl-tel-input .country-list .dial-code {         vertical-align: middle;     }      .intl-tel-input .country-list .flag-box, .intl-tel-input .country-list .country-name {         margin-right: .375rem;     }      .intl-tel-input.allow-dropdown input, .intl-tel-input.allow-dropdown input[type=text], .intl-tel-input.allow-dropdown input[type=tel] {         padding-right: 6px;         padding-left: 3.25rem;         margin-left: 0;     }      .intl-tel-input.allow-dropdown .flag-container {         right: auto;         left: 0;     }      .intl-tel-input.allow-dropdown .selected-flag {         width: 2.875rem;     }      .intl-tel-input.allow-dropdown .flag-container:hover {         cursor: pointer;     }      .intl-tel-input.allow-dropdown .flag-container:hover .selected-flag {         background-color: rgba(0, 0, 0, 0.05);     }      .intl-tel-input.allow-dropdown input[disabled] + .flag-container:hover, .intl-tel-input.allow-dropdown input[readonly] + .flag-container:hover {         cursor: default;     }      .intl-tel-input.allow-dropdown input[disabled] + .flag-container:hover .selected-flag, .intl-tel-input.allow-dropdown input[readonly] + .flag-container:hover .selected-flag {         background-color: transparent;     }      .intl-tel-input.allow-dropdown.separate-dial-code .selected-flag {         background-color: rgba(0, 0, 0, 0.05);         display: table;     }      .intl-tel-input.allow-dropdown.separate-dial-code .selected-dial-code {         display: table-cell;         vertical-align: middle;         padding-left: 28px;     }      .intl-tel-input.allow-dropdown.separate-dial-code.iti-sdc-2 input, .intl-tel-input.allow-dropdown.separate-dial-code.iti-sdc-2 input[type=text], .intl-tel-input.allow-dropdown.separate-dial-code.iti-sdc-2 input[type=tel] {         padding-left: 76px;     }      .intl-tel-input.allow-dropdown.separate-dial-code.iti-sdc-2 .selected-flag {         width: 70px;     }      .intl-tel-input.allow-dropdown.separate-dial-code.iti-sdc-3 input, .intl-tel-input.allow-dropdown.separate-dial-code.iti-sdc-3 input[type=text], .intl-tel-input.allow-dropdown.separate-dial-code.iti-sdc-3 input[type=tel] {         padding-left: 84px;     }      .intl-tel-input.allow-dropdown.separate-dial-code.iti-sdc-3 .selected-flag {         width: 78px;     }      .intl-tel-input.allow-dropdown.separate-dial-code.iti-sdc-4 input, .intl-tel-input.allow-dropdown.separate-dial-code.iti-sdc-4 input[type=text], .intl-tel-input.allow-dropdown.separate-dial-code.iti-sdc-4 input[type=tel] {         padding-left: 92px;     }      .intl-tel-input.allow-dropdown.separate-dial-code.iti-sdc-4 .selected-flag {         width: 86px;     }      .intl-tel-input.allow-dropdown.separate-dial-code.iti-sdc-5 input, .intl-tel-input.allow-dropdown.separate-dial-code.iti-sdc-5 input[type=text], .intl-tel-input.allow-dropdown.separate-dial-code.iti-sdc-5 input[type=tel] {         padding-left: 100px;     }      .intl-tel-input.allow-dropdown.separate-dial-code.iti-sdc-5 .selected-flag {         width: 94px;     }      .intl-tel-input.iti-container {         position: absolute;         top: -1000px;         left: -1000px;         z-index: 1060;         padding: 1px;     }      .intl-tel-input.iti-container:hover {         cursor: pointer;     }      .iti-mobile .intl-tel-input.iti-container {         top: 30px;         bottom: 30px;         left: 30px;         right: 30px;         position: fixed;         z-index: 999999;     }      .iti-mobile .intl-tel-input .country-list {         max-height: 100%;         width: 100%;     }      .iti-mobile .intl-tel-input .country-list .country {         padding: 10px 10px;         line-height: 1.5em;     }      .iti-flag {         width: 20px;     }      .iti-flag.be {         width: 18px;     }      .iti-flag.ch {         width: 15px;     }      .iti-flag.mc {         width: 19px;     }      .iti-flag.ne {         width: 18px;     }      .iti-flag.np {         width: 13px;     }      .iti-flag.va {         width: 15px;     }      @media only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (min--moz-device-pixel-ratio: 2), only screen and (min-device-pixel-ratio: 2), only screen and (min-resolution: 192dpi), only screen and (min-resolution: 2dppx) {         .iti-flag {             background-size: 5630px 15px;         }     }      .iti-flag.ac {         height: 10px;         background-position: 0px 0px;     }      .iti-flag.ad {         height: 14px;         background-position: -22px 0px;     }      .iti-flag.ae {         height: 10px;         background-position: -44px 0px;     }      .iti-flag.af {         height: 14px;         background-position: -66px 0px;     }      .iti-flag.ag {         height: 14px;         background-position: -88px 0px;     }      .iti-flag.ai {         height: 10px;         background-position: -110px 0px;     }      .iti-flag.al {         height: 15px;         background-position: -132px 0px;     }      .iti-flag.am {         height: 10px;         background-position: -154px 0px;     }      .iti-flag.ao {         height: 14px;         background-position: -176px 0px;     }      .iti-flag.aq {         height: 14px;         background-position: -198px 0px;     }      .iti-flag.ar {         height: 13px;         background-position: -220px 0px;     }      .iti-flag.as {         height: 10px;         background-position: -242px 0px;     }      .iti-flag.at {         height: 14px;         background-position: -264px 0px;     }      .iti-flag.au {         height: 10px;         background-position: -286px 0px;     }      .iti-flag.aw {         height: 14px;         background-position: -308px 0px;     }      .iti-flag.ax {         height: 13px;         background-position: -330px 0px;     }      .iti-flag.az {         height: 10px;         background-position: -352px 0px;     }      .iti-flag.ba {         height: 10px;         background-position: -374px 0px;     }      .iti-flag.bb {         height: 14px;         background-position: -396px 0px;     }      .iti-flag.bd {         height: 12px;         background-position: -418px 0px;     }      .iti-flag.be {         height: 15px;         background-position: -440px 0px;     }      .iti-flag.bf {         height: 14px;         background-position: -460px 0px;     }      .iti-flag.bg {         height: 12px;         background-position: -482px 0px;     }      .iti-flag.bh {         height: 12px;         background-position: -504px 0px;     }      .iti-flag.bi {         height: 12px;         background-position: -526px 0px;     }      .iti-flag.bj {         height: 14px;         background-position: -548px 0px;     }      .iti-flag.bl {         height: 14px;         background-position: -570px 0px;     }      .iti-flag.bm {         height: 10px;         background-position: -592px 0px;     }      .iti-flag.bn {         height: 10px;         background-position: -614px 0px;     }      .iti-flag.bo {         height: 14px;         background-position: -636px 0px;     }      .iti-flag.bq {         height: 14px;         background-position: -658px 0px;     }      .iti-flag.br {         height: 14px;         background-position: -680px 0px;     }      .iti-flag.bs {         height: 10px;         background-position: -702px 0px;     }      .iti-flag.bt {         height: 14px;         background-position: -724px 0px;     }      .iti-flag.bv {         height: 15px;         background-position: -746px 0px;     }      .iti-flag.bw {         height: 14px;         background-position: -768px 0px;     }      .iti-flag.by {         height: 10px;         background-position: -790px 0px;     }      .iti-flag.bz {         height: 14px;         background-position: -812px 0px;     }      .iti-flag.ca {         height: 10px;         background-position: -834px 0px;     }      .iti-flag.cc {         height: 10px;         background-position: -856px 0px;     }      .iti-flag.cd {         height: 15px;         background-position: -878px 0px;     }      .iti-flag.cf {         height: 14px;         background-position: -900px 0px;     }      .iti-flag.cg {         height: 14px;         background-position: -922px 0px;     }      .iti-flag.ch {         height: 15px;         background-position: -944px 0px;     }      .iti-flag.ci {         height: 14px;         background-position: -961px 0px;     }      .iti-flag.ck {         height: 10px;         background-position: -983px 0px;     }      .iti-flag.cl {         height: 14px;         background-position: -1005px 0px;     }      .iti-flag.cm {         height: 14px;         background-position: -1027px 0px;     }      .iti-flag.cn {         height: 14px;         background-position: -1049px 0px;     }      .iti-flag.co {         height: 14px;         background-position: -1071px 0px;     }      .iti-flag.cp {         height: 14px;         background-position: -1093px 0px;     }      .iti-flag.cr {         height: 12px;         background-position: -1115px 0px;     }      .iti-flag.cu {         height: 10px;         background-position: -1137px 0px;     }      .iti-flag.cv {         height: 12px;         background-position: -1159px 0px;     }      .iti-flag.cw {         height: 14px;         background-position: -1181px 0px;     }      .iti-flag.cx {         height: 10px;         background-position: -1203px 0px;     }      .iti-flag.cy {         height: 13px;         background-position: -1225px 0px;     }      .iti-flag.cz {         height: 14px;         background-position: -1247px 0px;     }      .iti-flag.de {         height: 12px;         background-position: -1269px 0px;     }      .iti-flag.dg {         height: 10px;         background-position: -1291px 0px;     }      .iti-flag.dj {         height: 14px;         background-position: -1313px 0px;     }      .iti-flag.dk {         height: 15px;         background-position: -1335px 0px;     }      .iti-flag.dm {         height: 10px;         background-position: -1357px 0px;     }      .iti-flag.do {         height: 13px;         background-position: -1379px 0px;     }      .iti-flag.dz {         height: 14px;         background-position: -1401px 0px;     }      .iti-flag.ea {         height: 14px;         background-position: -1423px 0px;     }      .iti-flag.ec {         height: 14px;         background-position: -1445px 0px;     }      .iti-flag.ee {         height: 13px;         background-position: -1467px 0px;     }      .iti-flag.eg {         height: 14px;         background-position: -1489px 0px;     }      .iti-flag.eh {         height: 10px;         background-position: -1511px 0px;     }      .iti-flag.er {         height: 10px;         background-position: -1533px 0px;     }      .iti-flag.es {         height: 14px;         background-position: -1555px 0px;     }      .iti-flag.et {         height: 10px;         background-position: -1577px 0px;     }      .iti-flag.eu {         height: 14px;         background-position: -1599px 0px;     }      .iti-flag.fi {         height: 12px;         background-position: -1621px 0px;     }      .iti-flag.fj {         height: 10px;         background-position: -1643px 0px;     }      .iti-flag.fk {         height: 10px;         background-position: -1665px 0px;     }      .iti-flag.fm {         height: 11px;         background-position: -1687px 0px;     }      .iti-flag.fo {         height: 15px;         background-position: -1709px 0px;     }      .iti-flag.fr {         height: 14px;         background-position: -1731px 0px;     }      .iti-flag.ga {         height: 15px;         background-position: -1753px 0px;     }      .iti-flag.gb {         height: 10px;         background-position: -1775px 0px;     }      .iti-flag.gd {         height: 12px;         background-position: -1797px 0px;     }      .iti-flag.ge {         height: 14px;         background-position: -1819px 0px;     }      .iti-flag.gf {         height: 14px;         background-position: -1841px 0px;     }      .iti-flag.gg {         height: 14px;         background-position: -1863px 0px;     }      .iti-flag.gh {         height: 14px;         background-position: -1885px 0px;     }      .iti-flag.gi {         height: 10px;         background-position: -1907px 0px;     }      .iti-flag.gl {         height: 14px;         background-position: -1929px 0px;     }      .iti-flag.gm {         height: 14px;         background-position: -1951px 0px;     }      .iti-flag.gn {         height: 14px;         background-position: -1973px 0px;     }      .iti-flag.gp {         height: 14px;         background-position: -1995px 0px;     }      .iti-flag.gq {         height: 14px;         background-position: -2017px 0px;     }      .iti-flag.gr {         height: 14px;         background-position: -2039px 0px;     }      .iti-flag.gs {         height: 10px;         background-position: -2061px 0px;     }      .iti-flag.gt {         height: 13px;         background-position: -2083px 0px;     }      .iti-flag.gu {         height: 11px;         background-position: -2105px 0px;     }      .iti-flag.gw {         height: 10px;         background-position: -2127px 0px;     }      .iti-flag.gy {         height: 12px;         background-position: -2149px 0px;     }      .iti-flag.hk {         height: 14px;         background-position: -2171px 0px;     }      .iti-flag.hm {         height: 10px;         background-position: -2193px 0px;     }      .iti-flag.hn {         height: 10px;         background-position: -2215px 0px;     }      .iti-flag.hr {         height: 10px;         background-position: -2237px 0px;     }      .iti-flag.ht {         height: 12px;         background-position: -2259px 0px;     }      .iti-flag.hu {         height: 10px;         background-position: -2281px 0px;     }      .iti-flag.ic {         height: 14px;         background-position: -2303px 0px;     }      .iti-flag.id {         height: 14px;         background-position: -2325px 0px;     }      .iti-flag.ie {         height: 10px;         background-position: -2347px 0px;     }      .iti-flag.il {         height: 15px;         background-position: -2369px 0px;     }      .iti-flag.im {         height: 10px;         background-position: -2391px 0px;     }      .iti-flag.in {         height: 14px;         background-position: -2413px 0px;     }      .iti-flag.io {         height: 10px;         background-position: -2435px 0px;     }      .iti-flag.iq {         height: 14px;         background-position: -2457px 0px;     }      .iti-flag.ir {         height: 12px;         background-position: -2479px 0px;     }      .iti-flag.is {         height: 15px;         background-position: -2501px 0px;     }      .iti-flag.it {         height: 14px;         background-position: -2523px 0px;     }      .iti-flag.je {         height: 12px;         background-position: -2545px 0px;     }      .iti-flag.jm {         height: 10px;         background-position: -2567px 0px;     }      .iti-flag.jo {         height: 10px;         background-position: -2589px 0px;     }      .iti-flag.jp {         height: 14px;         background-position: -2611px 0px;     }      .iti-flag.ke {         height: 14px;         background-position: -2633px 0px;     }      .iti-flag.kg {         height: 12px;         background-position: -2655px 0px;     }      .iti-flag.kh {         height: 13px;         background-position: -2677px 0px;     }      .iti-flag.ki {         height: 10px;         background-position: -2699px 0px;     }      .iti-flag.km {         height: 12px;         background-position: -2721px 0px;     }      .iti-flag.kn {         height: 14px;         background-position: -2743px 0px;     }      .iti-flag.kp {         height: 10px;         background-position: -2765px 0px;     }      .iti-flag.kr {         height: 14px;         background-position: -2787px 0px;     }      .iti-flag.kw {         height: 10px;         background-position: -2809px 0px;     }      .iti-flag.ky {         height: 10px;         background-position: -2831px 0px;     }      .iti-flag.kz {         height: 10px;         background-position: -2853px 0px;     }      .iti-flag.la {         height: 14px;         background-position: -2875px 0px;     }      .iti-flag.lb {         height: 14px;         background-position: -2897px 0px;     }      .iti-flag.lc {         height: 10px;         background-position: -2919px 0px;     }      .iti-flag.li {         height: 12px;         background-position: -2941px 0px;     }      .iti-flag.lk {         height: 10px;         background-position: -2963px 0px;     }      .iti-flag.lr {         height: 11px;         background-position: -2985px 0px;     }      .iti-flag.ls {         height: 14px;         background-position: -3007px 0px;     }      .iti-flag.lt {         height: 12px;         background-position: -3029px 0px;     }      .iti-flag.lu {         height: 12px;         background-position: -3051px 0px;     }      .iti-flag.lv {         height: 10px;         background-position: -3073px 0px;     }      .iti-flag.ly {         height: 10px;         background-position: -3095px 0px;     }      .iti-flag.ma {         height: 14px;         background-position: -3117px 0px;     }      .iti-flag.mc {         height: 15px;         background-position: -3139px 0px;     }      .iti-flag.md {         height: 10px;         background-position: -3160px 0px;     }      .iti-flag.me {         height: 10px;         background-position: -3182px 0px;     }      .iti-flag.mf {         height: 14px;         background-position: -3204px 0px;     }      .iti-flag.mg {         height: 14px;         background-position: -3226px 0px;     }      .iti-flag.mh {         height: 11px;         background-position: -3248px 0px;     }      .iti-flag.mk {         height: 10px;         background-position: -3270px 0px;     }      .iti-flag.ml {         height: 14px;         background-position: -3292px 0px;     }      .iti-flag.mm {         height: 14px;         background-position: -3314px 0px;     }      .iti-flag.mn {         height: 10px;         background-position: -3336px 0px;     }      .iti-flag.mo {         height: 14px;         background-position: -3358px 0px;     }      .iti-flag.mp {         height: 10px;         background-position: -3380px 0px;     }      .iti-flag.mq {         height: 14px;         background-position: -3402px 0px;     }      .iti-flag.mr {         height: 14px;         background-position: -3424px 0px;     }      .iti-flag.ms {         height: 10px;         background-position: -3446px 0px;     }      .iti-flag.mt {         height: 14px;         background-position: -3468px 0px;     }      .iti-flag.mu {         height: 14px;         background-position: -3490px 0px;     }      .iti-flag.mv {         height: 14px;         background-position: -3512px 0px;     }      .iti-flag.mw {         height: 14px;         background-position: -3534px 0px;     }      .iti-flag.mx {         height: 12px;         background-position: -3556px 0px;     }      .iti-flag.my {         height: 10px;         background-position: -3578px 0px;     }      .iti-flag.mz {         height: 14px;         background-position: -3600px 0px;     }      .iti-flag.na {         height: 14px;         background-position: -3622px 0px;     }      .iti-flag.nc {         height: 10px;         background-position: -3644px 0px;     }      .iti-flag.ne {         height: 15px;         background-position: -3666px 0px;     }      .iti-flag.nf {         height: 10px;         background-position: -3686px 0px;     }      .iti-flag.ng {         height: 10px;         background-position: -3708px 0px;     }      .iti-flag.ni {         height: 12px;         background-position: -3730px 0px;     }      .iti-flag.nl {         height: 14px;         background-position: -3752px 0px;     }      .iti-flag.no {         height: 15px;         background-position: -3774px 0px;     }      .iti-flag.np {         height: 15px;         background-position: -3796px 0px;     }      .iti-flag.nr {         height: 10px;         background-position: -3811px 0px;     }      .iti-flag.nu {         height: 10px;         background-position: -3833px 0px;     }      .iti-flag.nz {         height: 10px;         background-position: -3855px 0px;     }      .iti-flag.om {         height: 10px;         background-position: -3877px 0px;     }      .iti-flag.pa {         height: 14px;         background-position: -3899px 0px;     }      .iti-flag.pe {         height: 14px;         background-position: -3921px 0px;     }      .iti-flag.pf {         height: 14px;         background-position: -3943px 0px;     }      .iti-flag.pg {         height: 15px;         background-position: -3965px 0px;     }      .iti-flag.ph {         height: 10px;         background-position: -3987px 0px;     }      .iti-flag.pk {         height: 14px;         background-position: -4009px 0px;     }      .iti-flag.pl {         height: 13px;         background-position: -4031px 0px;     }      .iti-flag.pm {         height: 14px;         background-position: -4053px 0px;     }      .iti-flag.pn {         height: 10px;         background-position: -4075px 0px;     }      .iti-flag.pr {         height: 14px;         background-position: -4097px 0px;     }      .iti-flag.ps {         height: 10px;         background-position: -4119px 0px;     }      .iti-flag.pt {         height: 14px;         background-position: -4141px 0px;     }      .iti-flag.pw {         height: 13px;         background-position: -4163px 0px;     }      .iti-flag.py {         height: 11px;         background-position: -4185px 0px;     }      .iti-flag.qa {         height: 8px;         background-position: -4207px 0px;     }      .iti-flag.re {         height: 14px;         background-position: -4229px 0px;     }      .iti-flag.ro {         height: 14px;         background-position: -4251px 0px;     }      .iti-flag.rs {         height: 14px;         background-position: -4273px 0px;     }      .iti-flag.ru {         height: 14px;         background-position: -4295px 0px;     }      .iti-flag.rw {         height: 14px;         background-position: -4317px 0px;     }      .iti-flag.sa {         height: 14px;         background-position: -4339px 0px;     }      .iti-flag.sb {         height: 10px;         background-position: -4361px 0px;     }      .iti-flag.sc {         height: 10px;         background-position: -4383px 0px;     }      .iti-flag.sd {         height: 10px;         background-position: -4405px 0px;     }      .iti-flag.se {         height: 13px;         background-position: -4427px 0px;     }      .iti-flag.sg {         height: 14px;         background-position: -4449px 0px;     }      .iti-flag.sh {         height: 10px;         background-position: -4471px 0px;     }      .iti-flag.si {         height: 10px;         background-position: -4493px 0px;     }      .iti-flag.sj {         height: 15px;         background-position: -4515px 0px;     }      .iti-flag.sk {         height: 14px;         background-position: -4537px 0px;     }      .iti-flag.sl {         height: 14px;         background-position: -4559px 0px;     }      .iti-flag.sm {         height: 15px;         background-position: -4581px 0px;     }      .iti-flag.sn {         height: 14px;         background-position: -4603px 0px;     }      .iti-flag.so {         height: 14px;         background-position: -4625px 0px;     }      .iti-flag.sr {         height: 14px;         background-position: -4647px 0px;     }      .iti-flag.ss {         height: 10px;         background-position: -4669px 0px;     }      .iti-flag.st {         height: 10px;         background-position: -4691px 0px;     }      .iti-flag.sv {         height: 12px;         background-position: -4713px 0px;     }      .iti-flag.sx {         height: 14px;         background-position: -4735px 0px;     }      .iti-flag.sy {         height: 14px;         background-position: -4757px 0px;     }      .iti-flag.sz {         height: 14px;         background-position: -4779px 0px;     }      .iti-flag.ta {         height: 10px;         background-position: -4801px 0px;     }      .iti-flag.tc {         height: 10px;         background-position: -4823px 0px;     }      .iti-flag.td {         height: 14px;         background-position: -4845px 0px;     }      .iti-flag.tf {         height: 14px;         background-position: -4867px 0px;     }      .iti-flag.tg {         height: 13px;         background-position: -4889px 0px;     }      .iti-flag.th {         height: 14px;         background-position: -4911px 0px;     }      .iti-flag.tj {         height: 10px;         background-position: -4933px 0px;     }      .iti-flag.tk {         height: 10px;         background-position: -4955px 0px;     }      .iti-flag.tl {         height: 10px;         background-position: -4977px 0px;     }      .iti-flag.tm {         height: 14px;         background-position: -4999px 0px;     }      .iti-flag.tn {         height: 14px;         background-position: -5021px 0px;     }      .iti-flag.to {         height: 10px;         background-position: -5043px 0px;     }      .iti-flag.tr {         height: 14px;         background-position: -5065px 0px;     }      .iti-flag.tt {         height: 12px;         background-position: -5087px 0px;     }      .iti-flag.tv {         height: 10px;         background-position: -5109px 0px;     }      .iti-flag.tw {         height: 14px;         background-position: -5131px 0px;     }      .iti-flag.tz {         height: 14px;         background-position: -5153px 0px;     }      .iti-flag.ua {         height: 14px;         background-position: -5175px 0px;     }      .iti-flag.ug {         height: 14px;         background-position: -5197px 0px;     }      .iti-flag.um {         height: 11px;         background-position: -5219px 0px;     }      .iti-flag.us {         height: 11px;         background-position: -5241px 0px;     }      .iti-flag.uy {         height: 14px;         background-position: -5263px 0px;     }      .iti-flag.uz {         height: 10px;         background-position: -5285px 0px;     }      .iti-flag.va {         height: 15px;         background-position: -5307px 0px;     }      .iti-flag.vc {         height: 14px;         background-position: -5324px 0px;     }      .iti-flag.ve {         height: 14px;         background-position: -5346px 0px;     }      .iti-flag.vg {         height: 10px;         background-position: -5368px 0px;     }      .iti-flag.vi {         height: 14px;         background-position: -5390px 0px;     }      .iti-flag.vn {         height: 14px;         background-position: -5412px 0px;     }      .iti-flag.vu {         height: 12px;         background-position: -5434px 0px;     }      .iti-flag.wf {         height: 14px;         background-position: -5456px 0px;     }      .iti-flag.ws {         height: 10px;         background-position: -5478px 0px;     }      .iti-flag.xk {         height: 15px;         background-position: -5500px 0px;     }      .iti-flag.ye {         height: 14px;         background-position: -5522px 0px;     }      .iti-flag.yt {         height: 14px;         background-position: -5544px 0px;     }      .iti-flag.za {         height: 14px;         background-position: -5566px 0px;     }      .iti-flag.zm {         height: 14px;         background-position: -5588px 0px;     }      .iti-flag.zw {         height: 10px;         background-position: -5610px 0px;     }      .iti-flag {         width: 20px;         height: 15px;         -webkit-box-shadow: 0px 0px 1px 0px #888;         box-shadow: 0px 0px 1px 0px #888;         background-image: url("<%= cdnPath %>/callback/static/img/flags.png");         background-repeat: no-repeat;         background-color: #DBDBDB;         background-position: 20px 0;     }      @media only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (min--moz-device-pixel-ratio: 2), only screen and (min-device-pixel-ratio: 2), only screen and (min-resolution: 192dpi), only screen and (min-resolution: 2dppx) {         .iti-flag {             background-image: url("<%= cdnPath %>/callback/static/img/flags@2x.png");         }     }      .iti-flag.np {         background-color: transparent;     }      .SumoSelect p {         margin: 0;     }      .SelectBox {         padding: .3125rem .9375rem;         cursor: pointer;     }      .sumoStopScroll {         overflow: hidden;     }      /* Filtering style */     .SumoSelect .hidden {         display: none;     }      .SumoSelect .search-txt {         display: none;         outline: none;     }      .SumoSelect .no-match {         display: none;         padding: .375rem;     }      .SumoSelect.open .search-txt {         display: inline-block;         position: absolute;         top: 0;         left: 0;         width: 100%;         margin: 0;         padding: .3125rem .5rem;         border: none;         -webkit-box-sizing: border-box;         box-sizing: border-box;         -webkit-border-radius: .3125rem;         border-radius: .3125rem;     }      .SumoSelect.open > .search > span, .SumoSelect.open > .search > label {         visibility: hidden;     }      /*this is applied on that hidden select. DO NOT USE display:none; or visiblity:hidden; and Do not override any of these properties. */     .SelectClass, .SumoUnder {         position: absolute;         top: 0;         left: 0;         right: 0;         height: 100%;         width: 100%;         border: none;         -webkit-box-sizing: border-box;         box-sizing: border-box;         -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";         filter: alpha(opacity=0);         -moz-opacity: 0;         -khtml-opacity: 0;         opacity: 0;background-color: <%= callback.window_style.phone_background %>;         border: 1px solid <%= callback.window_style.phone_border %>;         color: <%= callback.window_style.phone_color %>;     }      .SelectClass {         z-index: 1;     }      .SumoSelect > .optWrapper > .options li.opt label, .SumoSelect > .CaptionCont, .SumoSelect .select-all > label {         -ms-user-select: none;         user-select: none;         -o-user-select: none;         -moz-user-select: none;         -khtml-user-select: none;         -webkit-user-select: none;         display: block;     }     .SumoSelect {         display: inline-block;         position: relative;         outline: none;         background-color: <%= callback.window_style.phone_background %>;         border: 1px solid <%= callback.window_style.phone_border %>;         color: <%= callback.window_style.phone_color %>;     }      .SumoSelect > .CaptionCont {         position: relative;         border: .0625rem solid #d4d6d9;         background-color: #fff;         height: 100%;         -webkit-border-radius: .1875rem;         border-radius: .1875rem;         margin: 0;         cursor: pointer;         -webkit-box-sizing: border-box;         box-sizing: border-box;         background-color: <%= callback.window_style.phone_background %>;         border: 1px solid <%= callback.window_style.phone_border %>;         color: <%= callback.window_style.phone_color %>;     }      .SumoSelect > .CaptionCont:after {         content: \'\';         width: .0625rem;         height: 100%;         display: inline-block;         vertical-align: middle;     }      .SumoSelect > .CaptionCont > span {         display: block;         text-overflow: ellipsis;         white-space: nowrap;         overflow: hidden;         cursor: default;         font-size: .875rem;         cursor: pointer;         display: inline-block;         vertical-align: middle;         width: 96%;     }      /*placeholder style*/     .SumoSelect > .CaptionCont > span.placeholder {         color: #ccc;         font-style: italic;     }      .SumoSelect > .CaptionCont > label {         position: absolute;         top: 0;         right: 0;         bottom: 0;         width: 1.875rem;         cursor: pointer;     }      .SumoSelect > .CaptionCont > label > i {         position: absolute;         cursor: pointer;         top: 50%;         margin-top: -.125rem;         right: .625rem;         width: 0;         height: 0;         border-left: .1875rem solid transparent;         border-right: .1875rem solid transparent;         border-top: .25rem solid #999999;     }      .SumoSelect > .optWrapper {         display: none;         z-index: 1000;         top: 1.875rem;         width: 100%;         position: absolute;         left: 0;         -webkit-box-sizing: border-box;         box-sizing: border-box;         background: #fff;         border: .0625rem solid #ddd;         -webkit-box-shadow: 0.125rem 0.1875rem 0.1875rem rgba(0, 0, 0, 0.11);         box-shadow: 0.125rem 0.1875rem 0.1875rem rgba(0, 0, 0, 0.11);         -webkit-border-radius: .1875rem;         border-radius: .1875rem;         overflow: hidden;         background-color: <%= callback.window_style.phone_background %>;         border: 1px solid <%= callback.window_style.phone_border %>;         color: <%= callback.window_style.phone_color %>;     }      .SumoSelect.open > .optWrapper {         top: 3.4375rem;         display: block;     }      .SumoSelect.open > .optWrapper.up {         top: auto;         bottom: 100%;         margin-bottom: .3125rem;     }      .SumoSelect > .optWrapper ul {         list-style: none;         display: block;         padding: 0;         margin: 0;         overflow: auto;     }      .SumoSelect > .optWrapper > .options {         -webkit-border-radius: .125rem;         border-radius: .125rem;         position: relative; /*Set the height of pop up here (only for desktop mode)*/         max-height: 9.375rem; /*height*/     }      .SumoSelect > .optWrapper > .options li.group.disabled > label {         opacity: 0.5;     }      .SumoSelect > .optWrapper > .options li ul li.opt {         padding-left: 1.375rem;     }      .SumoSelect > .optWrapper.multiple > .options li ul li.opt {         padding-left: 3.125rem;     }      .SumoSelect > .optWrapper.isFloating > .options {         max-height: 100%;         -webkit-box-shadow: 0 0 6.25rem #595959;         box-shadow: 0 0 6.25rem #595959;     }      .SumoSelect > .optWrapper > .options li.opt {         padding: .4375rem .9375rem;         position: relative;         cursor: pointer;display:block;     }      .SumoSelect > .optWrapper > .options > li.opt:first-child {         -webkit-border-radius: .125rem .125rem 0 0;         border-radius: .125rem .125rem 0 0;     }      .SumoSelect > .optWrapper > .options > li.opt:last-child {         -webkit-border-radius: 0 0 .125rem .125rem;         border-radius: 0 0 .125rem .125rem;         border-bottom: none;     }      .SumoSelect > .optWrapper > .options li.opt:hover {         background-color: #E4E4E4;         color:black;     }      .SumoSelect > .optWrapper > .options li.opt.sel {         background-color: #a1c0e4;         border-bottom: .0625rem solid #a1c0e4;     }      .SumoSelect > .optWrapper > .options li label {         text-overflow: ellipsis;         white-space: nowrap;         overflow: hidden;         display: block;         cursor: pointer;     }      .SumoSelect > .optWrapper > .options li span {         display: none;     }      .SumoSelect > .optWrapper > .options li.group > label {         cursor: default;         padding: .5rem .375rem;         font-weight: bold;     }      /*Floating styles*/     .SumoSelect > .optWrapper.isFloating {         position: fixed;         top: 0;         left: 0;         right: 0;         width: 90%;         bottom: 0;         margin: auto;         max-height: 90%;     }      /*disabled state*/     .SumoSelect > .optWrapper > .options li.opt.disabled {         background-color: inherit;         pointer-events: none;     }      .SumoSelect > .optWrapper > .options li.opt.disabled * {         -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=50)"; /* IE 5-7 */         filter: alpha(opacity=50); /* Netscape */         -moz-opacity: 0.5; /* Safari 1.x */         -khtml-opacity: 0.5; /* Good browsers */         opacity: 0.5;     }      /*styling for multiple select*/     .SumoSelect > .optWrapper.multiple > .options li.opt {         padding-left: 2.1875rem;         cursor: pointer;     }      .SumoSelect > .optWrapper.multiple > .options li.opt span, .SumoSelect .select-all > span {         position: absolute;         display: block;         width: 1.875rem;         top: 0;         bottom: 0;         margin-left: -2.1875rem;     }      .SumoSelect > .optWrapper.multiple > .options li.opt span i, .SumoSelect .select-all > span i {         position: absolute;         margin: auto;         left: 0;         right: 0;         top: 0;         bottom: 0;         width: .875rem;         height: .875rem;         border: .0625rem solid #AEAEAE;         -webkit-border-radius: .125rem;         border-radius: .125rem;         -webkit-box-shadow: inset 0 0.0625rem 0.1875rem rgba(0, 0, 0, 0.15);         box-shadow: inset 0 0.0625rem 0.1875rem rgba(0, 0, 0, 0.15);         background-color: #fff;     }      .SumoSelect > .optWrapper > .MultiControls {         display: none;         border-top: .0625rem solid #ddd;         background-color: #fff;         -webkit-box-shadow: 0 0 0.125rem rgba(0, 0, 0, 0.13);         box-shadow: 0 0 0.125rem rgba(0, 0, 0, 0.13);         -webkit-border-radius: 0 0 .1875rem .1875rem;         border-radius: 0 0 .1875rem .1875rem;     }      .SumoSelect > .optWrapper.multiple.isFloating > .MultiControls {         display: block;         margin-top: .3125rem;         position: absolute;         bottom: 0;         width: 100%;     }      .SumoSelect > .optWrapper.multiple.okCancelInMulti > .MultiControls {         display: block;     }      .SumoSelect > .optWrapper.multiple.okCancelInMulti > .MultiControls > p {         padding: .375rem;     }      .SumoSelect > .optWrapper.multiple > .MultiControls > p {         display: inline-block;         cursor: pointer;         padding: .75rem;         width: 50%;         -webkit-box-sizing: border-box;         box-sizing: border-box;         text-align: center;     }      .SumoSelect > .optWrapper.multiple > .MultiControls > p:hover {         background-color: #f1f1f1;     }      .SumoSelect > .optWrapper.multiple > .MultiControls > p.btnOk {         border-right: .0625rem solid #DBDBDB;         -webkit-border-radius: 0 0 0 .1875rem;         border-radius: 0 0 0 .1875rem;     }      .SumoSelect > .optWrapper.multiple > .MultiControls > p.btnCancel {         -webkit-border-radius: 0 0 .1875rem 0;         border-radius: 0 0 .1875rem 0;     }      /*styling for select on popup mode*/     .SumoSelect > .optWrapper.isFloating > .options li.opt {         padding: .75rem .375rem;     }      /*styling for only multiple select on popup mode*/     .SumoSelect > .optWrapper.multiple.isFloating > .options li.opt {         padding-left: 2.1875rem;     }      .SumoSelect > .optWrapper.multiple.isFloating {         padding-bottom: 2.6875rem;     }      .SumoSelect > .optWrapper.multiple > .options li.opt.selected span i, .SumoSelect .select-all.selected > span i, .SumoSelect .select-all.partial > span i {         background-color: #11a911;         -webkit-box-shadow: none;         box-shadow: none;         border-color: transparent;         background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAGCAYAAAD+Bd/7AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNXG14zYAAABMSURBVAiZfc0xDkAAFIPhd2Kr1WRjcAExuIgzGUTIZ/AkImjSofnbNBAfHvzAHjOKNzhiQ42IDFXCDivaaxAJd0xYshT3QqBxqnxeHvhunpu23xnmAAAAAElFTkSuQmCC");         background-repeat: no-repeat;         background-position: center center;     }      /*disabled state*/     .SumoSelect.disabled {         opacity: 0.7;         cursor: not-allowed;     }      .SumoSelect.disabled > .CaptionCont {         border-color: #ccc;         -webkit-box-shadow: none;         box-shadow: none;     }      /**Select all button**/     .SumoSelect .select-all {         -webkit-border-radius: .1875rem .1875rem 0 0;         border-radius: .1875rem .1875rem 0 0;         position: relative;         border-bottom: .0625rem solid #ddd;         background-color: #fff;         padding: .5rem 0 .1875rem 2.1875rem;         height: 1.25rem;         cursor: pointer;     }      .SumoSelect .select-all > label, .SumoSelect .select-all > span i {         cursor: pointer;     }      .SumoSelect .select-all.partial > span i {         background-color: #ccc;     }      /*styling for optgroups*/     .SumoSelect > .optWrapper > .options li.optGroup {         padding-left: .3125rem;         text-decoration: underline;     }      /* -------- */     /* Css demo */     /* -------- */     body {         font-family: \'Arial\', sans-serif;         margin: 0;         zoom:1;     }      li {         list-style: none;         display: -moz-inline-stack;         zoom: 1;         *display: inline;     }      li:not(:first-child) {         padding-left: 1.25rem;     }      a {         color: rgba(51, 51, 51, 0.5);     }      .section {         padding: 1.25rem;         font-size: 0;     }      .wrap {         margin-left: -30px;         margin-right: -30px;     }      .box {         height: 300px;         width: 33.333%;         display: -moz-inline-stack;         display: inline-block;         zoom: 1;         *display: inline;         -webkit-box-sizing: border-box;         box-sizing: border-box;         padding-left: 1.875rem;         padding-right: 1.875rem;     }      .box > div {         background-color: #688bee;         height: 100%;         width: 100%;     }      .demoWork {         position: fixed;         font-size: 1rem;         top: 3.75rem;         left: 0;         background: rgba(0, 0, 0, 0.7);         padding: .9375rem;         color: #fff;         line-height: 1.8;         z-index: 99999;     }      .demoWork.left {         left: auto;         right: 0;         z-index: 999;     }      .demoWork div {         cursor: pointer;     }      /* -------- */     /* Css widget */     /* -------- */     /* Global style chat */     html, body {          font-size: 16px;      }      input, textarea, button, a, img {         outline: none;         -webkit-appearance: none;     }      p, h2 {         margin: 0;     }      .flex {         display: -webkit-box;         display: -webkit-flex;         display: -ms-flexbox;         display: flex;     }      .flex--row {         -webkit-box-orient: horizontal;         -webkit-box-direction: normal;         -webkit-flex-direction: row;         -ms-flex-direction: row;         flex-direction: row;     }      .flex--space-between {         -webkit-box-pack: justify;         -webkit-justify-content: space-between;         -ms-flex-pack: justify;         justify-content: space-between;     }      .flex--space-center {         -webkit-box-pack: center;         -webkit-justify-content: center;         -ms-flex-pack: center;         justify-content: center;     }      .flex--align-center {         -webkit-box-align: center;         -webkit-align-items: center;         -ms-flex-align: center;         -ms-grid-row-align: center;         align-items: center;     }      .box-inline {         display: inline-block;         vertical-align: middle;     }      .box-inline__wrap {         font-size: 0;     }      .vertical-align-top {         vertical-align: top;     }      .text-center {         text-align: center;     }      .animate {         -webkit-transition: all .15s ease;         transition: all .15s ease;     }      .animate-x2 {         -webkit-transition: all .3s ease;         transition: all .3s ease;     }      /* Scroll */     .custom-scroll_inner::-webkit-scrollbar, .country-list::-webkit-scrollbar, .custom-scroll_inner::-webkit-scrollbar {         width: .25rem;     }      .custom-scroll_inner::-webkit-scrollbar-track, .country-list::-webkit-scrollbar-track, .custom-scroll_inner::-webkit-scrollbar-track {         background-color: #f7f7f7;     }      .custom-scroll_inner::-webkit-scrollbar-thumb, .country-list::-webkit-scrollbar-thumb, .custom-scroll_inner::-webkit-scrollbar-thumb {         background-color: #d4d6d9;     }      .callback {         position: fixed;         z-index: 9999;         font-family: \'Open Sans\', sans-serif;         color: #505458;         font-size: .875rem;         -webkit-box-sizing: border-box;         box-sizing: border-box;         max-height: 100vh;     }      .callback--right,     .callback--left,     .callback--center {         overflow: hidden;     }      .callback--bottom, .callback--top {         width: 100%;         right: 0;         padding-bottom: 2.8125rem;     }      .callback--bottom .callback__logo, .callback--top .callback__logo {          padding-top: 0;         padding-bottom: 0;     }      .callback--bottom .field--fake-select, .callback--top .field--fake-select {         height: auto;         width: auto;         margin-left: 0;         margin-right: 0;         padding-bottom: .125rem;     }      .callback--right, .callback--left {         width: 20rem;         height: 100vh;     }      .callback--right .callback__box, .callback--left .callback__box {          height: 100%;         -webkit-box-sizing: border-box;         box-sizing: border-box;         overflow-x: hidden;         overflow-y: auto;     }      .callback--right .field-check, .callback--left .field-check {         max-width: 100%;     }      .callback--right .form__text-select-bt, .callback--left .form__text-select-bt {         display: none;     }      .callback--right .callback__header, .callback--left .callback__header {         padding-left: 0;     }      .callback--right .form__select-box .form__select, .callback--left .form__select-box .form__select {         display: inline-block;     }      .callback--right .callback__close, .callback--left .callback__close {         padding-right: .9375rem;     }      .callback--right .field--normal, .callback--left .field--normal {         margin-left: 0;         margin-right: 0;     }      .callback--right .field--fake-select, .callback--left .field--fake-select {         background-color: #fff;         border: .0625rem solid #d4d6d9;         font-size: .875rem;         padding-left: .9375rem;         padding-right: .9375rem;         font-family: \'Open Sans\';         -webkit-box-sizing: border-box;         box-sizing: border-box;         -webkit-border-radius: .1875rem;         border-radius: .1875rem;         text-align: left;     }      .callback--right .form__select, .callback--left .form__select {         color: #505458;         border: none;         padding-top: .9375rem;         margin-left: 0;         display: block !important;         padding-bottom: .875rem;         padding-right: .625rem;         -webkit-box-sizing: border-box;         box-sizing: border-box;         text-overflow: ellipsis;         white-space: nowrap;         overflow: hidden;     }      .callback--right .form__select:after, .callback--left .form__select:after {         right: 0;     }      .callback--right .form__select-box, .callback--left .form__select-box {         padding-top: 0;         padding-bottom: .625rem;     }      .callback--right .field--fake-select--active, .callback--left .field--fake-select--active {         border-color: #5cb2c2;         color: <%= callback.window_style.phone_color%>;      }      .callback--right {         right: 0;     }      .callback--left {         left: 0;     }      .callback--bottom {         bottom: 0;     }      .callback--top {         top: 0;     }      .callback--center {         width: 43.75rem;         min-height: 26.5625rem;         left: 50%;         top: 50%;         padding-bottom: 2.8125rem;         -webkit-border-radius: .375rem;         border-radius: .375rem;         margin-left: -21.875rem;         margin-top: -13.25rem;     }      .callback--center .callback__logo {         padding-top: 0;         padding-bottom: 0;     }      .callback--center .callback__header {         padding-bottom: 2.1875rem;         padding-left: 0;     }      .callback--center .callback__close {         margin-right: .9375rem;     }      .callback--center .field--fake-select {         height: auto;         width: auto;         margin-left: 0;         margin-right: 0;         padding-bottom: .125rem;     }      .callback--bottom .field__fake-select-drop,     .callback--top .field__fake-select-drop,     .callback--center .field__fake-select-drop {         max-height: 220px;     }      .callback__header {         max-width: 60rem;         margin-left: auto;         margin-right: auto;         position: relative;         padding-left: 1.5625rem;         padding-right: 1.5625rem;     }      .callback__logo {         height: 25%;         padding-top: 1em;         padding-bottom: 1em;         display: flex;         justify-content: center;         align-items: center;         transition: height 0.5s ease-out;     }      @media (max-height: 550px) {         .buy {             display: none;         }     }      @media (max-height: 650px) {         .callback--left .callback__logo,         .callback--right .callback__logo {             height: 10%;         }          .callback--left .callback__logo img,         .callback--right .callback__logo img {             height: 100%;         }     }      @media (max-height: 620px) {         .callback--left .callback__logo,         .callback--right .callback__logo {             height: 7.5%;         }         .callback--left .callback__logo img,         .callback--right .callback__logo img {             height: 100%;         }     }      @media (max-height: 590px) {         .callback--left .callback__logo,         .callback--right .callback__logo {             height: 5%;         }         .callback--left .callback__logo img,         .callback--right .callback__logo img {             height: 100%;         }     }      @media (max-height: 560px) {         .callback--left .callback__logo,         .callback--right .callback__logo {             height: 0%;         }         .callback--left .callback__logo img,         .callback--right .callback__logo img {             height: 100%;         }     }      .callback__logo img {         max-height: 125px;     }      .callback__close {         display: block;         width: 1.5rem;         height: 1.5rem;         position: relative;         cursor: pointer;     }      .callback__close:before, .callback__close:after {         width: 2rem;         height: .125rem;         background-color: #dddddd;         content: \'\';         display: block;         position: absolute;         top: 50%;         margin-top: -.0625rem;         left: 50%;         margin-left: -1rem;     }      .callback__close:before {         -webkit-transform: rotate(-45deg);         -ms-transform: rotate(-45deg);         transform: rotate(-45deg);     }      .callback__close:after {         -webkit-transform: rotate(45deg);         -ms-transform: rotate(45deg);         transform: rotate(45deg);     }      .callback__close:hover:before, .callback__close:hover:after {         background-color: #cccccc;     }      .callback__box {         visibility: hidden;         opacity: 0;         position: absolute;         width: 100%;         height: 100%;         height: -webkit-calc(100% - 2.8125rem);         height: calc(100% - 2.8125rem);         top: 0;         left: 0;         padding-left: 1.5625rem;         padding-right: 1.5625rem;         -webkit-box-sizing: border-box;         box-sizing: border-box;     }      .callback__box--active {         visibility: visible;         opacity: 1;     }      .callback__box--current {         visibility: visible;         opacity: 1;         position: static;     }      .callback__box--current.callback__box--next-slide {         -webkit-animation: next_slide_c .3s forwards;         animation: next_slide_c .3s forwards;     }      .callback__box--current.callback__box--prev-slide {         -webkit-animation: prev_slide_c .3s forwards;         animation: prev_slide_c .3s forwards;     }      .callback__box--next-slide {         -webkit-animation: next_slide .3s forwards;         animation: next_slide .3s forwards;     }      .callback__box--prev-slide {         -webkit-animation: prev_slide .3s forwards;         animation: prev_slide .3s forwards;     }      .callback__sliding {         position: absolute;         width: 1.1875rem;         height: 1.1875rem;         background-position: center;         background-repeat: no-repeat;         padding: .1875rem;         cursor: pointer;     }      .callback__sliding--bottom, .callback__sliding--top {         margin-left: .5625rem;         left: 50%;         top: 0;     }      .callback__sliding--bottom {         background-image: url(<%= cdnPath %>/callback/static/img/callback_slide_bottom.svg);     }      .callback__sliding--top {         background-image: url(<%= cdnPath %>/callback/static/img/callback_slide_top.svg);     }      .callback__sliding--left, .callback__sliding--right {         top: 50%;         margin-top: .5625rem;     }      .callback__sliding--right {         left: 0;         background-image: url(<%= cdnPath %>/callback/static/img/callback_slide_right.svg);     }      .callback__sliding--left {         right: 0;         background-image: url(<%= cdnPath %>/callback/static/img/callback_slide_left.svg);     }      @-webkit-keyframes next_slide_c {         from {             -webkit-transform: translateX(100%);             transform: translateX(100%);         }         to {             -webkit-transform: translateX(0);             transform: translateX(0);         }     }      @keyframes next_slide_c {         from {             -webkit-transform: translateX(100%);             transform: translateX(100%);         }         to {             -webkit-transform: translateX(0);             transform: translateX(0);         }     }      @-webkit-keyframes prev_slide_c {         from {             -webkit-transform: translateX(-100%);             transform: translateX(-100%);         }         to {             -webkit-transform: translateX(0);             transform: translateX(0);         }     }      @keyframes prev_slide_c {         from {             -webkit-transform: translateX(-100%);             transform: translateX(-100%);         }         to {             -webkit-transform: translateX(0);             transform: translateX(0);         }     }      @-webkit-keyframes next_slide {         from {             -webkit-transform: translateX(0);             transform: translateX(0);         }         to {             -webkit-transform: translateX(-100%);             transform: translateX(-100%);         }     }      @keyframes next_slide {         from {             -webkit-transform: translateX(0);             transform: translateX(0);         }         to {             -webkit-transform: translateX(-100%);             transform: translateX(-100%);         }     }      @-webkit-keyframes prev_slide {         from {             -webkit-transform: translateX(0);             transform: translateX(0);         }         to {             -webkit-transform: translateX(100%);             transform: translateX(100%);         }     }      @keyframes prev_slide {         from {             -webkit-transform: translateX(0);             transform: translateX(0);         }         to {             -webkit-transform: translateX(100%);             transform: translateX(100%);         }     }      .fake-switch {         width: 13.75rem;         height: 3rem;     }     /* Switch */     .switch {         width: 13.75rem;         position: relative;     }      .switch:before {         content: \'\';         position: absolute;         bottom: 0;         left: 0;         <% if(email.is_enable && callback.email.is_enable) {%>         width: 6.5625rem;         <%} else {%>         width: 100%;         <%}%>         height: .1875rem;         background-color: #7fba00;         -webkit-transition: all .15s ease;         transition: all .15s ease;     }      .switch--message:before {         -webkit-transform: translateX(7.1875rem);         -ms-transform: translateX(7.1875rem);         transform: translateX(7.1875rem);     }      .switch__item {         width: 6.5625rem;         height: 3rem;         line-height: 3rem;         font-size: .8rem;         cursor: pointer;     }      .switch__item--no-current {         opacity: .3;     }      .switch__item--no-current:hover {         opacity: .7;     }      .switch__item:first-child {         margin-right: .625rem;     }      .switch__img {         margin-right: .1875rem;         height: 1rem;     }      /* Group box */     .group {         margin-bottom: 1.25rem;         max-width: 37.5rem;         margin-left: auto;         margin-right: auto;     }      .group__title {         font-size: 1.625rem;         font-weight: 300;         margin-bottom: .5rem;         line-height: 1.38;     }      .group__par {         line-height: 1.5;     }      .group--small-w {         max-width: 23.125rem;     }      /* Form */     .form__select-box {         padding-top: .625rem;         padding-bottom: 1.0625rem;     }      .form__select {         margin-left: .3125rem;         position: relative;         cursor: pointer;     }      .form__select:after {         content: \'\';         top: 50%;         width: 0;         height: 0;         border-left: .1875rem solid transparent;         border-right: .1875rem solid transparent;         border-top: .25rem solid #999;         display: inline-block;         position: absolute;         right: -.625rem;     }      .form__select--active:after {         content: \'\';         top: 50%;         width: 0;         height: 0;         border-top: none;         border-left: .1875rem solid transparent;         border-right: .1875rem solid transparent;         border-bottom: .25rem solid #999;         display: inline-block;         position: absolute;         right: -.625rem;     }      /* Field */     .field {         height: 3.125rem;         position: relative;     }      .field--small {         width: 8.125rem;     }      .field--small:first-child {         margin-right: .1875rem;     }      .field--small:last-child {         margin-right: .1875rem;     }      .field--normal {         width: 16.875rem;         margin-left: .3125rem;         margin-right: .3125rem;     }      .field--textarea {         height: 6.875rem;     }      .field__box {         margin-bottom: .625rem;     }      .field__box--answer-selection {         margin-top: 2.8125rem;     }      .field__box--bottom {         position: absolute;         width: 100%;         bottom: 2.8125rem;         left: 0;     }      .field__inner {         -webkit-border-radius: .1875rem;         border-radius: .1875rem;         width: 100%;         height: 100%;         -webkit-box-sizing: border-box;         box-sizing: border-box;     }      .field__input, .field__textarea {         background-color: #fff;         border: .0625rem solid #d4d6d9;         font-size: .875rem;         padding-left: .9375rem;         padding-right: .9375rem;         font-family: \'Open Sans\';         background-color: <%= callback.window_style.phone_background %>;         border: .0625rem solid <%= callback.window_style.phone_border %>;         color: <%= callback.window_style.phone_color %>;     }      .field__input[type="tel"] {         font-size: 1.375rem;         color: #505458;         background-color: <%= callback.window_style.phone_background %>;         border: .0625rem solid <%= callback.window_style.phone_border %>;         color: <%= callback.window_style.phone_color %>;     }      .field__textarea {         padding-top: 1.25rem;         padding-bottom: 1.25rem;         resize: none;         background-color: <%= callback.window_style.phone_background %>;         border: .0625rem solid <%= callback.window_style.phone_border %>;         color: <%= callback.window_style.phone_color %>;     }      .field__label {         font-size: .875rem;         opacity: .5;         padding: 1.0625rem .9375rem;         position: absolute;         top: 0;         left: 0;         cursor: text; color: <%= callback.window_style.phone_color %>;     }      .field__label--textarea {         padding-top: .9375rem;         padding-bottom: .9375rem;     }      .field__label--active {         padding-top: .3125rem;         padding-bottom: 0;         font-size: .625rem;     }      .field__input:focus ~ .field__label, .field__textarea:focus ~ .field__label {         padding-top: .3125rem;         padding-bottom: 0;         font-size: .625rem;     }      .field-check {         position: relative;         margin-left: auto;         margin-right: auto;         max-width: 14.375rem;         margin-bottom: .625rem;     }      .field-check__box {         margin-bottom: 1.75rem;     }      .field-check__input {         display: none;     }      .field-check__input[type="radio"] ~ .field-check__label:before, .field-check__input[type="radio"] ~ .field-check__labelafter {         -webkit-border-radius: 6.25rem;         border-radius: 6.25rem;     }      .field-check__input[type="checkbox"] ~ .field-check__label:before, .field-check__input[type="checkbox"] ~ .field-check__labelafter {         -webkit-border-radius: .125rem;         border-radius: .125rem;     }      .field-check__label {         cursor: pointer;         display: block;         -webkit-box-sizing: border-box;         box-sizing: border-box;         padding-left: 1.875rem;         text-align: left;         padding-bottom: .0625rem;         line-height: 1.5;     }      .field-check__label:before, .field-check__label:after {         content: \'\';         display: block;         position: absolute;         top: 0;         left: 0;         cursor: pointer;         width: 1.375rem;         height: 1.375rem;         -webkit-box-sizing: border-box;         box-sizing: border-box;         -webkit-transition: all .25s ease;         transition: all .25s ease;     }      .field-check__label:after {         opacity: 0;         background-image: url(<%= cdnPath %>/callback/static/img/checked.svg);         background-repeat: no-repeat;         background-position: center;         background-size: .8rem;     }      .field-check__label:hover:before {         border-color: #5cb2c2;     }      .field-check__input:checked ~ .field-check__label:after {         opacity: 1;     }      .field__btn {         font-size: 1rem;         font-weight: bold;         text-transform: uppercase;         color: #fff;         letter-spacing: 0.02em;         padding-top: .1875rem;         -webkit-box-sizing: border-box;         box-sizing: border-box;      }      .field__btn[type="button"] {         border: none;         cursor: pointer;     }      .field__btn-img {         padding-bottom: .1875rem;         margin-right: .625rem;         height: 1rem;     }      .field__week {         width: 11.05rem;         margin-right: 0;         margin-left: 0;     }      .field.field__time {         width: 5.4rem;         margin-right: 0;         margin-left: .3125rem;     }      .field--upload {         display: inline-block;     }     .field-upload,     .field-upload__mark {         color: <%= callback.window_style.widget_color %>;     }      .field-upload .field-upload__box .pvm-icon-upload_file {         position: absolute;     }     .field-upload .field-upload__box .pvm-icon-upload_file:before {         position: absolute;         top: -0.15rem;     }      .field-upload .field-upload__mark {         padding-left: .9375rem;     }      .field-upload__ready [class*=\'pvm-icon-\']:before {         display: none;     }      .field-upload [class*=\'pvm-icon-\']:before {         font-size: .6rem;         opacity: .7;     }      .field-upload__button .pvm-icon-upload_button {         margin-right: 0.275rem;     }      .field-upload {         display: block;         position: relative;         text-align: left;     }      .field-upload .flex {         position: relative;     }      .field-upload__input {         position: absolute;         top: 0;         opacity: 0;     }      .field-upload__mark, .field-upload__button, .field-upload__size {         display: block;         cursor: pointer;         font-size: .8rem;         line-height: 1.5;         -webkit-box-sizing: border-box;         box-sizing: border-box;     }      .field-upload__mark {         background: none;         white-space: nowrap;         overflow: hidden;         text-overflow: ellipsis;         padding-right: .3125rem; /*        background-image: url(<%= cdnPath %>/callback/static/img/upload_file.svg);*/     }      .field-upload__size {         white-space: nowrap;         opacity: .5;         padding-right: 1.25rem;     }      .field-upload__mark, .field-upload__button {         background-position: left;         background-repeat: no-repeat;         margin-left: .125rem;         background-size: .625rem;     }      /*.field-upload__button {         opacity: .7;         background-image: url(<%= cdnPath %>/callback/static/img/upload_button.svg);     }*/      .field-upload__button:hover {         opacity: 1;     }      .field-upload__clear {         cursor: pointer;         display: none;         position: absolute;         right: -.30rem;         top: 0;         opacity: .5;         padding: .30rem;         z-index: 3;     }      .field-upload__clear img {         height: .5rem;     }      .field-upload__clear--active {         display: block;     }      .field-upload__clear:hover {         opacity: 1;     }      .field-upload__help {         position: absolute;         padding: .4375rem;         right: -.5rem;         bottom: -.1875rem;         cursor: pointer;         z-index: 4;     }      .field-upload__help img {         height: .7rem;     }      .field-upload__help:hover .field-upload__inform, .field-upload__help.hover .field-upload__inform {         opacity: 1;         visibility: visible;         bottom: 100%;     }      .field-upload__inform {         position: absolute;         background: <%= callback.window_style.widget_color%>;         color: <%= callback.window_style.widget_background%>;         border: .0625rem solid <%= callback.window_style.widget_color%>;         -webkit-box-shadow: 0 0.625rem 0.9375rem 0 rgba(0, 0, 0, 0.15);         box-shadow: 0 0.625rem 0.9375rem 0 rgba(0, 0, 0, 0.15);         font-size: .8rem;         bottom: 140%;         right: 0;         width: 13.125rem;         padding: .4375rem .625rem;         line-height: 1.4;         opacity: 0;         visibility: hidden;     }      .field-upload__inform:before {         width: 0;         height: 0;         border-style: solid;         border-width: .3125rem .3125rem 0 .25rem;         border-color: <%= callback.window_style.widget_color%> transparent transparent transparent;         content: \'\';         position: absolute;         bottom: -.3125rem;         right: .375rem;     }      .field-upload__help.hide, .field-upload__button.hide {         display: none;     }      .field__fake-select-input {         position: absolute;         opacity: 0;         visibility: hidden;     }      .field__fake-select-drop {         position: absolute;         border: .0625rem solid #d4d6d9;         -webkit-box-shadow: 0 0.625rem 0.9375rem 0 rgba(0, 0, 0, 0.15);         box-shadow: 0 0.625rem 0.9375rem 0 rgba(0, 0, 0, 0.15);         width: 16.875rem;         visibility: hidden;         margin-top: .3125rem;         margin-bottom: .3125rem;         -webkit-border-radius: .1875rem;         border-radius: .1875rem;         -webkit-box-sizing: border-box;         box-sizing: border-box;         z-index: 9;         background-color: #fff;         overflow-x: hidden;         overflow-y: auto;         opacity: 0;         left: -.0625rem;         top: 100%;         margin-top: .3125rem;         background-color: <%= callback.window_style.phone_background%>;         border: 1px solid <%= callback.window_style.phone_border%>;         color: <%= callback.window_style.phone_color%>;     }      .field__fake-select-drop--active {         visibility: visible;         opacity: 1;     }      .field__fake-select-list {         padding: .4375rem .625rem .4375rem .9375rem;         text-align: left;         cursor: pointer;         background-color: <%= callback.window_style.phone_color%>;         color: <%= callback.window_style.phone_background%>;     }      .field__fake-select-list:hover, .field__fake-select-list.current {         background-color: <%= callback.window_style.phone_background%>;         color: <%= callback.window_style.phone_color%>;     }      .intl-tel-input {         height: 100%;         width: 16.875rem;     }      .intl-tel-input .country-list .country {         display: block;         position: relative;         width: 100%;         padding-left: .9375rem;         padding-right: .625rem;         padding-top: .4375rem;         padding-bottom: .4375rem;     }      .intl-tel-input .country-list .country-name {         white-space: normal;         font-size: .8125rem;         width: 11.0625rem;         display: inline-block;         font-size: .875;     }      .intl-tel-input .country-list .divider {         width: 100%;     }      .intl-tel-input .country-list .country .dial-code {         min-width: 1.875rem;         font-size: .8125rem;     }      .intl-tel-input.allow-dropdown.separate-dial-code .selected-flag {         outline: none;     }      .intl-tel-input.allow-dropdown.separate-dial-code .selected-dial-code {         font-size: 1.375rem;         opacity: .5;         position: relative;     }      .intl-tel-input.allow-dropdown.separate-dial-code .selected-dial-code:before {         content: \'\';         position: absolute;         top: .5625rem;         height: 1.875rem;         background-color: #d4d6d9;         width: .0625rem;         left: 2.1875rem;     }      .intl-tel-input.allow-dropdown.separate-dial-code.iti-sdc-4 input, .intl-tel-input.allow-dropdown.separate-dial-code.iti-sdc-4 input[type=tel], .intl-tel-input.allow-dropdown.separate-dial-code.iti-sdc-4 input[type=text] {         padding-left: 6.4375rem;     }      .intl-tel-input .selected-flag .iti-arrow {         border-top: .25rem solid #999999;     }      .intl-tel-input .country-list.dropup {         -webkit-border-radius: .1875rem;         border-radius: .1875rem;     }      .intl-tel-input .country-list {         border-color: #d4d6d9;         -webkit-box-shadow: 0 0.625rem 0.9375rem 0 rgba(0, 0, 0, 0.15);         box-shadow: 0 0.625rem 0.9375rem 0 rgba(0, 0, 0, 0.15);     }      .intl-tel-input.allow-dropdown.separate-dial-code .selected-dial-code {         padding-left: 2.375rem;     }      .intl-tel-input .selected-flag .iti-arrow {         right: auto;         left: 2.5rem;     }      .intl-tel-input .selected-flag {         padding: 0 0 0 .9375rem;     }      .intl-tel-input.allow-dropdown.separate-dial-code .selected-flag {         background: none;     }      .intl-tel-input.allow-dropdown .selected-flag {         outline: none;     }      .intl-tel-input.allow-dropdown .flag-container .selected-flag:hover {         background: none;     }      .intl-tel-input .country-list {         width: 16.875rem;         margin-top: .3125rem;         margin-bottom: .3125rem;         -webkit-border-radius: .1875rem;         border-radius: .1875rem;     }      .SumoSelect {         vertical-align: middle;         height: 100%;         width: 100%;         text-align: left;     }      .SumoSelect.open > .optWrapper {         -webkit-border-radius: .1875rem;         border-radius: .1875rem;         -webkit-box-shadow: 0 0.625rem 0.9375rem 0 rgba(0, 0, 0, 0.15);         box-shadow: 0 0.625rem 0.9375rem 0 rgba(0, 0, 0, 0.15);         font-size: .8125rem;         text-align: left;     }      .SumoSelect.open .CaptionCont > label > i {         border-bottom: .25rem solid #999999;         border-top: none;     }      .mbYTP_wrapper {         -webkit-border-radius: 6.25rem;         border-radius: 6.25rem;     }      .flag-container.active .iti-arrow {         border-bottom: .25rem solid #999999;         border-top: none;     }      /* Timer */     .timer {         font-size: 2.8125rem;         font-weight: 300;         margin-top: .3125rem;     }      .timer-block {         width: 16.875rem;         height: 3.125rem;         background-color: #e4e5e7;         overflow: hidden;         display: inline-block;         color: #fff;         padding-top: 1rem;         -webkit-box-sizing: border-box;         box-sizing: border-box;         -webkit-border-radius: .1875rem;         border-radius: .1875rem;     }      .timer-block__inner {         content: \'\';         position: absolute;         top: 0;         left: 0;         height: 100%;         -webkit-animation-timing-function: linear;         animation-timing-function: linear;         -webkit-animation-fill-mode: forwards;         animation-fill-mode: forwards;         background-color: #a0ccd4;     }      .timer-block__text {         position: relative;         font-size: 1rem;         font-weight: bold;         text-transform: uppercase;     }      .load_dots {         margin-right: .5rem;     }      .load_dots:before, .load_dots:after {         content: \'\';     }      .load_dots i, .load_dots:before, .load_dots:after {         display: -moz-inline-stack;         display: inline-block;         zoom: 1;         *display: inline;         vertical-align: middle;         width: .25rem;         height: .25rem;         -webkit-border-radius: 6.25rem;         border-radius: 6.25rem;         -webkit-animation: loadingDots infinite;         animation: loadingDots infinite;         -webkit-animation-duration: .8s;         animation-duration: .8s;         -webkit-animation-timing-function: linear;         animation-timing-function: linear;         background-color: #fff;         top: -.0625rem;         position: relative;     }      .load_dots:before {         -webkit-animation-delay: 0s;         animation-delay: 0s;     }      .load_dots i {         -webkit-animation-delay: .2s;         animation-delay: .2s;         margin: 0 .1875rem;     }      .load_dots:after {         -webkit-animation-delay: .6s;         animation-delay: .6s;     }      @-webkit-keyframes loadingDots {         from {             opacity: .3;         }         50% {             opacity: 1;         }         to {             opacity: .3;         }     }      @keyframes loadingDots {         from {             opacity: .3;         }         50% {             opacity: 1;         }         to {             opacity: .3;         }     }      @-webkit-keyframes load_bar {         0% {             width: 0;         }         100% {             width: 100%;         }     }      @keyframes load_bar {         0% {             width: 0;         }         100% {             width: 100%;         }     }      .tooltip {         background-color: #fe7272;         height: 3.125rem;         position: absolute;         -webkit-border-radius: .1875rem;         border-radius: .1875rem;         font-size: .875rem;         color: #fff;         line-height: 1.28;         visibility: hidden;         opacity: 0;         -webkit-transition: all .15s ease;         transition: all .15s ease;         z-index: 3;     }      .tooltip:after, .tooltip:before {         content: \'\';     }      .tooltip:after {         display: inline-block;         vertical-align: middle;         width: 0;         height: 100%;     }      .tooltip:before {         position: absolute;         width: 0;         height: 0;         border-style: solid;     }      .tooltip__text {         width: 99%;         display: inline-block;         vertical-align: middle;     }      .tooltip--top, .tooltip--bottom {         width: 100%;         left: 0;     }      .tooltip--top {         bottom: 100%;         margin-bottom: 1.875rem;     }      .tooltip--top:before {         border-width: .25rem .4375rem 0 .4375rem;         bottom: -.25rem;         left: 50%;         margin-left: -.4375rem;     }      .tooltip--bottom {         top: 100%;         margin-top: 1.875rem;     }      .tooltip--bottom:before {         border-width: 0 .4375rem .25rem .4375rem;         top: -.25rem;         left: 50%;         margin-left: -.4375rem;     }      .tooltip--left, .tooltip--right {         width: auto;         top: 0;         padding-left: .625rem;         padding-right: .625rem;     }      .tooltip--left {         left: 0;         margin-left: -.625rem;         -webkit-transform: translateX(-100%);         -ms-transform: translateX(-100%);         transform: translateX(-100%);     }      .tooltip--left:before {         border-width: .4375rem 0 .4375rem .25rem;         right: -.25rem;         top: 50%;         margin-top: -.4375rem;     }      .tooltip--right {         right: 0;         margin-right: -.625rem;         -webkit-transform: translateX(100%);         -ms-transform: translateX(100%);         transform: translateX(100%);     }      .tooltip--right:before {         border-width: .4375rem .25rem .4375rem 0;         left: -.25rem;         top: 50%;         margin-top: -.4375rem;     }      .tooltip--active {         visibility: visible;         opacity: 1;     }      .tooltip--active.tooltip--top {         margin-bottom: .625rem;     }      .tooltip--active.tooltip--bottom {         margin-top: .625rem;     }      /* callback buy*/     .buy {         font-size: .8rem;         position: absolute;         bottom: 0;         left: 0;         width: 100%;     }      .buy__link {         color: rgba(102, 102, 102, 0.5);         padding: .625rem .3125rem;         display: inline-block;         text-decoration: none;     }      .buy__link:hover {         color: #666666;     }      .buy__img {         margin-right: .4375rem;         padding-bottom: .1875rem;         height: 1rem;     }      /* Rating */     .rating__item {         width: 1.6875rem;         height: 1.625rem;         padding: .5rem;         position: relative;         cursor: pointer;     }      .rating__item--no-select:active {         -webkit-transform: translateY(0.0625rem);         -ms-transform: translateY(0.0625rem);         transform: translateY(0.0625rem);     }      @media all and (max-width: 60rem) {         .callback--center .callback__header, .callback--top .callback__header, .callback--bottom .callback__header {             padding-left: 0;         }     }      .callback {         background-position: center;         background-repeat: no-repeat;         background-size: cover;         background-color: <%= callback.window_style.widget_background%>;         color: <%= callback.window_style.widget_color%>;     }      <% if(callback.background){ %>         .callback.callback--right,         .callback.callback--left,         .callback.callback--bottom,         .callback.callback--top,         .callback.callback--center {         <% if(callback.background == \'none\'){ %>             background-image: none;         <% } else { %>             background-image: url(<%= callback.background %>);             <% if(callback.background_fill == 1){ %>                 background-size: cover;             <% } %>             <% if(callback.background_center == 1){ %>                 background-position: center center;             <% } %>             <% if(callback.background_norepeat == 1){ %>                 background-repeat: no-repeat;             <% } %>         <% } %>         }     <% } %>      .callback--bottom, .callback--top, .callback--center {         background-image: url(<%= cdnPath %>/callback/static/img/default-bg.png)     }      .callback--left, .callback--right {         background-image: url(<%= cdnPath %>/callback/static/img/default-bg_lr.png)     }      .field__input:focus, .field__textarea:focus {         border: .0625rem solid #5cb2c2;     }      /*Button*/     .field__inner.field__btn--default {         background-color: #7fba00;         border-bottom: .0625rem solid <%= callback.window_style.button_background %>;;         border-top: .0625rem solid #7fba00;         border-top: .0625rem solid <%= callback.window_style.button_background %>;;         background-color: <%= callback.window_style.button_background %>;         color: <%= callback.window_style.button_color%>;     }      .field__inner.field__btn--default:hover {         background-color: #8cc11a;         border-top-color: #8cc11a;         background-color: <%= callback.window_style.button_hover_background%>;         border-top-color: <%= callback.window_style.button_hover_background%>;         border-bottom: .0625rem solid <%= callback.window_style.button_hover_background %>;;         color: <%= callback.window_style.button_hover_color%>;     }      .field__inner.field__btn--default:active {         background-color: #72a700;         border-top: .0625rem solid <%= callback.window_style.button_background %>;;         border-bottom: .0625rem solid <%= callback.window_style.button_background %>;;         background-color: <%= callback.window_style.button_background %>;         color: <%= callback.window_style.button_color%>;     }      .field__inner.field__btn--accen {         background-color: #5cb2c2;         border-bottom: .0625rem solid <%= callback.window_style.button_background %>;         border-top: .0625rem solid <%= callback.window_style.button_background %>;         background-color: <%= callback.window_style.button_background %>;         color: <%= callback.window_style.button_color%>;         border-left:0;border-right:0;     }      .field__inner.field__btn--accen:hover {         background-color: #70bbc7;;         border-top-color: #70bbc7;         background-color: <%= callback.window_style.button_hover_background%>;         border-top-color: <%= callback.window_style.button_hover_background%>;         border-bottom: .0625rem solid <%= callback.window_style.button_hover_background %>;         color: <%= callback.window_style.button_hover_color%>;     }      .field__inner.field__btn--accen:active {         background-color: #56a1ad;         border-top-color: #4d919b;         border-bottom-color: #56a1ad;     }      .form__select {         color: #60b3c1;         border-bottom: .0625rem dashed #0088cc;     }      .switch__item--current {         border-color: #7fba00;     }      .tooltip--top:before {         border-color: #fe7272 transparent transparent transparent;     }      .tooltip--right:before {         border-color: transparent #fe7272 transparent transparent;     }      .tooltip--bottom:before {         border-color: transparent transparent #fe7272 transparent;     }      .tooltip--left:before {         border-color: transparent transparent transparent #fe7272;     }      .field__input.error, .field__textarea.error, .field__input.error:focus, .field__textarea.error:focus {         border-color: #fe7272;     }       .field-check__label:before {         -webkit-box-shadow: inset 0 0 0 .125rem #5cb2c2;         box-shadow: inset 0 0 0 .125rem #d4d6d9;     }      .field-check__input:checked ~ .field-check__label:before {         -webkit-box-shadow: inset 0 0 0 .75rem #5cb2c2;         box-shadow: inset 0 0 0 .75rem #5cb2c2;     }      .rating__item--hover path {         fill: #5cb2c2;     }      .feedback-rating {         border: none;         direction: rtl;         unicode-bidi: bidi-override;         width: 210px;         height: 42px;     }      .feedback-rating.center {         margin-left: auto;         margin-right: auto;     }      .feedback-rating > input { display: none; }     .feedback-rating > label {         display: block;         float: right;         background-image: url(<%= cdnPath %>/feedback/report/img/star.svg);         width: 26px;         height: 26px;         padding: 8px;         background-position: center;         background-repeat: no-repeat;     }      .feedback-rating > input:checked ~ label,     .feedback-rating:not(:checked) > label:hover,     .feedback-rating:not(:checked) > label:hover ~ label,     .feedback-rating > input:checked + label:hover,     .feedback-rating > input:checked ~ label:hover,     .feedback-rating > label:hover ~ input:checked ~ label,     .feedback-rating > input:checked ~ label:hover ~ label {         background-image: url(<%= cdnPath %>/feedback/report/img/star_active.svg);     }      #feedback-container {         /*    scroll- */         display: inline;     }      .callback.callback--center #feedback-button-container,     .callback.callback--top #feedback-button-container,     .callback.callback--bottom #feedback-button-container,      .callback.callback--center #feedback-after-button-container,     .callback.callback--top #feedback-after-button-container,     .callback.callback--bottom #feedback-after-button-container  {         display: block;         margin-left: auto;         margin-right: auto;     }      #callback-cover {         display: block;         height: 100% !important;         position: fixed !important;         top: 0 !important;         width: 100% !important;     }     a, a:link, a:visited, a:hover {         color: #ffffff;         color: <%= callback.window_style.widget_color%>;     } .pozvonim-validation-defcode { border-radius: 5px; box-shadow: 2px 0 27px 0 rgba(204, 204, 204, 0.5); font-size: 16px; margin-top: -89px; opacity: 1; padding: 15px; position: absolute; z-index: 99; border: 1px solid transparent; background-color: rgba(0, 0, 0, 0.8); color: #ffffff; background-color: rgba(0, 0, 0, 0.8); border: 1px solid transparent; color: #ffffff; }     <%= callback.api_css_code %> </style> <div class="callback callback--<%= callback.window_position %>" id="callback">     <div class="callback__header flex flex--space-between flex--align-center">         <% if(email.is_enable && callback.email.is_enable) { %>             <div class="switch box-inline__wrap text-center">                 <div class="switch__item switch__item--phone box-inline animate data-activate switch__item--current" id="js__slide-callback" data-activate="pozvonim-element-call">                 <img src="<%= cdnPath %>/callback/static/img/phone.svg" class="switch__img box-inline"></div>                 <% if(email.is_enable && callback.email.is_enable){ %>                 <div class="switch__item box-inline animate data-activate switch__item--no-current" id="js__slide-message" data-activate="pozvonim-element-email"><img src="<%= cdnPath %>/callback/static/img/message.svg" class="switch__img box-inline">  </div>                 <% } %>             </div>         <% } else { %>             <div class="fake-switch box-inline__wrap text-center">                 <p></p>             </div>         <% } %>         <i class="callback__close actionHide" id="js__close-widget"></i>     </div>     <div class="callback__sliding callback__sliding--<%= callback.window_position %> actionHide" id="callback__sliding"></div>     <div class="callback__logo text-center">         <% if (callback.logo){ %> <img src="<%= cdnPath %>/files/widget/<%= callback.logo %>" class="box-inline"><% } %> </div>     <div class="callback__box  callback__box--current content-call" id="pozvonim-element-call">         <div class="group text-center events enter" style="display: none;">             <h2 class="group__title"><%= callback.window_text.enter.title %></h2>             <p class="group__par"><%= callback.window_text.enter.description %></p>         </div>         <div class="group text-center events afterEnter" style="display: none;">             <h2 class="group__title"><%= callback.window_text.afterEnter.title.replace(\' \', \'\').replace(\'%counter_back%\', \'<span id="pozvonim-element-returnback">1</span>\') %></h2>             <p class="group__par"><%= callback.window_text.afterEnter.description %></p>         </div>         <div class="group text-center events afterView" style="display: none;">             <h2 class="group__title"><%= callback.window_text.afterView.title.replace(\' \', \'\').replace(\'%counter_page%\', \'<span id="pozvonim-element-viewpagecount">1</span>\') %></h2>             <p class="group__par"><%= callback.window_text.afterView.description %></p>         </div>         <div class="group text-center events afterScroll" style="display: none;">             <h2 class="group__title"><%= callback.window_text.afterScroll.title %></h2>             <p class="group__par"><%= callback.window_text.afterScroll.description %></p>         </div>         <div class="group text-center events exit" style="display: none;">             <h2 class="group__title"><%= callback.window_text.exit.title.replace(\'%staytime%\', \'<span id="pozvonim-element-staytime"></span>\') %></h2>             <p class="group__par"><%= callback.window_text.exit.description %></p>         </div>         <div class="group text-center events wait" style="display: none;">             <h2 class="group__title"><%= callback.window_text.wait.title %></h2>             <p class="group__par"><%= callback.window_text.wait.description %></p>         </div>         <div class="group text-center events return" style="display: none;">             <h2 class="group__title"><%= callback.window_text.return.title.replace(\' \', \'\').replace(\'%counter%\', \'<span id="pozvonim-element-returncount">1</span>\') %></h2>             <p class="group__par"><%= callback.window_text.return.description %></p>         </div>         <div class="group text-center events click" style="display: none;">             <h2 class="group__title"><%= callback.window_text.click.title %></h2>             <p class="group__par"><%= callback.window_text.click.description %></p>         </div>         <div class="group text-center events calendar" style="display: none;">             <h2 class="group__title">                 <%= callback.window_text.delayed.title %>             </h2>             <p class="group__par">                 <%= callback.window_text.delayed.description %>             </p>         </div>         <div class="group text-center events offline" style="display: none;">             <% var offlineText = callback.window_text.offline.description.split(\'%calltime%\'); %>             <div class="group text-center">                 <h2 class="group__title"><%= callback.window_text.offline.title %></h2>                 <p class="group__par"><%= offlineText[0] %></p>             </div>         </div>         <form class="form text-center actionCall" method="post" enctype="application/x-www-form-urlencoded">             <div class="field__box box-inline__wrap events offline calendar" style="display: none;">                 <div class="field field--normal field__week box-inline">                     <select class="field__inner field__sumo-select day select" name="delay_day" id="pozvonim-delay-day-input"></select>                 </div>                 <!--div class="field field--normal field__time box-inline">                      <select class="field__inner field__sumo-select hours select" name="delay_minute" id="pozvonim-delay-hours-input"></select>                  </div-->                 <div class="field field--normal field__time box-inline">                     <select class="field__inner field__sumo-select minutes select" name="delay_minute" id="pozvonim-delay-minute-input"></select>                 </div>             </div>             <% if(callback.manager_region_enable) {var regionText = callback.window_text.region.select.split(\'%regionselect%\'); %>             <div class="form__select-box">                 <span class="form__text-select-bt"><%= regionText[0] %></span>                 <div id="pozvonim-region-input-fake" class="field field--normal box-inline field--fake-select relative">                     <input type="text" name="region" value="" id="pozvonim-region-input" class="field__fake-select-input select region" />                     <span class="form__select js__form-select"></span>                     <div class="field__fake-select-drop"></div>                 </div>                 <span class="form__text-select-bt"><%= regionText[1] %></span>             </div>             <% } %>             <div class="box-inline__wrap">                 <div class="field__box field field--normal box-inline">                     <input type="tel" id="pozvonim-phone-input" class="field__inner field__input js__field-phone input phone" name="phone" value="+<%= callback.phone_prefix %>">                     <div class="tooltip tooltip--top" id="pozvonim-validation-element">                         <div class="tooltip__text">   <br>: +<%= callback.phone_prefix %> 913 900-00-00</div>                     </div> <div id="pozvonim-validation-defcode" class="pozvonim-validation-defcode" style="display: none;"> <%= callback.window_text.defcode.denied %> </div>                 </div>                 <div class="field__box field field--normal box-inline">                     <button id="pozvonim-button-element" type="button" class="field__inner field__btn animate field__btn--default js__start-timer js__phone-valid call actionCall" type="submit" name="button"><img                                 src="<%= cdnPath %>/callback/static/img/phone__button.svg" class="field__btn-img box-inline"/><%= callback.window_text.button.select %></button>                 </div>             </div>             <% if(callback.is_working){ %>             <div id="pozvonim-calendar-button" class="field field--normal box-inline">                 <a id="display-calendar-call" style="text-decoration: none;border-bottom: 1px dashed; " href="#" class="btn-link">                     <%= callback.window_text.delayed.button_later %>                 </a>                 <a id="display-calendar-back" style="display:none;text-decoration: none;border-bottom: 1px dashed; " href="#" class="btn-link">                     <%= callback.window_text.delayed.button_now %>                 </a>             </div>             <% } %>         </form>         <% if(callback.call_time > 0 && callback.is_working ){ %>         <div class="timer text-center js__start-timer" id="pozvonim-timer-element" data-timer="<%= callback.call_time * 10 %>">00:<%= callback.call_time %>:00</div>         <% } %>     </div>     <div class="callback__box" id="pozvonim-element-final-offline">         <div class="group text-center">             <h2 class="group__title">!</h2>             <p class="group__par"><%= callback.window_text.offline.final %></p>             <b id="pozvonim-delay-time"></b>         </div>         <div class="field__box text-center">             <div class="field field--normal box-inline">                 <button type="button" class="field__inner field__btn animate field__btn--accen actionHide" name="button"></button>             </div>         </div>     </div>     <div class="callback__box" id="pozvonim-element-final">         <div class="group text-center">             <h2 class="group__title">!</h2>             <% if(callback.window_text.final !== undefined && callback.window_text.final.callAgain) { %>    <p class="group__par">   ?   ?</p><%}%>         </div>         <% if(callback.window_text.final !== undefined && callback.window_text.final.callAgain) { %>             <div id="pozvonim-call-again-countdown" class="field__box text-center" style="display: none">                 <div class="field field--normal box-inline">                     <b>    <span id="pozvonim-call-again-countdown-timer"></span> </b>                 </div>             </div>         <div id="pozvonim-call-again-button-container" class="field__box text-center">             <div class="field field--normal box-inline">                 <button type="button" class="field__inner field__btn animate field__btn--default actionCallAgain" name="button"><img src="<%= cdnPath %>/callback/static/img/phone__button.svg" class="field__btn-img box-inline"                                                                                                                                     /><%= callback.window_text.final.callAgain %></button>             </div>         </div>         <% } %>         <div class="field__box text-center">             <div class="field field--normal box-inline">                 <button type="button" class="field__inner field__btn animate field__btn--accen actionHide" name="button"></button>             </div>         </div>     </div>     <div id="feedback-container">      </div>     <div class="callback__box" id="pozvonim-element-email">         <div class="group text-center">             <h2 class="group__title"> </h2>         </div>          <form class="form box-inline__wrap text-center pozvonim-com-x-chat-form actionEmailForm" id="pozvonim-com-x-chat" name="emailSendForm" method="post" action="" enctype="multipart/form-data">             <input type="hidden" name="email-type" id="pozvonim-email-type" value="site"/>             <div class="box-inline vertical-align-top">                 <% if(callback.email.send_email){%>                 <div class="field__box pozvonim-com-x-chat-email">                     <div class="field field--normal">                         <input type="text" class="field__inner field__input" name="email-email" id="pozvonim-email-email" value="">                         <label for="pozvonim-email-email" class="field__label animate">E-mail</label>                     </div>                 </div>                 <%}%>                  <% if(callback.email.send_phone){%>                 <div class="field__box pozvonim-com-x-chat-phone">                     <div class="field field--normal">                         <input type="text" id="pozvonim-email-phone" class="field__inner field__input" name="email-phone" value="">                         <label for="pozvonim-email-phone" class="field__label animate"></label>                     </div>                 </div>                 <%}%>             </div>             <div class="box-inline">                 <div class="field__box pozvonim-com-x-chat-textarea">                     <div class="field field--normal field--textarea">                         <textarea name="email-text" id="pozvonim-email-textarea" class="field__inner field__textarea"></textarea>                         <label id="pozvonim-email-textarea-label" for="pozvonim-email-textarea" class="field__label field__label--textarea animate"> </label>                     </div>                 </div>                 <% if(callback.email.send_file){%>                 <div class="field__box">                     <div class="field field--normal field--upload">                         <div class="field-upload"> <span class="flex flex--space-between flex--align-center field-upload__box field-upload__ready"> <i class="pvm-icon-upload_file"></i> <mark class="field-upload__mark field-upload__mark-1"></mark> <label for="js__file-size1" class="field-upload__label field-upload__label-1"><input type="file" class="field-upload__input field-upload__input-1" id="js__file-size1" data-id="1" /></label> <span class="field-upload__clear field-upload__clear-1" data-id="1"><i class="pvm-icon-close"></i></span> <span class="field-upload__size field-upload__size-1"></span> </span>  <span class="flex flex--space-between flex--align-center field-upload__box field-upload__ready"> <i class="pvm-icon-upload_file"></i> <mark class="field-upload__mark field-upload__mark-2"></mark> <label for="js__file-size2" class="field-upload__label field-upload__label-2"><input type="file" class="field-upload__input field-upload__input-2" id="js__file-size2" data-id="2" /></label> <span class="field-upload__clear field-upload__clear-2" data-id="2"><i class="pvm-icon-close"></i></span> <span class="field-upload__size field-upload__size-2"></span> </span>  <span class="flex flex--space-between flex--align-center field-upload__box field-upload__ready"> <i class="pvm-icon-upload_file"></i> <mark class="field-upload__mark field-upload__mark-3"></mark> <label for="js__file-size3" class="field-upload__label field-upload__label-3"><input type="file" class="field-upload__input field-upload__input-3" id="js__file-size3" data-id="3" /></label> <span class="field-upload__clear field-upload__clear-3" data-id="3"><i class="pvm-icon-close"></i></span> <span class="field-upload__size field-upload__size-3"></span> </span>                              <span class="field-upload__button animate "><i class="pvm-icon-upload_button"></i> </span>                              <div class="field-upload__help">                                 <i class="pvm-icon-upload_question"></i>                                 <div class="field-upload__inform animate">                                     <p>     2 Mb JPG, PNG, GIF, PDF, DOC, XLS</p>                                 </div>                             </div>                         </div>                      </div>                 </div>                 <%}%>             </div>             <div>                 <div class="field field--normal box-inline">                     <button class="field__inner field__btn animate field__btn--accen  actionEmail data-activate" id="pozvonim-button-element-email" type="submit" data-activate="pozvonim-element-email-final"></button>                 </div>             </div>         </form>     </div>     <div class="callback__box" id="pozvonim-element-email-final">         <div class="group group--small-w text-center">             <h2 class="group__title">  </h2>             <p class="group__par">    .</p>             <p class="group__par">       .</p>         </div>         <div class="text-center">             <div class="field field--normal box-inline">                 <button type="button" class="field__inner field__btn animate field__btn--accen actionHide" name="button"></button>             </div>         </div>     </div>     <% if(callback.copyright === 1) { %>     <div class="buy text-center">         <a href="<%= referal_url %>" target="_blank" class="buy__link animate copyright"><img src="<%= cdnPath %>/callback/static/img/logo_small.svg" class="box-inline buy__img">   </a>     </div>     <% } %> </div> <div id="callback-cover"></div> </body> </html> ';template.wrapper=' <% if(callback.is_enable){ %> <style>     #pozvonim-button div {         background: transparent none repeat scroll 0 0;     }      @keyframes pzv-inner-animation {         0% {             transform: scale(1);         }         40% {             opacity: 0.9;             transform: scale(1.2);         }         100% {             transform: scale(1.5);         }     }      @keyframes pzv-outer-animation {         0%, 100% {             transform: scale(1.5);         }         40% {             transform: scale(1);         }     }      @keyframes pzv-phone-animation {         0%, 50%, 100% {             transform: rotate(0deg);         }         10%, 30% {             transform: rotate(-25deg);         }         20%, 40% {             transform: rotate(25deg);         }     }      @-webkit-keyframes pzv-inner-animation {         0% {             -webkit-transform: scale(1);         }         40% {             opacity: 0.9;             transform: scale(1.2);             -webkit-transform: scale(1.2);         }         100% {             -webkit-transform: scale(1.5);         }     }      @-webkit-keyframes pzv-outer-animation {         0%, 100% {             -webkit-transform: scale(1.5);         }         40% {             -webkit-transform: scale(1);         }     }      @-webkit-keyframes pzv-phone-animation {         0%, 50%, 100% {             -webkit-transform: rotate(0deg);         }         10%, 30% {             -webkit-transform: rotate(-25deg);         }         20%, 40% {             -webkit-transform: rotate(25deg);         }     }      @-moz-keyframes pzv-inner-animation {         0% {             -moz-transform: scale(1);         }         40% {             opacity: 0.9;             -moz-transform: scale(1.2);         }         100% {             -moz-transform: scale(1.5);         }     }      @-moz-keyframes pzv-outer-animation {         0%, 100% {             -moz-transform: scale(1.5);         }         40% {             -moz-transform: scale(1);         }     }      @-moz-keyframes pzv-phone-animation {         0%, 50%, 100% {             -moz-transform: rotate(0deg);         }         10%, 30% {             -moz-transform: rotate(-25deg);         }         20%, 40% {             -moz-transform: rotate(25deg);         }     }      #pozvonim-cover *, #pozvonim-cover *::before, #pozvonim-cover *::after, #pozvonim-button *, #pozvonim-button *::before, #pozvonim-button *::after, #pozvonim-wrapper *, #pozvonim-wrapper *::before, #pozvonim-wrapper *::after {         -webkit-box-sizing: border-box;         -moz-box-sizing: border-box;         box-sizing: border-box;     }      #pozvonim-button {         transform-origin: center center 0 !important;         /*opacity: 0;*/         width: auto !important;         height: auto !important;          cursor: pointer !important;     <% if(is_mobile){%>         position: fixed;         -webkit-backface-visibility: hidden;         -webkit-transform: translateZ(0);     <%} else {%>         position: absolute;     <%}%>         display: block;         z-index: 10000000 !important;         background: transparent none repeat scroll 0 0 !important;     }      #pozvonim-button * {         transform-origin: center center 0 !important;     } <% if(!is_mobile){%>     #pozvonim-button.pozvonim-dragging {         -o-transition: none 0s ease 0s !important;         -moz-transition: none 0s ease 0s !important;         -webkit-transition: none 0s ease 0s !important;         transition: none 0s ease 0s !important;     } <%}%>     #pozvonim-button .pozvonim-button-phone {         <% if (!is_mobile) { %>             <% if (!callback.disable_animation) { %>                 -webkit-animation: pzv-phone-animation 1.2s ease-in-out 0s normal none infinite running;                 -moz-animation: pzv-phone-animation 1.2s ease-in-out 0s normal none infinite running;                 -o-animation: pzv-phone-animation 1.2s ease-in-out 0s normal none infinite running;                 animation: pzv-phone-animation 1.2s ease-in-out 0s normal none infinite running;             <% } %>         <% } %>         position: absolute !important;         background-color: #4BC2CE !important;         background-color: rgba(29, 179, 194, 0.8) !important;         background-color: <%= callback.window_style.opener_background%> !important;         background-position: center;         <% if (callback.button_icon.logo_file) { %>             background-image: url(<%= callback.button_icon.logo_file %>);             background-repeat: no-repeat;         <% } else if (!callback.button_icon.logo) { %>             background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAABECAYAAAA4E5OyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAJKSURBVHja7Nk7aBRRFIDh/8QHPvBBQNTGRgVNZ7AI2Ai+sBOLiAabINgKirWCjQQRQUtLC8FCgoUprERsVLAzRhAUo60WIWrgt3BFXTK7i9nZZJxz4DZzL7tzv7mvMxMqGb+jLwkSJEESJEESJEESJEESJEESJEESJEESJEESJCNBeggSEV0pwHbgOTALjAHLmurLCbWrpUv3tEF97d/xUF1X1n3/Kkt1ytwAdjZdOwJMqGtK/eelNkLUQ7aOm2WOkOj2d5mFzm/1BbCnVRNgAHj13+8y6mAbDIAARuuy7e7osN2BuoC8bEyJdrGrFiARMQmc76BpaTvNkltUG2vJCeA2sLagySywujZH94i4Cxxt0WSqdrlMRDwGJguqn9YORO0DthZUj9cx2z0GrJ/n+jQwUSsQdRVwpaD6ekTM1W2EXAV2z3P9HXCrbsndSIvE7njZ6X9PQNSN6pYOMPapXwsw7pX5IHsCom5W76hzjU49UjcVYAypnwsw3qv9lQZRB9VP83RuSt3W1LlT6kwBxqw6VPZULxVEPah+abEWfFTPqMPqeJsXQiO9WPtKe0EEHAYeACu68FsXIuJaEUglkjvgDT/fmC80LkfEpVa7Y1VAZrqQiV6MiLF2x4WqHMzOLRDzZDuMyh3M1NE/ttpO45k6sFj33Yttd7/6tgOIafWsunwxH2RPPkOoK4HTwDCwF+gHvgMfgCeNNP5+RHz7l5FdlUW10pFf/xMkQRIkQRIkQRIkQRIkQRIkQRIkQRIkQRIkI0FaxI8BAMGiej+TuldEAAAAAElFTkSuQmCC);         <% } else { %>             background-repeat: no-repeat;         <% } %>         border-radius: 100% !important;         height: <%= 70 * callback.buttonConfig.scale %>px !important;         width: <%= 70 * callback.buttonConfig.scale %>px !important;         left: <%= 44 * callback.buttonConfig.scale %>px !important;         top: <%= 44 * callback.buttonConfig.scale %>px !important;         z-index: 10000000 !important;     }      #pozvonim-button .pozvonim-button-border-inner {         <%if(!is_mobile){%>-webkit-animation: 2.3s ease-in-out 0s normal none infinite running pzv-outer-animation;         -moz-animation: 2.3s ease-in-out 0s normal none infinite running pzv-outer-animation;         -o-animation: 2.3s ease-in-out 0s normal none infinite running pzv-outer-animation;         animation: 2.3s ease-in-out 0s normal none infinite running pzv-outer-animation;         <%}%>         border: 1px solid #68cafa !important;         border: 1px solid <%= callback.window_style.opener_inner_border%> !important;         border-radius: 100% !important;         opacity: 0.5 !important;         -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=50)" !important;         height: <%= 70 * callback.buttonConfig.scale %>px !important;         left: <%= 44 * callback.buttonConfig.scale %>px !important;         top: <%= 44 * callback.buttonConfig.scale %>px !important;         width: <%= 70 * callback.buttonConfig.scale %>px !important;         position: absolute !important;         z-index: 10000000 !important;         display: block !important;     }      #pozvonim-button .pozvonim-button-border-outer {     <%if(!is_mobile){%> -webkit-animation: 2.3s ease-in-out 0s normal none infinite running pzv-inner-animation;         -moz-animation: 2.3s ease-in-out 0s normal none infinite running pzv-inner-animation;         -o-animation: 2.3s ease-in-out 0s normal none infinite running pzv-inner-animation;         animation: 2.3s ease-in-out 0s normal none infinite running pzv-inner-animation;<%}%>         border: 1px solid #9abfd3 !important;         border: 1px solid <%= callback.window_style.opener_outer_border%> !important;         border-radius: 100% !important;         width: <%= 100 * callback.buttonConfig.scale %>px !important;         height: <%= 100 * callback.buttonConfig.scale %>px !important;         left: <%= 30 * callback.buttonConfig.scale %>px !important;         top: <%= 30 * callback.buttonConfig.scale %>px !important;         position: absolute !important;         z-index: 10000000 !important;         display: block !important;     }     <%if(!is_mobile){%>     #pozvonim-button.pozvonim-hovered .pozvonim-button-phone, #pozvonim-button:hover .pozvonim-button-phone {         background-color: #79D000 !important;         background-color: rgba(121, 208, 0, 0.8) !important;         background-color: <%= callback.window_style.opener_hover_background %> !important;     }      #pozvonim-button.pozvonim-hovered .pozvonim-button-border-inner, #pozvonim-button:hover .pozvonim-button-border-inner {         border: 1px solid #b7de69 !important;         border: 1px solid <%= callback.window_style.opener_hover_inner_border %> !important;     }      #pozvonim-button.pozvonim-hovered .pozvonim-button-border-outer, #pozvonim-button:hover .pozvonim-button-border-outer {         border: 1px solid #b7de69 !important;         border: 1px solid <%= callback.window_style.opener_hover_outer_border %> !important;     }     <%}%>     #pozvonim-button .pozvonim-button-wrapper {         padding: 0 !important;         display: block !important;         width: <%= 0 * callback.buttonConfig.scale %>px !important;         height: <%= 0 * callback.buttonConfig.scale %>px !important;     } <% if(!is_mobile){%>     #pozvonim-cover {         background-color: rgba(0, 0, 0, 0.25) !important;         display: none;         height: 100% !important;         position: fixed !important;         top: 0 !important;         width: 100% !important;         z-index: 20000000 !important;     }      .pozvonim-animated {         -o-transition: all 0.8s ease 0s;         -moz-transition: all 0.8s ease 0s;         -webkit-transition: all 0.8s ease 0s;         transition: all 0.8s ease 0s;     } <%}%>     .pozvonim-hovered {         // -webkit-transform: rotateY(-360deg) scale(<%= callback.buttonConfig.scale %>) !important;         // -ms-transform: rotateY(-360deg) scale(<%= callback.buttonConfig.scale %>) !important;         // -o-transform: rotateY(-360deg) scale(<%= callback.buttonConfig.scale %>) !important;         // -moz-transform: rotateY(-360deg) scale(<%= callback.buttonConfig.scale %>) !important;         // transform: rotateY(-360deg) scale(<%= callback.buttonConfig.scale %>) !important;     }      <% if(!callback.buttonConfig.animation && !is_mobile){%>     #pozvonim-button {         top: <%= callback.buttonConfig.position_y%>%;         left: <%= callback.buttonConfig.position_x%>%;     }     <%} else if (is_mobile) { %>         #pozvonim-button {             <% if (callback.buttonConfig.position_x == 5) { %>                 left: 0px;             <% } else if (callback.buttonConfig.position_x == 95) { %>                 right: 350px;             <% } %>             <% if (callback.buttonConfig.position_y == 5) { %>                 top: 0px;             <% } else if (callback.buttonConfig.position_y == 95) { %>                 bottom: 350px;             <% } %>         }     <%} %>     <% if(callback.buttonConfig.text && !is_mobile) {%>     #pozvonim-button.pozvonim-hovered .pozvonim-button-phone, #pozvonim-button:hover .pozvonim-button-phone {         display: none !important;     }      #pozvonim-button.pozvonim-hovered .pozvonim-button-border-inner, #pozvonim-button:hover .pozvonim-button-border-inner {         height: <%= 90 * callback.buttonConfig.scale %>px !important;         left: <%= 33 * callback.buttonConfig.scale %>px !important;         top: <%= 33 * callback.buttonConfig.scale %>px !important;         width: <%= 90 * callback.buttonConfig.scale %>px !important;     }      #pozvonim-button.pozvonim-hovered .pozvonim-button-border-outer, #pozvonim-button:hover .pozvonim-button-border-outer {         height: <%= 100 * callback.buttonConfig.scale %>px !important;         left: <%= 28 * callback.buttonConfig.scale %>px !important;         top: <%= 28 * callback.buttonConfig.scale %>px !important;         width: <%= 100 * callback.buttonConfig.scale %>px !important;     }      #pozvonim-button.pozvonim-hovered .pozvonim-button-text, #pozvonim-button:hover .pozvonim-button-text {         display: block !important;     }      #pozvonim-button .pozvonim-button-text {         <% if (callback.buttonConfig.size == 1) { %>             padding: 1px 16px !important;         <% } else { %>             padding: 1px !important;         <% } %>         background-color: <%= callback.window_style.opener_hover_background %> !important;         color: <%= callback.window_style.opener_text_color %> !important;         border-radius: 100% !important;         display: none !important;         width: <%= 90 * callback.buttonConfig.scale %>px !important;         height: <%= 90 * callback.buttonConfig.scale %>px !important;         left: <%= 33 * callback.buttonConfig.scale %>px !important;         top: <%= 33 * callback.buttonConfig.scale %>px !important;         margin: 0 !important;         position: absolute;         text-align: center !important;         font-size: 14px !important;         font-family: "Open Sans", "Helvetica Neue", "Helvetica", arial, sans-serif !important;         font-weight: 500 !important;         line-height: 19px !important;     }      #pozvonim-button .pozvonim-button-center-text {         vertical-align: middle;         text-align: center;         color:<%=callback.window_style.opener_text_color%> !important;         display: table-cell !important;         height: <%= 90 * callback.buttonConfig.scale %>px !important;         width: <%= 90 * callback.buttonConfig.scale %>px !important;         word-break: break-all !important;         line-height: 14px !important;         padding: 0 !important;         font-size: 14px !important;         font-weight: 500 !important;         font-family: "Open Sans", "Helvetica Neue", "Helvetica", arial, sans-serif !important;         white-space: pre-wrap !important;     }      <%}%>     .callback__wrap {         font-size: 16px;     }      /*  ..          .callback__button {         position: fixed;         width: 3em;         height: 3em;         border-radius: 100%;         background-color: #80be00;         cursor: pointer;         -webkit-box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7);          box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7);         -webkit-animation: pulse 1.65s infinite cubic-bezier(0.66, 0, 0, 1);         animation: pulse 1.65s infinite cubic-bezier(0.66, 0, 0, 1);         transition: all .2s ease;         z-index: 2147483642 !important;         background-color: <%= callback.window_style.opener_hover_background %> !important;         color: <%= callback.window_style.opener_text_color %> !important;     }      .callback__button--hide {         visibility: hidden;         opacity: 0;     }*/      @-webkit-keyframes pulse {         to {             -webkit-box-shadow: 0 0 0 1.5625em rgba(255, 255, 255, 0.2);             box-shadow: 0 0 0 1.5625em rgba(255, 255, 255, 0.2);         }     }      @keyframes pulse {         to {             -webkit-box-shadow: 0 0 0 1.5625em rgba(255, 255, 255, 0.2);             box-shadow: 0 0 0 1.5625em rgba(255, 255, 255, 0.2);         }     }      /*  ..          .callback__button > img {         position: absolute;         top: 50%;         left: 50%;         margin-left: -.75em;         margin-top: -.75em;         height: 1.5em     }*/     <% if(!is_mobile){%>     .callback__overlay {         z-index: 2147483640 !important;         position: fixed !important;         border: none !important;         top: 0 !important;         left: 0 !important;         right: 0 !important;         bottom: 0 !important;         <% if (callback.buttonConfig.window_cover) { %>         background-color: rgba(0, 0, 0, .5) !important;         <% } %>         opacity: 0 !important;         visibility: hidden !important;         transition: all .2s ease !important;     }     <%} else {%>     .callback__overlay {         z-index: 2147483640 !important;         position: absolute !important;         border: none !important;         padding: 0;         margin:0;         -webkit-text-size-adjust: 100%; /* 3 */         -webkit-font-smoothing: subpixel-antialiased;         font-smoothing: subpixel-antialiased;         -webkit-backface-visibility: hidden;         backface-visibility: hidden;         -webkit-backface-visibility: hidden;      <% if (callback.buttonConfig.window_cover) { %>         background-color: rgba(0, 0, 0, .5) !important;     <% } %>         opacity: 0 !important;         visibility: hidden !important;      }     <%}%>     .callback__overlay--active {         z-index: 2147483641 !important;         opacity: 1 !important;         visibility: visible !important;     }      .callback__arrow {         background-color: rgba(218, 218, 219, 0.7);         position: fixed;         cursor: pointer;         transition: all .2s ease;     }      .callback__arrow:hover {         background-color: rgba(218, 218, 219, 1)     }      .callback__arrow-icon {         width: 100%;         height: 100%;         background-repeat: no-repeat;         background-position: center;         opacity: .5;         transition: all .2s ease;         background-size: 1.5em;     }      .callback__arrow:hover .callback__arrow-icon {         opacity: 1;     }      .callback__arrow--bottom, .callback__arrow--top {         width: 4em;         height: 1.25em;         left: 50%;         margin-left: -2em;     }      .callback__arrow--left, .callback__arrow--right {         width: 1.25em;         height: 4em;         top: 50%;         margin-top: -2em;     }      .callback__arrow--bottom {         bottom: 0;         border-radius: .1875em .1875em 0 0     }      .callback__arrow--top {         top: 0;         border-radius: 0 0 .1875em .1875em     }      .callback__arrow--left {         left: 0;         border-radius: 0 .1875em .1875em 0     }      .callback__arrow--right {         right: 0;         border-radius: .1875em 0 0 .1875em     }      .callback__arrow--bottom .callback__arrow-icon {         background-image: url(<%=cdnPath%>/callback/static/img/callback_slide_top.svg);     }      .callback__arrow--top .callback__arrow-icon {         background-image: url(<%=cdnPath%>/callback/static/img/callback_slide_bottom.svg);     }      .callback__arrow--left .callback__arrow-icon {         background-image: url(<%=cdnPath%>/callback/static/img/callback_slide_right.svg);     }      .callback__arrow--right .callback__arrow-icon {         background-image: url(<%=cdnPath%>/callback/static/img/callback_slide_left.svg);     }      <%if(is_mobile){%>     .callback-frame {         width: 100%;         height: 100%;         position:absolute;         top:0;         left:0;         -webkit-font-smoothing: antialiased;         font-smoothing: antialiased;         -webkit-backface-visibility: hidden;         backface-visibility: hidden;         z-index: 2147483643 !important;         background: transparent !important;     }     <%} else {%>     .callback-frame {         position: fixed;         transition: all .2s ease;         width: 100%;         height: 100vh;         z-index: 2147483643 !important;         background: transparent !important;          left: 0;         top: 0;         min-width: 0;         max-width: none;         margin: inherit;         bottom: auto;         right: auto;         boder: 0 !important;     }       .callback-frame--active.callback-frame--bottom {         transform: translateY(0);     }      .callback-frame--active.callback-frame--top {         transform: translateY(0);     }      .callback-frame--active.callback-frame--center {         transform: scale(1);         transform-origin: 50% 50%;         opacity: 1;     }      .callback-frame--active.callback-frame--left {         transform: translateX(0);     }      .callback-frame--active.callback-frame--right {         transform: translateX(0);     }      .callback-frame--bottom {         bottom: 0;         left: 0;         transform: translateY(100%)     }      .callback-frame--top {         top: 0;         left: 0;         transform: translateY(-100%)     }      .callback-frame--center {         transform-origin: 50% 50%;         opacity: 0;         transform: scale(.8);     }      .callback-frame--left {         top: 0;         left: 0;         transform: translateX(-100%)     }      .callback-frame--right {         top: 0;         right: 0;         transform: translateX(100%)     }     <%}%>     .callback-frame--active.callback-frame {         opacity: 1;         visibility: visible;         display: block  !important;     }      <% if (callback.mini_enable === 1) { %>     #pozvonim-mini-wrapper {         position: fixed;         z-index: 10000000 !important;     }     <% } %>      <% if (callback.buttonConfig.size === 2) { %>         .button-icon { padding: 32px; }     <% } else if (callback.buttonConfig.size === 1) { %>         .button-icon { padding: 25px; }         <% if (is_mobile) { %>             .button-icon { padding: 10px; }         <% } %>     <% } else if (callback.buttonConfig.size === 0) { %>         .button-icon { padding: 15px; }         <% if (is_mobile) { %>             .button-icon { padding: 5px; }         <% } %>     <% } else { %>         .button-icon { }     <% } %> </style> <% if (callback.mini_enable === 1 && !is_mobile) { %> <div id="pozvonim-mini-wrapper"></div> <% } else if (callback.buttonConfig.enable === 1) { %> <div id="pozvonim-button" class="<%= callback.buttonConfig.position %>">     <div class="pozvonim-button-wrapper actionShow">         <% if (callback.buttonConfig.wawes) { %>         <div class="pozvonim-button-border-inner"></div>         <div class="pozvonim-button-border-outer"></div>         <% } %>         <% if (callback.buttonConfig.text && !is_mobile) { %>             <div class="pozvonim-button-text pozvonim-animated">                 <span class="pozvonim-button-center-text"><%= ($.trim(callback.window_text.button.hover)) %></span>             </div>         <% } %>         <% if (callback.button_icon.logo_file) { %>             <div class="pozvonim-button-phone pozvonim-animated"></div>         <% } else if (callback.button_icon.logo) { %>             <div class="pozvonim-button-phone pozvonim-animated button-icon"><%= callback.button_icon.logo %></div>         <% } else { %>             <div class="pozvonim-button-phone pozvonim-animated"></div>         <% } %>     </div> </div> <% } %> <div class="callback__wrap">     <% if (callback.buttonConfig.arrow) { %>     <div class="callback__arrow callback__arrow--<%= callback.window_position %> js__callback-button actionShow">         <div class="callback__arrow-icon"></div>     </div>     <% } %>  </div> <div class="callback__overlay actionHide" id="pozvonim-wrapper"></div> <% } %> <% if(chat.is_enable){ %> <style type="text/css">     /***************** CHAT **************************/     #pozvonim-wrapper-chat {     <% if (is_mobile){%> -webkit-backface-visibility: hidden;         -webkit-transform: translateZ(0);         transform-origin: center center 0 !important;          position: absolute !important;         font-size: 30px;     <%} else { %> position: fixed !important;         font-size: 16px;     <%}%> z-index: 30000000 !important;         min-width: 0 !important;      }      <%if(!is_mobile){%>     #pozvonim-wrapper-chat.CHAT-BOTTOM-LEFT {         left: 0;         bottom: 0;     }      #pozvonim-wrapper-chat.CHAT-TOP-LEFT {         left: 0;         top: 0;     }      #pozvonim-wrapper-chat.CHAT-TOP-RIGHT {         right: 0;         top: 0;     }      #pozvonim-wrapper-chat.CHAT-BOTTOM-RIGHT {         right: 0;         bottom: 0;     }      #pozvonim-wrapper-chat.CHAT-RANDOM-POSITION[data-type-random-block="top-left"] {         top: <%= chat.button.place.position.top %>%;         left: <%= chat.button.place.position.left %>%;     }      #pozvonim-wrapper-chat.CHAT-RANDOM-POSITION[data-type-random-block="top-right"] {         top: <%= chat.button.place.position.top %>%;         right: <%= 100-chat.button.place.position.left %>%;         left: inherit;     }      #pozvonim-wrapper-chat.CHAT-RANDOM-POSITION[data-type-random-block="bottom-left"] {         bottom: <%= 100-chat.button.place.position.top %>%;         left: <%= chat.button.place.position.left %>%;         top: inherit;     }      #pozvonim-wrapper-chat.CHAT-RANDOM-POSITION[data-type-random-block="bottom-right"] {         bottom: <%= 100-chat.button.place.position.top %>%;         right: <%= 100-chat.button.place.position.left %>%;         top: inherit;         left: inherit;     }      <%}%>     <% if(chat.button.type == 1){ %>      #pozvonim-wrapper-chat.CHAT-TOP-LEFT,     #pozvonim-wrapper-chat.CHAT-TOP-LEFT iframe,     #pozvonim-wrapper-chat.CHAT-TOP-LEFT div {         top: 15%;         height: 27em;         width: 3em;     }      #pozvonim-wrapper-chat.CHAT-BOTTOM-RIGHT,     #pozvonim-wrapper-chat.CHAT-BOTTOM-RIGHT iframe,     #pozvonim-wrapper-chat.CHAT-BOTTOM-RIGHT div {         right: 0;         bottom: 0;         height: 2.6em;         width: 15.5em;     }      #pozvonim-wrapper-chat.CHAT-BOTTOM-LEFT,     #pozvonim-wrapper-chat.CHAT-BOTTOM-LEFT iframe,     #pozvonim-wrapper-chat.CHAT-BOTTOM-LEFT div {         left: 0;         bottom: 0;         height: 2.6em;         width: 16em;     }      #pozvonim-wrapper-chat.CHAT-TOP-RIGHT,     #pozvonim-wrapper-chat.CHAT-TOP-RIGHT iframe,     #pozvonim-wrapper-chat.CHAT-TOP-RIGHT div {         right: 0;         top: 15%;         height: 27em;         width: 3em;     }      #pozvonim-wrapper-chat.CHAT-BOTTOM-LEFT div,     #pozvonim-wrapper-chat.CHAT-BOTTOM-RIGHT div,     #pozvonim-wrapper-chat.CHAT-TOP-LEFT div,     #pozvonim-wrapper-chat.CHAT-TOP-RIGHT div {         top: 0;         left: 0;     }      #pozvonim-wrapper-chat[data-type-view=\'invite\'],     #pozvonim-wrapper-chat[data-type-view=\'invite\'] iframe,     #pozvonim-wrapper-chat[data-type-view=\'invite\'] div {         height: 16em;         width: 18em;     }      #pozvonim-wrapper-chat.CHAT-TOP-LEFT[data-type-view=\'invite\'],     #pozvonim-wrapper-chat.CHAT-TOP-LEFT[data-type-view=\'invite\'] iframe,     #pozvonim-wrapper-chat.CHAT-TOP-LEFT[data-type-view=\'invite\'] div,     #pozvonim-wrapper-chat.CHAT-TOP-RIGHT[data-type-view=\'invite\'],     #pozvonim-wrapper-chat.CHAT-TOP-RIGHT[data-type-view=\'invite\'] iframe,     #pozvonim-wrapper-chat.CHAT-TOP-RIGHT[data-type-view=\'invite\'] div {         height: 29em;     }      <% } %>      #pozvonim-wrapper-chat.small[data-type-view=\'minify\'],     #pozvonim-wrapper-chat.small[data-type-view=\'minify\'] iframe,     #pozvonim-wrapper-chat.small[data-type-view=\'minify\'] div {         height: 6.3em;         width: 6.3em;     }      #pozvonim-wrapper-chat.medium[data-type-view=\'minify\'],     #pozvonim-wrapper-chat.medium[data-type-view=\'minify\'] iframe,     #pozvonim-wrapper-chat.medium[data-type-view=\'minify\'] div {         height: 8em;         width: 8em;     }      #pozvonim-wrapper-chat.big[data-type-view=\'minify\'],     #pozvonim-wrapper-chat.big[data-type-view=\'minify\'] iframe,     #pozvonim-wrapper-chat.big[data-type-view=\'minify\'] div {         height: 9.51em;         width: 9.51em;     }      #pozvonim-wrapper-chat.small[data-type-view=\'invite\'],     #pozvonim-wrapper-chat.small[data-type-view=\'invite\'] iframe,     #pozvonim-wrapper-chat.small[data-type-view=\'invite\'] div {         height: 18em;         width: 19em;     }      #pozvonim-wrapper-chat.medium[data-type-view=\'invite\'],     #pozvonim-wrapper-chat.medium[data-type-view=\'invite\'] iframe,     #pozvonim-wrapper-chat.medium[data-type-view=\'invite\'] div {         height: 19.7em;         width: 19em;     }      #pozvonim-wrapper-chat.big[data-type-view=\'invite\'],     #pozvonim-wrapper-chat.big[data-type-view=\'invite\'] iframe,     #pozvonim-wrapper-chat.big[data-type-view=\'invite\'] div {         height: 21.2em;         width: 19em;     }      #pozvonim-wrapper-chat div {         position: absolute;         cursor: pointer;     }      <% if(is_mobile){ %>     #pozvonim-wrapper-chat[data-type-view=\'full\'],     #pozvonim-wrapper-chat[data-type-view=\'full\'] iframe {         height: 100%;         width: 100%;         /*                 top: 0!important;                 left: 0!important;*/     }      <% } else { %>     #pozvonim-wrapper-chat[data-type-view=\'full\'] div,     #pozvonim-wrapper-chat[data-type-view=\'full-open\'] div {         width: 16.7em;         height: 1.36em;     }      #pozvonim-wrapper-chat[data-type-view=\'full\'],     #pozvonim-wrapper-chat[data-type-view=\'full\'] iframe {         height: 30em;         width: 20em;     }      <%}%>      #pozvonim-wrapper-chat[data-type-view=\'full-open\'],     #pozvonim-wrapper-chat[data-type-view=\'full-open\'] iframe {         height: 100% !important;         width: 20em !important;         top: 0 !important;     }      <% if(!is_mobile){ %>      #pozvonim-wrapper-chat[data-type-view=\'full\'][data-type-random-block="top-left"],     #pozvonim-wrapper-chat[data-type-view=\'full\'][data-type-random-block="top-left"] iframe,     #pozvonim-wrapper-chat[data-type-view=\'full-open\'][data-type-random-block="top-left"],     #pozvonim-wrapper-chat[data-type-view=\'full-open\'][data-type-random-block="top-left"] iframe {         top: 0 !important;         left: 0 !important;     }      #pozvonim-wrapper-chat[data-type-view=\'full\'][data-type-random-block="top-right"],     #pozvonim-wrapper-chat[data-type-view=\'full\'][data-type-random-block="top-right"] iframe,     #pozvonim-wrapper-chat[data-type-view=\'full-open\'][data-type-random-block="top-right"],     #pozvonim-wrapper-chat[data-type-view=\'full-open\'][data-type-random-block="top-right"] iframe {         top: 0 !important;         right: 0 !important;         left: inherit;     }      #pozvonim-wrapper-chat[data-type-view=\'full\'][data-type-random-block="bottom-left"],     #pozvonim-wrapper-chat[data-type-view=\'full\'][data-type-random-block="bottom-left"] iframe,     #pozvonim-wrapper-chat[data-type-view=\'full-open\'][data-type-random-block="bottom-left"],     #pozvonim-wrapper-chat[data-type-view=\'full-open\'][data-type-random-block="bottom-left"] iframe {         bottom: 0 !important;         left: 0 !important;         top: inherit;     }      #pozvonim-wrapper-chat[data-type-view=\'full\'][data-type-random-block="bottom-right"],     #pozvonim-wrapper-chat[data-type-view=\'full\'][data-type-random-block="bottom-right"] iframe,     #pozvonim-wrapper-chat[data-type-view=\'full-open\'][data-type-random-block="bottom-right"],     #pozvonim-wrapper-chat[data-type-view=\'full-open\'][data-type-random-block="bottom-right"] iframe {         bottom: 0 !important;         right: 0 !important;         top: inherit;         left: inherit;     }      <% } %>      /*       <% if(chat.button.place.position.class == \'CHAT-BOTTOM-RIGHT\' && callback.buttonConfig.enable == 1 && callback.buttonConfig.position == \'BOTTOM-RIGHT\'){ %>               #pozvonim-wrapper-chat.CHAT-BOTTOM-RIGHT {                 margin-right: 160px;                 margin-bottom: 30px;             }        <% } %>         <% if(chat.button.place.position.class == \'CHAT-TOP-LEFT\' && callback.buttonConfig.enable == 1 && callback.buttonConfig.position == \'TOP_LEFT\'){ %>               #pozvonim-wrapper-chat.CHAT-TOP-LEFT {                 margin-left: 150px;                 margin-top: 15px;             }        <% } %>         <% if(chat.button.place.position.class == \'CHAT-TOP-RIGHT\' && callback.buttonConfig.enable == 1 && callback.buttonConfig.position == \'TOP_RIGHT\'){ %>               #pozvonim-wrapper-chat.CHAT-TOP-RIGHT {                 margin-top: 15px;                 margin-right: 150px;             }        <% } %>         <% if(chat.button.place.position.class == \'CHAT-BOTTOM-LEFT\' && callback.buttonConfig.enable == 1 && callback.buttonConfig.position == \'BOTTOM_LEFT\'){ %>               #pozvonim-wrapper-chat.CHAT-BOTTOM-LEFT {                 margin-bottom: 35px;                 margin-left: 150px;             }        <% } %>               */     /***************** CHAT **************************/ </style> <div id="pozvonim-wrapper-chat" class="resizeable pozvonim-wrapper <%= chat.button.place.position.class %> <%= (chat.button.type) ? \'\' : chat.button.size %>" style="display:none;">     <div></div> </div> <% } %>';template.chat='<!DOCTYPE html> <html lang="ru" class="no-js"> <head>     <meta charset="UTF-8"/>     <meta http-equiv="x-ua-compatible" content="ie=edge">     <meta name="viewport" content="width=device-width, initial-scale=1.0"/>     <title>Chat</title>     <meta name="description" content="">     <meta name="keywords" content="">     <link href=\'https://fonts.googleapis.com/css?family=Open+Sans:400,500,600&subset=latin,cyrillic\' rel=\'stylesheet\' type=\'text/css\'>     <link rel="stylesheet" href="<%= cdnPath %>/plugins/chat/static/css/style.css?build=ver.1.9">     <link rel="stylesheet" href="<%= cdnPath %>/plugins/chat/static/css/smile.css">     <style type="text/css">         #pozvonim-chat.pozvonim-chat--base .consultant__avatar {             border-color: <%= chat.button.color.border %>;             background: <%= chat.button.color.background %>;             -webkit-box-shadow: 0 0 0 0 <%= chat.button.color.border %>;             box-shadow: 0 0 0 0 <%= chat.button.color.border %>;         }          #pozvonim-chat.pozvonim-chat--base .consultant__avatar svg,         #pozvonim-chat.pozvonim-chat--panel .consultant__avatar svg {             fill: <%= chat.button.color.svg %>;         }          #pozvonim-chat.pozvonim-chat--panel .consultant__avatar {             width: 1.625rem;             height: 1.625rem;             background: <%= chat.button.color.background %>;             border: 0.125rem solid <%= chat.button.color.border %>;         }          #pozvonim-chat.pozvonim-chat--panel {             background-color: <%= chat.button.color.background %>;         }          #pozvonim-chat .mess--attachment:hover {             background: <%= chat.chat.background %>;             color: <%= chat.chat.color %>;         }          #pozvonim-chat .header__drop-item:hover {             color: <%= chat.chat.color %>;             background: <%= chat.chat.background %>;         }          #pozvonim-chat .header__drop-item:hover path {             fill: <%= chat.chat.color %>;         }          #pozvonim-chat .header__control-wrap path {             fill: <%= chat.chat.color %>;         }          #pozvonim-chat .header,         #pozvonim-chat .file-bar__inner,         #pozvonim-chat .button__el,         #pozvonim-chat .welcome-chat {             background: <%= chat.chat.background %>;         }          #pozvonim-chat .welcome-chat:before {             content: \'\';             position: absolute;             width: 0;             height: 0;             border-style: solid;             border-color: transparent <%= chat.chat.background %> transparent transparent;             border-width: 0 1.375rem 0.6875rem 0;             bottom: -.375rem;             right: 0.7625rem;             -webkit-border-radius: 0 0 .1875rem 0;             border-radius: 0 0 .1875rem 0;         }          #pozvonim-chat .header__control--minify:before {             content: \'\';             display: block;             width: .75rem;             border-bottom: 0.125rem solid <%= chat.chat.color %>;             position: relative;             top: .375rem;             -webkit-transition: all 0.1s ease;             transition: all 0.1s ease;             opacity: 0.5         }          #pozvonim-chat .messOperator.mess--attachment:hover:before,         #pozvonim-chat .messOperator.mess--attachment:hover:after {             border-color: transparent transparent transparent <%= chat.chat.background %>;         }          #pozvonim-chat .user-message {             border-bottom-color: <%= chat.chat.background %>;         }          #pozvonim-chat .messUsers:before {             border-color: transparent <%= chat.chat.background %> transparent transparent;         }          #pozvonim-chat .text-blue {             color: <%= chat.chat.background %>;         }          #pozvonim-chat .rating__star--active, #pozvonim-chat.smiles__activation--on .smiles__circle {             fill: <%= chat.chat.background %>;         }          #pozvonim-chat.smiles__activation--on .smiles__path {             stroke: <%= chat.chat.background %>         }          #pozvonim-chat .header__control path {             fill: <%= chat.chat.color %>;         }          #pozvonim-chat .header__status {             color: <%= chat.chat.color %>;         }          #pozvonim-chat .messOperator.mess--attachment:hover {             border-color: <%= chat.chat.background %>;         }          #pozvonim-chat .messOperator.mess--attachment:hover .file-title {             color: <%= chat.chat.color %>;         }          #pozvonim-chat .messUsers.mess--attachment .file-title {             color: <%= chat.chat.color %>;         }          #pozvonim-chat.pozvonim-chat--left .welcome-chat:before {             border-color: <%= chat.chat.background %> transparent transparent transparent;             border-width: 0.6875rem 1.375rem 0 0;             -webkit-border-radius: 0 0 0 .1875rem;             border-radius: 0 0 0 .1875rem;             left: 1rem;         }          #pozvonim-chat .chat-text__wrap-message .messUsers .messText {             color: #333;         }          #pozvonim-chat .messUsers {             border: .0625rem solid <%= chat.chat.background %>;             background: <%= chat.chat[\'color-opacity\'] %>;         }          #pozvonim-chat .messUsers:after {             border-color: transparent <%= chat.chat[\'color-opacity\'] %> transparent transparent;         }          #pozvonim-chat .messUsers.mess--attachment:hover:after {             border-color: transparent <%= chat.chat.background %> transparent transparent;         }          #pozvonim-chat.small[data-type-view=\'invite\'][data-start-position="CHAT-BOTTOM-LEFT"] .welcome-chat:before,         #pozvonim-chat.medium[data-type-view=\'invite\'][data-start-position="CHAT-BOTTOM-LEFT"] .welcome-chat:before,         #pozvonim-chat.big[data-type-view=\'invite\'][data-start-position="CHAT-BOTTOM-LEFT"] .welcome-chat:before,         #pozvonim-chat.small[data-type-view=\'invite\'][data-start-position="CHAT-RANDOM-POSITION"][data-type-random-block="bottom-left"] .welcome-chat:before,         #pozvonim-chat.medium[data-type-view=\'invite\'][data-start-position="CHAT-RANDOM-POSITION"][data-type-random-block="bottom-left"] .welcome-chat:before,         #pozvonim-chat.big[data-type-view=\'invite\'][data-start-position="CHAT-RANDOM-POSITION"][data-type-random-block="bottom-left"] .welcome-chat:before{             border-color: <%= chat.chat.background %> transparent transparent transparent;             border-width: 0.6875rem 1.375rem 0 0;             -webkit-border-radius: 0 0 0 .1875rem;             border-radius: 0 0 0 .1875rem;         }          #pozvonim-chat.pozvonim-chat--bottom--left .welcome-chat:before {             border-color: <%= chat.chat.background %> transparent transparent transparent;             border-width: 0.6875rem 1.375rem 0 0;             -webkit-border-radius: 0 0 0 .1875rem;             border-radius: 0 0 0 .1875rem;             left: 1rem;         }          #pozvonim-chat.small[data-type-view=\'invite\'][data-start-position="CHAT-TOP-LEFT"] .welcome-chat:before,         #pozvonim-chat.medium[data-type-view=\'invite\'][data-start-position="CHAT-TOP-LEFT"] .welcome-chat:before,         #pozvonim-chat.big[data-type-view=\'invite\'][data-start-position="CHAT-TOP-LEFT"] .welcome-chat:before,         #pozvonim-chat.small[data-type-view=\'invite\'][data-start-position="CHAT-RANDOM-POSITION"][data-type-random-block="top-left"] .welcome-chat:before,         #pozvonim-chat.medium[data-type-view=\'invite\'][data-start-position="CHAT-RANDOM-POSITION"][data-type-random-block="top-left"] .welcome-chat:before,         #pozvonim-chat.big[data-type-view=\'invite\'][data-start-position="CHAT-RANDOM-POSITION"][data-type-random-block="top-left"] .welcome-chat:before{             top: -.375rem;             border-color: transparent transparent <%= chat.chat.background %> transparent;         }          #pozvonim-chat.small[data-type-view=\'invite\'][data-start-position="CHAT-TOP-LEFT"] .welcome-chat:before,         #pozvonim-chat.small[data-type-view=\'invite\'][data-start-position="CHAT-RANDOM-POSITION"][data-type-random-block="top-left"] .welcome-chat:before{             left: 1.7625rem;         }          #pozvonim-chat.medium[data-type-view=\'invite\'][data-start-position="CHAT-TOP-LEFT"] .welcome-chat:before,         #pozvonim-chat.medium[data-type-view=\'invite\'][data-start-position="CHAT-RANDOM-POSITION"][data-type-random-block="top-left"] .welcome-chat:before{             left: 2.2625rem;         }          #pozvonim-chat.big[data-type-view=\'invite\'][data-start-position="CHAT-TOP-LEFT"] .welcome-chat:before,         #pozvonim-chat.big[data-type-view=\'invite\'][data-start-position="CHAT-RANDOM-POSITION"][data-type-random-block="top-left"] .welcome-chat:before{             left: 3.2625rem;         }          #pozvonim-chat.small[data-type-view=\'invite\'][data-start-position="CHAT-TOP-RIGHT"] .welcome-chat:before,         #pozvonim-chat.medium[data-type-view=\'invite\'][data-start-position="CHAT-TOP-RIGHT"] .welcome-chat:before,         #pozvonim-chat.big[data-type-view=\'invite\'][data-start-position="CHAT-TOP-RIGHT"] .welcome-chat:before,         #pozvonim-chat.small[data-type-view=\'invite\'][data-start-position="CHAT-RANDOM-POSITION"][data-type-random-block="top-right"] .welcome-chat:before,         #pozvonim-chat.medium[data-type-view=\'invite\'][data-start-position="CHAT-RANDOM-POSITION"][data-type-random-block="top-right"] .welcome-chat:before,         #pozvonim-chat.big[data-type-view=\'invite\'][data-start-position="CHAT-RANDOM-POSITION"][data-type-random-block="top-right"] .welcome-chat:before{             top: -.375rem;             border-color: transparent transparent <%= chat.chat.background %> transparent;         }          #pozvonim-chat.medium[data-type-view=\'invite\'][data-start-position="CHAT-TOP-RIGHT"] .welcome-chat:before,         #pozvonim-chat.medium[data-type-view=\'invite\'][data-start-position="CHAT-RANDOM-POSITION"][data-type-random-block="top-right"] .welcome-chat:before{             right: 1.525rem;         }          #pozvonim-chat.big[data-type-view=\'invite\'][data-start-position="CHAT-TOP-RIGHT"] .welcome-chat:before,         #pozvonim-chat.big[data-type-view=\'invite\'][data-start-position="CHAT-RANDOM-POSITION"][data-type-random-block="top-right"] .welcome-chat:before{             right: 2.525rem;         }          #pozvonim-chat.small[data-type-view=\'invite\'][data-start-position="CHAT-BOTTOM-RIGHT"] .welcome-chat:before,         #pozvonim-chat.small[data-type-view=\'invite\'][data-start-position="CHAT-RANDOM-POSITION"][data-type-random-block="bottom-right"] .welcome-chat:before{             right: 2.8rem;         }          #pozvonim-chat.medium[data-type-view=\'invite\'][data-start-position="CHAT-BOTTOM-RIGHT"] .welcome-chat:before,         #pozvonim-chat.medium[data-type-view=\'invite\'][data-start-position="CHAT-RANDOM-POSITION"][data-type-random-block="bottom-right"] .welcome-chat:before{             right: 3.6rem;         }          #pozvonim-chat.big[data-type-view=\'invite\'][data-start-position="CHAT-BOTTOM-RIGHT"] .welcome-chat:before,         #pozvonim-chat.big[data-type-view=\'invite\'][data-start-position="CHAT-RANDOM-POSITION"][data-type-random-block="bottom-right"] .welcome-chat:before{             right: 4.7rem;         }     </style>     <% if(is_mobile){ %>         <link rel="stylesheet" href="<%= cdnPath %>/plugins/chat/static/css/media.css">         <style>             #pozvonim-chat.pozvonim-chat{                 width:100%;                 height:100%;                 -webkit-backface-visibility: hidden;                 -webkit-transform: translateZ(0);              }             #pozvonim-chat.pozvonim-chat--open{                 width:100%;                 height:100%;                 -webkit-backface-visibility: hidden;                 -webkit-transform: translateZ(0);              }             @media screen and (max-width: 31.25rem), (max-device-width: 1024px) and (-webkit-min-device-pixel-ratio: 2), (max-device-width: 800px) and (-webkit-min-device-pixel-ratio: 1.5) {                 #pozvonim-chat .user-message__input{                     -webkit-border-radius: .1875rem;                     border-radius: .1875rem;                     width: 100%;                     -webkit-box-sizing: border-box;                     box-sizing: border-box;                     background-color: #fff;                     border: .0625rem solid <%= chat.chat.background %>;                     -webkit-box-shadow: 0 0 0 0.125rem rgba(204, 204, 204, 0.3);                     box-shadow: 0 0 0 0.125rem rgba(204, 204, 204, 0.3);                     position: relative;                     -webkit-transition: all 0.1s ease;                     transition: all 0.1s ease;                 }             }         </style>     <% } %> </head> <body class="chat"> <!-- Chat open --> <div class="pozvonim-chat pozvonim-chat--open pozvonim-chat--element-hidden pozvonim-chat-open ui-draggable" id="pozvonim-chat" data-start-position="<%= chat.button.place.position.class %>">      <div class="pozvonim-chat__panel-message pozvonim-chat-open"> </div>      <!-- Welcome chat -->     <div class="welcome-chat animation text-right pozvonim-chat-open">         <i class="welcome-chat__close animation">             <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid" width="10" height="10" viewBox="0 0 10 10">                 <path fill="#fff"                       d="M9.804 1.067L5.868 5.003l3.898 3.898a.625.625 0 0 1-.884.884L4.984 5.887 1.068 9.803a.63.63 0 0 1-.891-.891l3.916-3.916L.195 1.098a.625.625 0 0 1 .884-.884l3.898 3.898L8.913.176a.63.63 0 0 1 .891.891z"                       id="path-1" class="cls-2" fill-rule="evenodd"/>             </svg>         </i>         <div class="welcome-chat__text"></div>         <i class="typing__loading typing__loading--welcome-text typing__loading--white box-inline box-inline--center"><i></i></i>     </div>      <!-- Consultant avatar -->     <div class="consultant__avatar animation pozvonim-chat-open box-inline box-inline--center"></div>      <!-- Chat body -->     <div class="pozvonim-chat__body animation">         <div class="header text-center relative">             <div class="header__status vertical-center-wrap"><span class="vertical-center"> </span></div>             <div class="header__control-wrap box-inline-wrap">                 <div class="header__control header__control--drop box-inline box-inline--top " style="display: none">                     <svg class="animation header__icon header__drop-activate" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid" width="10" height="10" viewBox="0 0 10 10">                         <path fill="#fff"                               d="M9.539 3.935l-.754.313c.093.48.097.981-.002 1.479l.747.309a.763.763 0 0 1-.583 1.409l-.75-.311c-.28.414-.633.758-1.034 1.027l.313.754a.761.761 0 1 1-1.408.584l-.313-.754a3.842 3.842 0 0 1-1.473.001l-.316.761a.763.763 0 1 1-1.408-.583l.316-.763A3.821 3.821 0 0 1 1.84 7.124l-.753.312a.763.763 0 0 1-.583-1.409l.753-.312a3.798 3.798 0 0 1-.005-1.457l-.757-.314a.763.763 0 0 1 .583-1.409l.755.313A3.795 3.795 0 0 1 2.879 1.8l-.312-.753A.762.762 0 1 1 3.975.463l.312.754a3.84 3.84 0 0 1 1.465-.004l.306-.74a.763.763 0 0 1 1.409.583l-.307.74c.42.282.769.638 1.041 1.042l.754-.312a.764.764 0 0 1 .584 1.409zM5.917 2.83a2.329 2.329 0 1 0-1.784 4.303A2.329 2.329 0 0 0 5.917 2.83zM4.539 6.165a1.275 1.275 0 1 1 .975-2.356 1.275 1.275 0 0 1-.975 2.356z"                               class="cls-2" fill-rule="evenodd"/>                     </svg>                     <div class="header__drop">                         <div class="header__drop-inner">                             <p class="header__drop-item animation">                                 <span class="box-inline box-inline--center header__drop-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12"><path fill="#b3b3b3" fill-rule="evenodd"                                  d="M6.2 1a.739.739 0 0 0-.364.1.218.218 0 0 0-.03.02L3 4H1a.906.906 0 0 0-1 1v2a.97.97 0 0 0 1 1h2l2.8 2.877a.225.225 0 0 0 .037.026A.737.737 0 0 0 6.2 11a1.1 1.1 0 0 0 .8-1V2a1.1 1.1 0 0 0-.8-1zm2.749.881a.234.234 0 0 0-.293.136.215.215 0 0 0 .144.276 3.825 3.825 0 0 1 2.738 3.6 3.827 3.827 0 0 1-2.733 3.6.215.215 0 0 0-.144.276.23.23 0 0 0 .218.147.242.242 0 0 0 .076-.016A4.264 4.264 0 0 0 12 5.891a4.262 4.262 0 0 0-3.051-4.01zM9.99 6a2.16 2.16 0 0 0-1.756-1.993.186.186 0 0 0-.223.105.152.152 0 0 0 .123.19A1.84 1.84 0 0 1 9.63 6a1.84 1.84 0 0 1-1.495 1.7.152.152 0 0 0-.123.19.179.179 0 0 0 .172.11.219.219 0 0 0 .05-.006A2.16 2.16 0 0 0 9.99 6z"/></svg></span>                                 <span class="box-inline box-inline--center"> </span>                             </p>                             <p class="header__drop-item animation">                            <span class="box-inline box-inline--center header__drop-icon">                               <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12"><path fill="#b3b3b3" fill-rule="evenodd"                                  d="M10.452 9.12s-.89-.275-2.335-.783a.6.6 0 0 0-.535-.589h-.468l.069-1a2 2 0 0 0 1.175-1.577 19.1 19.1 0 0 0 .219-2.606A2.35 2.35 0 0 0 5.981 0h-.06a2.384 2.384 0 0 0-2.487 2.566 25.541 25.541 0 0 0 .218 2.606 1.882 1.882 0 0 0 1.175 1.571l.069 1h-.469a.624.624 0 0 0-.535.613c-1.4.532-2.5.83-2.5.83C.347 9.6.03 10.08 0 10.61v.9l.019.129a.507.507 0 0 0 .094.183.43.43 0 0 0 .234.154.446.446 0 0 0 .108.024h11.076a.416.416 0 0 0 .32-.149.637.637 0 0 0 .149-.338v-.865a.467.467 0 0 0-.016-.1 2.432 2.432 0 0 0-1.532-1.428z"/></svg>                            </span>                                 <span class="box-inline box-inline--center"> </span>                             </p>                             <p class="header__drop-item animation">                            <span class="box-inline box-inline--center header__drop-icon">                               <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12"><path fill="#b3b3b3" fill-rule="evenodd"                                  d="M6.039 9.42a.844.844 0 0 0 .647-.243L10.892 5A.857.857 0 0 0 9.68 3.787l-2.823 2.8V.857a.857.857 0 0 0-1.714 0v5.734L2.32 3.787A.857.857 0 0 0 1.108 5l4.2 4.178a.847.847 0 0 0 .645.244c.015 0 .027.008.042.008s.031-.009.044-.01zm-5.182.865h10.286a.857.857 0 1 1 0 1.714H.857a.857.857 0 1 1 0-1.714z"/></svg>                            </span>                                 <span class="box-inline box-inline--center"> </span>                             </p>                             <p class="header__drop-item animation">                            <span class="box-inline box-inline--center header__drop-icon">                               <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12"><path fill="#b3b3b3" fill-rule="evenodd"                                  d="M11.76 8.273L7.56.912a1.779 1.779 0 0 0-3.107 0L.242 8.273A1.817 1.817 0 0 0 1.8 11h8.4a1.826 1.826 0 0 0 1.56-2.727zM6 9.988a.985.985 0 1 1 0-1.969.984.984 0 1 1 0 1.969zm.931-5.343c-.044.486-.092.97-.131 1.455a3.171 3.171 0 0 0-.022.456.677.677 0 0 1-.75.456.672.672 0 0 1-.75-.442c-.066-.757-.136-1.5-.2-2.258-.022-.2-.044-.4-.07-.6a.794.794 0 0 1 .772-.686 1.232 1.232 0 0 1 1.158.357.515.515 0 0 1 .092.315c-.03.319-.077.634-.099.947z"/></svg>                            </span>                                 <span class="box-inline box-inline--center"></span>                             </p>                             <p class="header__drop-item animation">                            <span class="box-inline box-inline--center header__drop-icon">                               <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid" width="10" height="10" viewBox="0 0 10 10"><path fill="#b3b3b3" fill-rule="evenodd"                                   d="M9.804 1.067L5.868 5.003l3.898 3.898a.625.625 0 0 1-.884.884L4.984 5.887 1.068 9.803a.63.63 0 0 1-.891-.891l3.916-3.916L.195 1.098a.625.625 0 0 1 .884-.884l3.898 3.898L8.913.176a.63.63 0 0 1 .891.891z"                                   id="path-1" class="cls-2" fill-rule="evenodd"/></svg>                            </span>                                 <span class="box-inline box-inline--center"> </span>                             </p>                         </div>                     </div>                 </div>                 <div class="header__control header__control--right-sidebar box-inline box-inline--top animation">                     <svg class="animation header__icon" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid" width="8" height="8" viewBox="0 0 8 8">                         <path fill="#fff"                               d="M7.941.937c.028.103.065.204.065.316l-.002.005v3.651c0 .673-.548 1.219-1.223 1.219a1.222 1.222 0 0 1-1.224-1.219v-.768L2.055 7.625a1.218 1.218 0 0 1-1.717 0 1.207 1.207 0 0 1 0-1.711l3.461-3.442h-.687a1.222 1.222 0 0 1-1.224-1.219c0-.674.548-1.219 1.224-1.219H6.64c.032-.004.062.009.094.008.016-.001.03-.01.047-.01.042 0 .078.02.119.024.12.01.235.025.347.07.024.01.043.028.066.04.113.053.23.1.325.195.122.121.21.263.269.413v.001c.021.05.019.109.034.162z"                               class="cls-2" fill-rule="evenodd"/>                     </svg>                 </div>                 <div class="header__control header__control--minify box-inline box-inline--top animation"></div>             </div>         </div>         <!-- Consultant -->         <div class="consultant">             <div class="consultant__text box-inline box-inline--center">                 <div class="consultant__name"></div>                 <div class="consultant__post text-small"></div>             </div>         </div>         <!-- Notification  DEMO-->         <div class="connection animation" id="connection" style="display: none;">             <div class="reconnecting animation" style="display: none;">                 <p>  </p>                 <p>  <i class="fa fa-plug"><i></i></i></p>             </div>             <div class="disconnect animation" style="display: none;">                 <p>  </p>                 <p> ,  .</p>             </div>         </div>          <div class="present-send-form" style="display: none;">             <form action="" class="form form--authorized">                 <i class="form__back-button vertical-center-wrap text-center animation cancelPresentChat">                     <svg class="vertical-center" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid" width="8" height="12" viewBox="0 0 8 12">                         <path fill="<%= chat.chat.background %>"                               d="M3.119 5.927l3.885-3.885a1 1 0 0 0 0-1.414L6.65.274a.999.999 0 0 0-1.414 0L.664 4.847c-.008.007-.017.009-.024.016l-.353.353a.999.999 0 0 0-.292.711.997.997 0 0 0 .292.711l.353.354c.007.007.017.009.024.015l4.572 4.573a1 1 0 0 0 1.414 0l.354-.353c.39-.391.39-1.024 0-1.415L3.119 5.927z"                               id="path-1" class="cls-2" fill-rule="evenodd"/>                     </svg>                 </i>                  <div class="text-center form-info">                     <i class="form-info__icon form-info__icon--border form-info__icon--offset-bottom-15 robot_present_logo"></i>                     <p class="form-info__text">,   <span class="text-bold robot_present_name"></span>. <span class="robot_present_text"></p>                 </div>                  <div class="form-field form-field--set form-field--login" style="display: none;">                     <input type="text" class="form-field__input form-field__focus chat-name-element full-form-username-chat" data-attr="text" placeholder=" ">                     <a href="#" class="form-field__login">  <span class="form-field__soc-icon vk-settings-present-chat" alt=""></span><span class="form-field__soc-icon fb-settings-present-chat" alt=""></span></a>                 </div>                 <div class="form-field form-field--set" style="display: none;">                     <input type="text" class="form-field__input form-field__focus chat-email-element full-form-email-chat" data-attr="email" placeholder="E-mail">                 </div>                 <div class="form-field form-field--set" style="display: none;">                     <input type="text" class="form-field__input form-field__focus chat-phone-element" data-attr="phone" placeholder="   +79458521478">                 </div>                 <div class="button form-button">                     <button class="button__el button__el--native button__el--full actionPresentChat" data-demoform="demo__form-2"></button>                 </div>             </form>         </div>          <div class="message-send-form" style="display: none;">             <form action="" class="form">                 <div class="text-center form-info">                     <i class="form-info__icon form-info__icon--mail form-info__icon--offset-bottom"></i>                     <p class="form-info__text"></p>                 </div>                 <div class="form-field form-field--set" style="display: none;">                     <input type="text" class="form-field__input form-field__focus message-email-element" data-attr="email" placeholder="E-mail">                 </div>                 <div class="form-field form-field--set" style="display: none;">                     <input type="text" class="form-field__input form-field__focus message-phone-element" data-attr="phone" placeholder="   +79458521478">                 </div>                 <div class="form-field form-field--set">                     <textarea class="form-field__textarea form-field__focus message-text-element required" placeholder=""></textarea>                 </div>                 <div class="button form-button">                     <button class="button__el button__el--native button__el--full actionMessageChat"></button>                 </div>             </form>         </div>          <div class="message-send-form-finish" style="display: none;">             <form action="" class="form form--thank-you">                 <div class="text-center form-info">                     <i class="form-info__icon form-info__icon--mail form-info__icon--offset-bottom"></i>                     <p class="form-info__text">   !</p>                     <p class="form-info__text chat-email-form-block"></p>                 </div>             </form>         </div>          <!-- Chat  -->         <div class="chat-text custom-scroll_container scroll-box--bottom">             <div class="custom-scroll_inner">                 <div class="chat-text__inner"></div>             </div>              <div class="custom-scroll_bar-y"></div>             <div class="custom-scroll_track-y"></div>         </div>          <div class="typing typing--visible animation" style="display:none;">             <i class="typing__loading typing__loading--grey box-inline box-inline--center"><i></i></i>             <span class="box-inline box-inline--center text-small"></span>         </div>          <div class="pozvonim-chat__footer relative">             <!-- Smiles box -->             <div class="smiles box-inline-wrap custom-scroll_container animation">                 <div class="custom-scroll_inner">                     <div class="smiles__inner">                         <button class="smiles__item"><i class="smiles__smile smiles__smile--263A_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE00_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE01_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE02_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE03_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE05_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE06_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE07_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE09_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE0A_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE0B_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE0C_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE0D_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE0E_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE0F_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE10_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE11_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE12_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE13_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE14_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE15_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE16_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE17_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE18_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE19_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE1A_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE1B_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE1C_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE1D_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE1E_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE1F_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE20_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE21_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE22_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE23_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE24_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE25_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE26_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE27_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE28_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE29_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE2A_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE2B_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE2C_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE2D_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE2E_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE2F_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE30_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE31_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE33_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE34_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE35_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE36_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE38_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE3A_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE3B_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE3C_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE3D_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE3E_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE3F_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE41_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE42_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE43_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDE44_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83DDF20_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83EDD10_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83EDD11_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83EDD13_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83EDD14_2x"></i></button>                         <button class="smiles__item"><i class="smiles__smile smiles__smile--D83EDD17_2x"></i></button>                     </div>                 </div>                 <div class="custom-scroll_bar-y"></div>                 <div class="custom-scroll_track-y"></div>             </div>              <!-- User message box -->             <div class="user-message relative">                 <div class="user-message__text-edit form-field relative">                     <div class="user-message__text-scroll custom-scroll_inner">                         <div class="">                             <div id="pozvonim-widget-chat" class="input-content user-message__input form-field__focus" contenteditable="true"></div>                             <p class="user-message__label">    Enter</p>                             <a class="form__send-message">                                 <svg xmlns="http://www.w3.org/2000/svg" width="14" height="13" viewBox="0 0 14 13">                                     <path fill=\'<%= chat.chat.background %>\' fill-rule=\'evenodd\' d="M0 13l14-6.5L0 0v4.333L8.105 6.5 0 8.667V13z"/>                                 </svg>                             </a>                         </div>                         <div class="custom-scroll_bar-y"></div>                         <div class="custom-scroll_track-y"></div>                     </div>                     <button class="smiles__activation">                         <svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24">                             <path class="smiles__path" stroke-miterlimit="10" stroke-width="2" fill="none" d="M12 1C5.9 1 1 5.9 1 12s4.9 11 11 11 11-4.9 11-11S18.1 1 12 1z"/>                             <path class="smiles__path" stroke-miterlimit="10" stroke-width="2" fill="none" d="M7 15.4C8.1 17 9.9 18 12 18s3.9-1 5-2.6"/>                             <circle cx="8" class="smiles__circle" cy="10" r="2"/>                             <circle cx="16" class="smiles__circle" cy="10" r="2"/>                         </svg>                     </button>                 </div>                 <div class="user-message__down flex flex--space-between flex--align-center">                     <div class="file-add">                         <input type="file" class="chat-file-upload file-add__field">                         <mark class="file-add__mark animation">                             <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid" width="21" height="23" class="file-add__img box-inline--center" viewBox="0 0 21 23">                                 <path fill="#666666"                                       d="M11.763 20.139c-2.617 2.581-7.028 2.531-9.705-.11-2.677-2.641-2.727-6.994-.111-9.576l9.157-9.036c1.919-1.893 5.095-1.857 7.058.08s1.999 5.071.081 6.964l-7.413 7.315c-1.221 1.205-3.162 1.183-4.411-.05-1.25-1.232-1.272-3.148-.051-4.352l6.541-6.454 1.339 1.32-6.541 6.454c-.524.517-.516 1.213.02 1.741.535.529 1.241.537 1.764.02l7.413-7.314c1.221-1.205 1.199-3.12-.05-4.353-1.25-1.233-3.19-1.255-4.411-.05l-9.158 9.036c-1.918 1.893-1.882 5.027.081 6.964 1.963 1.937 5.139 1.973 7.058.08l8.285-8.175 1.339 1.32-8.285 8.176z"                                       id="path-1" class="cls-2" fill-rule="evenodd"/>                             </svg>                             <span class=" box-inline--center"> </span>                         </mark>                     </div>                     <a href="https://pozvonim.com" class="pozvonim-link animation" target="_parent">  Pozvonim.com</a>                 </div>             </div>         </div>      </div> </div> <!-- Chat close --> </body> </html>';template.miniIframe='<!DOCTYPE html> <html> <head> <meta charset="utf-8" /> <title>- - Pozvonim.com</title> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=latin,cyrillic-ext" rel="stylesheet" type="text/css"> <link href="<%= cdnPath %>/mini-widget/css/style.css" rel="stylesheet" type="text/css" /> <style type="text/css"> #callback { <% if (callback.mini_button_position_x > 50) { %> right: 0px; <% } else { %> left: 0px; <% } %>  <% if (callback.mini_button_position_y > 50) { %> bottom: 0px; <% } else { %> top: 0px; <% } %> }  .callback--background { background-color: <%= callback.mini_style.button_background_color %>; } .callback--background:hover { background-color: <%= callback.mini_style.button_background_color_hover %>; }  .callback--no-active { -webkit-box-shadow: 0 0 0 0 <%= callback.mini_style.circle_color %>; box-shadow: 0 0 0 0 <%= callback.mini_style.circle_color %>; }  .callback__bg { background-color: <%= callback.mini_style.widget_background_color %>; }  .callback__help, .timer, .field__input, .SumoSelect > .CaptionCont > span { color: <%= callback.mini_style.widget_text_color %>; }  .field__inner--border, .SumoSelect > .CaptionCont { border-color: <%= callback.mini_style.phone_border_color %>; }  .field__inner--border:focus { border-color: <%= callback.mini_style.phone_border_color_focus %>; }  .field__button { background-color: <%= callback.mini_style.widget_button_background_color %>; color: <%= callback.mini_style.widget_button_text_color %>; }  .field__button:hover { background-color: <%= callback.mini_style.widget_button_background_color_hover %>; color: <%= callback.mini_style.widget_button_text_color_hover %>; } .opacity { opacity: 0; } <%= callback.api_css_code %> </style> </head> <body class="opacity"> <div class="callback callback--no-active callback--background animate" id="callback"> <i class="callback__close js__callback-close animate"><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8"><path fill="#333333" d="M7.675 1.96L5.635 4l2.013 2.006a1.156 1.156 0 1 1-1.635 1.635L4 5.63 1.986 7.641A1.156 1.156 0 0 1 .352 6.006L2.364 4 .324 1.96A1.156 1.156 0 0 1 1.959.325L4 2.362 6.04.325A1.156 1.156 0 1 1 7.675 1.96z"/></svg></i> <% if(callback.copyright === 1) { %> <a href="<%= referal_url %>" target="_blank" class="callback__copyright animate">  <img src="<%= cdnPath %>/mini-widget/img/logo_small.svg"  height="12" class="box-inline" alt="" />   <span class="text-bold">Pozvonim.com</span></a> <% } %>  <div class="callback__bg animate"> <% if (callback.mini_style.widget_background_video) { %> <div id="video" class="player"></div> <% } %> </div>  <div class="callback__button js__callback-button callback__button--active flex flex--space-center flex--align-center"> <img src="<%= cdnPath %>/mini-widget/img/tel.svg" height="24" alt="" /> </div>  <form id="callback-form" class="" action="" method="post"> <div class="callback__box animate flex flex--row flex--space-between flex--align-center" id="js__box-call"> <div class="callback__help" id="js__text-help"> <span<%= (callback.manager_region_enable) ? \' id="js-show-devision" class="border-dotted border-dotted--white"\' : \'\' %>></span>   <%= callback.call_time %>  </div> <div class="callback__help" id="js__text-help2" style="display:none;">  <br /> ... </div> <div class="field"> <input id="phone" name="phone" type="text" value="+<%= callback.phone_prefix %>" class="field__inner field__inner--border field__input js__field-phone" maxlength="17" /> <button class="field__inner field__button js__activation-data" data-select="js__select-division"> </button> <span class="timer" data-timer="<%= callback.call_time * 100 %>"> 00:<span class="js__seconds"><%= callback.call_time %></span>:<span class="js__centisecond">00</span> </span> </div> </div>  <div class="callback__box animate flex flex--row flex--space-between flex--align-center" id="js__select-division"> <div class="callback__help">   </div> <div class="field"> <select id="region" name="region" class="field__inner field__select"> <% if (callback.manager_region_enable) { %>                                 <% if (callback.is_working) { %>                                     <% $.each($.grep(callback.regions, function(region) {                                         return region.is_working;                                     }), function(key, region) { %>                                         <option value="<%= region.id %>"><%= region.name %></option>                                     <% }); %>                                 <% } else { %>                                     <% $.each(callback.regions, function(key, region) { %>                                         <option value="<%= region.id %>"><%= region.name %></option>                                     <% }); %>                                 <% } %> <% } %> </select> <button type="button" id="js-division-select" class="field__inner field__button js__activation-data"></button> </div> </div> </form>  <div class="callback__box animate flex flex--row flex--space-between flex--align-center" id="js__box-close"> <div class="callback__help callback__help--very-big" >  !</div> <div class="field"> <button class="field__inner field__button js__callback-close"></button> </div> </div>  <div class="callback__box animate flex flex--row flex--space-between flex--align-center" id="js__box-delayed"> <div class="callback__help callback__help--very-big" >,      !</div> <div class="field"> <button class="field__inner field__button js__callback-close"></button> </div> </div> </div>  <script type="text/javascript" src="<%= cdnPath %>/mini-widget/js/scripts.js"></script> <script type="text/javascript" src="<%= cdnPath %>/mini-widget/js/main.js"></script> </body> </html>';template.feedback='<div class="callback__box" id="feedback-before">     <div class="group text-center">         <h2 class="group__title">             <%= title_before_feedback %>         </h2>         <p>                             <%= message_before_feedback %>         </p>     </div>             <div id="feedback-button-container" class="field field--normal box-inline">         <button type="button" class="field__inner field__btn animate field__btn--accen"> </button>     </div> </div> <% for(var qIndex=0; qIndex < questions.length; qIndex++) { %> <% var question = questions[qIndex]; %>     <div class="callback__box" id="feedback-question-<%= question.questionId %>">         <div class="group text-center">             <h2 class="group__title"><%= question.question %></h2>         </div>         <form class="form field__box--answer-selection text-center">             <% if(question.answer_type === \'text\') { %>                 <div class="field__box">                    <div class="field field--normal">                       <input type="text" id="text__cal-<%= question.questionId %>-<%= aIndex %>" class="field__inner field__input" name="answer" value="">                    </div>                 </div>             <% } else if(question.answer_type === \'stars\') { %>                 <div class="form__select-box">                     <div class="feedback-rating center">                         <input id="star__cal-<%= question.questionId %>-5" type="radio" name="answer" value="5"/>                         <label for="star__cal-<%= question.questionId %>-5"></label>                         <input id="star__cal-<%= question.questionId %>-4" type="radio" name="answer" value="4"/>                         <label for="star__cal-<%= question.questionId %>-4"></label>                         <input id="star__cal-<%= question.questionId %>-3" type="radio" name="answer" value="3"/>                         <label for="star__cal-<%= question.questionId %>-3"></label>                         <input id="star__cal-<%= question.questionId %>-2" type="radio" name="answer" value="2"/>                         <label for="star__cal-<%= question.questionId %>-2"></label>                         <input id="star__cal-<%= question.questionId %>-1" type="radio" name="answer" value="1"/>                         <label for="star__cal-<%= question.questionId %>-1"></label>                     </div>                 </div>             <% } else if(question.answer_type === \'select\') { %>                 <div class="form__select-box">                     <div class="field field--normal box-inline">                        <select name="answer" class="field__inner field__sumo-select" id="">                             <% for(var aIndex=0; aIndex < question.answer_variants.length; aIndex++) { %>                                 <% var answer = question.answer_variants[aIndex]; %>                                 <option value="<%= answer %>"><%= answer %></option>                             <% } %>                                              </select>                     </div>                 </div>             <% } else if(question.answer_type === \'radio\') { %>                 <div class="field-check__box">                     <% for(var aIndex=0; aIndex < question.answer_variants.length; aIndex++) { %>                         <% var answer = question.answer_variants[aIndex]; %>                         <div class="field-check">                            <input type="radio" name="answer" id="radio__cal-<%= question.questionId %>-<%= aIndex %>" class="field-check__input" value="<%= answer %>">                            <label for="radio__cal-<%= question.questionId %>-<%= aIndex %>" class="field-check__label"><%= answer %></label>                         </div>                     <% } %>                 </div>             <% } else if(question.answer_type === \'checkbox\') { %>                 <div class="flex flex--row flex--space-center">                     <div class="field-check__box">                         <% for(var aIndex=0; aIndex < question.answer_variants.length; aIndex++) { %>                         <% var answer = question.answer_variants[aIndex]; %>                             <div class="field-check">                                 <input type="checkbox" id="checkbox__cal-<%= question.questionId %>-<%= aIndex %>" name="answer" class="field-check__input" value="<%= answer %>">                                 <label for="checkbox__cal-<%= question.questionId %>-<%= aIndex %>" class="field-check__label"><%= answer %></label>                             </div>                         <% } %>                     </div>                 </div>             <% } %>             <div class="field field--normal box-inline">                 <button type="button" class="field__inner field__btn animate field__btn--accen"></button>             </div>         </form>             </div> <% } %> <div class="callback__box" id="feedback-after">     <div class="group text-center">         <h2 class="group__title">             <%= title_after_feedback %>         </h2>         <p>               <%= message_after_feedback %>                       </p>     </div>             <div id="feedback-after-button-container" class="field field--normal box-inline">         <button type="button" class="field__inner field__btn animate field__btn--accen"></button>     </div> </div>';

        var $ = wjq,
            $window = $(window),
            $document = $(document),
            self = this,
            opts = $.extend(true,window.PozvonimcomWidgetRootConfig, (typeof window.PozvonimcomWidgetConfig === 'undefined' ? {} : window.PozvonimcomWidgetConfig)),
            offset,
            control, height,
            enterAt = new Date().getTime(),
            location = window.location.href,
            path = window.location.pathname,
            referer = window.document.referrer.replace('http://', '').replace('https://', ''),
            iframe,
            iframeChat,
            iframeDocument,
            iframeDocumentChat,
            filesEvent = [],
            countFilesEvent = 0,
            phonePrefix = '',
            timeOutAction = [],
            widgetState = {
                id: null,
                time: 0,
                mouse: {x: 0, y: 0, prevX: 0, prevY: 0, distance: 0, init: false},
                button: {isDragging: false, isDragged: false, isPositioned: false},
                events: {},

                scroll: {top: 0, left: 0},
                window: {width: 0, height: 0},
                windowInitial: $.Utils.windowSize(window, document),
                percentScroll: 0,
                is_delayed: false,
                isActive: true,
                isLocked: false,
                isReturned: false,
                isRating: false,
                isReported: false,
                isCalled: false,
                permanent: {
                    enterPreviousAt: null,
                    showPreviousAt: 0,
                    returnCount: 0,
                    showFeedback: true
                },
                permanentChat: {
                    user: null
                },
                session: {
                    enterAt: null,
                    enterSessionAt: null,
                    showSessionCount: 0,
                    sourceEnter: location,
                    sourceReferer: referer,
                    sourceCall: location,
                    viewPage: 0,
                    sendNotification: 0,
                    showInvite: 0,
                    textMessageChat: null,
                    textMessage: null
                }
            };

        var onInit = function () {
                try {
                    onInitFeedback();
                    onInitCallback();
                    onResize();
                    onScroll();

                    $window.on('mousemove', onMouse);
                    $window.on('touchstart', onScroll);
                    $window.on('touchmove', onScroll);
                    $window.on('touchend', onScroll);
                    $window.on('scroll', onScroll);
                    $window.on('resize', onResize);
                    $window.on('zoom', onResize);
                    $window.on('orientationchange', function (){
                        window.setTimeout(onResize,150);
                    });

                    if(opts.callback.email.is_enable){
                        self.api.Input.emailtext.on("keyup", inputMailWidget);
                        if(widgetState.session.textMessage !== null){
                            self.api.Input.emailtext.val(widgetState.session.textMessage);
                            self.api.Input.emailtextLabel.addClass('field__label--active');
                        }
                    }
                }

                catch (e) {
                    PVE('ERROR', (e ? e.toString() : ''), {}, e);
                }

                PVE('LOADED', 'Event: widget called onReady');

                return true;
            },
            onInitFeedback = function () {
                if (!opts.callback.is_enable) return;
                self.feedback = new FeedbackCallManager(self);
            },
            prepareCallbackButtonConfig = function(opts) {
                var buttonConfig = {
                    enable: null,
                    drag: null,
                    text: null,
                    text_show: null,
                    animation: null,
                    wawes: null,
                    display: null,
                    scale: null,
                    button_logo: null,
                    size: null,
                    arrow: null,
                    position: null,
                    position_x: null,
                    position_y: null,
                    window_cover: null
                };
                if (opts.callback.is_enable) {
                    if (opts.is_mobile) {
                        buttonConfig.enable = opts.callback.mobile_button;
                        buttonConfig.drag   = opts.callback.mobile_button_drag;
                        buttonConfig.text    = true;
                        buttonConfig.text_show = false;
                        buttonConfig.animation = opts.callback.mobile_button_animation;
                        buttonConfig.wawes  = opts.callback.mobile_button_wawes;
                        buttonConfig.display = true;
                        buttonConfig.window_cover = true;

                        if (opts.callback.mobile_button_size == 0) {
                            buttonConfig.size = 1;
                        } else {
                            buttonConfig.size = 0;
                        }

                        buttonConfig.arrow   = false;
                        buttonConfig.position_x = 5;
                        buttonConfig.position_y = 5;

                        if (opts.callback.mobile_button_position == 2) {
                            buttonConfig.position_x = 95;
                        } else if (opts.callback.mobile_button_position == 5) {
                            buttonConfig.position_x = 5;
                            buttonConfig.position_y = 95;
                        } else if (opts.callback.mobile_button_position == 6) {
                            buttonConfig.position_x = 95;
                            buttonConfig.position_y = 95;
                        }

                        if (buttonConfig.size == 1) {
                            buttonConfig.scale = 0.85;
                        } else if (buttonConfig.size == 2) {
                            buttonConfig.scale = 1.2;
                        } else {
                            buttonConfig.scale = 0.7;
                        }
                    } else {
                        buttonConfig.enable = opts.callback.button;
                        buttonConfig.drag   = opts.callback.button_drag;
                        buttonConfig.text    = opts.callback.button_text;
                        buttonConfig.text_show = opts.callback.button_text_show;
                        buttonConfig.animation = opts.callback.button_animation;
                        buttonConfig.wawes  = opts.callback.button_wawes;
                        buttonConfig.display = opts.callback.button_display;
                        buttonConfig.size    = opts.callback.button_size;
                        buttonConfig.arrow   = opts.callback.button_arrow;
                        buttonConfig.position_x = opts.callback.button_position_x;
                        buttonConfig.position_y = opts.callback.button_position_y;
                        buttonConfig.window_cover = opts.callback.window_cover;

                        if (buttonConfig.size == 1) {
                            buttonConfig.scale = 1.3;
                        } else if (buttonConfig.size == 2) {
                            buttonConfig.scale = 1.5;
                        } else {
                            buttonConfig.scale = 1.0;
                        }
                    }

                    buttonConfig.disable_animation = opts.callback.disable_animation;

                    if (buttonConfig.position_x == 5 && buttonConfig.position_y == 5) {
                        buttonConfig.position = 'TOP-LEFT';
                    } else if (buttonConfig.position_x == 95 && buttonConfig.position_y == 5) {
                        buttonConfig.position = 'TOP-RIGHT';
                    } else if (buttonConfig.position_x == 5 && buttonConfig.position_y == 95) {
                        buttonConfig.position = 'BOTTOM-LEFT';
                    } else if (buttonConfig.position_x == 95 && buttonConfig.position_y == 95) {
                        buttonConfig.position = 'BOTTOM-RIGHT';
                    }
                }

                return buttonConfig;
            },
            onInitCallbackButton = function() {
                var buttonConfig = opts.callback.buttonConfig;

                if (!buttonConfig.enable) {
                    self.api.Button.hide();

                    return;
                }

                widgetState.window = $.Utils.windowSize(window, document);

                if(!opts.is_mobile) {
                    if (buttonConfig.animation) {
                        self.elButton.addClass('pozvonim-animated');
                    }

                    if (buttonConfig.drag) {
                        self.elButton.drags({
                            start: function () {
                                widgetState.button.isDragging = true;
                                widgetState.button.isDragged = false;
                            },
                            stop: function () {
                                widgetState.button.isDragging = false;
                                window.setTimeout(function () {
                                    widgetState.button.isDragged = false;
                                }, 0);
                            },
                            move: function () {
                                if (widgetState.button.isDragging) {
                                    widgetState.button.isDragged = true;
                                }
                            }
                        });
                    }

                    if (buttonConfig.text_show) {
                        window.setInterval(function () {
                            self.elButton.toggleClass('pozvonim-hovered');
                        }, 5000);
                    }
                }
                if(opts.is_mobile){
                    if($('body').css('position') == 'relative') {
                        $('body').css('position','static');
                    }
                }

                if (!buttonConfig.display) {
                    self.api.Button.hide();
                }
            },
            onInitCallback = function () {
                if (!opts.callback.is_enable) return;
                //if (!opts.callback.is_working) {
                self.elIframe.find('#callback-cover').on('click', function () {
                    self.api.hide();
                });

                if (opts.callback.report_analytic) {
                    self.elWidget.find('.rating .input').on('click', ratingSend);
                }

                if (opts.callback.tracking_google_enable) {
                    self.api.on('call.success',
                        function (number) {
                            try {
                                ga('send', 'event', 'button', opts.callback.tracking_google_target, 'widget', number);
                            } catch (e) {
                                PVE(
                                    PVE.prototype.TYPE.ERROR, (e ? e.toString() : 'CustomError: User google analytic error'), {}, e
                                );
                            }
                        }
                    );
                    self.api.on('call.delayed',
                        function (number) {
                            try {
                                ga('send', 'event', 'button', opts.callback.tracking_google_target, 'widget', number);
                            } catch (e) {
                                PVE(
                                    PVE.prototype.TYPE.ERROR, (e ? e.toString() : 'CustomError: User google analytic error'), {}, e
                                );
                            }
                        }
                    );
                }
                if (opts.callback.tracking_yandex_enable) {
                    self.api.on('call.success',
                        function (number) {
                            try {
                                $.each(Ya.Metrika.counters(), function (index, counter) {
                                    window['yaCounter' + counter.id].reachGoal(opts.callback.tracking_yandex_target);
                                });
                            }
                            catch (e) {
                                PVE('ERROR', (e ? e.toString() : 'CustomError: User yandex metrika error'), {}, e);
                            }
                        }
                    );
                    self.api.on('call.delayed',
                        function (number) {
                            try {
                                $.each(Ya.Metrika.counters(), function (index, counter) {
                                    window['yaCounter' + counter.id].reachGoal(opts.callback.tracking_yandex_target);
                                });
                            }
                            catch (e) {
                                PVE('ERROR', (e ? e.toString() : 'CustomError: User yandex metrika error'), {}, e);
                            }
                        }
                    );
                }
                onInitCallbackButton();
                if (opts.callback.api_enable) {
                    try {
                        var callback;
                        if (typeof opts.ready === 'function'){
                            opts.callback.ready = opts.ready;
                        }

                        if (typeof opts.callback.ready === 'function') callback = opts.callback.ready;
                        else if (typeof window[opts.callback.ready] === 'function') callback = window[opts.callback.ready];
                        else if (typeof window[opts.callback.api_callback] === 'function') callback = window[opts.callback.api_callback];
                        else if (opts.callback.api_callback_code) {
                            eval(opts.callback.api_callback_code);
                            if (typeof pozvonimUserReady === 'function') {
                                callback = pozvonimUserReady;
                            }
                        }
                        if (typeof callback === 'function') {
                            callback.apply(self);
                        }
                    }
                    catch (e) {
                        PVE('ERROR', (e ? e.toString() : 'CustomError: User onReady function error'), {}, e);
                    }
                }

                self.api.Element.calendarCall.on('click', function () {
                    regionSelect.setItems(opts.callback.regions);
                    self.api.show('calendar', {preventSound: true});
                    self.api.Element.calendarCall.hide();
                    self.api.Element.calendarBack.show();
                });
                self.api.Element.calendarBack.on('click', function () {
                    regionSelect.setItems($.grep(opts.callback.regions, function(region) {
                        return region.is_working;
                    }));
                    self.api.show('click', {preventSound: true});
                    self.api.Element.calendarCall.show();
                    self.api.Element.calendarBack.hide();
                });

                self.api.on('call.defcode', function (number) {
                    self.api.Input.phone.focus();
                    self.api.Input.phone.addClass('error');
                    self.api.Element.defcode.fadeIn();
                    window.setTimeout(function () {
                        self.api.Element.defcode.fadeOut();
                        self.api.Input.phone.removeClass('error');
                    }, 5000);
                    widgetState.isCalled = false;
                });
                onTimer();
                onInitPhoneInput(self.api.Input.phone);
            },
            onInitIframe = function (options) {
                $(options.wrapper).append('<iframe id="' + (options.id || '') + '" style="' + (options.style || '') + '" class=" ' + (options.class || '') + '" frameborder="0" name="' + (options.name || '') + '" scrolling="no" allowtransparency="true"></iframe>');
                var iframe = $('#' + options.id).get(0);
                iframe = iframe.contentDocument || iframe.contentWindow.document;
                iframe.open();
                iframe.write(options.html);
                iframe.close();
                return iframe;
            },
            onInitPhoneInput = function (element) {
                element.intlTelInput({
                    allowDropdown: true,
                    autoHideDialCode: false,
                    formatOnInit: true,
                    initialCountry: "auto",
                    nationalMode: false,
                    numberType: "MOBILE",
                    preferredCountries: ['RU', 'UA', 'BY', 'KZ'],
                    onlyCountries: ['au', 'at', 'bh', 'br', 'gb', 'do', 'dk', 'eg', 'in', 'es', 'va', 'kh', 'cy', 'cn', 'lu', 'mt', 'nl', 'no', 'pk', 'pa', 'pe', 'by', 'pl', 'ie', 'ru', 'ua', 'bg', 'pt', 'kz', 'ro', 'rs', 'sk', 'fr', 'th', 'tw', 'tm', 'uz', 'az', 'ge', 'kg', 'tj', 'bs', 'bb', 'bm', 'vg', 'ca', 'ky', 'dm', 'do', 'gd', 'gu', 'jm', 'ms', 'mp', 'pr', 'kn', 'lc', 'vc', 'sx', 'tt', 'tc', 'vi', 'us', 'as', 'ai', 'ag', 'lt', 'lv', 'cz', 'tr', 'si', 'mn']
                });
                if (opts.callback.detect_defcode_by_ip) {                    
                    element.intlTelInput("setCountry",opts.geo.country_code);
                }
                self.api.on('wrapper.input.phone.changed',function(phone){
                    element.intlTelInput("setNumber",phone);
                });
            },

            onChangePosition = function(event) {
                var cbOffset = null;
                if (opts.callback.buttonConfig.enable && widgetState.isLocked === false && widgetState.button.isDragging === false && !opts.is_mobile) {
                    if (opts.callback.buttonConfig.display === 0 && widgetState.scroll.top > 10) {
                        self.api.Button.show();
                    }

                        cbOffset = {
                            top: ((widgetState.window.height / 100 * widgetState.button.offsetTop) + widgetState.scroll.top - widgetState.button.height),
                            left: ((widgetState.window.width / 100 * widgetState.button.offsetLeft) - widgetState.button.width)
                        };
                        if (cbOffset.top < 0) cbOffset.top = 0;
                        if (cbOffset.left < 0) cbOffset.left = 0;
                        var offset = cbOffset;
                    if(opts.id==37626){
                        offset.top -= 130;
                    }
                        offset.top += 'px';
                        offset.left += 'px';

                        self.elButton.css(offset);

                }
                if (opts.callback.buttonConfig.enable && opts.is_mobile) {
                        cbOffset = {top: 0, left: 0};
                        if (opts.callback.mobile_button_position == 1) {
                            cbOffset = {top: 0, left: 0};
                        }
                        if (opts.callback.mobile_button_position == 2) {
                            cbOffset = {top: 0, right: 0};
                        }
                        if (opts.callback.mobile_button_position == 5) {
                            cbOffset = {bottom: 0, left: 0};
                        }
                        if (opts.callback.mobile_button_position == 6) {
                            cbOffset = {bottom: 0, right: 0};
                        }

                    if (typeof self.elButton !== 'undefined' && self.elButton.length) {
                        $.Utils.scale({element: self.elButton.get(0), viewportWidthPortrait: 400, viewportWidthLandscape: 840, pos: cbOffset});
                    }

                }
                if (widgetState.isLocked === true && opts.is_mobile) {
                    if (typeof self.elWrapper !== 'undefined' && self.elWrapper.length) {
                        $.Utils.fullscreen({element: self.elWrapper.get(0), viewportWidthPortrait: 400, viewportWidthLandscape: 840, pos: {left: 0, right: 0, top: 0, bottom: 0}});
                    }

                }
                if (opts.chat.is_enable && opts.is_mobile) {
                    var pos = {top: 0, left: 0};
                    if (opts.chat.button.place.position.class == 'CHAT-TOP-LEFT') {
                        pos = {top: 0, left: 0};
                    }
                    if (opts.chat.button.place.position.class == 'CHAT-TOP-RIGHT') {
                        pos = {top: 0, right: 0};
                    }
                    if (opts.chat.button.place.position.class == 'CHAT-BOTTOM-LEFT') {
                        pos = {bottom: 0, left: 0};
                    }
                    if (opts.chat.button.place.position.class == 'CHAT-BOTTOM-RIGHT') {
                        pos = {bottom: 0, right: 0};
                    }
                    if (self.api.Chat.blockForIframe.attr('data-type-view') == 'full') {
                        $.Utils.fullscreen({element: self.elWrapperChat.get(0), viewportWidthPortrait: 400, viewportWidthLandscape: 840, pos: {left: 0, right: 0, top: 0, bottom: 0}}, true);
                    } else {
                        self.elWrapperChat.get(0).style.cssText = '';
                        $.Utils.scale({element: self.elWrapperChat.get(0), viewportWidthPortrait: 400, viewportWidthLandscape: 840, pos: pos});
                    }
                }
            },

            onScroll = function (event) {
                widgetState.scroll.top = $window.scrollTop();
                widgetState.scroll.left = $window.scrollLeft();
                widgetState.percentScroll = 100 * $window.scrollTop() / ($document.height() - $window.height());
                onChangePosition(event);
            },
            onResize = function (event) {
                widgetState.window = $.Utils.windowSize(window, document);
                onChangePosition(event);
            },
            onMouse = function (event) {
                if (widgetState.mouse.init === false) {
                    widgetState.mouse.y = event.clientY;
                    widgetState.mouse.x = event.clientX;
                    widgetState.mouse.prevY = event.clientY;
                    widgetState.mouse.prevX = event.clientX;
                    widgetState.mouse.init = true;
                }
                widgetState.mouse.y = widgetState.mouse.prevY;
                widgetState.mouse.x = widgetState.mouse.prevX;
                widgetState.mouse.prevY = event.clientY;
                widgetState.mouse.prevX = event.clientX;
                widgetState.mouse.distance += Math.abs(widgetState.mouse.y - event.clientY + widgetState.mouse.x - event.clientX);
            },

            onTimer = function (event) {
                if (!widgetState.isActive) return;
                widgetState.time = new Date().getTime() - widgetState.session.enterAt;
                catchEnter();
                catchExit();
                catchReturn();
                catchSearch();
                catchAfterEnter();
                catchAfterScroll();
                catchAfterView();
                window.setTimeout(onTimer, 300);
            },

            ratingSend = function (event) {
                event.preventDefault();
                event.stopPropagation();
                if (widgetState.isRating) return;
                widgetState.isRating = true;
                self.api.rating($(event.currentTarget).val());
                self.elWidget.find('.text-analytic').html(',   .');
                self.elWidget.find('.rating').hide();
            },
            reportSend = function (event) {
                event.preventDefault();
                event.stopPropagation();
                if (widgetState.isReported) return;
                widgetState.isReported = true;
                self.api.report(0);
                self.elWidget.find('.report').addClass('disabled');
                self.elWidget.find('.reported').show();
            },
            callAgainTimer = function(callAgainCountdown) {
                var widgetState = self.api.getState();
                if (callAgainCountdown > 0) {
                    widgetState.callAgainTimerRunning = true;
                    if (!self.context.isTabRemapped('pozvonim-element-call')) {
                        self.context.remapTab('pozvonim-element-call','pozvonim-element-final');
                    }
                    self.api.Element.buttonCallAgainContainer.hide();
                    self.api.Element.buttonCallAgainCountdown.show();
                    var time = Math.floor(callAgainCountdown / 1000) / 1;
                    self.api.Element.buttonCallAgainCountdownTimer.html(time);
                    window.setTimeout(function(){
                        callAgainTimer(callAgainCountdown - 1000);
                    },1000);
                } else {                
                    self.api.Element.buttonCallAgainContainer.show();
                    self.api.Element.buttonCallAgainCountdown.hide();
                    widgetState.callAgainTimerRunning = false;
                    if (self.context.isTabRemapped('pozvonim-element-call','pozvonim-element-final')) {
                        self.context.remapTab('pozvonim-element-call',null);
                    }
                }
            },
            finalShow = function () {
                self.api.Input.phone.removeClass('disabled');
                self.api.Element.button.removeClass('disabled');
                self.api.Input.phone.attr('disabled', false);
                self.api.Element.button.attr('disabled', false);
                self.api.Element.button.html('<img src="' + opts.cdnPath + '/callback/static/img/phone__button.svg" class="field__btn-img box-inline"/>' + opts.callback.window_text.button.select);
                self.api.Element.timer.html('00:' + opts.callback.call_time + ':00');
            },
            finalShowCallAgainCountdown = function() {
                if (opts.callback.lock_recall_button_timeout) {
                    var callAgainCountdown = opts.callback.lock_recall_button_timeout;
                    var widgetState = self.api.getState();
                    if (!widgetState.callAgainTimerRunning) {
                        callAgainTimer(callAgainCountdown);
                    }
                }
            },
            callAgain = function (event) {
                event.preventDefault();
                event.stopPropagation();
                self.context.activate('pozvonim-element-call');
                finalShow();
                widgetState.isCalled = false;
                callSend(event);
            },
            callSend = function (event) {
                event.preventDefault();
                event.stopPropagation();
                var delayed,
                    wait = {s: opts.callback.call_time - 1, ms: 9},
                    timer = function () {
                        if (!opts.callback.is_working) {
                            return false;
                        }
                        if (wait.ms <= 1) {
                            wait.ms = 9;
                            wait.s--;
                        }
                        wait.ms--;
                        if (wait.s <= 0) {

                            self.context.activate('pozvonim-element-final');
                            finalShow();
                            finalShowCallAgainCountdown();
                            return true;
                        }
                        self.api.Element.timer.html(['00:', wait.s > 9 ? '' : '0', wait.s, ':', wait.ms, '9'].join(''));
                        window.setTimeout(timer, 100);
                    },
                    status = self.api.call({
                        phone: self.api.Input.phone.val(),
                        region: self.api.Input.region.data('value'),
                        delayed: (opts.callback.is_working && !widgetState.is_delayed ? false : self.api.getDelayedUTC())
                    });
                if (status === 'validation') {
                    self.api.Input.phone.focus();
                    self.api.Input.phone.addClass('error');
                    self.api.Element.validation.addClass('tooltip--active');
                    window.setTimeout(
                        function () {
                            self.api.Element.validation.removeClass('tooltip--active');
                            self.api.Input.phone.removeClass('error');
                        }, 2000
                    );
                    return false;
                }
                widgetState.isCalled = true;
                if (status === 'defcode') {
                    self.api.event('call.defcode');
                }
                if (status === 'blacklist') {
                    self.context.activate('pozvonim-element-final-offline');

                }
                if (status === 'balance') {
                    self.context.activate('pozvonim-element-final-offline');

                }
                if (status === 'delayed') {
                    self.context.activate('pozvonim-element-final-offline');

                }
                if (status === 'call') {
                    self.api.Input.phone.addClass('disabled');
                    self.api.Element.button.addClass('disabled');
                    self.api.Input.phone.attr('disabled', true);
                    self.api.Element.button.attr('disabled', true);
                    self.api.Element.button.html('<div class="timer-block__inner"></div><div class="timer-block__text"><i class="load_dots"><i></i></i><span></span></div>');

                    self.api.Element.calendarCall.hide();
                    self.api.Element.calendarBack.hide();
                    timer();
                }
                return false;
            },
            changeEmailPhone = function (e, countryData) {
                phonePrefix = countryData.dialCode;
            },
            addEmailFile = function (event) {
                countFilesEvent++;
                var countBlock = self.elWidget.find('input.pozvonim-com-x-btn-file').size();
                var html = '<div class="block-file newEmailFile" data-id="' + countFilesEvent + '" style="display:none;"><div class="block-file-title"><span></span><a href="">X</a></div></div>';
                var fileInput = '<div class="block-file-input block-file-back" data-id="' + countFilesEvent + '"> <input type="file" id="attr-filename-' + countFilesEvent + '"  name="email-file[]" class="pozvonim-com-x-btn-file"></div>';
                var htmlBlock = '<div class="block-file-input-disabled block-file-back"></div>';
                if (event != undefined) {
                    var dataId = $(this).parent().attr("data-id");
                    var filename = ' ' + countBlock;
                    if (window.FormData !== undefined) {
                        var ext = event.originalEvent.target.files[0]['name'].split('.').pop().toLowerCase();
                        if ($.inArray(ext, ['gif', 'png', 'jpg', 'jpeg', 'pdf', 'doc', 'docx', 'xls', 'xlsx']) == -1) {
                            mailFileValidation('ext');
                            return false;
                        }
                        if (event.originalEvent.target.files[0]['size'] > 1100000) {
                            mailFileValidation('size');
                            return false;
                        }
                        var filename = event.originalEvent.target.files[0]['name'];
                        filesEvent[dataId] = event.originalEvent.target.files;
                    }
                    $(this).parent().hide();
                    var blockFile = self.api.Content.email.find("div.block-file[data-id='" + dataId + "']");
                    blockFile.show();
                    blockFile.find('a').show();
                    blockFile.removeClass('newEmailFile');
                    blockFile.find('a').on('click', deleteEmailFile);
                    blockFile.find('span').html(filename);
                }
                if (countBlock <= 2) {
                    self.api.Content.buttonBlock.find('.block-file-input-disabled').remove();
                    self.api.Element.emailfile.append(html);
                    self.api.Content.buttonBlock.prepend(fileInput);
                    self.elWidget.find('input.pozvonim-com-x-btn-file').on('change', addEmailFile);
                } else {
                    self.api.Content.buttonBlock.append(htmlBlock);
                }
            },
            showCallWidget = function () {
                self.elWidget.find('.call_widget_view').removeClass('pozvonim-visible-show');
                self.elWidget.find('.message_widget_view').addClass('pozvonim-visible-show');
                self.elWidget.find('.chat_widget_view').addClass('pozvonim-visible-show');
                $(this).parents().find('ul.pozvonim-com-x-top-menu>li').removeClass('active');
                $(this).parent().addClass('active');
                return false;
            },
            showEmailWidget = function () {
                self.elWidget.find('.call_widget_view').addClass('pozvonim-visible-show');
                self.elWidget.find('.message_widget_view').removeClass('pozvonim-visible-show');
                self.elWidget.find('.chat_widget_view').addClass('pozvonim-visible-show');
                $(this).parents().find('ul.pozvonim-com-x-top-menu>li').removeClass('active');
                $(this).parent().addClass('active');
                return false;
            },
            deleteEmailFile = function () {
                var blockFile = $(this).parents('div.block-file');
                var dataId = $(this).parents('div.block-file').attr("data-id");
                delete filesEvent[dataId];
                blockFile.remove();
                self.api.Content.email.find("div.block-file-input[data-id='" + dataId + "']").remove();
                var countBlock = self.api.Element.emailfile.find('.newEmailFile').size();
                if (countBlock == 0) {
                    addEmailFile();
                }
                return false;
            },

            mailFileValidation = function (type) {
                var fade;
                if (type == 'ext') {
                    fade = self.api.Element.emailFileValidation;
                }
                if (type == 'size') {
                    fade = self.api.Element.emailFileSizeValidation;
                }
                fade.fadeIn();
                window.setTimeout(
                    function () {
                        fade.fadeOut();
                    }, 3000
                );
                return false;
            },
            mailTextValidation = function () {
                self.api.Input.emailtext.focus();
                self.api.Input.emailtext.addClass('error');
                self.api.Element.emailBodyValidation.fadeIn();
                window.setTimeout(
                    function () {
                        self.api.Element.emailBodyValidation.fadeOut();
                        self.api.Input.emailtext.removeClass('error');
                    }, 2000
                );
                return false;
            },
            mailEmailValidation = function (type) {
                self.api.Input.emailemail.focus();
                self.api.Input.emailemail.addClass('error');
                var fade;
                if (type == 'empty') {
                    fade = self.api.Element.emailEmailValidation;
                }
                if (type == 'wrong') {
                    fade = self.api.Element.emailEmailVertValidation;
                }
                fade.fadeIn();
                window.setTimeout(
                    function () {
                        fade.fadeOut();
                        self.api.Input.emailemail.removeClass('error');
                    }, 2000
                );
                return false;
            },
            mailPhoneValidation = function (type) {
                self.api.Input.emailphone.focus();
                self.api.Input.emailphone.addClass('error');
                self.api.Element.emailPhoneValidation.fadeIn();
                window.setTimeout(
                    function () {
                        self.api.Element.emailPhoneValidation.fadeOut();
                        self.api.Input.emailphone.removeClass('error');
                    }, 2000
                );
                return false;
            },
            mailResponseIE = function () {
                self.api.Content.email.hide();
                self.api.Content.emailFinal.show();
            },
            mailResponse = function () {
                if (this.status == 202) {
                    self.api.Content.email.hide(); //  
                    self.context.activate('pozvonim-element-email-final');
                    self.api.Input.emailname.val('');
                    self.api.Input.emailemail.val('');
                    self.api.Input.emailphone.val('');
                    self.api.Input.emailtext.val('');
                } else {
                    self.api.Element.emailSendValidation.fadeIn();
                    window.setTimeout(
                        function () {
                            self.api.Element.emailSendValidation.fadeOut();
                        }, 2000
                    );
                }
                self.api.Element.emailfile.find('a,input').each(function () {
                    $(this).attr('disabled', false);
                    $(this).removeClass('disabled');
                });
                self.api.Input.emailemail.removeClass('disabled');
                self.api.Input.emailemail.attr('disabled', false);
                self.api.Input.emailphone.removeClass('disabled');
                self.api.Input.emailphone.attr('disabled', false);
                self.api.Input.emailtext.removeClass('disabled');
                self.api.Input.emailtext.attr('disabled', false);
                self.api.Element.emailbutton.removeClass('disabled');
                self.api.Element.emailbutton.attr('disabled', false);
                self.api.Element.emailbutton.html("");
            },
            mailSend = function (event) {
                event.preventDefault();
                event.stopPropagation();

                var re, number = (typeof self.api.Input.emailphone.val() === 'string') ? self.api.Input.emailphone.val().replace(/[^0-9]/g, '') : '';
                if ($.trim(self.api.Input.emailtext.val()) == '') {
                    return mailTextValidation();
                }
                if (opts.callback.email.send_email) {

                    if (opts.callback.email.send_email_required && $.trim(self.api.Input.emailemail.val()) == '') {
                        return mailEmailValidation('empty');
                    }

                    re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                    if ($.trim(self.api.Input.emailemail.val()) != '' && !re.test(self.api.Input.emailemail.val())) {
                        return mailEmailValidation('wrong');
                    }
                }

                if (opts.callback.email.send_phone) {
                    if (number != phonePrefix && $.trim(number) != '') {
                        re = new RegExp('^[0-9]{7,20}$');
                        if (!number.match(re)) {
                            return mailPhoneValidation('wrong');
                        }
                    } else {
                        number = '';
                    }

                    if (opts.callback.email.send_phone_required && $.trim(number) == '') {
                        return mailPhoneValidation('empty');
                    }
                }

                self.api.Element.emailbutton.addClass('disabled');
                self.api.Element.emailbutton.attr('disabled', true);
                self.api.Element.emailbutton.html("...");

                widgetState.session.textMessage = null;
                self.api.Storage.session.set('session', widgetState.session);

                if (window.FormData === undefined) {

                    self.api.Input.emailphone.val(number);
                    $.ajax(opts.apiPath + '/mail', {
                        data: $("input:text,textarea,#pozvonim-email-phone,#pozvonim-email-type", self.api.Element.emailAll).serializeArray(),
                        files: $(":file", self.api.Content.buttonBlock),
                        iframe: true,
                        dataType: 'jsonp'
                    }).complete(function (data) {
                        var myObject = JSON.stringify(data);
                    });
                    mailResponseIE();
                } else {

                    self.api.Input.emailemail.addClass('disabled');
                    self.api.Input.emailemail.attr('disabled', true);
                    self.api.Input.emailphone.addClass('disabled');
                    self.api.Input.emailphone.attr('disabled', true);
                    self.api.Input.emailtext.addClass('disabled');
                    self.api.Input.emailtext.attr('disabled', true);
                    self.api.Element.emailfile.find('a,input').each(function () {
                        $(this).attr('disabled', true);
                        $(this).addClass('disabled');
                    });

                    var http = new XMLHttpRequest();
                    var form = new FormData();

                    if (self.api.Input.emailemail.length > 0) {
                        form.append('email-email', self.api.Input.emailemail.val());
                    }

                    if (number) {
                        form.append('email-phone', number);
                    }

                    form.append('email-text', self.api.Input.emailtext.val());
                    form.append('email-type', self.api.Input.emailtype.val());
                    form.append('source_enter', widgetState.session.sourceEnter);

                    filesEvent.forEach(function (item, i) {
                        form.append('email-file[]', filesEvent[i][0]);
                    });

                    http.withCredentials = true;
                    http.addEventListener("load", mailResponse);
                    http.open('POST', opts.apiPath + '/mail');
                    http.send(form);

                }
                return false;
            },

            catchEnter = function () {
                if (
                    opts.callback.algoritms.onenter.enable === 1 &&
                    widgetState.mouse.distance > 2000 &&
                    widgetState.time > opts.callback.algoritms.onenter.time * 1000
                ) {
                    return self.api.show('enter');
                }
            },
            catchExit = function () {
                if (
                    opts.callback.algoritms.onexit.enable === 1 &&
                    widgetState.time > opts.callback.algoritms.onexit.time * 1000 &&
                    widgetState.mouse.prevY < 200 &&
                    widgetState.mouse.prevY < widgetState.mouse.y
                ) {
                    var sessionStay = (new Date().getTime() - widgetState.session.enterSessionAt) / 1000;
                    self.api.Element.staytime.html(
                        [
                            Math.round(sessionStay / 60 - 0.5),
                            $.Utils.pluralDigits(sessionStay / 60 - 0.5, ['', '', '']),
                            Math.round(sessionStay % 60),
                            $.Utils.pluralDigits(sessionStay % 60, ['', '', ''])
                        ].join(" ")
                    );
                    return self.api.show('exit');
                }
            },
            catchReturn = function () {
                if (
                    opts.callback.algoritms.onwait.enable === 1 &&
                    widgetState.time > opts.callback.algoritms.onwait.time * 1000 &&
                    widgetState.mouse.distance > 2000
                ) {
                    return self.api.show('wait');
                }
            },
            catchSearch = function () {
                if (
                    opts.callback.algoritms.onreturn.enable === 1 &&
                    widgetState.isReturned === 1 &&
                    widgetState.time > 15 * 1000 &&
                    widgetState.mouse.distance > 10000
                ) {
                    self.api.Element.returncount.html((widgetState.permanent.returnCount || 1) + ' ' + $.Utils.pluralDigits((widgetState.permanent.returnCount || 1), ['', '', '']))
                    return self.api.show('return');
                }
            },
            catchAfterEnter = function () {
                if (
                    opts.callback.algoritms.showAfterEnter.enable === 1 &&
                    widgetState.permanent.returnCount >= opts.callback.algoritms.showAfterEnter.count &&
                    widgetState.mouse.distance > 2000
                ) {
                    self.api.Element.returnback.html((widgetState.permanent.returnCount || 1) + ' ' + $.Utils.pluralDigits((widgetState.permanent.returnCount || 1), ['', '', '']))
                    return self.api.show('afterEnter');
                }
            },
            catchAfterScroll = function () {
                if (
                    opts.callback.algoritms.showAfterScroll.enable === 1 &&
                    widgetState.percentScroll >= opts.callback.algoritms.showAfterScroll.percent &&
                    widgetState.mouse.distance > 2000
                ) {
                    return self.api.show('afterScroll');
                }
            },
            catchAfterView = function () {
                if (
                    opts.callback.algoritms.showAfterView.enable === 1 &&
                    widgetState.session.viewPage >= opts.callback.algoritms.showAfterView.count &&
                    widgetState.mouse.distance > 2000
                ) {
                    self.api.Element.viewpagecount.html((widgetState.session.viewPage || 1) + ' ' + $.Utils.pluralDigits((widgetState.session.viewPage || 1), ['', '', '']))
                    return self.api.show('afterView');
                }
            },
            inputMailWidget = function () {
                if ($(this).val() == 0) {
                    widgetState.session.textMessage = null;
                } else {
                    widgetState.session.textMessage = $(this).val();
                }
                self.api.Storage.session.set('session', widgetState.session);
            };
        if (opts.callback.is_enable) {
            if (opts.is_mobile && !opts.callback.mobile_enable) {
                opts.callback.is_enable = false;
            }
        }

        // check if url or referer is blacklisted in widgets

        ['callback', 'chat'].forEach(function (widget) {
            var bl = opts[widget].blacklist;

            if (!opts[widget].is_enable) return;

            if (bl && bl.referer && bl.referer.length) {
                bl.referer.some(function (elm) {
                    if (new RegExp(elm).test(referer)) {
                        opts[widget].is_enable = false;
                        return true;
                    }
                    return false;
                });
            }

            if (bl && bl.url && bl.url.length) {
                bl.url.some(function (elm) {
                    if (new RegExp(elm).test(path)) {
                        opts[widget].is_enable = false;
                        return true;
                    }
                    return false;
                });
            }

            return;
        });

        opts.callback.buttonConfig = prepareCallbackButtonConfig(opts);

        $('body').append($.template(template.wrapper)(opts));

        if (opts.callback.is_enable) {
            iframe = onInitIframe({
                id: 'callback-frame',
                name: 'callback-frame',
                html: $.template(template.callback)(opts),
                wrapper: '#pozvonim-wrapper',
                class: 'callback-frame callback-frame--' + opts.callback.window_position,
            });

            iframeDocument = document.getElementById('callback-frame');
            this.elWrapper = $('#pozvonim-wrapper');
            this.elWidget = $(iframe).find('#callback');
            this.elIframe = $(iframe);
            this.elButton = $('#pozvonim-button');
            this.elCover = $('#pozvonim-cover');

            if (opts.callback.mini_enable === 1 && !opts.is_mobile) {
                miniIframe = onInitIframe({
                    id: 'pozvonim-mini-frame',
                    name: 'pozvonim-mini-frame',
                    html: $.template(template.miniIframe)(opts),
                    wrapper: '#pozvonim-mini-wrapper',
                    class: opts.callback.window_postion,
                    style: 'height:100%;width:100%'
                });

                this.elMiniWrapper = $('#pozvonim-mini-wrapper');
                this.elMiniWidget = $(miniIframe).find('#callback');
            }
        }
        if (opts.chat.is_enable) {
            iframeChat = onInitIframe({
                id: 'pozvonim-chat-frame',
                name: 'pozvonim-chat-frame',
                html: $.template(template.chat)(opts),
                wrapper: '#pozvonim-wrapper-chat'
            });
            iframeDocumentChat = document.getElementById('pozvonim-chat-frame');
            this.elWrapperChat = $('#pozvonim-wrapper-chat');
            this.elWidgetChat = $(iframeChat).find('#pozvonim-chat');
        }
        this.$ = $;
        var Api = (function () {
    var core = {};
    core = {
        ws: null,
        getStayTime: function () {
            return (new Date().getTime() - widgetState.session.enterSessionAt) / 1000;
        },
        getWsConnection: function () {
            if (Api.ws === null) {
                Api.ws = null;
                var url = opts.apiPath.match("^(([^:/\\?#]+):)?(//(([^:/\\?#]*)(?::([^/\\?#]*))?))?([^\\?#]*)(\\?([^#]*))?(#(.*))?$");
                var wsUrl = null;
                if (window.location.protocol == 'https:') {
                    wsUrl = 'https://' + url[4] + ':3008/widget';
                } else {
                    wsUrl = 'http://' + url[4] + ':3000/widget';
                }
                Api.ws = io.connect(wsUrl, {
                    reconnection: true, 
                    reconnectionAttempts: 3, 
                    forceNew: true,
                    transports: [
                        'websocket',
                        'flashsocket',
                        'htmlfile',
                        // 'xhr-polling',
                        // 'jsonp-polling',
                        // 'polling'
                    ]
                });
            }
            return Api.ws;
        },
        style: function (link) {
            var cssLink = document.createElement("link");
            cssLink.href = link;
            cssLink.rel = "stylesheet";
            cssLink.type = "text/css";
            frames['pozvonim-frame'].document.body.appendChild(cssLink);
        },
        request: function (options, data) {
            options.url = opts.apiPath + options.url;
            var params = $.extend(
                {
                    method: 'POST',
                    async: true,
                    cache: false,
                    timeout: 30000,
                    dataType: 'json',
                    data: $.extend(
                        self.api.getClient(),
                        data || {}
                    ),
                    xhrFields: {withCredentials: true},
                    crossDomain: true
                }, options || {}
            );

            return $.ajax(params);
        },
        show: function (event,config) {
            if (typeof config === 'undefined') {
                config = {};
            }
            if (widgetState.button.isDragged) {
                return;//false;
            }

            if (opts.callback.sound_on_show == 1 && !config.preventSound) {
                self.audioPlayer.play('/callback/sound/open.mp3');
            }

            if (typeof event !== "string") {
                event = 'click';
            }

            if (!opts.callback.is_working && event != 'calendar') {
                event = 'offline';
            }

            widgetState.is_delayed = false;

            if (event == 'calendar') {
                widgetState.is_delayed = true;
                self.api.Element.calendarCall.hide();
                self.api.Element.calendarBack.show();
            } else {
                self.api.Element.calendarCall.show();
                self.api.Element.calendarBack.hide();
            }

            if (opts.callback.window_cover) {
                self.elCover.addClass('callback__overlay--active');
            }

            if (event != 'click') {
                widgetState.isActive = false;
                widgetState.session.showSessionCount++;
                widgetState.permanent.showPreviousAt = new Date().getTime();
                if (true) {
                    self.api.Storage.storage.set('permanent', widgetState.permanent);
                }
            }

            widgetState.catchType = event;
            widgetState.isLocked = true;
            self.api.Button.hide();
            self.api.Content.call.find('.events').hide();
            self.api.Content.call.find('.' + event).show();
            self.elWrapper.addClass('opened');
            self.elWrapper.addClass('callback__overlay--active');
            self.elWrapper.find('iframe').addClass('callback-frame--active');
            PVE('OPENED', 'Widget called api function show:' + event);
            if(opts.is_mobile){
                $.Utils.fullscreen({
                element: self.elWrapper.get(0),
                viewportWidthPortrait: 400,
                viewportWidthLandscape: 840,
                pos: {left: 0, right: 0, top: 0, bottom: 0}
            });
            }
            /*window.setTimeout(function () {
                if (navigator.userAgent.match(/(iPod|iPhone|iPad)/) && navigator.userAgent.match(/AppleWebKit/)) {
                    self.api.Input.phone.focus();
                }
            },500);*/
            self.api.event('show');
        },
        hide: function (event) {
            widgetState.isLocked = false;
            self.api.Button.show();
            self.elCover.hide();
            self.elWrapper.removeClass('callback__overlay--active');
            self.elWrapper.find('iframe').removeClass('callback-frame--active');
            self.elWrapper.removeClass('opened');
            onScroll();
            onResize();
            self.api.event('hide');
        },
        on: function (type, callback) {
            if (!widgetState.events[type]) {
                widgetState.events[type] = [];
            }
            widgetState.events[type].push(callback);

        },
        event: function (type, data) {
            $.each(widgetState.events[type] || [], function (index, callback) {
                try {
                    callback.apply(self, [data]);
                } catch (e) {
                    PVE('ERROR', 'User event handler error', {}, e);
                }
            });
        },
        report: function (status) {
            self.api.event('report', self.api.getPhone());
            self.api.request({url: '/call/report'}, {call_id: widgetState.id, status: status});
        },
        rating: function (rating) {
            self.api.event('rating', self.api.getPhone());
            self.api.request({url: '/call/rating'}, {call_id: widgetState.id, rating: rating});
        },
        feedback: function (clauseId,questionId,feedbackData) {
            self.api.request({url: '/call/feedback/' + clauseId + '/' + questionId}, feedbackData);
        },
        userData: function(callback) {
            if (typeof(callback) === 'undefined') {
                callback = function(){}
            }
            $.ajax({
                url: opts.apiPath + '/user',
                cache: false,
                async: true,                
                success: callback,
                method: 'GET',
                xhrFields: {withCredentials: true},
                crossDomain: true
            });
        },
        call: function (options) {
            var status,
                number = options.phone || '',
                region = options.region || '',
                delayed = options.delayed || false;
            number = number.replace(/[^0-9]/g, '');

            var re = new RegExp('^(' + opts.callback.prefixes.join('|') + '0' + ')[0-9]{7,20}$');
            if (!number.match(re)) {
                return 'validation';
            }
			
			var defcode = parseInt(number.substring(1, 4));
			
			if(opts.callback.defcode_rules &&
				opts.callback.defcode_rules.length > 0 && (
					(opts.callback.defcode_mode === 'allowed' && opts.callback.defcode_rules.indexOf(defcode) === -1)
					|| (opts.callback.defcode_mode === 'denied' && opts.callback.defcode_rules.indexOf(defcode) !== -1)
				)
			) {
				return 'defcode';
			}
			
            widgetState.session.sourceCall = window.location.href;
            PVE('CALL', 'Widget called api function call');
            self.api.event('call.before', number);
            self.api.event('call', number);
            if (delayed !== false) {
                self.api.event('call.delayed', number);
                self.api.event('call.offline', number);
                self.api.request(
                    {
                        url: '/call/delayed',
                        success: function (respond) {
                            self.api.event('call.delayed.respond', respond);
                            widgetState.id = respond.id;
                        }
                    },
                    {
                        phone: number, 
                        region: region, 
                        delayed: delayed,
                        local_time: self.api.Schedule.getLocalISO8601()
                    }
                );
                status = 'delayed';
            } else {
                self.api.event('call.success', number);
                self.api.request(
                    {
                        url: '/call',
                        success: function (respond) {
                            widgetState.id = respond.id;
                            self.api.event('call.success.respond', respond);
                        },
                        error: function(respond) {
                            var errorCode = respond.responseJSON.error.message;
                            if (errorCode == 'Phone blacklisted') {
                                self.api.event('call.blacklist', respond.responseJSON);
                            } else if (errorCode == 'Widget balance too low') {
                                self.api.event('call.balance', respond.responseJSON);
                            } else if (respond.responseJSON.error.code == 'DELAYED-CALLS-ONLY') {
                                self.api.event('call.required.delayed', respond.responseJSON);
                            }
                        }
                    },
                    {
                        phone: number, 
                        region: region,
                        local_time: self.api.Schedule.getLocalISO8601()
                    }
                );
                status = 'call';
            }
            if (opts.callback.balance === 0) {
                self.api.event('call.balance', number);
                status = 'balance';
            }
            return status;
        },
        getState: function () {
            return widgetState;
        },
        getClient: function () {
            return {
                source_enter: widgetState.session.sourceEnter,
                source_referer: widgetState.session.sourceReferer,
                source_call: widgetState.session.sourceCall,
                catch_type: widgetState.catchType,
                return_count: widgetState.session.isReturned
            };
        },
        getOptions: function () {
            return opts;
        },
        setOptions: function (key, value) {
            opts[key] = value;
        },
        getPhone: function () {
            return self.api.Input.phone.val();
        },
        setPhone: function (phone) {
            if (self.api.Input) {                
                var result = self.api.Input.phone.val(phone);
                self.api.event('wrapper.input.phone.changed', phone);
                return result;
            }
        },
        getDelayed: function () {            
            var minuteValue = self.api.Input.delayed.minute.find('option:selected').data('time');
            if (!minuteValue) {
                minuteValue = '';
            }
            return [self.api.Input.delayed.day.val()].concat(minuteValue.split(':'));
        },
        getDelayedUTC: function() {
            return self.api.Input.delayed.minute.val();
        },
        setDelayed: function (weekday,hour,minutes) {
            self.api.Input.delayed.day.val(weekday);
            var time = this.Schedule.zeroPad(hour,2) + ':' + this.Schedule.zeroPad(minutes,2);
            self.api.Input.delayed.minute.find('option').each(function(k,v){
                var $v = $(v);
                var timeValue = $v.data('time');
                var isSelected = timeValue == time;
                $v.prop('selected',isSelected);
            });
            var minuteSumo = self.api.Input.delayed.minute[0].sumo;
            if (minuteSumo) {
                minuteSumo.reload();
            }
            var weekSumo = self.api.Input.delayed.day[0].sumo;
            if (weekSumo) {
                weekSumo.reload();
            }
        },
        Storage: loStorage
    };
    if (opts.chat.is_enable) {
        core.Chat = {
            blockForIframe: $('#pozvonim-wrapper-chat'),
            iframe: $('#pozvonim-chat-frame'),
            body: self.elWidgetChat,
            footer: self.elWidgetChat.find('.pozvonim-chat__footer'),
            smile: self.elWidgetChat.find('#emojionearea3'),
            Class: {
                animation: {
                    visibleChat: 'pozvonim-chat--animation-visible',
                    chatHidden: 'pozvonim-chat--element-hidden',
                    transition: 'pozvonim-chat--animation',
                },
                smile: {
                    smileActiv: 'smiles__activation',
                    smileElement: 'smiles__item',
                    smile: 'smiles',
                },
                drop: {
                    dropHeader: 'header__drop',
                    dropHeaderActivate: 'header__drop-activate',
                    dropHeaderItem: 'header__drop-item',
                },
                welcome: {
                    welcomeChat: 'welcome-chat',
                    close: 'welcome-chat__close',
                    selector: 'welcome-chat__text',
                },
                base: 'pozvonim-chat--base',
                open: 'pozvonim-chat-open',
                full: 'pozvonim-chat--full',
                fullHeight: 'pozvonim-chat--full-height',
            },
            Connection: {
                connect: self.elWidgetChat.find('.connection'),
                disconnect: self.elWidgetChat.find('.connection .disconnect'),
                reconnect: self.elWidgetChat.find('.connection .reconnecting'),
                block: self.elWidgetChat.find('.connection > div'),
            },
            Input: {
                chatinput: self.elWidgetChat.find('#pozvonim-widget-chat'),
                chatinputMessage: self.elWidgetChat.find('.user-message__input'),
                chatphone: self.elWidgetChat.find('#pozvonim-chat-phone'),
            },
            Block: {
                chatBlock: self.elWidgetChat.find('.pozvonim-chat--open'),
            },
            Sidebar: {
                right: self.elWidgetChat.find('.header__control--right-sidebar'),
            },
            Message: {
                body: self.elWidgetChat.find('.message-send-form'),
                info: self.elWidgetChat.find('.message-send-form').find('.form-info__text'),
                bodyFinish: self.elWidgetChat.find('.message-send-form-finish'),
                emailBlock: self.elWidgetChat.find('.chat-email-form-block'),
                form: {
                    name: self.elWidgetChat.find('.message-name-element'),
                    email: self.elWidgetChat.find('.message-email-element'),
                    phone: self.elWidgetChat.find('.message-phone-element'),
                    text: self.elWidgetChat.find('.message-text-element'),
                    button: self.elWidgetChat.find('.actionMessageChat'),
                }
            },
            Element: {
                chatTextButton: self.elWidgetChat.find('.x-chat-btn-enter'),
                type: self.elWidgetChat.find('.typing'),
                typeWelcome: self.elWidgetChat.find('.typing__loading--welcome-text'),
                messageFromChat: self.elWidgetChat.find('.message-from-chat'),
                inputFocus: self.elWidgetChat.find('.form-field__focus'),
                scroll: self.elWidgetChat.find('.custom-scroll_container'),
                scrollTrack: self.elWidgetChat.find('.custom-scroll_track-y'),
                scrollBar: self.elWidgetChat.find('.custom-scroll_bar-y'),
                minify: self.elWidgetChat.find('.header__control--minify'),
                header: self.elWidgetChat.find('.header'),
            },
            Present: {
                body: self.elWidgetChat.find('.present-send-form'),
                info: self.elWidgetChat.find('.present-send-form').find('.form-info__text'),
                robot: {
                    name: self.elWidgetChat.find('.robot_present_name'),
                    logo: self.elWidgetChat.find('.robot_present_logo'),
                    info: self.elWidgetChat.find('.robot_present_text'),
                },
                form: {
                    name: self.elWidgetChat.find('.chat-name-element'),
                    email: self.elWidgetChat.find('.chat-email-element'),
                    phone: self.elWidgetChat.find('.chat-phone-element'),
                    button: self.elWidgetChat.find('.actionPresentChat'),
                    cancel: self.elWidgetChat.find('.cancelPresentChat'),
                }
            },
            Content: {
                chatTextBlock: self.elWidgetChat.find('.chat-text'),
                chatText: self.elWidgetChat.find('.chat-text__inner'),
                chatInnerBlockText: self.elWidgetChat.find('.custom-scroll_inner'),
                chatPresent: self.elWidgetChat.find('.chatPresent'),
                chatFormText: self.elWidgetChat.find('.chatFormText'),
            },
            Robot: {
                logo: self.elWidgetChat.find('.consultant__avatar'),
                name: self.elWidgetChat.find('.consultant__name')
            },
            Consultant: {
                body: self.elWidgetChat.find('.consultant'),
                avatar: self.elWidgetChat.find('.consultant__avatar'),
                name: self.elWidgetChat.find('.consultant__name'),
                status: self.elWidgetChat.find('.consultant__status'),
                header: self.elWidgetChat.find('.header__status span'),
            },
            Welcome: {
                body: self.elWidgetChat.find('.welcome-chat'),
            }
        };
        core.Type = {
            typeChat: 0
        };
    }
    var Schedule = function(config, serverTime) {
	this.config = config;
    this.serverTime = serverTime;
	this.weekConfig = {};
    this.now = new Date();
    
    this.run();
};

Schedule.prototype.zeroPad = function(num, places) {
    var zero = places - num.toString().length + 1;
    
    return Array(+(zero > 0 && zero)).join("0") + num;
};

Schedule.prototype.getWeek = function(day) {
    var week = ["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];
    
    if (week[day]) {
        return week[day];
    }
    
    return null;
};

Schedule.prototype.zeroMinutes = function(time) {
    var date = new Date(time * 1000);
    var minutes = Math.floor(date.getMinutes() / 10) * 10;
    
    date.setMinutes(minutes);
    date.setSeconds(0);
    
    return Math.floor(date.getTime() / 1000);
};

Schedule.prototype.normalizeOffset = function(offset) {
    return Math.round(offset / 1800) * 1800;
};

Schedule.prototype.nextWorkingTime = function() {
    var result = false;
    
    for (var day in this.weekConfig) {
        for (var time in this.weekConfig[day]) {
            return time;
        }
    }
    
    return result;
};

Schedule.prototype.run = function(delayFree) {
    if (delayFree !== undefined) {
        var config = delayFree;
    } else {
        var config = this.config;
    }
    
    this.weekConfig = {};
    var serverTime = this.serverTime;
    var now = this.now;
	var clientTime = Math.floor(now.getTime() / 1000);
	var offsetTime = this.normalizeOffset(clientTime - serverTime);
	var realNow = new Date(now.getTime() - offsetTime * 1000);
    
	for (var i in config) {
		var period = $.extend({}, config[i]);
		var dateOffset = period.begin - this.zeroMinutes(period.begin);
        
		for (var j = period.begin; j <= period.end; j+= 10 * 60) {
			var date = new Date((j - dateOffset + offsetTime) * 1000);
			var realDate = new Date((j - dateOffset ) * 1000);
            
			if (realDate > realNow) {
				var dayOfWeek = this.getWeek(date.getDay());
                
				if (!this.weekConfig[dayOfWeek]) {
					this.weekConfig[dayOfWeek] = {};
				}
                
				var realTime = realDate.toISOString();
				var time = date.toTimeString().substr(0,5);
				this.weekConfig[dayOfWeek][realTime] = time;
			}
		}
	}
    
    return this;
};

Schedule.prototype.getLocalISO8601 = function() {
    var now = new Date();
    var result = this.zeroPad(now.getFullYear(),4) + '-' + this.zeroPad(now.getMonth() + 1,2) + '-' + this.zeroPad(now.getDate(),2);
    result = result + 'T' + this.zeroPad(now.getHours(),2) + ':' + this.zeroPad(now.getMinutes(),2) + ':' + this.zeroPad(now.getSeconds(),2);
    return result;
};

    core.Schedule = new Schedule(opts.callback.delay_free, opts.time);
    if (opts.callback.is_enable) {
        core.Input = { //+
            phone: self.elWidget.find('#pozvonim-phone-input'),
            region: self.elWidget.find('#pozvonim-region-input'),
            regionFake: self.elWidget.find('#pozvonim-region-input-fake'),
            emailname: self.elWidget.find('#pozvonim-email-name'),
            emailtype: self.elWidget.find('#pozvonim-email-type'),
            emailtext: self.elWidget.find('#pozvonim-email-textarea'),
            emailtextLabel: self.elWidget.find('#pozvonim-email-textarea-label'),
            emailemail: self.elWidget.find('#pozvonim-email-email'),
            emailphone: self.elWidget.find('#pozvonim-email-phone'),
            delayed: {
                day: self.elWidget.find('#pozvonim-delay-day-input'),
                hour: self.elWidget.find('#pozvonim-delay-hour-input'),
                minute: self.elWidget.find('#pozvonim-delay-minute-input')
            }
        };
        core.Element = { //-
            timer: self.elWidget.find('#pozvonim-timer-element'),
            button: self.elWidget.find('#pozvonim-button-element'),
            validation: self.elWidget.find('#pozvonim-validation-element'),
			defcode: self.elWidget.find('#pozvonim-validation-defcode'),
            staytime: self.elWidget.find('#pozvonim-element-staytime'),
            returncount: self.elWidget.find('#pozvonim-element-returncount'),
            viewpagecount: self.elWidget.find('#pozvonim-element-viewpagecount'),
            returnback: self.elWidget.find('#pozvonim-element-returnback'),
            emailAll: self.elWidget.find('.pozvonim-com-x-chat'),
            emailbutton: self.elWidget.find('#pozvonim-button-element-email'),
            emailfile: self.elWidget.find('.pozvonim-com-x-chat-file'),
            emailAddButton: self.elWidget.find('.pozvonim-com-x-chat-div-add-file'),
            emailBodyValidation: self.elWidget.find('#pozvonim-email-body-validation-element'),
            emailSendValidation: self.elWidget.find('#pozvonim-email-send-validation-element'),
            emailEmailValidation: self.elWidget.find('#pozvonim-email-email-validation-element'),
            emailEmailVertValidation: self.elWidget.find('#pozvonim-email-emailvert-validation-element'),
            emailPhoneValidation: self.elWidget.find('#pozvonim-email-phone-validation-element'),
            emailFileValidation: self.elWidget.find('#pozvonim-email-file-validation-element'),
            emailFileSizeValidation: self.elWidget.find('#pozvonim-email-file-size-validation-element'),
            emailFileExt: self.elWidget.find('.file-ext'),
            buttonCallAgain: self.elWidget.find('.actionCallAgain'),
            buttonCallAgainContainer: self.elWidget.find('#pozvonim-call-again-button-container'),
            buttonCallAgainCountdown: self.elWidget.find('#pozvonim-call-again-countdown'),
            buttonCallAgainCountdownTimer: self.elWidget.find('#pozvonim-call-again-countdown-timer'),            
            feedback: self.elWidget.find('#feedback-container'),
            calendarCall: self.elWidget.find('#display-calendar-call'),
            calendarBack: self.elWidget.find('#display-calendar-back'),
            delayTime: self.elWidget.find('#pozvonim-delay-time')
        };

        core.Content = { // -
            call: self.elWidget.find('#pozvonim-element-call'),
            final: self.elWidget.find('#pozvonim-element-final'),
            balance: self.elWidget.find('#pozvonim-element-balance'),
            offline: self.elWidget.find('#pozvonim-element-offline'),
            calendar: self.elWidget.find('#pozvonim-element-calendar'),
            formcalendarbtn: self.elWidget.find('#pozvonim-calendar-button'),

            calendarDay: self.elWidget.find('#calendar-day-input'),
            calendarTime: self.elWidget.find('#calendar-time-input'),
            //calendarMinute: self.elWidget.find('#calendar-minute-input'),

            email: self.elWidget.find('#pozvonim-element-email'),
            emailFinal: self.elWidget.find('#pozvonim-element-email-final'),
            buttonBlock: self.elWidget.find('.pozvonim-com-x-chat-btn-top'),
        };
        core.Button = {
            show: function () {
                self.elButton.show();
            },
            hide: function () {
                self.elButton.hide();
            },
        };
    }
    core.Storage = loStorage;
    return core;
})();

        this.api = Api;
        var CallbackContext = function () {
	this.tabMaps = {};
	this.findActiveElement = function() {
		if (self.elWidget) {			
			return self.elWidget.find('.callback__box.callback__box--current');
		} else {
			return null;
		}
	}
	this.activateTab = function($tab) {		
		if (self.elWidget) {			
			self.elWidget.find('.callback__box').removeClass('callback__box--current');
			$tab.addClass('callback__box--current');
			$tab.show();
		}
	}
	this.activate = function(tab,force) {
		if (self.elWidget) {			
			if (typeof force === 'undefined') {
				force = false;
			}
			tab = this.getTabForActivation(tab);
			var $tab = self.elWidget.find('#' + tab);
			this.activateTab($tab);			
		}
	}.bind(this);
	this.get = function() {
		var element = this.findActiveElement();
		if (element) {
			return element.attr('id');
		} else {
			return null;
		}
	}.bind(this);
	this.getTabForActivation = function(tab) {
		if (this.tabMaps[tab]) {
			tab = this.tabMaps[tab];
		}
		return tab;
	}.bind(this);
	this.isTabRemapped = function(fromTab,toTab) {
		var result = this.tabMaps[fromTab];
		if (toTab) {
			return result == toTab;
		} else {
			return !!result;
		}
	}
	this.remapTab = function(fromTab,toTab) {
		this.tabMaps[fromTab] = toTab;
	}.bind(this);
	return this;
};
        this.context = new CallbackContext;
        var UserInfo = function(api) {
	this.api = api;
	this.iframeUrl = opts.userInfoProto + opts.cdnPath + '/crossdomain.html?v2'
	this.iframe = document.createElement('iframe');
	this.iframe.style.display = 'none';
	this.iframe.src = this.iframeUrl;
	document.body.appendChild(this.iframe);		
	this.requestUserData = function(callback) {
		if (typeof (callback) === 'undefined') {
			callback = function(){};
		}
		var messageId = Math.random();
		var listener = function(callback,messageId,event) {
			if (event.data.messageId == messageId) {
				if (event.data.session) {
					callback(event.data.session);
				} else if (event.data.version) {
					this.api.userData(function(sessionResponse){
						if (this.iframe.contentWindow.postMessage) {
							this.iframe.contentWindow.postMessage(
								{
									session: sessionResponse,
									type: 'pvm:session:set',
								},
								this.iframeUrl
							);					
						}
						callback(sessionResponse);
					}.bind(this));
				}
				event.target.removeEventListener(event.type, arguments.callee);
			}
		}.bind(this,callback,messageId);
		window.addEventListener('message',listener);
		if (this.iframe.contentWindow.postMessage) {
			this.iframe.contentWindow.postMessage(
				{
					url: window.location.href,
					type: 'pvm:session:get',
					messageId: messageId
				},
				this.iframeUrl
			);
		}
	}.bind(this);
	this.iframe.addEventListener('load',function(){
		this.requestUserData(function(data){
			if (data.phone) {			
				this.api.setPhone('+' + data.phone);
			}
		}.bind(this));		
		this.api.on('call.delayed.respond',function(){
			//  .
			this.requestUserData();
		}.bind(this));
		this.api.on('call.success.respond',function(){
			//  .
			this.requestUserData();
		}.bind(this));
	}.bind(this));
	return this;
}
        if (opts.userInfo) {
            this.userInfo = new UserInfo(this.api);
        }
        if (opts.fingerprint == true) {	
	this.fingerprint = new Fingerprint2({
	    detectScreenOrientation: false,
	    extendedJsFonts: true
	});
	this.fingerprint.get(function (result, components) {
	    self.api.request({url: '/user/detect'}, {
	        fingerprint: result
	    });
	});
}
        if (opts.chat.is_enable) {
            var EVENT_TYPE = {
    1: 'CONNECT',
    2: 'UPDATE',
    3: 'RECONNECT',
    4: 'DISCONNECT',
    5: 'TYPING',
    6: 'MESSAGE',
    7: 'SELECT',
    8: 'STATE',
    9: 'HISTORY',
    10: 'TRANSFER',
    11: 'BAN',
    12: 'NOTE',
    13: 'TAG',
    14: 'INFO',
    15: 'LEAVE',
    16: 'IDLE',
    17: 'AWAY',
    18: 'OFFLINE',
    19: 'READ',
    20: 'PRESENT',
    21: 'VIEW',
    22: 'ANSWERPHONE',
    23: 'ANSWERPHONE_ONLINE',
    24: 'BLACKLIST',
    25: 'BLACKLISTHISTORY',
    26: 'UNBAN',
    27: 'DOWNLOAD',
    28: 'PRESENTSOCIAL',
    100: 'CALL'
};

var Event = function (data) {
    if (data.from === null) return null;

    //console.log(data);
    return {

        from: data.from || null,
        type: data.type || null,
        data: data.data || null,
        created_at: data.created_at || null
    };
};

var player = this.audioPlayer;
var event, lastEventId, connection, push, client, clients = {}, transport, state, active;

var banClient = [];

var feedbackChat = null;

var waitTyping, waitPopup, is_connect, is_guest, waitPopupBan, is_block_message = true,
    waitNote = false,
    selectedClientId,
    clientFilter = 'all',
    idleStatus = false,
    idleTimeout,
    idleThrottle = false,
    idleThrottleTimeout = false,
    unreadCount = 0,
    managerMessageCount = 0,
    controls = {},
    title = document.title,
    titleMessage,
    statusMessage = 'read';

var chatRobot = {};
var chatInvite = {};
var chatSettings = {};
var chatInviteClone = {};
var chatButton = {};
var sessionId = '';

transport = {
    push: function (event) {

        connection.emit(event.type, event);
    },
    connect: function (type) {
        var handler = transport.events;
        transport.state('connecting');
        transport.listen(type);
        $.each(EVENT_TYPE, function (index, event) {
            connection.on(event, handler);
        });
        transport.state('connected');

    },
    disconnect: function () {
        transport.state('disconnecting');
        connection.disconnect();
        transport.state('disconnected');
    },
    state: function (newState) {
        state = newState;
    },
    events: function (data) {

        var event = Event(data);
        if (self.api.Type.typeChat) {
            clients[event.from.id] = event.from;
        }
        self.Event.trigger(event.type, event);
    },
    listen: function () {
        if (!connection) {
            var url = opts.apiPath.match("^(([^:/\\?#]+):)?(//(([^:/\\?#]*)(?::([^/\\?#]*))?))?([^\\?#]*)(\\?([^#]*))?(#(.*))?$");
            var chatUrl = null;
            if (window.location.protocol == 'https:') {
                chatUrl = 'https://' + url[4] + ':8443/client';
            } else {
                chatUrl = 'http://' + url[4] + ':3005/client';
            }
            connection = io.connect(chatUrl, {reconnection: true, reconnectionAttempts: 3, forceNew: true});
            connection.on('connect', function () {
                if (self.api.Type.typeChat) {
                    connection.emit('authenticated', client);
                } else {
                    connection.emit('connected', client);
                }
                self.api.Chat.Connection.connect.hide();
                if (self.api.Type.typeChat) {
                    self.elWidget.find('.chat-input-block').show();
                } else {
                    self.api.Chat.body.removeClass('pozvonim-chat--connection');
                }
            });
            connection.on('disconnect', function () {
                self.api.Chat.Connection.connect.show();
                self.api.Chat.Connection.reconnect.show();

                if (self.api.Type.typeChat) {
                    self.api.Chat.Connection.block.hide();
                    self.elWidget.find('.chat-input-block').show();
                } else {
                    self.api.Chat.body.addClass('pozvonim-chat--connection');
                }
            });
            connection.on('reconnecting', function () {
                self.api.Chat.Connection.connect.show();
                self.api.Chat.Connection.reconnect.show();

                if (self.api.Type.typeChat) {
                    self.api.Chat.Connection.block.hide();
                    self.elWidget.find('.chat-input-block').show();
                } else {
                    self.api.Chat.body.addClass('pozvonim-chat--connection');
                }
            });
            connection.on('reconnect_failed', function () {
                self.api.Chat.Connection.connect.show();
                self.api.Chat.Connection.disconnect.show();

                if (self.api.Type.typeChat) {
                    self.api.Chat.Connection.block.hide();
                    self.elWidget.find('.chat-input-block').show();
                } else {
                    self.api.Chat.Connection.reconnect.hide();
                    self.api.Chat.body.addClass('pozvonim-chat--connection');
                }
            });
        }
    }
};

var onConnect = function (event) {

        //console.log(event);

        if (event.from.id == client.id) {
            client = event.from;
            clients = event.data.clients;

            var messages = '';
            $.each(event.data.history, function (index, event) {
                if(event.type == 'MESSAGE'){
                    messages += messageText(event);
                    if (event.from.manager_id !== null) {
                        managerMessageCount++;
                    }
                    is_guest = false;
                }
            });
            self.api.Chat.Content.chatText.html(messages);
            idleTimer();
            $(window).on('click mousemove keypress', idleTimer);

        } else {
            if (self.api.Type.typeChat == 0) {
                if (event.from.id == client.select_id) {
                    updateStatus(event.from.online);
                }
            } else {
                clients[event.from.id] = event.from;
                if (event.from.select_id === null) {
                    player.play('/plugins/iframe.widget-2.0.0/notification.wav');
                }
                if(client.select_id == event.from.id && event.from.type === null){
                    event.data = ' ' + event.from.name + '  ';
                    onMessage(event);
                }
            }

        }
        updateClients();

        if (self.api.Type.typeChat == 0) {
            message('text');
            sessionId = event.from.sessionID;
        }
    },
    onMessage = function (event) {

        updateClients();

        waitTyping = false;

        if (event.from.select_id == client.id) {
            answerPhoneStop(event);
        } else {
            answerPhoneStart(event);
        }

        if ((!self.hasFocus || !self.state) && event.from.select_id == client.id) {
            player.play('/plugins/iframe.widget-2.0.0/notification.wav');
            titleMessage = '   ';
            clearInterval(timeOutAction['newMessageInterval']);
            timeOutAction['newMessageInterval'] = setInterval(function () {
                if (document.title != titleMessage) {
                    document.title = titleMessage;
                }
                else {
                    document.title = title;
                }
            }, 1000);
        }

        if (event.from.manager_id !== null) {
            managerMessageCount++;
        }

        statusMessage = 'unread';

        if (event.from.id == client.select_id || client.id == event.from.id) {

            var message = messageText(event);

            self.api.Chat.Content.chatText.append(message);

            if (self.api.Type.typeChat) {
                self.api.Content.chatList.data('jsp').reinitialise();
                self.api.Content.chatList.data('jsp').scrollToBottom();
            } else {
                onScrollElement(self.api.Chat.Content.chatText[0].scrollHeight);
            }
        }

        onPresent();

        onFeedbackChat('message');

    },
    onFeedbackChat = function (type) {

    },
    onPresent = function () {

    },
    onIdle = function (event) {
        if (self.api.Type.typeChat) {
            updateClients();
        } else {
            if (event.from.id == client.select_id) {
                updateStatus(event.from.online);
            }
        }
    },
	onView = function(data) {
		if (self.api.Type.typeChat && data.from.id == client.id) {
			if (data.data.is_select) {
				select(data.data.client);
				return;
			}
			clients[data.data.client.id] = data.data.client;
			self.api.Content.chatListPane.empty();
			var messages = '';
			$.each(data.data.history, function(index, event) {
			    if(event.type == 'MESSAGE'){
                    messages += messageText(event);
                }

                if(event.type == 'CONNECT'){
                    event.data = ' ' + event.from.name + '  ';
                    messages += messageText(event);
                }

                if(event.type == 'DISCONNECT'){
                    event.data = ' ' + event.from.name + '  ';
                    messages += messageText(event);
                }

                if(event.type == 'PRESENT'){
                    event.data = '  ' + event.from.name;
                    messages += messageText(event);
                }

                if(event.type == 'DOWNLOAD'){
                    event.data = event.from.name + '  ';
                    messages += messageText(event);
                }

			});
			self.api.Content.chatListPane.append(messages);
            controls.setStateChat();
        }
    },
    onSelect = function (event) {
        if (self.api.Type.typeChat) {
            clients[event.data.client.id] = event.data.client;
            if (event.from.id == client.id && event.data.history) {
                self.api.Content.chatListPane.empty();
                var messages = '';
                $.each(event.data.history, function (index, event) {
                    if(event.type == 'MESSAGE'){
                        messages += messageText(event);
                    }

                    if(event.type == 'CONNECT'){
                        event.data = ' ' + event.from.name + '  ';
                        messages += messageText(event);
                    }

                    if(event.type == 'DISCONNECT'){
                        event.data = ' ' + event.from.name + '  ';
                        messages += messageText(event);
                    }

                    if(event.type == 'PRESENT'){
                        event.data = '  ' + event.from.name;
                        messages += messageText(event);
                    }

                    if(event.type == 'DOWNLOAD'){
                        event.data = event.from.name + '  ';
                        messages += messageText(event);
                    }
                });
                self.api.Content.chatListPane.append(messages);
            }
            if (client.info.tarif[event.data.client.site_id].name == opts.defaultDialog && event.from.id == client.id && event.data.payinfo) {
                if(event.data.payinfo === 'success'){
                    opts.curentBalance = event.data.balance;
                }
            }
            controls.setStateChat();
            updateClients();
        } else {
            if (client.select_id !== null) return false;
            client.select_id = event.from.id;
            player.play('/plugins/iframe.widget-2.0.0/notification.wav');

            //console.log(client);
            //console.log(event.from.info.connect[client.site_id].site.settings);

            //event.from.info.logo
            //event.from.name

            var messageSelect = '<div class="text-center form-info">';
            messageSelect += '<p class="form-info__text" style="margin-bottom: 5px;">   </p>';
            messageSelect += '<i class="form-info__icon form-info__icon--border"><img class="form-info__icon-img" src="' + event.from.info.connect[client.site_id].site.settings.logo + '"></i>';
            messageSelect += '<p class="form-info__text"><span class="text-bold">' + event.from.info.connect[client.site_id].site.settings.name + '</span></p>';
            messageSelect += '</div>';
            self.api.Chat.Content.chatText.append(messageSelect);
            self.api.Chat.Consultant.avatar.html('<img src="' + event.from.info.connect[client.site_id].site.settings.logo + '">');
            self.api.Chat.Consultant.name.html(event.from.info.connect[client.site_id].site.settings.name);
            updateStatus(event.from.online);
            onScrollElement(self.api.Chat.Content.chatText[0].scrollHeight);
        }
    },
    onTyping = function (event) {
        if (event.from.id == client.id || event.from.id != client.select_id) {
            return false;
        }
        self.api.Chat.Element.type.show();

        var typingUser = event.from.name;
        if (!self.api.Type.typeChat) {
            typingUser = event.from.info.connect[client.site_id].site.settings.name;
        }
        self.api.Chat.Element.type.find('span').html(typingUser + '  ...');
        setTimeout(function () {
            self.api.Chat.Element.type.find('span').html('');
            self.api.Chat.Element.type.hide();
        }, 3000);
    },
    onDisconnect = function (event) {
        if (self.api.Type.typeChat) {
            updateClients();
            if(client.select_id == event.from.id){
                event.data = ' ' + event.from.name + '  ';
                onMessage(event);
            }
        } else {
            if (event.from.id == client.select_id) {

                updateStatus(event.from.online);
            }
        }
    },
    onBan = function (event) {
        if (self.api.Type.typeChat) {
            banClient[event.data] = event.data;
            delete clients[event.data];
            updateClients();
        } else {
            transport.disconnect();
            onBanAction();
        }
    },
    onBanAction = function () {
        self.elWidgetChat.find('.connection').remove();
        self.api.Chat.body.removeClass('pozvonim-chat--connection');
        self.api.Chat.Content.chatText.empty();
        self.api.Chat.Content.chatText.append('<div class="mess messOperator"><div class="messText">   ,   ,     .</div></div>');
        self.elWidgetChat.find('.user-message__text-edit').remove();
        self.elWidgetChat.find('.user-message__down .file-add').remove();
        self.api.Chat.body.find('.pozvonim-chat__footer').css('height','40px');

    },
    onLeave = function (event) {

        if (self.api.Type.typeChat) {
            clients[event.data.id] = event.data;
            if (event.from.id == client.id) {
                self.api.Content.chatListPane.empty();
                controls.setStateClient();
            }
            updateClients();
        } else {
            if (client.select_id === null) {
                return false;
            }
            client.select_id = null;

            var messageSelect = '<div class="text-center form-info">';
            messageSelect += '<p class="form-info__text" style="margin-bottom: 5px;">   </p>';
            messageSelect += '<i class="form-info__icon form-info__icon--border"><img class="form-info__icon-img" src="' + event.from.info.connect[client.site_id].site.settings.logo + '"></i>';
            messageSelect += '<p class="form-info__text"><span class="text-bold">' + event.from.info.connect[client.site_id].site.settings.name + '</span></p>';
            messageSelect += '</div>';

            self.api.Chat.Content.chatText.append(messageSelect);
            self.api.Chat.Consultant.avatar.html('<img src="' + opts.cdnPath +  chatRobot.logo + '">');
            self.api.Chat.Consultant.name.html(chatRobot.name);
            updateStatus(1);
            onScrollElement(self.api.Chat.Content.chatText[0].scrollHeight);

            onFeedbackChat('leave');
        }
    },
    onTransfer = function (event) {

    },
    onHistory = function (event) {
    },
    onDownload = function (event) {

    },
    onPresentSocial = function (event) {

    },
    onRead = function (event) {

        if (event.from.select_id == client.id) {

        } else {

        }
    },
    onPresentClient = function (event) {
        updateClients();
        updateChat(event);

        if (self.api.Type.typeChat) {
            if (client.select_id == event.from.id) {
                event.data = '  ' + event.from.name;
                onMessage(event);
            }
        }

    },
    idleTimer = function (event) {
        if (idleThrottle === false) {
            window.clearTimeout(idleTimeout);
            idleTimeout = window.setTimeout(idle, 30000);
            idleThrottle = true;
            if (client.online == 2) {
                idle(1);
            }
        } else if (idleThrottleTimeout === false) {
            idleThrottleTimeout = window.setTimeout(idleTimerThrottle, 3000);
        }
    },
    idle = function (state) {
        transport.push({type: 'IDLE', data: state ? 1 : 2, tp: client.id});
        client.online = state ? 1 : 2;
    },
    idleTimerThrottle = function () {
        idleThrottle = false;
        idleThrottleTimeout = false;
    },
    typing = function () {
        if (is_connect && !waitTyping) {
            transport.push({type: 'TYPING', data: 1});
            waitTyping = true;
            setTimeout(function () {
                waitTyping = false;
            }, 3000);
        }
    },
    message = function (type) {
        var content = self.api.Chat.Input.chatinput.html();
        if (content.trim().length > 0) {
            waitTyping = false;
            transport.push({type: 'MESSAGE', data: content, typeContent: type});
            self.api.Chat.Input.chatinput.focus();
            self.api.Chat.Input.chatinput.html('');
            if (!self.api.Type.typeChat) {
                widgetState.session.textMessageChat = null;
                self.api.Storage.session.set('session', widgetState.session);
            }
        }
    },
    leave = function (clientId) {
        transport.push({type: 'LEAVE', data: clientId});
    },
    transfer = function (clientId, agentId) {
        transport.push({type: 'TRANSFER', data: {client: clientId, manager: agentId}});
        self.api.Content.statePopup.css("margin-right", '9999px').stop().animate({opacity: 0}, 200);
    },
    updateClients = function () {

    },
    updateChat = function () {

    },
    updateStatus = function (type) {

        var classInNetwork;

        switch (type) {
            case '1':
            case 1:
                classInNetwork = 'online';
                break;
            case '2':
            case 2:
                classInNetwork = 'online';
                break;
            default:
                classInNetwork = 'offline';
                break;
        }

        self.api.Chat.Consultant.status.remove();
        self.api.Chat.Consultant.avatar.append('<i class="consultant__status consultant__status--' + classInNetwork + '"></i>');
        self.api.Chat.Consultant.header.html(' ' + classInNetwork);
    },
    chatInviteOpen = function(){

    },
    Client = function () {

        var locationEnter = '';
        var returnOnSite = 0;
        var referChat = "";

        if (self.api.Type.typeChat == 0) {
            locationEnter = widgetState.session.sourceEnter;
            returnOnSite = widgetState.permanent.returnCount;
            referChat = widgetState.session.sourceReferer;
        }

        //var self = this;
        var date = new Date();
        var navigator = window.navigator;
        return {
            time: {
                timestamp: date.getTime() / 1000,
                timezone: '',
                timeoffset: date.getTimezoneOffset() / 60,
                rfc: date.toISOString(),
                date: date.toISOString().split('T')[0],
                time: date.toISOString().split('T')[1],
                difference: 0
            },
            geolocation: {
                ip: null,
                continent: null,
                country: null,
                city: null
            },
            visits: [],
            history: [],
            browser: {
                appCodeName: navigator.appCodeName,
                appName: navigator.appName,
                appVersion: navigator.appVersion,
                platform: navigator.platform,
                oscpu: navigator.oscpu,
                userAgent: navigator.userAgent,
                source_enter: locationEnter,
                pathLocation: window.location.href,
                domain: window.location.hostname,
            },
            location: window.location.pathname,
            referer: referChat,
            returnOnSite: returnOnSite,
        }
    },
    sendConnect = function () {
        $.ajax({
            url: opts.apiPath + '/chat/connect',
            type: 'post',
            data: {type: 'connect', data: Client()},
            async: true,
            cache: false,
            timeout: 30000,
            dataType: 'json',
            xhrFields: {withCredentials: true},
            crossDomain: true,
            success: function (result) {
                if (result.data) {
                    if (result.data.error) {

                    } else {
                        is_connect = true;
                        client = result.data.client;
                        var manager = result.data.manager;
                        var feedbackResult = result.data.feedback;
                        if (client.is_new == 1) {
                            is_guest = false;
                        }
                        if (manager !== undefined && manager !== null) {
                            self.api.Chat.Consultant.avatar.html('<img src="' + manager.info.connect[client.site_id].site.settings.logo + '">');
                            self.api.Chat.Consultant.name.html(manager.info.connect[client.site_id].site.settings.name);
                            updateStatus(manager.online);
                        }
                        if (feedbackResult !== undefined && feedbackResult !== null) {
                            feedbackChat = feedbackResult;
                        }
                        if (client.is_block == 1) {
                            onBanAction();
                        } else {
                            chatInviteOpen();
                            transport.connect();
                        }
                    }
                }
            }
        });
    },
    checkTriger = function () {
        self.Event.on('CONNECT', onConnect);
        self.Event.on('DISCONNECT', onDisconnect);
        self.Event.on('TYPING', onTyping);
        self.Event.on('MESSAGE', onMessage);
        self.Event.on('SELECT', onSelect);
        self.Event.on('BAN', onBan);
        self.Event.on('LEAVE', onLeave);
        self.Event.on('TRANSFER', onTransfer);
        //self.Event.on('NOTE', onNote);
        self.Event.on('IDLE', onIdle);
        self.Event.on('HISTORY', onHistory);
        self.Event.on('READ', onRead);
        self.Event.on('PRESENT', onPresentClient);
        //self.Event.on('OFFLINE', onOffline);
        //self.Event.on('AWAY', onAway);
        self.Event.on('VIEW', onView);
        self.Event.on('BLACKLIST', onBlackList);
        self.Event.on('BLACKLISTHISTORY', onBlackListHistory);
        self.Event.on('UNBAN', onUnBan);
        self.Event.on('DOWNLOAD', onDownload);
        self.Event.on('PRESENTSOCIAL', onPresentSocial);
    },
    htmlUnescape = function (value) {
        var string = String(value)
            .replace(/&quot;/g, '"')
            .replace(/&lt;img/g, '<img')
            .replace(/&lt;div/g, '<div')
            .replace(/&lt;span/g, '<span')
            .replace(/&lt;a/g, '<a')
            .replace(/&lt;br/g, '<br')
            .replace(/&lt;\/a/g, '</a')
            .replace(/&lt;\/div/g, '</div')
            .replace(/&lt;\/span/g, '</span')
            .replace(/&gt;/g, '>')
            .replace(/&amp;/g, '&');

        return string;
    },
    chatFocus = function () {
        if (is_connect) {
            transport.push({type: 'READ', data: client});
        }
        document.title = title;
        clearInterval(timeOutAction['newMessageInterval']);
    },
    messageText = function (event) {

        var message;
        var status;
        var classMessage;
        var date = new Date(event.created_at);


        if (statusMessage == 'read') {
            status = ''
        }
        if (statusMessage == 'unread') {
            status = ''
        }

        message = '<div class="chat-text__wrap-message">';

        if (event.from.manager_id !== null) {
            classMessage = 'messOperator';
        } else {
            classMessage = 'messUsers';
        }

        if (event.data !== null && event.data != '' && event.data.indexOf("attachment") !== -1) {
            classMessage += ' mess--attachment box-block box-inline-wrap';
        }

        message += '<div class="mess ' + classMessage + '"><div class="messText">' + htmlUnescape(event.data) + '</div><div class="mess__time text-small">' + ('0' + (date.getHours())).slice(-2) + ':' + ('0' + (date.getMinutes())).slice(-2) + '</div></div>';

        message += '</div>';

        return message;
    },
    inputChatWidget = function (event) {

    },
    smileFileShow = function () {
        clearTimeout(timeOutAction['hideChatFile']);
        self.elWidget.find('.chat-smile').hide();
        self.elWidget.find('.chat-file').show();
    },
    smileFileHide = function () {
        timeOutAction['hideChatFile'] = setTimeout(function () {
            self.elWidget.find('.chat-file').hide();
        }, 300);
    },
    historyShow = function (event) {

    },
    answerPhoneStart = function (event) {

    },
    answerPhoneStop = function (event) {

    },
    onBlackList = function (event) {

    },
    onBlackListHistory = function (event) {

    },
    onUnBan = function (event) {

    },
    addChatFile = function (event) {

        if(event.originalEvent.target.files[0] !== undefined){
            var http = new XMLHttpRequest();
            var form = new FormData();
            form.append('chatfile', event.originalEvent.target.files[0]);
            http.addEventListener("load", chatUploadResponse);
            http.addEventListener("error", chatUploadResponseError);
            http.upload.addEventListener("progress", chatLoadFileResponse);
            http.open('POST', opts.apiPath + '/chat/upload');
            http.send(form);
        }
    },
    chatUploadResponseError = function () {
        self.api.Chat.Content.chatText.find('.messFiles').find('.messText').html(' / .     : jpeg,png,gif,pdf,doc,docx,xls,rar,zip,xlsx.   2.');
        self.api.Chat.Content.chatText.find('.messFiles').removeClass('messFiles');
        self.api.Chat.Content.chatText.find('.file-bar').remove();
    },
    chatUploadResponse = function () {
        try {
            var response = $.parseJSON(this.response);

            if (response.data.status == 'success') {
                self.api.Chat.Content.chatText.find('.messFiles').remove();

                var path = opts.cdnPath + '/' + response.data.path + '/' + response.data.name;
                var messageText = '';
                var fileSize = '';

                if (response.data.size < 1000) {
                    fileSize = response.data.size + ' ';
                }
                else if (response.data.size < 1000 * 1000) {
                    fileSize = Math.round((response.data.size / 1000)) + ' K';
                } else {
                    fileSize = Math.round((response.data.size / (1000 * 1000))) + ' ';
                }

                if (response.data.type == 'image') {
                    messageText = '<a href="' + path + '" target="_blank" data-type="attachment" class="box-block box-inline-wrap message-hide">';
                    messageText += '<span class="box-inline box-inline--bottom">';
                    messageText += '<img src="' + path + '" class="file-image" alt="">';
                    messageText += '</span>';
                    messageText += '<span class="box-inline box-inline--bottom file-info">';
                    messageText += '<span class="file-data animation">' + response.data.ext + ' <br> ' + fileSize + '</span>';
                    messageText += '</span>';
                    messageText += '</a>';
                }
                if (response.data.type == 'file') {
                    messageText = '<a href="' + path + '" download data-type="attachment" class="box-inline-wrap animation message-hide attachment-file">';
                    messageText += '<span class="box-inline box-inline--center vertical-center-wrap relative">';
                    messageText += '<img src="' + opts.cdnPath + '/plugins/chat/static/img/attachment.svg" class="animation vertical-center file-attachment" alt="">';
                    messageText += '<img src="' + opts.cdnPath + '/plugins/chat/static/img/download.svg" class="animation vertical-center file-download" alt="">';
                    messageText += '</span>';
                    messageText += '<span class="box-inline box-inline--center file-info">';
                    messageText += '<span class="file-title">' + response.data.origin + '</span>';
                    messageText += '<span class="file-data animation">' + response.data.ext + ', ' + fileSize + '</span>';
                    messageText += '</span>';
                    messageText += '</a>';
                }
                self.api.Chat.Input.chatinput.html(messageText);
                if (is_connect) {
                    message('attachment');
                } else {
                    sendConnect();
                }
                message('attachment');
            } else {
                self.api.Chat.Content.chatText.find('.messFiles').find('.messText').html(response.data.status_message);
                self.api.Chat.Content.chatText.find('.messFiles').removeClass('messFiles');
                self.api.Chat.Content.chatText.find('.file-bar').remove();
            }

        } catch (e) {
            chatUploadResponseError();
        }



    },
    chatLoadFileResponse = function (event) {

        var percentComplete = event.loaded / event.total * 100;
        self.api.Chat.Content.chatText.find('.messFiles').remove();

        var messageUpload = '';
        messageUpload += '<div class="chat-text__wrap-message messFiles">';
        messageUpload += '<div class="mess messOperator file-loading">';
        messageUpload += '<div class="flex flex--space-between flex--align-center messText">';
        messageUpload += '<p> </p>';
        messageUpload += '</div>';;
        messageUpload += '<div class="file-bar">';
        messageUpload += '<span class="file-bar__inner" style="width: ' + percentComplete + '%"><span class="file-bar__animation"></span></span>';
        messageUpload += '</div>';
        messageUpload += '</div>';
        messageUpload += '</div>';

        self.api.Chat.Content.chatText.append(messageUpload);

        if (self.api.Type.typeChat) {
            self.api.Content.chatList.data('jsp').reinitialise();
            self.api.Content.chatList.data('jsp').scrollToBottom();
        } else {
            onScrollElement(self.api.Chat.Content.chatText[0].scrollHeight);
        }

    },
    nl2br = function (str, is_xhtml) {
        var breakTag = (is_xhtml || typeof is_xhtml === 'undefined') ? '<br />' : '<br>';
        return (str + '').replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g, '$1' + breakTag + '$2');
    },
    onSmileChatChange = function () {
        var element = $(this).find(".smiles__smile").attr("class");
        self.api.Chat.Input.chatinput.focus();
        pasteHtmlAtCaret('<span contenteditable="false" class="' + element + '"></span>');

        //$(this).parents(".pozvonim-chat__footer").find(".user-message__label").addClass("user-message__label--hidden");
        //$(this).parents(".pozvonim-chat__footer").find(".form__send-message").addClass("form__send-message--visible");

        chatFull();
        return false;
    },
    onSmileChatActive = function () {
        self.api.Chat.Input.chatinput.focus();
        self.api.Chat.body.toggleClass(self.api.Chat.Class.smile.smileActiv + "--on");
        chatFull();
        return false;
    },
    chatFull = function () {

    },
    pasteHtmlAtCaret = function (html, selectPastedContent) {
        var sel, range, selection;

        if (self.api.Type.typeChat) {
            selection = document.getSelection()
        } else {
            selection = iframeDocumentChat.contentDocument.getSelection()
        }

        if (selection) {
            // IE9 and non-IE
            sel = selection;
            if (sel.getRangeAt && sel.rangeCount) {
                range = sel.getRangeAt(0);
                range.deleteContents();
                // Range.createContextualFragment() would be useful here but is
                // only relatively recently standardized and is not supported in
                // some browsers (IE9, for one)
                var el = document.createElement("div");
                el.innerHTML = html;
                var frag = document.createDocumentFragment(), node, lastNode;
                while (node = el.firstChild) {
                    lastNode = frag.appendChild(node);
                }
                var firstNode = frag.firstChild;
                range.insertNode(frag);
                // Preserve the selection
                if (lastNode) {
                    range = range.cloneRange();
                    range.setStartAfter(lastNode);
                    if (selectPastedContent) {
                        range.setStartBefore(firstNode);
                    } else {
                        range.collapse(true);
                    }
                    sel.removeAllRanges();
                    sel.addRange(range);
                }
            }
        } else if ((sel = document.selection) && sel.type != "Control") {
            // IE < 9
            var originalRange = sel.createRange();
            originalRange.collapse(true);
            sel.createRange().pasteHTML(html);
            if (selectPastedContent) {
                range = sel.createRange();
                range.setEndPoint("StartToStart", originalRange);
                range.select();
            }
        }
    },
    insertHTML = function (html) {

        try {
            var selection;

            if (self.api.Type.typeChat) {
                selection = document.getSelection()
            } else {
                selection = iframeDocument.contentDocument.getSelection()
            }
            var range = selection.getRangeAt(0),
                temp = document.createElement('div'),
                insertion = document.createDocumentFragment();

            temp.innerHTML = html;

            while (temp.firstChild) {
                insertion.appendChild(temp.firstChild);
            }

            var point = insertion.firstChild;

            range.deleteContents();
            range.insertNode(insertion);
        } catch (z) {
            try {
                iframeDocument.selection.createRange().pasteHTML(html);
            } catch (z) {
            }
        }
    }
    ;

PozvonimcomWidgetPrototype.prototype.Event = (function () {
    var self = this;
    var listeners = {};
    return {
        listeners: listeners,
        trigger: function (type, event) {

            var key, list = listeners[type] || [];
            for (key = 0; key < list.length; key++) {
                (list[key]).apply(self, [event]);
            }
        },
        on: function (type, callback) {
            if (!listeners[type]) {
                listeners[type] = [];
            }
            listeners[type].push(callback);
        }
    };
})();

self.api.Chat.Input.chatinput.on('keypress', function (event) {
    if (event.which !== 13) {
        typing();
    }
    if (event.which === 13) {
        event.preventDefault();
        if (is_connect) {
            message('text');
        } else {
            sendConnect();
        }
    }
});

this.api.Chat.Input.chatinput.on("focus", chatFocus);
self.api.Chat.body.on('change', 'input.chat-file-upload', addChatFile);
// Smiles
self.api.Chat.body.on("click", "." + self.api.Chat.Class.smile.smileActiv, onSmileChatActive);
self.api.Chat.body.on("click", "." + self.api.Chat.Class.smile.smileElement, onSmileChatChange);


            var openChat = false;
var widthOpenChat = 320, heightOpenChat = 30;
var textWelcome = [],
    countTextWelcome = 0,
    elementTextWelcome = 0;
var is_guest = true, isMessage = false, isFullForm = true;
var positionChatDefaul = {};
var classPanel = '';

widgetState.permanent = $.extend(widgetState.permanent, this.api.Storage.storage.get('permanent'));
widgetState.session = $.extend(widgetState.session, this.api.Storage.session.get('session'));

var voteChatShow = function () {

    },
    onFeedbackChat = function (type) {
        if (widgetState.permanent.showFeedback && feedbackChat !== null) {
            if (feedbackChat['enable'] && feedbackChat['enable_chat'] == 1) {
                var savePermanent = 0;

                var messageText = '';
                if (feedbackChat['chat_algorithm_onmessage'] == 1 && managerMessageCount >= feedbackChat['chat_message_count'] && type == 'message') {
                    messageText += feedbackChat['chat_algorithm_onmessage_interview_message'];
                    savePermanent = 1;
                }

                if (feedbackChat['chat_algorithm_onexit'] == 1 && type == 'leave') {
                    messageText += feedbackChat['chat_algorithm_onexit_interview_message'];
                    savePermanent = 1;
                }

                if (savePermanent) {
                    if (feedbackChat.feedback_path) {
                        messageText += '<div class="button animation mess--button"><a href="' + feedbackChat.feedback_path + '?chat_id=' + sessionId + '" target="_blank"><button class="button__el button__el--native button__el--small text-replacement__activation showFormVote"> </button></a></a></div>';
                        var message = messageRobot(messageText);
                        self.api.Chat.Content.chatText.append(message);
                        onScrollElement(self.api.Chat.Content.chatText[0].scrollHeight);
                        //self.api.Chat.Content.chatText.find('.showFormVote').on('click', voteChatShow);
                        widgetState.permanent.showFeedback = false;
                        self.api.Storage.storage.set('permanent', widgetState.permanent);
                    }
                }
            }
        }
    },
    showChatWidget = function () {
        /*self.elWidget.find('.call_widget_view').addClass('pozvonim-visible-show');
         self.elWidget.find('.message_widget_view').addClass('pozvonim-visible-show');
         self.elWidget.find('.chat_widget_view').removeClass('pozvonim-visible-show');
         $(this).parents().find('ul.pozvonim-com-x-top-menu>li').removeClass('active');
         $(this).parent().addClass('active');
         return false;*/
    },
    inputChatWidget = function (event) {
        self.api.Chat.body.removeClass(self.api.Chat.Class.smile.smileActiv + "--on");
        if ($(this).text() == 0) {
            $(this).parents(".user-message").find(".user-message__label").removeClass("user-message__label--hidden");
            $(this).parents(".user-message").find(".form__send-message").removeClass("form__send-message--visible");
            widgetState.session.textMessageChat = null;
        } else {
            $(this).parents(".user-message").find(".user-message__label").addClass("user-message__label--hidden");
            $(this).parents(".user-message").find(".form__send-message").addClass("form__send-message--visible");
            widgetState.session.textMessageChat = $(this).text();
        }
        self.api.Storage.session.set('session', widgetState.session);
        chatFull();
    },
    authConnect = function () {
        $.ajax({
            url: opts.apiPath + '/chat/user',
            type: 'post',
            data: {type: 'auth', data: Client()},
            async: true,
            cache: false,
            timeout: 30000,
            dataType: 'json',
            xhrFields: {withCredentials: true},
            crossDomain: true,
            success: function (result) {
                if (result.data) {
                    if (result.data.error) {

                    } else {
                        if (result.data.client !== null) {
                            sendConnect();
                        }else{
                            chatInviteOpen();
                        }
                    }
                }
            }
        });
    },
    answerPhoneStart = function (event) {
        answerPhoneStop(event);

        var inPlace = event.from.managerOnline;

        if (inPlace == 'offline') {
            chatNotificationSend('manager_offline');
        }

        if (opts.chat.answerphone[inPlace].on == 1) {
            timeOutAction['answerRobot'] = setTimeout(function () {
                var text = opts.chat.answerphone[inPlace].message;

                if (opts.chat.answerphone[inPlace].action == 'text-form' || opts.chat.answerphone[inPlace].action == 'text') {

                    for (var i = 0; i < text.length; i++) {
                        var messageText = text[i];
                        if (opts.chat.answerphone[inPlace].action == 'text-form') {
                            if (isMessage) messageText += '<div class="button animation mess--button"><button class="button__el button__el--native button__el--small text-replacement__activation chatMessageshow"> </button></div>';
                        }
                        var message = messageRobot(messageText);
                        self.api.Chat.Content.chatText.append(message);
                    }
                    onScrollElement(self.api.Chat.Content.chatText[0].scrollHeight);
                    self.api.Chat.Content.chatText.find('.chatMessageshow').on('click', chatSendMessage);
                }

                if (opts.chat.answerphone[inPlace].action == 'form' || opts.chat.answerphone[inPlace].action == 'text-form') {
                    self.api.Chat.Message.info.html('');
                    for (var i = 0; i < text.length; i++) {
                        self.api.Chat.Message.info.append(text[i]);
                    }
                }

                if (opts.chat.answerphone[inPlace].action == 'form' && isMessage) {
                    chatSendMessage();
                }

                if (inPlace == 'online') {
                    chatNotificationSend('client_no_answer');
                    transport.push({type: 'ANSWERPHONE_ONLINE', data: client});
                }

                transport.push({type: 'ANSWERPHONE', data: client});

            }, 1000 * 60 * opts.chat.answerphone[inPlace].time_limit);
        }
    },
    answerPhoneStop = function (event) {
        clearTimeout(timeOutAction['answerRobot']);
    },
    chatSendMessage = function () {
        self.api.Chat.footer.hide();
        self.api.Chat.Content.chatTextBlock.hide();
        self.api.Chat.Message.body.show();
        return false;
    },
    messageChatSubmit = function (event) {
        event.preventDefault();
        event.stopPropagation();

        var number = '';

        $.each(self.api.Chat.Message.body.find('input,textarea'), function (index, object) {

            if ($.trim($(this).val()) == '' && $(this).parent().find('.required').length) {
                $(this).parent().addClass('form-field--error');
            } else {
                $(this).parent().removeClass('form-field--error');

                if ($(this).attr("data-attr") == 'phone' && $.trim($(this).val()) != '') {

                    number = $(this).val().replace(/[^0-9]/g, '') || '';
                    var rePhone = new RegExp('^[0-9]{7,20}$');

                    if (!number.match(rePhone)) {
                        $(this).parent().addClass('form-field--error');
                    }
                }

                if ($(this).attr("data-attr") == 'email' && $.trim($(this).val()) != '') {
                    var reEmail = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                    if (!reEmail.test($(this).val())) {
                        $(this).parent().addClass('form-field--error');
                    }
                }
            }
        });

        if (self.api.Chat.Message.body.find('.form-field--error').length) {
            return;
        }

        self.api.Chat.Message.body.find('input,textarea,button').each(function () {
            $(this).attr('disabled', true);
            $(this).addClass('disabled');
        });
        self.api.Chat.Message.form.button.html("...");

        var http = new XMLHttpRequest();
        var form = new FormData();

        form.append('email-text', self.api.Chat.Message.form.text.val());
        form.append('email-email', self.api.Chat.Message.form.email.val());
        form.append('email-type', 'chat');
        form.append('email-phone', number);
        form.append('source_enter', widgetState.session.sourceEnter);
        http.addEventListener("load", messageChatResponse);
        http.open('POST', opts.apiPath + '/mail');
        http.send(form);

    },
    messageChatResponse = function () {
        if (this.status == 202) {
            self.api.Chat.Message.body.hide();
            self.api.Chat.Message.bodyFinish.show();
            if (self.api.Chat.Message.form.email.val() != '') {
                self.api.Chat.Message.emailBlock.html('      e-mail <span class="text-bold">' + self.api.Chat.Message.form.email.val() + '</span>');
            } else if (self.api.Chat.Message.form.phone.val() != '') {
                self.api.Chat.Message.emailBlock.html('        <span class="text-bold">' + self.api.Chat.Message.form.phone.val() + '</span>');
            }
        } else {
            self.api.Chat.Message.body.find('input,textarea,button').each(function () {
                $(this).attr('disabled', false);
                $(this).removeClass('disabled');
            });
            self.api.Chat.Message.form.button.html("");
        }
    },
    onPresentSocial = function (event) {
        console.log(event);
        if(self.api.Chat.body.find(".short-form-username-chat").length){
            self.api.Chat.body.find(".short-form-username-chat").val(event.data.username);
            self.api.Chat.body.find(".welcome-user--save").addClass("form__send-message--visible");
        }

        if(self.api.Chat.body.find(".full-form-username-chat").length){
            self.api.Chat.body.find(".full-form-username-chat").val(event.data.username);
        }

        if(self.api.Chat.body.find(".full-form-email-chat").length){
            self.api.Chat.body.find(".full-form-email-chat").val(event.data.email);
        }

        //console.log(self.api.Chat.body.find(".short-form-username-chat").length);
        //self.api.Chat.body.find(".form-field__input--send-message").val(event.data.username);
    },
    presentChatSubmit = function (event) {

        event.preventDefault();
        event.stopPropagation();

        var number = '';

        $.each(self.api.Chat.Present.body.find('input'), function (index, object) {

            if ($.trim($(this).val()) == '' && $(this).parent().find('.required').length) {
                $(this).parent().addClass('form-field--error');
            } else {
                $(this).parent().removeClass('form-field--error');

                if ($(this).attr("data-attr") == 'phone' && $.trim($(this).val()) != '') {

                    number = $(this).val().replace(/[^0-9]/g, '') || '';
                    var rePhone = new RegExp('^[0-9]{7,29}$');

                    if (!number.match(rePhone)) {
                        $(this).parent().addClass('form-field--error');
                    }
                }

                if ($(this).attr("data-attr") == 'email' && $.trim($(this).val()) != '') {
                    var reEmail = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                    if (!reEmail.test($(this).val())) {
                        $(this).parent().addClass('form-field--error');
                    }
                }
            }
        });

        if (self.api.Chat.Present.body.find('.form-field--error').length) {
            return;
        }

        transport.push({type: 'PRESENT', data: {client: client, data: {name: self.api.Chat.Present.form.name.val(), email: self.api.Chat.Present.form.email.val(), phone: number}}});

        return false;

    },
    presentChatCancel = function () {
        self.api.Chat.footer.show();
        self.api.Chat.Content.chatTextBlock.show();
        self.api.Chat.Consultant.body.show();
        self.api.Chat.Consultant.avatar.show();
        self.api.Chat.Present.body.hide();
    },
    presentChatShow = function () {
        self.api.Chat.footer.hide();
        self.api.Chat.Content.chatTextBlock.hide();
        self.api.Chat.Consultant.body.hide();
        self.api.Chat.Consultant.avatar.hide();
        self.api.Chat.Present.body.show();
    },
    presentChatShowShort = function () {
        self.api.Chat.body.find('.blockforpresent').addClass("box-none");
        self.api.Chat.body.find('.showFormShort').removeClass("box-none");

        self.api.Chat.body.find(".form-field__input--send-message").keyup(function () {
            if ($(this).val() == 0) {
                $(this).parents(".form-field").find(".form__send-message").removeClass("form__send-message--visible");
            } else {
                $(this).parents(".form-field").find(".form__send-message").addClass("form__send-message--visible");
            }
        });
        self.api.Chat.body.find(".welcome-user--save").click(function () {
            var name = $(this).parents(".text-replacement").find(".form-field__input").val();
            if ($.trim(name) != '') {
                var message = '<div class="welcome-user"> ,</div>';
                message += '<div class="welcome-user"><span class="text-blue welcome-user__name">' + name + '</span>!</div>';
                $(this).parents(".text-replacement").html(message);
                transport.push({type: 'PRESENT', data: {client: client, data: {name: name, email: '', phone: ''}}});
            }
            return false;
        });
        return false;
    },
    onPresent = function () {
        if (chatSettings.present.on && is_guest) {
            var messageText = '<div class="text-replacement">';
            messageText += chatSettings.present.present_message;
            messageText += '<div class="button animation mess--button blockforpresent"><button class="button__el button__el--native button__el--small text-replacement__activation chatPresentShow">' + chatSettings.present.present_button + '</button></div>';

            if (!isFullForm) {
                messageText += '<div class="form-field mess--field-input box-none showFormShort"><input type="text" class="form-field__input form-field__input--send-message  form-field__focus form-field__input--small short-form-username-chat" placeholder="  "><a class="form__send-message welcome-user--save"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="13" viewBox="0 0 14 13"><path fill="#77b7e4" fill-rule="evenodd" d="M0 13l14-6.5L0 0v4.333L8.105 6.5 0 8.667V13z"/></svg></a></div>';
                messageText += '<div class="form-field-social box-none showFormShort"><span>  </span> <div class="vk-settings-present-chat"></div> <div class="fb-settings-present-chat"></div></div>';
                messageText += '';
            }

            messageText += '</div>';

            var message = messageRobot(messageText);

            self.api.Chat.Content.chatText.append(message);
            onScrollElement(self.api.Chat.Content.chatText[0].scrollHeight);

            if (isFullForm) {
                self.api.Chat.Content.chatText.find('.chatPresentShow').on('click', presentChatShow);
            } else {
                self.api.Chat.Content.chatText.find('.chatPresentShow').on('click', presentChatShowShort);
            }

            self.api.Chat.body.find('.vk-settings-present-chat').on('click', presentChatVK);
            self.api.Chat.body.find('.fb-settings-present-chat').on('click', presentChatFB);

            self.api.Chat.Present.robot.info.append(chatSettings.present.present_message);
            self.api.Chat.Present.robot.logo.append('<img class="form-info__icon-img" src="' + opts.cdnPath + chatRobot.logo + '">');
            self.api.Chat.Present.robot.name.append(chatRobot.name);

            is_guest = false;
        }
    },
    presentChatFB = function(){
        var swidth=675;
        var sheight=380;
        var left=(screen.width-swidth)/2;
        var top=(screen.height-sheight)/4;
        open(opts.apiPath+'/chat/auth_fb/'+ client.id,"publish","width="+swidth+",height="+sheight+", top="+top+", left="+left+",resizable=yes,scrollbars=yes,status=yes");
    },
    presentChatVK = function(){
        var swidth=675;
        var sheight=380;
        var left=(screen.width-swidth)/2;
        var top=(screen.height-sheight)/4;
        open(opts.apiPath+'/chat/auth_vk/'+ client.id,"publish","width="+swidth+",height="+sheight+", top="+top+", left="+left+",resizable=yes,scrollbars=yes,status=yes");
    },
    updateChat = function (event) {
        client = event.data;
        self.api.Chat.Content.chatText.find('.blockforpresent').html('<i> , ' + client.name + '!</i>');
        presentChatCancel();
    },
    chatNotificationSend = function (type) {
        if (widgetState.session.sendNotification == 0) {
            $.ajax({
                url: opts.apiPath + '/chat/notification',
                type: 'post',
                data: {type: type},
                async: true,
                cache: false,
                timeout: 30000,
                dataType: 'json',
                xhrFields: {withCredentials: true},
                crossDomain: true,
                success: function (result) {

                    widgetState.session.sendNotification++;
                    self.api.Storage.session.set('session', widgetState.session);
                }
            });
        }
    },

    chatInit = function () {
        chatRobot = opts.chat.robot;
        chatInvite = opts.chat.invite;
        chatSettings = opts.chat.settings;
        chatButton = opts.chat.button;

        if (chatSettings !== null) {
            buttonSetSettings();

            if (chatSettings.present.on) {
                var countIform = 0;

                if (chatSettings.present.name.show) {
                    self.api.Chat.Present.form.name.parent().show();

                    if (chatSettings.present.name.require) {
                        self.api.Chat.Present.form.name.addClass('required');
                    }

                    countIform++;
                }

                if (chatSettings.present.phone.show) {
                    self.api.Chat.Present.form.phone.parent().show();

                    if (chatSettings.present.phone.require) {
                        self.api.Chat.Present.form.phone.addClass('required');
                    }

                    countIform++;
                }

                if (chatSettings.present.email.show) {
                    self.api.Chat.Present.form.email.parent().show();

                    if (chatSettings.present.email.require) {
                        self.api.Chat.Present.form.email.addClass('required');
                    }

                    countIform++;
                }

                if (countIform == 1) {
                    isFullForm = false;
                } else {
                    self.api.Chat.Present.form.button.on("click", presentChatSubmit);
                    self.api.Chat.Present.form.cancel.on("click", presentChatCancel);
                }
            }

            if (opts.chat.email.is_enable == 1) {
                if (opts.chat.email.send_email) {
                    self.api.Chat.Message.form.email.parent().show();

                    if (opts.chat.email.send_email_required) {
                        self.api.Chat.Message.form.email.addClass('required');
                    }
                }

                if (opts.chat.email.send_phone) {
                    self.api.Chat.Message.form.phone.parent().show();

                    if (opts.chat.email.send_phone_required) {
                        self.api.Chat.Message.form.phone.addClass('required');
                    }
                }

                self.api.Chat.Message.form.button.on("click", messageChatSubmit);

                isMessage = true;
            }

            if (chatButton.logo == 0) {
                self.api.Chat.Consultant.avatar.html('<img src="' + opts.cdnPath + chatButton.logo_user + '">');
            } else {
                self.api.Chat.Consultant.avatar.html(chatButton.logosvg[chatButton.logo]);
            }

            self.api.Chat.Consultant.name.html(chatRobot.name);

            if (opts.chat.button.place.position.class == 'CHAT-RANDOM-POSITION') {
                var wH = $(window).height()/2;
                var wW = $(window).width()/2;

                var pTop = $(window).height()*opts.chat.button.place.position.top/100;
                var pLeft = $(window).width()*opts.chat.button.place.position.left/100;

                var positionRandomButton = '';

                if(wH<pTop && wW<pLeft){
                    positionRandomButton = 'bottom-right';
                }

                if(wH>pTop && wW<pLeft){
                    positionRandomButton = 'top-right';
                }

                if(wH<pTop && wW>=pLeft){
                    positionRandomButton = 'bottom-left';
                }

                if(wH>pTop && wW>=pLeft){
                    positionRandomButton = 'top-left';
                }

                self.api.Chat.body.attr("data-type-random-block", positionRandomButton);
                self.api.Chat.blockForIframe.attr("data-type-random-block", positionRandomButton);
            }

            updateStatus(1);

            checkTriger();

            authConnect();
            self.api.Chat.body.css('color','#FFF');
            setTimeout(function () {
                self.api.Chat.body.removeAttr('style');
                self.api.Chat.body.addClass(self.api.Chat.Class.animation.chatHidden);
                self.api.Chat.blockForIframe.show();
                iframeChatResize('minify');
                onResize();
            }, 1500);
        }
    },

    chatInviteOpen = function () {
        //console.log(widgetState.session.showInvite);
        if (chatInvite.on == 1 && widgetState.session.showInvite == 0 && !opts.is_mobile) {
            setTimeout(function () {
                widgetState.session.showInvite++;
                self.api.Storage.session.set('session', widgetState.session);

                textWelcome = chatInvite.message;
                countTextWelcome = textWelcome.length;

                if (chatInvite.action == 'close') {

                    iframeChatResize('invite');

                    for (var i = 0; i < countTextWelcome; i++) {
                        var message = messageRobot(textWelcome[i]);
                        self.api.Chat.Content.chatText.append(message);
                    }
                    setTimeout(function () {
                        self.api.Chat.body.find("." + self.api.Chat.Class.welcome.welcomeChat).addClass(self.api.Chat.Class.welcome.welcomeChat + "--visible");
                        Welcome('panel');
                    }, 3000);
                }
                if (chatInvite.action == 'open') {
                    setTimeout(function () {
                        onOpenChat();
                        Welcome('chat');
                    }, 3000);
                }
            }, 2000);
        }
    },
    Welcome = function (type) {
        if (elementTextWelcome < countTextWelcome) {
            if (type == 'panel') {
                WelcomeTextPanel();
            }
            if (type == 'chat') {
                self.api.Chat.Element.type.show();
                self.api.Chat.Element.type.find('span').html(chatRobot.name + '  ...');
                WelcomeTextChat();
            }
        } else {
            if (type == 'panel') {
                self.api.Chat.Element.typeWelcome.hide();
            }
            if (type == 'chat') {
                self.api.Chat.Element.type.hide();
            }
        }
    },
    WelcomeTextPanel = function () {
        setTimeout(function () {
			var p = self.api.Chat.body.find("." + self.api.Chat.Class.welcome.selector).find('p:visible');

			if (p.length === 3) {
				p.first().hide();
			}

            self.api.Chat.body.find("." + self.api.Chat.Class.welcome.selector).append('<p class="fadeIn">' + textWelcome[elementTextWelcome] + "</p>");
            elementTextWelcome += 1;
            Welcome('panel');
        }, 2700);
    },
    WelcomeTextChat = function () {
        setTimeout(function () {
            var message = messageRobot(textWelcome[elementTextWelcome]);
            self.api.Chat.Content.chatText.append(message);
            elementTextWelcome += 1;
            onScrollElement(self.api.Chat.Content.chatText[0].scrollHeight);
            Welcome('chat');
        }, 2700);
    },
    messageRobot = function (text) {
        var message = '';

        message += '<div class="chat-text__wrap-message">';
        message += '<div class="mess mess--full-width messOperator messOperator--avatar flex flex--content-start">';
        message += '<div class="messUser">';
        message += '<img src="' + opts.cdnPath + chatRobot.logo + '" alt="">';
        message += '</div>';
        message += '<div class="messText">';
        message += '<p class="text-bold">' + chatRobot.name + '</p>';
        message += '<p>' + htmlUnescape(text) + '</p>';
        message += '</div>';
        message += '</div>';
        message += '</div>';

        return message;
    },
    /*********************** BLOCk FROM NEW CSS/JS ********************/
    onScrollElement = function (delta) {
        self.api.Chat.Content.chatInnerBlockText.animate({
            scrollTop: self.api.Chat.Content.chatInnerBlockText.scrollTop() + delta + "px"
        }, 100);
    },
    onScrollChat = function (e) {
        var scrollTo = null;
        if (e.type == "mousewheel") {
            scrollTo = e.originalEvent.wheelDelta * -1;
        } else if (e.type == "DOMMouseScroll") {
            scrollTo = 40 * e.originalEvent.detail;
        }
        if (scrollTo) {
            e.preventDefault();
            $(this).scrollTop(scrollTo + $(this).scrollTop());
        }
    },
    focusIn = function () {
        $(this).parents(".form-field").addClass("form-field--focus");
    },
    focusOut = function () {
        $(this).parents(".form-field").removeClass("form-field--focus");
    },
    scrollEnter = function () {
        $(this).prev().addClass("custom-scroll--hover");
    },
    scrollLeave = function () {
        $(this).prev().removeClass("custom-scroll--hover");
    },
    onScrollTrack = function (e) {
        var yPos = e.pageY - $(this).offset().top;
        var barTop = self.api.Chat.Element.scrollBar.position().top;
        var h = self.api.Chat.Element.scroll.height();
        onScrollElement(yPos < barTop ? -h : h);
    },
    chatFull = function () {

        var height = self.api.Chat.body.height(),
            heightHeader = self.api.Chat.Element.header.height(),
            heightConsultant = self.api.Chat.Consultant.body.height(),
            heightTyping = self.api.Chat.Element.type.height(),
            heightUserMessage = self.api.Chat.footer.height(),
            widthWindows = $(window).width();

        allHeight = heightHeader + heightConsultant + heightUserMessage + 30;

        $(self.api.Chat.Content.chatTextBlock).css({
            height: height - allHeight + "px"
        });
    },
    onMinify = function () {

        self.api.Chat.body.addClass(self.api.Chat.body.attr("data-view"));
        self.api.Chat.body.addClass(self.api.Chat.body.attr("data-position"));

        self.api.Chat.body.find('.' + self.api.Chat.Class.smile.smile).hide();

        self.api.Chat.body.removeClass(self.api.Chat.Class.fullHeight);

        self.api.Chat.body.addClass(self.api.Chat.Class.animation.visibleChat);
        self.api.Chat.body.addClass(self.api.Chat.Class.animation.chatHidden);
        self.api.Chat.body.addClass(self.api.Chat.Class.animation.transition);

        var css = self.api.Chat.body.attr("style");

        //self.api.Chat.body.addClass(self.api.Chat.Class.base);

        //self.api.Chat.body.removeClass(self.api.Chat.Class.full);

        self.api.Chat.body.removeClass(self.api.Chat.Class.animation.visibleChat);

        self.api.Chat.Consultant.avatar.addClass(self.api.Chat.Class.open);
        self.api.Chat.Welcome.body.addClass(self.api.Chat.Class.open);
        self.api.Chat.body.addClass(self.api.Chat.Class.open);

        self.api.Chat.blockForIframe.removeAttr('style');

        if ((client === undefined || client.select_id === null)) {
            if (chatButton.logo != 0) {
                self.api.Chat.Consultant.avatar.html(chatButton.logosvg[chatButton.logo]);
            } else {
                self.api.Chat.Consultant.avatar.html('<img src="' + opts.cdnPath + chatButton.logo_user + '">');
            }

        }

        setTimeout(function () {
            self.api.Chat.body.removeClass(self.api.Chat.Class.animation.transition);
            iframeChatResize('minify');
        }, 100);
    },
    onOpenChat = function () {
        iframeChatResize('full');

        self.api.Chat.body.find('.' + self.api.Chat.Class.smile.smile).show();

        self.api.Chat.body.addClass(self.api.Chat.Class.animation.chatHidden);

        self.api.Chat.body.removeClass(self.api.Chat.body.attr("data-view"));
        self.api.Chat.body.removeClass(self.api.Chat.body.attr("data-position"));

        self.api.Chat.body.addClass(self.api.Chat.Class.animation.transition);


        if ((client === undefined || client.select_id === null)) {
            self.api.Chat.Consultant.avatar.html('<img src="' + opts.cdnPath + chatRobot.logo + '">');
        }

        setTimeout(function () {
            self.api.Chat.body.removeClass(self.api.Chat.Class.animation.visibleChat);
            self.api.Chat.body.removeClass(self.api.Chat.Class.animation.chatHidden);
            self.api.Chat.Consultant.avatar.removeClass(self.api.Chat.Class.open);
            self.api.Chat.Welcome.body.removeClass(self.api.Chat.Class.open);
            self.api.Chat.body.removeClass(self.api.Chat.Class.open);

            chatFull();

            self.api.Chat.body.removeClass(self.api.Chat.Class.animation.transition);

            var chatPosition = self.api.Chat.blockForIframe.position();
            var heightFull = self.api.Chat.body.height();
            var widthFull = self.api.Chat.body.width();
            var heightFreePlace = window.innerHeight - chatPosition.top;
            var widthFreePlace = window.innerWidth - chatPosition.left;

            if(!opts.is_mobile) {
                if (heightFreePlace < heightFull) {
                    var chatOffset = self.api.Chat.blockForIframe.offset();
                    self.api.Chat.blockForIframe.offset({
                        top: chatOffset.top - (heightFull - heightFreePlace),
                        left: chatOffset.left
                    });
                }
                if (widthFreePlace < widthFull) {
                    var chatOffset = self.api.Chat.blockForIframe.offset();
                    self.api.Chat.blockForIframe.offset({
                        top: chatOffset.top,
                        left: chatOffset.left - (widthFull - widthFreePlace) - 15
                    });
                }
            } else {
                onResize();
                onScroll();
            }

            if(widgetState.session.textMessageChat !== null){
                self.api.Chat.Input.chatinput.html(widgetState.session.textMessageChat);
                self.api.Chat.body.find(".user-message__label").addClass("user-message__label--hidden");
                self.api.Chat.body.find(".form__send-message").addClass("form__send-message--visible");
            }
        }, 250);
    },
    onChatSidebar = function () {

        self.api.Chat.body.toggleClass(self.api.Chat.Class.fullHeight);
        //self.api.Chat.body.toggleClass(self.api.Chat.Block.chatBlock);
        self.api.Chat.body.addClass(self.api.Chat.Class.animation.transition);

        if (self.api.Chat.body.hasClass(self.api.Chat.Class.fullHeight)) {
            iframeChatResize('full-open');
        } else {
            iframeChatResize('full');
        }

        self.api.Chat.body.css("height", heightOpenChat + "rem");

        var closeInterval = setInterval(function () {
            chatFull();
        }, 0);

        setTimeout(function () {
            clearInterval(closeInterval);
            self.api.Chat.body.removeClass(self.api.Chat.Class.animation.transition);
        }, 250);

    },
    iframeChatResize = function (type) {

        self.api.Chat.blockForIframe.attr("data-type-view", type);
        self.api.Chat.body.attr("data-type-view", type);


    },
    buttonSetSettings = function () {

        var button = chatButton;

        if (opts.chat.button.type == 0) {

            if (button.settings.wawes == 1) {
                self.api.Chat.Consultant.avatar.addClass('pulse');
            }

            self.api.Chat.body.addClass(button.size);

            if (button.settings['drag-and-drop'] == 1 && !opts.is_mobile) {
                $('#pozvonim-wrapper-chat').draggable({
                    scroll: false,
                    containment: 'window',
                    stop: function (event, ui) {}
                });
            }
        }


    },
    onScrollChatButton = function(){
        //self.api.Chat.blockForIframe.removeAttr('style');
    }
    /*********************** BLOCk FROM NEW CSS/JS ********************/
    ;

this.api.Chat.Element.chatTextButton.on('click', function (event) {
    event.preventDefault();
    if (is_connect) {
        message('text');
    } else {
        sendConnect();
    }
});
self.api.Chat.Input.chatinput.on("keyup", inputChatWidget);
self.api.Chat.Input.chatinput.empty();

/*********************** BLOCk FROM NEW CSS/JS ********************/
var myCS = self.api.Chat.Element.scroll.customScroll({
    prefix: "custom-scroll_",
    /* vertical */
    barMinHeight: 10,
    offsetTop: 0,
    offsetBottom: 0,
    /* will be added to offsetBottom in case of horizontal scroll */
    trackWidth: 4,
    /* horizontal */
    barMinWidth: 10,
    offsetLeft: 0,
    offsetRight: 0,
    /* will be added to offsetRight in case of vertical scroll */
    trackHeight: 10,
    /* each bar will have custom-scroll_bar-x or y class */
    barHtml: "<div />",
    /* both vertical or horizontal bar can be disabled */
    vertical: true,
    horizontal: false
});
// Ban scroll window
self.api.Chat.Content.chatInnerBlockText.on("mousewheel DOMMouseScroll", onScrollChat);
// Focus input
self.api.Chat.Element.inputFocus.focusin(focusIn).focusout(focusOut);

//self.api.Chat.Element.scrollTrack.on("click", onScrollTrack); //  ,   ,     

self.api.Chat.Element.scrollTrack.on("mouseenter", scrollEnter).on("mouseleave ", scrollLeave);

self.api.Chat.Content.chatInnerBlockText.scroll(function () {
    self.api.Chat.Element.scrollTrack.css("opacity", "1");
    self.api.Chat.Element.scrollBar.css("opacity", ".2");
    clearTimeout($.data(this, "scrollCheck"));
    $.data(this, "scrollCheck", setTimeout(function () {
        self.api.Chat.Element.scrollTrack.css("opacity", "0");
        self.api.Chat.Element.scrollBar.css("opacity", "0");
    }, 600));
});

// Minify chat
self.api.Chat.Element.minify.on("click", onMinify);

// Open chat
self.api.Chat.body.on("click", "." + self.api.Chat.Class.open, onOpenChat);

// Sidebar | on\off
self.api.Chat.Sidebar.right.on("click", onChatSidebar);

// Close box
self.api.Chat.body.click(function (e) {

    if ($(e.target).closest(".header__control--drop").length == 0) {
        $("." + self.api.Chat.Class.drop.dropHeader).removeClass(self.api.Chat.Class.drop.dropHeader + "--visible");
    }
    if ($(e.target).closest("." + self.api.Chat.Class.smile.smileActiv).length == 0 && $(e.target).closest("." + self.api.Chat.Class.smile.smile).length == 0 && $(e.target).closest(".emojionearea-button").length == 0) {
        self.api.Chat.body.removeClass(self.api.Chat.Class.smile.smileActiv + "--on");
        chatFull();
    }
    self.api.Chat.body.find("." + self.api.Chat.Class.welcome.welcomeChat).removeClass(self.api.Chat.Class.welcome.welcomeChat + "--visible");
});

// Header drop
self.api.Chat.body.on("click", "." + self.api.Chat.Class.drop.dropHeaderActivate, function () {
    $("." + self.api.Chat.Class.drop.dropHeader).toggleClass(self.api.Chat.Class.drop.dropHeader + "--visible");
});
self.api.Chat.body.on("click", "." + self.api.Chat.Class.drop.dropHeaderItem, function () {
    $("." + self.api.Chat.Class.drop.dropHeader).removeClass(self.api.Chat.Class.drop.dropHeader + "--visible");
});
/*********************** BLOCk FROM NEW CSS/JS ********************/

if (opts.chat.is_enable) {
    if (opts.chat.button.type == 1) {

        self.api.Chat.body.addClass('pozvonim-chat--panel');
        self.api.Chat.body.attr("data-position", 'pozvonim-chat--panel');

        if (opts.chat.button.place.position.class == 'CHAT-TOP-LEFT') {
            self.api.Chat.body.addClass('pozvonim-chat--left');
            self.api.Chat.body.attr("data-view", 'pozvonim-chat--left');
        }

        if (opts.chat.button.place.position.class == 'CHAT-BOTTOM-LEFT') {
            self.api.Chat.body.addClass('pozvonim-chat--bottom--left');
            self.api.Chat.body.attr("data-view", 'pozvonim-chat--bottom--left');
        }

        if (opts.chat.button.place.position.class == 'CHAT-TOP-RIGHT') {
            self.api.Chat.body.addClass('pozvonim-chat--right');
            self.api.Chat.body.attr("data-view", 'pozvonim-chat--right');
        }

        if (opts.chat.button.place.position.class == 'CHAT-BOTTOM-RIGHT') {
            self.api.Chat.body.addClass('pozvonim-chat--bottom');
            self.api.Chat.body.attr("data-view", 'pozvonim-chat--bottom');
        }

    } else {
        self.api.Chat.body.addClass('pozvonim-chat--base');
        self.api.Chat.body.attr("data-view", '');
        self.api.Chat.body.attr("data-position", 'pozvonim-chat--base');
    }
    chatInit();

    $window.on('scroll', onScrollChatButton);
} else {
    self.api.Chat.blockForIframe.remove();
}

$('#pozvonim-wrapper-chat').on('click', function () {
    self.api.Chat.body.find('.' + self.api.Chat.Class.open).click();
});

self.api.Chat.body.on("click", ".form__send-message", function () {
    if (is_connect) {
        message('text');
    } else {
        sendConnect();
    }
    return false;
});

self.api.Chat.body.on("click", ".messText a.attachment-file", function (){
    transport.push({type: 'DOWNLOAD', data: {filename: $(this).find('.file-title').html()}});
});

//console.log(opts);

        }

        var onTopMenu = false;

if (this.elWidget) {
    if (opts.callback.email && opts.callback.email.is_enable) {
        this.elWidget.find('a.pozvonim-com-x-top-menu-link3').parent().show();
		
        if (!opts.callback.email.send_file) {
            this.elWidget.find('.block-file-input').hide();
            self.api.Content.buttonBlock.css("margin-top", "15px");
        }
		
        if (!opts.callback.email.send_phone && !opts.callback.email.send_email) {
            if (opts.callback.window_position == 'BOTTOM_CENTER' || opts.callback.window_position == 'TOP_CENTER' || opts.callback.window_position == 'CENTER') {
                this.elWidget.find('.pozvonim-com-x-chat-textarea').css("width", 545);
            }
        }
        onTopMenu = true;
    }

    if (opts.chat.is_enable) {
        this.elWidget.find('a.pozvonim-com-x-top-menu-link2').parent().show();
        onTopMenu = true;
    }

    if (!onTopMenu) {
        this.elWidget.find('.pozvonim-com-x-top-menu').remove();
        this.elWidget.find('.message_widget_view').remove();
        this.elWidget.find('.chat_widget_view').remove();
    } else {
        this.elWidget.find('.pozvonim-com-x-top-menu').show();
        this.elWidget.find('a.pozvonim-com-x-top-menu-link1').parent().show();
    }
}

        if (this.elWidget) {	
	this.elWidget.find('a.pozvonim-com-x-top-menu-link3').on('click', showEmailWidget);
	this.elWidget.find('a.pozvonim-com-x-top-menu-link1').on('click', showCallWidget);
	this.elWidget.find('a.pozvonim-com-x-top-menu-link2').on('click', showChatWidget);
}

        if (opts.callback.is_enable) {
            widgetState.window = $.Utils.windowSize(window, document);
widgetState.scroll.top = $window.scrollTop();
widgetState.scroll.left = $window.scrollLeft();
widgetState.button.width = 0;
widgetState.button.height = 0;

if (opts.callback.buttonConfig.enable && !opts.is_mobile) {
    offset = {top: opts.callback.buttonConfig.position_y, left: opts.callback.buttonConfig.position_x, right: 'auto', bottom: 'auto'};

    if (offset.top >= 41 && offset.top <= 70) {
        widgetState.button.height = 80;
    }
    if (offset.top >= 71 && offset.top <= 100) {
        widgetState.button.height = 180;
    }
    if (offset.left >= 41 && offset.left <= 70) {
        widgetState.button.width = 80;
    }
    if (offset.left >= 71 && offset.left <= 100) {
        widgetState.button.width = 180;
    }

    widgetState.button.offsetTop = offset.top;
    widgetState.button.offsetLeft = offset.left;

    if (opts.callback.buttonConfig.size === 1) {
        widgetState.button.width = (widgetState.button.width - (widgetState.button.width > 80 ? 20 : 0)) * 1.3;
        widgetState.button.height = (widgetState.button.height - (widgetState.button.height > 80 ? 20 : 0)) * 1.3;
    }
    if (opts.callback.buttonConfig.size === 2) {
        widgetState.button.width = (widgetState.button.width - (widgetState.button.width > 80 ? 20 : 0)) * 1.5;
        widgetState.button.height = (widgetState.button.height - (widgetState.button.height > 80 ? 20 : 0)) * 1.5;
    }
    offset = {
        top: (widgetState.window.height / 100 * widgetState.button.offsetTop) - widgetState.button.height,
        left: ((widgetState.window.width / 100 * widgetState.button.offsetLeft) - widgetState.button.width)
    };
    if (offset.left !== 'auto') {
        offset.left += 'px';
    }
    this.elButton.css(offset);
}
if (true) {
    widgetState.permanent = $.extend(widgetState.permanent, this.api.Storage.storage.get('permanent'));
    widgetState.session = $.extend(widgetState.session, this.api.Storage.session.get('session'));
}
if (widgetState.permanent.enterPreviousAt === null) {
    widgetState.permanent.enterPreviousAt = enterAt;
}

if (widgetState.session.enterSessionAt === null) {
    widgetState.session.enterSessionAt = enterAt;
}
widgetState.session.enterAt = enterAt;
widgetState.session.viewPage++;
if (widgetState.session.enterAt == widgetState.session.enterSessionAt) {
    widgetState.session.sourceEnter = location;
    widgetState.session.sourceReferer = referer;
}
if (widgetState.permanent.enterPreviousAt != widgetState.session.enterSessionAt) {
    widgetState.permanent.enterPreviousAt = enterAt;
    widgetState.permanent.returnCount++;
    widgetState.isReturned = 1;
}
var elapsed = (widgetState.session.enterAt - widgetState.permanent.showPreviousAt) / 1000 / 3600;
if (elapsed < 24 && opts.callback.period === 1) {
    widgetState.isActive = false;
}
if (elapsed < 24 * 7 && opts.callback.period === 2) {
    widgetState.isActive = false;
}
if (elapsed < 24 * 30 && opts.callback.period === 3) {
    widgetState.isActive = false;
}

if (true) {
    self.api.Storage.storage.set('permanent', widgetState.permanent);
    self.api.Storage.session.set('session', widgetState.session);
}
var $link = $('a[href*="#pozvonim"]');
if ($link.size() > 0 && $link.get(0) !== undefined) {
    $link.on('click tap dblclick', Api.show);
}
if (typeof opts.callback.api_button_selector === 'string' && opts.callback.api_button_selector.length > 0) {
    $(opts.callback.api_button_selector).on('click tap dblclick', Api.show);
}
if (typeof opts.callback.api_algoritm_code === 'string' && opts.callback.api_algoritm_code.length > 0) {
    (Function(opts.callback.api_algoritm_code)).apply(self);
}
/*$link = $('.actionShow');
 if ($link.size() > 0 && $link.get(0) !== undefined) {
 $link.on('click tap dblclick', Api.show);
 }*/
$('.actionShow').on('click tap dblclick', Api.show);
$('.actionHide').on('click tap dblclick', Api.hide);
$link = this.elWidget.find('.actionShow');
if ($link.size() > 0 && $link.get(0) !== undefined) {
    $link.on('click tap dblclick', Api.show);
}
this.elWidget.find('.actionHide').on('click tap dblclick', Api.hide);
this.elWidget.find('.actionReport').on('click tap dblclick', reportSend);
self.api.Element.buttonCallAgain.on('click tap dblclick', callAgain);
this.elWidget.find('button.actionCall').on('click tap dblclick', callSend);
this.elWidget.find('form.actionCall').on('submit', callSend);
this.elWidget.find('button.actionEmail').on('click tap dblclick', mailSend);
this.elWidget.find('input.pozvonim-com-x-btn-file').on('change', addEmailFile);
this.elWidget.find('.pozvonim-com-x-chat-file div.block-file a').on('click', deleteEmailFile);
this.api.Input.emailphone.on("countrychange", changeEmailPhone);
this.api.on('call.delayed.respond',function(respond){
    var serverTime = new Date(respond.timestamp * 1000);
    var clientTime = new Date();
    var offset = this.api.Schedule.normalizeOffset((clientTime.getTime() - serverTime.getTime()) / 1000);
    var callAt = new Date(respond.call_at.date.replace(' ','T') + 'Z');
    var date = new Date(callAt.getTime() + offset * 1000);
    var weekDay = this.api.Schedule.getWeek(date.getDay());
    var text = opts.language.days[weekDay] + ', ' + date.toTimeString().substr(0,5);
    self.api.Element.delayTime.text(text);
}.bind(this));
this.api.on('call.required.delayed',function(respond){
    if (!opts.callback.mini_enable) {
        opts.callback.is_working = false;
        this.api.Content.call.find('.events').hide();
        this.api.Content.call.find('.offline').show();
        finalShow();
        self.api.Element.timer.hide();
    }
}.bind(this));

phonePrefix = this.api.Input.emailphone.val();



var activateBoxSelect='callback__box--active',mainSelector = 'callback',
    hover = '--hover',
    active = '--active',
    current = '--current',
    activate = 'data-activate',
    callbackBox = 'callback__box',
    switchBox = 'switch',
    switchItem = 'switch__item',
    ratingBox = 'rating',
    ratingItem = 'rating__item',
    ratingItemNoSelect = 'rating__item--no-select',
    fieldInput = 'field__input',
    fieldTextarea = 'field__textarea',
    fieldLabel = 'field__label',
    fieldUpload = 'field--upload',
    fieldUploadInput = 'field-upload__input',
    fieldUploadMark = 'field-upload__mark',
    fieldUploadButton = 'field-upload__button',
    fieldPhone = 'js__field-phone',
    fieldSelect = 'field__sumo-select',
    fileSize = 'field-upload__size',
    fileClear = 'field-upload__clear',
    fakeSelectActive = 'form__select',
    jsFakeSelectActive = 'js__form-select',
    fakeSelectBox = 'field--fake-select',
    fieldSelecDrop = 'field__fake-select-drop',
    fieldSelecDropList = 'field__fake-select-list',
    fieldSelecDropInput = 'field__fake-select-input',
    flagContainer = 'flag-container',
    closeWidget = 'js__close-widget',
    slidingWidget = 'callback__sliding';

var elWidget = this.elWidget;
var width = $(window).width();
if (width < 700) {
    positionFrameModible();
}
function positionFrameModible() {
    $('#callback-frame').removeAttr('class');
    $('#callback-frame').addClass('callback-frame');
};
// Add no viewport sty.e
if ($('meta[name="viewport"]').length == 0) {
    $('body').append('<link rel="stylesheet" href="'+opts.cdnPath+'/callback/static/css/onsite_no_viewport_style.css">')
    elWidget.find('body').append('<link rel="stylesheet" href="'+opts.cdnPath+'/callback/static/css/iframe_no_viewport_style.css">')
}

// Arrow select flag
elWidget.on('click', '.' + flagContainer, function () {
    elWidget.find(this).toggleClass('active');
});

elWidget.on('click', function(e) {
    if (elWidget.find(e.target).closest('.' + flagContainer).length == 0) {
        elWidget.find('.' + flagContainer).removeClass('active');
    }
});

/**
 *      ()
 */
var regionSelect = {
    $el: self.api.Input.regionFake,
    items: {},
    key: null,
    hidden: true,
    init: function() {
        var self = this;
        
        elWidget.on('click', '.'+jsFakeSelectActive, function() {
            if (self.hidden) {
                self.show();
            } else {
                self.hide();
            }
        });
        
        elWidget.on('click', '.'+fieldSelecDropList, function() {
            var $this = elWidget.find(this);
            
            self.select($this.data('key'));
            self.hide();
        });
        
        elWidget.on('click', function(e) {
            if (elWidget.find(e.target).closest('.' + fakeSelectBox).length == 0) {
                self.hide();
            }
        });
    },
    show: function() {
        this.$el.find('.'+jsFakeSelectActive).addClass(fakeSelectActive+active);
        this.$el.find('.'+fieldSelecDrop).addClass(fieldSelecDrop+active);
        this.hidden = false;
    },
    hide: function() {
        this.$el.find('.'+fieldSelecDrop).removeClass(fieldSelecDrop+active);
        this.$el.find('.'+fakeSelectActive).removeClass(fakeSelectActive+active);
        this.hidden = true;
    },
    select: function(key) {
        var item = this.items[key];
        
        if (item === undefined) {
            return false;
        }
        
        var oldKey = this.key;
        this.key = key;
        
        this.$el.find('.'+jsFakeSelectActive).text(item.name);
        this.$el.find('.'+fieldSelecDropInput).data('value', item.id).val(item.name);
        this.hide();
        
        if (oldKey !== this.key) {
            self.api.event('region.change', this);
        }
    },
    setItems: function(items, key) {
        this.items = items;
        this.key = null;
        var options =  this.$el.find('.'+fieldSelecDrop);
        
        options.empty();
        
        $.each(this.items, function(key, item) {
            options.append('<div class="field__fake-select-list" data-key="'+key+'">'+item.name+'</div>');
        });
        
        if (key === undefined) {
            var selected = null;
            
            if (opts.geo.city_name) {
                $.each(this.items, function(index, item) {
                    if (opts.geo.city_name.toLocaleLowerCase() == item.name.toLocaleLowerCase()) {
                        selected = index;
                        return false;
                    }
                });
            }
            
            if (selected === null && opts.geo.country_name) {
                $.each(this.items, function(index, item) {
                    if (opts.geo.country_name.toLocaleLowerCase() == item.name.toLocaleLowerCase()) {
                        selected = index;
                        return false;
                    }
                });
            }
            
            if (selected === null) {
                $.each(this.items, function(index, item) {
                    if (item.is_default) {
                        selected = index;
                        return false;
                    }
                });
            }
            
            if (selected === null) {
                $.each(this.items, function(index, item) {
                    selected = index;
                    return false;
                });
            }
            
            this.select(selected);
        } else {
            this.select(key);
        }
    },
    getSelected: function() {
        return this.items[this.key];
    }
};

/**
 *      
 */
var calendarInit = function(delayFree) {
    self.api.Schedule.run(delayFree);
    self.api.Input.delayed.day.empty();

    for (var scheduleDay in self.api.Schedule.weekConfig) {
        self.api.Input.delayed.day.append('<option value="' + scheduleDay + '">' + opts.language.days[scheduleDay] + '</option>');
    }

    var daySumo = self.api.Input.delayed.day[0].sumo;
    if (daySumo) {
        daySumo.reload();
    }

    self.api.Input.delayed.day.off('change').on('change', function() {
        var val = $(this).val();
        var times = self.api.Schedule.weekConfig[val];
        if (times) {
            self.api.Input.delayed.minute.empty();
            for (var realTime in times) {
                var time = times[realTime];
                self.api.Input.delayed.minute.append('<option data-time="' + time + '" value="' + realTime + '">' + time + '</option>');
            }
            var minuteSumo = self.api.Input.delayed.minute[0].sumo;
            if (minuteSumo) {
                minuteSumo.reload();
            }
        }
    }).trigger('change');
};

if (opts.callback.manager_region_enable) {
    regionSelect.init();
    self.api.on('region.change', function(regionSelect) {
        calendarInit(regionSelect.getSelected().delay_free);
    });
    
    (function() {
        var regions;
        
        if (opts.callback.is_working) {
            regions = $.grep(opts.callback.regions, function(region) {
                return region.is_working;
            });
        } else {
            regions = opts.callback.regions;
        }
        
        regionSelect.setItems(regions);
    })();
} else {
    calendarInit();
}

elWidget.find('.field__sumo-select').SumoSelect({
    forceCustomRendering: true,
    triggerChangeCombined: function () {
        // console.log(arguments);
    }
});

// Slide board
elWidget.on('click', '.' + activate, function (activateBox) {
    activateBoxSelect = elWidget.find(this).attr('data-activate');
    activateBoxSelect = self.context.getTabForActivation(activateBoxSelect);
    if (elWidget.find('.' + callbackBox + current).is('#' + activateBoxSelect)) {

    } else {
        SlideContent();

    }
});

function SlideContent(activateBox) {
    var
        thisIndex = elWidget.find('.' + callbackBox + current).attr('id'),
        thisIndex = thisIndex.replace('callback__box-', ''),
        nextIndex = elWidget.find('#' + activateBoxSelect).attr('id'),
        nextIndex = nextIndex.replace('callback__box-', ''),
        heightHeader = elWidget.find('.callback__header').outerHeight(true),
        heightLogo = elWidget.find('.callback__logo').outerHeight(true),
        offsetTop = heightHeader + heightLogo,
        heightBase = elWidget.find('#' + mainSelector).outerHeight(true);

    if (nextIndex > thisIndex) {
        elWidget.find('.' + callbackBox + current).addClass(callbackBox + active).css({'padding-top':offsetTop + 'px','height': 'calc(100% - 48px)'});
        elWidget.find('.' + callbackBox + current).addClass(callbackBox + '--next-slide')
        elWidget.find('#' + activateBoxSelect).addClass(callbackBox + '--next-slide');
    } else {
        elWidget.find('.' + callbackBox + current).addClass(callbackBox + active).css({'padding-top':offsetTop + 'px','height': 'calc(100% - 48px)'});
        elWidget.find('.' + callbackBox + current).addClass(callbackBox + '--prev-slide')
        elWidget.find('#' + activateBoxSelect).addClass(callbackBox + '--prev-slide');
    }
    elWidget.find('.' + callbackBox).removeClass(callbackBox + current);
    elWidget.find('#' + activateBoxSelect).addClass(callbackBox + current);

    var heightBase2 = elWidget.find('#' + mainSelector).outerHeight(true);
    elWidget.find('#' + mainSelector).css({'height':heightBase + 'px','overflow':'hidden'}).addClass('animate-x2');
    setTimeout(function(){
        elWidget.find('#' + mainSelector).css('height', heightBase2 + 'px');
    }, 10);
    setTimeout(function(){
        elWidget.find('.' + callbackBox).removeClass(callbackBox + active).removeAttr("style");
        elWidget.find('#' + mainSelector).removeClass('animate-x2 ');
        elWidget.find('#' + mainSelector).removeAttr("style");
        elWidget.find('.' + callbackBox).removeClass(callbackBox + '--next-slide')
        elWidget.find('.' + callbackBox).removeClass(callbackBox + '--prev-slide')
    }, 300);
    return false;

}

elWidget.on('click', '.' + switchItem, function () {
    if(elWidget.find(this).data('activate') == 'pozvonim-element-call'){
        elWidget.find(this).parent().removeClass('switch--message');
    } else{
        elWidget.find(this).parent().addClass('switch--message');
    }
    elWidget.find('.' + switchItem).addClass(switchItem + '--no-current');
    elWidget.find(this).removeClass(switchItem + '--no-current');
    elWidget.find('.' + switchItem).removeClass(switchItem + current);
    elWidget.find(this).addClass(switchItem + current);
});


// Field label
elWidget.find('.' + fieldInput + ',' + '.' + fieldTextarea).keyup(function () {
    if ($(this).val() == 0) {
        $(this).next().removeClass(fieldLabel + active);
    } else {
        $(this).next().addClass(fieldLabel + active);
    }
});

// Field upload
var count = 0;
function HideUploadButton() {
    if (count >= 3) {
        elWidget.find('.field-upload__button').addClass('hide');
        elWidget.find('.field-upload__help').addClass('hide');
    } else {

    }
}
elWidget.on('click', '.field-upload__button', function () {
    elWidget.find('.field-upload__ready').filter(':first').find('.field-upload__label').trigger('click');
});

var file_api = ( window.File && window.FileReader && window.FileList && window.Blob ) ? true : false;

elWidget.find('.field-upload__ready').find('.' + fieldUploadInput).change(function () {
	var file = this;
	var $file = $(this);
    var file_name;
	
	if (filesEvent[$file.data('id')] !== undefined) {
		delete filesEvent[$file.data('id')];
	}
	
    if (file_api && file.files[0]) {
        file_name = file.files[0].name;
	} else {
        file_name = file.val().replace("C:\\fakepath\\", '');
	}
	
    if (!file_name.length)
        return;
	
	var ext = file_name.split('.').pop().toLowerCase();
	
	if ($.inArray(ext, ['gif', 'png', 'jpg', 'jpeg', 'pdf', 'doc', 'docx', 'xls', 'xlsx']) == -1) {
		showMailValidationError();
		return;
	}
	
	var size = file.files[0]['size'];
	
	if (size > 1100000) {
		showMailValidationError();
		return;
	}
	
	filesEvent[$file.data('id')] = file.files;
	
    elWidget.find('.field-upload__ready').filter(':first').find('.' + fieldUploadMark).text(file_name);
    findSize();
    HideUploadButton();
});

function showMailValidationError()
{
	var fade = elWidget.find('.field-upload__help');
	console.log(fade);
	
	fade.addClass('hover');
	
	window.setTimeout(function () {
		fade.removeClass('hover');
	}, 2000);
}

function findSize() {
    var fileInput = elWidget.find('.' + fieldUploadInput)[0];
    var size = (fileInput.files[0].size);
    if (size > 1000000) {
        size = size / 1000000;
        size = size.toFixed(0) + ' MB';
    } else if (size > 1000) {
        size = size / 1000;
        size = size.toFixed(0) + ' KB';
    } else {
        size = size + ' B';
    }
    elWidget.find('.field-upload__ready').filter(':first').find('.' + fileSize).text(size);
    elWidget.find('.field-upload__ready').filter(':first').find('.' + fileClear).addClass(fileClear + active);
    count += 1;
    elWidget.find('.field-upload__ready').filter(':first').removeClass('field-upload__ready');
}

elWidget.on('click', '.' + fileClear, function () {
    count += -1;
	
	delete filesEvent[$(this).data('id')];
	
    // $(this).parents('.field-upload__box').find('.' + fieldUploadInput ).replaceWith( $('.' + fieldUploadInput).val('').clone( true ) );
    $(this).parents('.field-upload__box').find('.' + fileSize).text('');
    $(this).parents('.field-upload__box').find('.' + fieldUploadMark).text('');
    $(this).parents('.field-upload__box').addClass('field-upload__ready');
    $(this).removeClass(fileClear + active);
    elWidget.find('.field-upload__button').removeClass('hide');
    elWidget.find('.field-upload__help').removeClass('hide');
});
// Validate
elWidget.on('click', '.js__phone-valid', function () {
    if (elWidget.find('.' + fieldPhone).val().length < 7) {
        elWidget.find('.' + fieldPhone).addClass('error');
        elWidget.find('.tooltip').addClass('tooltip' + active);
    } else {
        elWidget.find('.' + fieldPhone).removeClass('error');
        elWidget.find('.tooltip').removeClass('tooltip' + active);
        elWidget.find('.' + fieldPhone).attr('disabled', 'disabled');
        elWidget.find('.' + fieldPhone).parents('.field__box').css('opacity', '.5');
    }
    return false;
});
elWidget.find('.' + fieldPhone).bind("change keyup input click", function () {
    if (this.value.match(/[^0-9+]/g)) {
        this.value = this.value.replace(/[^0-9+]/g, '');
    }
    if (elWidget.find('.' + fieldPhone).val().length < 7) {
    } else {
        elWidget.find('.' + fieldPhone).removeClass('error');
        elWidget.find('.tooltip').removeClass('tooltip' + active);
    }
});
elWidget.find('.' + fieldPhone).on('select keydown contextmenu click drop', function (e) {
    if ((e.keyCode == 37 && (this.selectionStart == 1 || e.ctrlKey)) || (e.keyCode == 36) ||
        (e.keyCode == 8 && this.value.length == 1) || e.type == 'drop') {
        e.preventDefault();
    }
    if (this.selectionStart == 0 &&
        this.selectionStart != this.selectionEnd) {
        this.setSelectionRange(1, this.selectionEnd);
    }
});







            if (opts.callback.mini_enable && !opts.is_mobile) {
                
    widgetState.miniButton = {
        width: 100,
        height: 100
    };

    widgetState.miniWidget = {
        width: 554,
        height: 114
    };

    widgetState.selectOpen = {
        height: 355
    };

    this.elMiniWrapper.css('width', widgetState.miniButton.width + 'px');
    this.elMiniWrapper.css('height', widgetState.miniButton.height + 'px');

    if (opts.callback.mini_button_position_x > 50) {
        this.elMiniWrapper.css('right', ((widgetState.window.width * (100 - opts.callback.mini_button_position_x)) / 100) + 'px');
    } else {
        this.elMiniWrapper.css('left', (widgetState.window.width * opts.callback.mini_button_position_x / 100) + 'px');
    }

    if (opts.callback.mini_button_position_y > 50) {
        this.elMiniWrapper.css('bottom', ((widgetState.window.height * (100 - opts.callback.mini_button_position_y)) / 100) + 'px');
    } else {
        this.elMiniWrapper.css('top', (widgetState.window.height * opts.callback.mini_button_position_y / 100) + 'px');
    }
    this.api.on('minWidget.maximize', function () {
        this.elMiniWrapper.css({
            width: widgetState.miniWidget.width + 'px',
            height: (widgetState.miniWidget.height + 1) + 'px'
        });

        setTimeout(function () {
            self.elMiniWrapper.css({
                width: widgetState.miniWidget.width + 'px',
                height: widgetState.miniWidget.height + 'px'
            });
        }, 200);
    });

    this.api.on('minWidget.minimize', function () {
        this.elMiniWrapper.css({
            width: widgetState.miniButton.width + 'px',
            height: widgetState.miniButton.height + 'px'
        });
    });

    this.api.on('minWidget.selectOpen', function () {
        this.elMiniWrapper.css({
            height: widgetState.selectOpen.height + 'px'
        });
    });

    this.api.on('minWidget.selectClose', function () {
        this.elMiniWrapper.css({
            width: widgetState.miniWidget.width + 'px',
            height: widgetState.miniWidget.height + 'px'
        });
    });
            }
        }
        onInit();


    }

    try {
        if (typeof window.PozvonimcomWidget === 'undefined') {
            wjq(document).ready(function () {
                window.PozvonimcomWidget = new PozvonimcomWidgetPrototype(window, document, wjq);
            });
        }
    } catch (e) {
        PVE('ERROR', (e ? e.toString() : 'Catched error'), {}, e);
        throw e;
    }
})(window, document);